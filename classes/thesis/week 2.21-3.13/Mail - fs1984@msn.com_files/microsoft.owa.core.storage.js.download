window.scriptsLoaded = window.scriptsLoaded || {}; window.scriptProcessStart = window.scriptProcessStart || {}; window.scriptProcessStart['microsoft.owa.core.storage.js'] = (new Date()).getTime();
Type.registerNamespace("_bs");_bs.l=function(){};_bs.l.d=function(n,t,i){i&&(t.onsuccess=function(t){var r=new _a.cc(_a.bc.b(_a.a.G),n);_a.bc.a(r,function(){_bs.s.b(i)})})};_bs.l.a=function(n,t,i){i&&(t.onsuccess=function(t){var r=new _a.cc(_a.bc.b(_a.a.G),n);_a.bc.a(r,function(){i(t)})})};_bs.l.e=function(n,t,i){i&&(t.onupgradeneeded=function(t){var r=new _a.cc(_a.bc.b(_a.a.G),n);_a.bc.a(r,function(){i(t)})})};_bs.l.b=function(n,t,i){i&&(t.onerror=function(t){var r=new _a.cc(_a.bc.b(_a.a.G),n);_a.bc.a(r,function(){_bs.s.a(t.target.error.name,i)})})};_bs.l.c=function(n,t,i){i&&(t.onerror=function(t){var r=new _a.cc(_a.bc.b(_a.a.G),n);_a.bc.a(r,function(){i(t)})})};function CoreStorageComponent(){}CoreStorageComponent.$$cctor=function(){_a.t.a().a(CoreStorageComponent)};CoreStorageComponent.prototype={b:function(n,t,i){var h=this;n.b(_bs.e,function(){return _bs.e.a()}).b(_bs.ck).a();if(!t.a()){var s=this;n.b(_e.u,function(){return new _e.u(n.a(_a.o))}).b(_e.m).a()}var c=this;n.b(_a.gc,function(){var t=new _e.x(n.a(_j.v),n.a(_a.cL),n.a(_a.bm));return _bs.bW.a(n.a(_e.m),t,n.a(_a.D))});var a=this;n.b(_a.dz,function(){return new _bs.f(256,n.a(_bs.ck),n.a(_a.gc),n.a(_a.f))}).a();var l=this;n.b(_bc.S,function(){return _bs.O.c()}).a();var u=this;n.b(_bc.F,function(){return new _bs.cm(n.a(_a.dz),_bs.f.b)});var r=this;n.b(_bc.R,function(){return new _bs.cg(n.a(_a.dz),_bs.f.b)});var f=this;n.b(_bs.bP,function(){return new _bs.bP(n.a(_a.dz))}).b(_bc.G);var o=this;n.b(_bs.bV,function(){return new _bs.bV(n.a(_a.D),n.a(_j.j))}).a();var e=this;n.b(_bs.V,function(){return new _bs.V(n.a(_bs.bP).a(_bs.f.b).e(),n.a(_j.v),n.a(_a.q),n.a(_a.y),n.a(_j.j),n.a(_a.x),n.a(_h.be),n.c(_db.bl))}).a();n.e(_bs.dv).a().b(_h.dp)},a:function(){return[new _j.y(_bs.bV,2,8),new _j.y(_bs.V,2,9)]}};_bs.bc=function(){};_bs.bc.a=function(n,t){var r=_bs.bc.b(n);var i=_bs.bc.b(t);return r+"\x01"+i};_bs.bc.b=function(n){return String.isInstanceOfType(n)?"S"+_bs.bc.d(n):Number.isInstanceOfType(n)?"N"+_bs.bc.c(n):Boolean.isInstanceOfType(n)?"B"+n.toString():null};_bs.bc.d=function(n){if(n.indexOf("\x01")>=0){_j.e.b(_a.a.G,"A composite key is being constructed with the composite key meta-character and will be stripped of the character.  Consequently, sorts and filters, will ignore that character in any comparisons. {0}",n);return n.replace("\x01","")}else return n};_bs.bc.c=function(n){n>0xfffffffffffff&&(n=0xfffffffffffff);n<-0xffffffffffff&&(n=-0xffffffffffff);if(n>=0){var i=n.toString(16);var e=13-i.length;var t=new Sys.StringBuilder;t.append("P");for(var r=0;r<e;++r)t.append("0");t.append(i);return t.toString()}else{var f=0xfffffffffffff+n+1;var u=f.toString(16);return"N"+u}};_bs.O=function(){this.d=!1};_bs.O.c=function(){_bs.O.b||(_bs.O.b=new _bs.O);return _bs.O.b};_bs.O.prototype={d:!1,b:function(){return this.d},a:function(n,t,i){_a.b.a(n,"nativeBridge");_j.e.a(_bs.O.a,"CleanAllPalAttachments start");this.g(n,t,i)&&this.h(n,t)},c:function(n,t,i,r){_a.b.a(n,"store");_a.b.a(t,"nativeBridge");_j.e.a(_bs.O.a,"AttachmentCleanupManager.StartCleanUp start");if(this.g(t,i,r)){var e=null;var o=null;var u=this,f=this;_bs.x.j(n,function(r){e=r;t.i().c(1,function(r){o=r;u.i(n,t,e,o);u.f(i);u.d=!1})},function(n){_j.e.b(_bs.O.a,"Error in DB during StartScheduledCleanup {0}",n);f.e(r,n.b());f.d=!1})}},i:function(n,t,i,r){var u;var e={};var o=[];for(u=0;u<r.length;u++)e[r[u]]=0;var s=_a.d.get_utcNow().c(-3).h();for(u=0;u<i.length;u++){var f=i[u];f.LastAccessedDateTime<s?Array.add(o,f.AttachmentId):f.DataID in e?e[f.DataID]=1:Array.add(o,f.AttachmentId)}for(u=0;u<r.length;u++)e[r[u]]||t.i().a(r[u]);_bs.x.e(o,n)},g:function(n,t,i){if(this.d||!n.b(n.i())){_j.e.b(_bs.O.a,"Already executing or the native bridge is not ready");this.e(i,Error.create("Already executing the cleanup or NativeBridge is not available."));return!1}else{this.d=!0;return!0}},h:function(n,t){var i=this;n.i().c(1,function(r){for(var f=r,o=f.length,u=0;u<o;++u){var e=f[u];n.i().a(e)}i.f(t);i.d=!1})},e:function(n,t){n&&n(t)},f:function(n){n&&n()}};var ItemShapeType=function(){};ItemShapeType.prototype={listView:0,conversationItemPart:1,fullItem:2};ItemShapeType.registerEnum("ItemShapeType",!1);_bs.dW=function(){};_bs.dW.prototype={none:0,syncedContent:1};_bs.dW.registerEnum("_bs.dW",!1);_bs.dX=function(){};_bs.ck=function(){};_bs.ck.registerInterface("_bs.ck");_bs.dY=function(){};_bs.dZ=function(){};_bs.dZ.registerInterface("_bs.dZ");_bs.ea=function(){};_bs.ea.registerInterface("_bs.ea");_bs.eb=function(){};_bs.eb.registerInterface("_bs.eb");function AddressbookPostalAddress(){}function AddressbookEmailAddressInfo(){}AddressbookEmailAddressInfo.prototype={EmailAddress:null,EmailAddressProperty:null};function AddressbookItemMetaData(){}AddressbookItemMetaData.prototype={OldValue:null,PropertyUriEnum:"FolderId",Attributions:null,OldEmailAddress:null};function AddressbookPhoneNumberInfo(){}AddressbookPhoneNumberInfo.prototype={PhoneNumber:null,PhoneNumberProperty:null};function AddressbookPostalAddressInfo(){}AddressbookPostalAddressInfo.prototype={PostalAddress:null,PostalAddressProperty:null};_bs.cV=function(n){_bs.cV.initializeBase(this);this.a=n};_bs.cV.prototype={a:null,c:function(n,t,i,r,u){var f=n.PersonaId.Id;switch(u){case 1:var e=_bs.w.e(n);this.a.g(f,JsonParser.serialize(e));break;case 2:this.a.e(f);break}}};_bs.bK=function(n,t){this.b=[];_bs.bK.initializeBase(this);_a.b.a(n,"attachmentItemStore");_a.b.a(t,"inlineImageItemStore");this.a=n;this.c=t};_bs.bK.prototype={a:null,c:null,d:0,e:function(n){this.h(n)},k:function(n,t,i){_a.b.a(n,"tx");_a.b.a(t,"emailCleanupContext");_a.b.a(t.e,"emailCleanupContext.DeletedMessages");_a.b.a(i,"completedCallback");Array.clear(this.b);this.d=0;var r=this;this.i(n,t.e,function(){t.a.z(_bs.T.a()-(t.c+t.a.d()+t.a.h()+t.a.i()));t.a.w(r.d);i()})},i:function(n,t,i){var u=n.a(_bs.e.a().k.a());var f=new _a.bk(null,null);if(!t.f()){i();return}var r=this;u.a(f,function(u){u.b(function(n){},null);var f=[];r.f(u,t,f,function(){_bs.T.b(n,r.a,f);_bs.T.b(n,r.c,f);i()})},null)},g:function(n,t,i,r){_a.b.a(n,"tx");_a.b.a(t,"messageIds");_a.b.e(i,0,t.length,"currentMessageIndex");_a.b.a(r,"completedCallback");if(!t.length){r();return}var u=this;this.j(n,t[i].a().toString(),function(f){f&&Array.addRange(u.b,f);++i;if(i===t.length){var h=u.b;u.d=u.b.length;for(var s=h,c=s.length,e=0;e<c;++e){var o=s[e];u.a.b(n,o);u.c.b(n,o)}Array.clear(u.b);r()}else u.g(n,t,i,r)})},h:function(n){_a.b.a(n,"tx");this.a.c(n);this.c.c(n)},j:function(n,t,i){_bs.x.i(n,t,this.a,i,null)},f:function(n,t,i,r){var u=this;n.a(50,function(f,e,o){for(var h=0;h<e.length;++h){var s=u.a.fromQueryResultEntry(e[h]);if(s.get_data().AttachmentType===1&&t.b[s.get_data().MessageID]){Array.add(i,s.a());u.d++}}e.length===50?u.f(n,t,i,r):r()},null)}};_bs.x=function(){_bs.x.initializeBase(this)};_bs.x.m=function(n,t,i,r){_a.b.c(n,"id");_a.b.a(t,"store");_a.b.a(i,"successCallback");var u=null;t.a(new _e.a("AttachmentInfoItem.RetrieveRecord"),function(i){t.bindIn(i,_bs.d.a(n),function(n){n&&(u=n.get_data())},null)},function(){i(u)},function(n){_bs.b.a(n,r)})};_bs.x.k=function(n,t,i,r){_a.b.c(n,"id");_a.b.a(t,"store");_a.b.a(i,"successCallback");var u=null;t.a(new _e.a("AttachmentInfoItem.GetAttachmentInfoAndUpdateTime"),function(i){t.d(i,_bs.d.a(n),function(t){if(_j.F.a(t)){_j.e.a(_bs.f.a,"Message with id {0} not found in local store",n);return}u=t;u.LastAccessedDateTime=_a.d.get_utcNow().h()})},function(){i(u)},function(n){_bs.b.a(n,r)})};_bs.x.n=function(n,t,i,r){_a.b.a(n,"record");_a.b.a(t,"store");var u=null;var f=t.k(n);t.a(new _e.a("AttachmentInfoItem.SaveAttachmentInfo"),function(n){f.b(n,function(n){u=n})},function(){_bs.b.d(u,i)},function(n){_bs.b.a(n,r)})};_bs.x.h=function(n,t){_a.b.c(n,"attachmentId");_a.b.a(t,"store");_bs.x.e([n],t)};_bs.x.e=function(n,t){_a.b.a(n,"attachmentIds");_a.b.a(t,"store");t.a(new _e.a("AttachmentInfoItem.DeleteAttachmentInfoWithIds"),function(i){for(var u=n,e=u.length,r=0;r<e;++r){var f=u[r];t.b(i,_bs.d.a(f))}},function(){},function(n){_j.e.c(_bs.f.a,"DeleteAttachmentInfoWithIds failed with error {0}",n.a)})};_bs.x.j=function(n,t,i){_a.b.a(n,"store");_a.b.a(t,"successCallback");var r=[];n.a(new _e.a("AttachmentInfoItem.GetAllNonInlineAttachmentInfoRecords"),function(t){var e=t.a(_bs.e.a().k.a());var f=new _e.b(_bs.x.b,0);var u=new _a.bk(f,null);e.a(u,function(t){_bs.x.f(n,t,r,_bs.b.b(i))},_bs.b.b(i))},function(){t(r)},_bs.b.b(i))};_bs.x.i=function(n,t,i,r,u){_a.b.a(n,"tx");_a.b.c(t,"messageId");_a.b.a(r,"successCallback");var f=[];var h=n.a(_bs.e.a().k.a());var s=new _e.b(_bs.x.c,t);var e=new _a.bk(s,null);var o=100;_bs.j.d(_bs.x,n,e,o,function(n,t,u,e){if(u)for(var o=0;o<u.length;o++){var s=i.fromQueryResultEntry(u[o]);s.get_data().AttachmentType===1&&Array.add(f,s.a())}e&&r(f)},_bs.b.b(u))};_bs.x.g=function(n,t,i,r,u){return new AttachmentInfoRecord(n.AttachmentId.Id,"InlineAttachmentId",n.Size,_a.d.get_utcNow().h(),t,u?1:0,i,r)};_bs.x.l=function(n,t){var i;i=n!==1||t?n===1&&t?1:n||t?3:2:0;return i};_bs.x.f=function(n,t,i,r){var u=100;t.a(u,function(u,f,e){for(var o=0;o<f.length;++o){var s=n.fromQueryResultEntry(f[o]);Array.add(i,s.get_data())}f.length>0&&_bs.x.f(n,t,i,r)},r)};_bs.x.prototype={l:function(){return _bs.e.a().k},K:function(n){_a.b.c(n.AttachmentId,"AttachmentId");_a.b.c(n.DataID,"DataID");_a.b.c(n.MessageID,"MessageID");_a.b.c(n.MessageReceivedDateTime,"MessageReceivedDateTime");_a.b.a(n.AttachmentType,"AttachmentType");if(n.LastAccessedDateTime<=0)throw Error.argument("LastAccessedDateTime","LastAccessedDateTime must be set to a valid value");},H:function(n){return _bs.d.a(n.AttachmentId)},I:function(n){return new AttachmentInfoMetadata(_bs.x.l(n.AttachmentType,n.Synced))}};function AttachmentInfoMetadata(n){AttachmentInfoMetadata.initializeBase(this);_a.b.a(n,"attachmentTypeAndSyncStatus");this.AttachmentTypeAndSyncStatus=n}AttachmentInfoMetadata.prototype={AttachmentTypeAndSyncStatus:0};_bs.cg=function(n,t){_bs.cg.initializeBase(this,[n,t])};_bs.cg.prototype={l:function(n,t,i){_bs.x.k(n,this,t,i)},g:function(n){_bs.x.h(n,this)},q:function(n,t,i){_bs.x.n(n,this,t,i)},p:function(n,t,i){_bs.x.m(n,this,t,i)}};_bs.cW=function(n){this.c={};_a.b.a(n,"eventAggregator");this.a=n};_bs.cW.prototype={a:null,f:function(n,t){_a.b.a(n,"clientStore");_a.b.a(n.d(),"database");_a.b.c(t,"timeZoneId");this.d(n.d());this.e(n,t);var r=this.c;for(var i in r){var f={key:i,value:r[i]};var u=f.value;u.b()}},d:function(n){_a.b.a(n,"offline store");var i=this.c;for(var t in i){var u={key:t,value:i[t]};var r=u.value;r.c()}this.g()},e:function(n,t){var i=new _bs.bh(n,t);this.b(new _bs.de(n,i,t,this.a));this.b(new _bs.ct(n,i,t,this.a));this.b(new _bs.cY(n,i,t,this.a));this.b(new _bs.dp(n,i,t,this.a));this.b(new _bs.dk(n,i,t,this.a));this.b(new _bs.dh(n,i,t,this.a));this.b(new _bs.db(n,i,t,this.a));this.b(new _bs.dm(n,i,t,this.a))},g:function(){var t=this.c;for(var n in t){var r={key:n,value:t[n]};var i=r.value;delete this.c[i.a().toLowerCase()]}},b:function(n){this.c[n.a().toLowerCase()]=n}};_bs.da=function(n){this.b=new _j.q;_a.b.a(n,"emailCleanupContext");this.a=n};_bs.da.prototype={a:null,e:null,c:null,l:function(){if(!this.c){this.c=_a.I.a();var i=this.e.ModuleSpecificContext;if(i)for(var r=i,u=r.length,n=0;n<u;++n){var t=r[n];this.c.a(t.FolderId.Id,this.d().p(t).h())}}return this.c},d:function(){return this.a.b.d()},g:function(){return this.a.b.k()},h:function(){return this.a.b.i()},m:function(){return this.a.b.q()},k:function(n){_j.e.a(_a.a.Q,"Starting full module conversation cleanup");this.d().c(n);this.g().c(n);this.h().b(n,_bs.d.a(this.a.g))},n:function(n,t){_j.e.a(_a.a.Q,"Starting periodic conversation cleanup");var i=this;this.j(n,function(){i.a.a.x(_bs.T.a()-i.a.c);_j.e.a(_a.a.Q,"Completed cleaning conversations, number cleaned = {0}, time taken = {1} ms",i.a.a.c(),i.a.a.d());i.i(n,function(){i.a.a.y(_bs.T.a()-(i.a.c+i.a.a.d()));_j.e.a(_a.a.Q,"Completed cleaning conversation nodes, number cleaned = {0}, time taken = {1} ms",i.a.a.e(),i.a.a.h());t()})})},j:function(n,t){var i=this;this.h().bindIn(n,_bs.d.a(this.a.g),function(r){if(r){i.e=r.get_data();var f=n.a(_bs.e.a().f.a());var u=new _a.bk(null,null);f.a(u,function(r){r.b(function(n){},null);var u=[];i.f(n,r,u,t)},null)}else t()},null)},f:function(n,t,i,r){var u=this;t.a(100,function(f,e,o){for(var s=0;s<e.length;++s){var a=u.d().fromQueryResultEntry(e[s]);var v=a.get_data();var l=v.ConversationId.Id;if(u.o(v))if(u.a.a.c()<50){u.b.c(l);var h;(h=u.a.a).u(h.c()+1);Array.add(i,a.a())}else{var c;(c=u.a.a).v(c.f()+1)}else u.a.d.a(l,!0)}if(e.length===100)u.f(n,t,i,r);else{_j.e.a(_a.a.Q,"Number of conversations left uncleaned in this batch is {0}",u.a.a.f());u.d().deleteWithoutTombstoning(n,i);r()}},null)},o:function(n){var t=this.l().b[n.FolderId.Id];var i=this.d().l(n.LastDeliveryOrRenewTime,n.LastDeliveryTime).h();return _j.C.a(t)||i<t},i:function(n,t){var u=[];var r=this,i=this;this.m().g(n,"ConversationItem",u,function(n){if(!r.b.g(n.Id)&&!r.a.d.b[n.Id]){var t;(t=r.a.a).p(t.g()+1);r.b.c(n.Id)}},function(){if(!i.b.d.length){t();return}for(var u=0,r=0;r<i.b.d.length;r++)i.g().bindIn(n,_bs.d.a(i.b.d[r]),function(r){u++;if(r&&!i.a.d.b[r.get_data().ConversationId.Id]){for(var a=r.get_data(),c=a.ConversationNodes,l=c.length,f=0;f<l;++f)for(var h=c[f],e=0;e<h.Items.length;e++){var s=h.Items[e];i.a.f.a(s.ItemId.Id,s)}var o;(o=i.a.a).t(o.e()+1);r.e(n)}u===i.b.d.length&&t()},null)})}};function CustomSyncData(n,t){this.IsDataSynced=n;this.ItemShape=t}CustomSyncData.prototype={IsDataSynced:null,ItemShape:0};_bs.n=function(n){_bs.n.initializeBase(this,[1,"EmailCleanup"]);this.a[_bs.n.k]=n};_bs.n.prototype={m:function(){return this.a[_bs.n.j]||0},q:function(n){this.a[_bs.n.j]=n;return n},s:function(){return this.a[_bs.n.m]||0},d:function(){return this.a[_bs.n.h]||0},x:function(n){this.a[_bs.n.h]=n;return n},c:function(){return this.a[_bs.n.b]||0},u:function(n){this.a[_bs.n.b]=n;return n},f:function(){return this.a[_bs.n.c]||0},v:function(n){this.a[_bs.n.c]=n;return n},h:function(){return this.a[_bs.n.g]||0},y:function(n){this.a[_bs.n.g]=n;return n},e:function(){return this.a[_bs.n.a]||0},t:function(n){this.a[_bs.n.a]=n;return n},i:function(){return this.a[_bs.n.i]||0},A:function(n){this.a[_bs.n.i]=n;return n},b:function(){return this.a[_bs.n.e]||0},n:function(n){this.a[_bs.n.e]=n;return n},z:function(n){this.a[_bs.n.l]=n;return n},r:function(){return this.a[_bs.n.d]||0},w:function(n){this.a[_bs.n.d]=n;return n},g:function(){return this.a[_bs.n.f]||0},p:function(n){this.a[_bs.n.f]=n;return n}};_bs.dc=function(n,t,i,r,u,f,e,o,s){this.d=_a.I.a();this.f=_a.I.a();this.e=_a.I.a();_a.b.a(t,"itemStoreGetter");_a.b.c(i,"converationSyncStateId");_a.b.c(r,"messageSyncStateId");_a.b.a(u,"folderMappings");_a.b.a(f,"datapointTracker");_a.b.e(e,0,2147483647,"syncMinimum");_a.b.e(o,0,2147483647,"syncWindow");_a.b.a(s,"localStorageAdapter");this.j=n;this.b=t;this.g=i;this.i=r;this.k=u;this.h=f;this.m=e;this.n=o;this.l=s;this.a=new _bs.n(n)};_bs.dc.prototype={m:0,n:0,j:0,g:null,i:null,b:null,k:null,h:null,a:null,c:0,l:null,o:function(){this.h.b()&&this.h.a(this.a)}};_bs.T=function(n){_bs.T.initializeBase(this);_a.b.a(n,"emailCleanupContext");this.a=n};_bs.T.a=function(){return _a.d.a().h()};_bs.T.b=function(n,t,i){for(var u=i,e=u.length,r=0;r<e;++r){var f=u[r];t.b(n,f)}};_bs.T.prototype={a:null,d:null,g:null,b:null,c:null,f:null,i:function(){this.d||(this.d=new _bs.da(this.a));return this.d},j:function(){this.g||(this.g=new _bs.dg(this.a));return this.g},l:function(){this.c||(this.c=this.a.b.j());return this.c},m:function(){this.f||(this.f=this.a.b.n());return this.f},h:function(){this.b||(this.b=new _bs.bK(this.l(),this.m()));return this.b},e:function(n){_a.b.a(n,"tx");switch(this.a.j){case 2:this.n(n);break;case 4:case 1:case 3:this.k(n);break;default:break}},k:function(n){this.i().k(n);this.j().l(n);this.h().h(n)},n:function(n){this.a.c=_bs.T.a();var t=this;this.i().n(n,function(){t.j().n(n,function(){t.h().k(n,t.a,function(){t.a.a.q(_bs.T.a()-t.a.c)})})})}};_bs.dg=function(n){this.d=_a.I.a();_a.b.a(n,"emailCleanupContext");this.a=n};_bs.dg.prototype={a:null,c:null,b:function(){return this.a.b.a()},g:function(){return this.a.b.i()},m:function(){return this.a.b.q()},l:function(n){_j.e.a(_a.a.Q,"Performing full module message cleanup");this.b().c(n);this.g().b(n,_bs.d.a(this.a.i))},n:function(n,t){_j.e.a(_a.a.Q,"Starting periodic message cleanup");var i=this;this.i(n,function(){i.a.a.A(_bs.T.a()-(i.a.c+i.a.a.d()+i.a.a.h()));_j.e.a(_a.a.Q,"Completed cleaning messages, number cleaned = {0}, time taken = {1} ms",i.a.a.b(),i.a.a.i());t()})},i:function(n,t){var i=this;this.g().bindIn(n,_bs.d.a(this.a.i),function(r){if(r){var o=r.get_data();i.c=o.PerFolderSyncStateContainer;var h=0;var e=[];var u=o.PerFolderSyncStateContainer;for(var f in u){var s={key:f,value:u[f]};Array.add(e,s.value)}i.f(n,e,h,function(){i.k(n,function(){t()})})}else t()},null)},f:function(n,t,i,r){if(!t.length){r();return}var u=this;this.j(n,t[i],function(){var f=t[i].Id;u.d.a(f,!0);i++;i===t.length?r():u.f(n,t,i,r)})},k:function(n,t){var u=[];var r=this,i=this;this.m().g(n,"MessageItem",u,function(n){var t;(t=r.a.a).p(t.g()+1);r.a.f.a(n.Id,n.Data)},function(){i.a.f.d(function(t,r){var e;var o,u;if(u=i.h(r,o={val:e}),e=o.val,u){var f;(f=i.a.a).n(f.b()+1);var s=_bs.d.a(r.ItemId.Id);i.a.e.a(r.ItemId.Id,!0);i.b().b(n,s)}});t()})},j:function(n,t,i){_j.e.a(_a.a.Q,"Starting to cleanup messages for folder {0}",t.Id);var f=t.Id;var e=n.a(_bs.e.a().h.a());var o=new _e.b(MessageItemMetadata.b(),f);var u=new _a.bk(o,[new _a.ca(MessageItemMetadata.a(),0)]);var r=this;e.a(u,function(t){var u=[];r.e(n,t,u,function(){_bs.T.b(n,r.b(),u);i()})},null)},e:function(n,t,i,r){var u=this;t.a(10,function(f,e,o){for(var s=!1,c=0;c<e.length;++c){var v=u.b().fromQueryResultEntry(e[c]);var h=v.get_data();s=!1;var y,l;if(l=u.h(h,y={val:s}),s=y.val,l){var a;(a=u.a.a).n(a.b()+1);u.a.f.e(h.ItemId.Id);u.a.e.a(h.ItemId.Id,!0);Array.add(i,v.a())}if(!s)break}e.length===10&&u.a.a.b()<150&&s?u.e(n,t,i,r):r()},null)},h:function(n,t){if(this.a.k.idToName(n.ParentFolderId)==="outbox"){t.val=!1;return!1}var r=this.c?this.c[n.ParentFolderId.Id]:null;var u=r?r.ModuleSpecificContext:null;var i;if(u){i=_a.d.b(n.DateTimeReceived).h()>=_a.d.b(u.OldestReceivedTime).h();t.val=!i}else{i=!1;t.val=!1}return!i&&!this.a.d.c(n.ConversationId.Id)&&!this.d.c(n.ParentFolderId.Id)}};_bs.bM=function(n,t){_bs.bM.$$(this.$$gta["_bs.bM"].TItem,this.$$gta["_bs.bM"].TCreate).initializeBase(this);_a.b.a(n,"itemStore");_a.b.a(t,"creates");this.a=n;this.b=t};_bs.bM.$$=function(n,t){var f=_bs.__tc=_bs.__tc||{};var i="bM"+"$"+n.getName().replace(/\./g,"_")+"$"+t.getName().replace(/\./g,"_");if(!f[i]){var u=f[i]=function(){for(var t=[],n=0;n<arguments.length;++n)t[n]=arguments[n];_bs.bM.apply(this,t)};var s=_bs.k;u.registerClass("_bs.__tc."+i,s);var h={"_bs.bM":{TItem:n,TCreate:t},ctor:_bs.bM};u.prototype.$$gta=h;var o=_bs.bM.prototype;for(var e in o){var r={key:e,value:o[e]};"constructor"!==r.key&&(u.prototype[r.key]=r.value)}}return f[i]};_bs.bM.prototype={a:null,b:null,e:function(n){_a.b.a(n,"tx");this.a.c(n);_bs.k.d(this.$$gta["_bs.bM"].TItem,this.$$gta["_bs.bM"].TCreate,this.a,n,this.b,null)}};_bs.bm=function(n,t){_bs.bm.initializeBase(this,[n,t])};_bs.bm.prototype={g:function(n,t,i,r){_a.b.a(n,"tx");_a.b.a(t,"folderId");_a.b.e(i,0,2147483647,"totalCount");_a.b.e(r,0,2147483647,"unreadCount");var u=this;this.bindIn(n,_bs.d.a(t.Id),function(u){if(!u){_j.e.b(_a.a.bc,"Folder with id {0} not found in client store",t.Id);return}var f=u.get_data();f.TotalCount+=i;f.UnreadCount+=r;u.b(n,null)},null)},l:function(n,t,i,r){_a.b.a(n,"tx");_a.b.a(t,"folderId");_a.b.e(i,0,2147483647,"totalCount");_a.b.e(r,0,2147483647,"unreadCount");var u=this;this.bindIn(n,_bs.d.a(t.Id),function(u){if(!u){_j.e.b(_a.a.bc,"Folder with id {0} not found in client store",t.Id);return}var f=u.get_data();f.TotalCount>=i?f.TotalCount-=i:_j.e.c(_a.a.bc,"Folder {0} total count {1} is less than the amount we are trying to decrement it by {2}",f.DisplayName,f.TotalCount);f.UnreadCount>=r?f.UnreadCount-=r:_j.e.c(_a.a.bc,"Folder {0} unread count {1} is less than the amount we are trying to decrement it by {2}",f.DisplayName,f.UnreadCount);u.b(n,null)},null)},q:function(n,t,i,r){_a.b.a(n,"tx");_a.b.a(t,"folderId");_a.b.e(i,0,2147483647,"totalCount");_a.b.e(r,0,2147483647,"unreadCount");var u=this;this.bindIn(n,_bs.d.a(t.Id),function(t){if(t){var u=t.get_data();!_j.C.a(i)&&i>=0?u.TotalCount=i:_j.e.c(_a.a.bc,"Folder {0} total count is being updated to an invalid value {1}",u.DisplayName,i);u.__type===_g.bD._dataContractName&&(!_j.C.a(r)&&r>=0?u.UnreadCount=r:_j.e.c(_a.a.bc,"Folder {0} unread count is being updated to an invalid value {1}",u.DisplayName,r));t.b(n,null)}},null)},p:function(n,t,i){_a.b.a(n,"tx");_a.b.a(t,"folderId");var r=this;this.bindIn(n,_bs.d.a(t.Id),function(n){if(!n){_j.e.b(_a.a.bc,"Folder with id {0} not found in client store",t.Id);return}var r=n.get_data();i(r.TotalCount,r.UnreadCount)},null)}};_bs.bh=function(n,t){_a.b.a(n,"clientStore");_a.b.c(t,"timeZoneId");this.y=n;this.z=t;var p=this;this.I=new _j.J(function(){return new _bs.bm(p.y,p.z)});var w=this;this.J=new _j.J(function(){return new _bs.dd(w.y,w.z)});var y=this;this.R=new _j.J(function(){return new(_bs.bO.$$(_bc.bk,_bs.v))(y.y,y.z)});var a=this;this.S=new _j.J(function(){return new(_bs.bO.$$(_bc.Z,_bs.bp))(a.y,a.z)});var v=this;this.G=new _j.J(function(){return new _bs.bN(v.y,v.z)});var g=this;this.L=new _j.J(function(){return new _bs.bR(g.y,g.z)});var nt=this;this.M=new _j.J(function(){return new _bs.dl(nt.y,nt.z)});var d=this;this.U=new _j.J(function(){return new _bs.cx(d.y,d.z)});var b=this;this.C=new _j.J(function(){return new _bs.cg(b.y,b.z)});var k=this;this.K=new _j.J(function(){return new _bs.cm(k.y,k.z)});var f=this;this.H=new _j.J(function(){return new(_bs.bO.$$(_bc.E,_bs.bl))(f.y,f.z)});var e=this;this.D=new _j.J(function(){return new(_bs.bO.$$(_bc.t,_bs.u))(e.y,e.z)});var u=this;this.E=new _j.J(function(){return new(_bs.bO.$$(_bc.u,_bs.Q))(u.y,u.z)});var i=this;this.F=new _j.J(function(){return new(_bs.bO.$$(_bc.T,_bs.bj))(i.y,i.z)});var r=this;this.N=new _j.J(function(){return new(_bs.bO.$$(_bc.X,_bs.g))(r.y,r.z)});var c=this;this.A=new _j.J(function(){return new(_bs.bO.$$(_bc.bh,_bs.cS))(c.y,c.z)});var l=this;this.B=new _j.J(function(){return new(_bs.bO.$$(_bc.bi,_bs.cT))(l.y,l.z)});var h=this;this.T=new _j.J(function(){return new(_bs.bO.$$(_bc.I,_bs.bD))(h.y,h.z)});var o=this;this.Q=new _j.J(function(){return new(_bs.bO.$$(_bc.Y,_bs.J))(o.y,o.z)});var s=this;this.O=new _j.J(function(){return new(_bs.bO.$$(_bc.H,_bs.bA))(s.y,s.z)});var tt=this;this.P=new _j.J(function(){return _bs.A.a(tt)})};_bs.bh.prototype={y:null,z:null,I:null,J:null,R:null,S:null,G:null,L:null,M:null,U:null,C:null,K:null,H:null,D:null,E:null,F:null,N:null,A:null,B:null,T:null,Q:null,O:null,P:null,h:function(){return this.y},c:function(){return this.I.e()},r:function(){return this.J.e()},u:function(){return this.R.e()},i:function(){return this.S.e()},j:function(){return this.C.e()},n:function(){return this.K.e()},d:function(){return this.G.e()},k:function(){return this.H.e()},b:function(){return this.D.e()},f:function(){return this.E.e()},a:function(){return this.L.e()},e:function(){return this.M.e()},g:function(){return this.Q.e()},q:function(){return this.U.e()},m:function(){return this.F.e()},s:function(){return this.N.e()},w:function(){return this.A.e()},x:function(){return this.B.e()},p:function(){return this.T.e()},o:function(){return this.O.e()},t:function(){return this.P.e()},l:function(n,t,i,r){this.y.d().b(n,t,i,r)},v:function(n,t,i,r){var u=new _e.a(n);this.l(u,t,i,r)}};_bs.bP=function(n){this.b=n};_bs.bP.prototype={b:null,a:function(n){return new _bs.bh(this.b,n)}};_bs.bn=function(n,t,i){_bs.bn.$$(this.$$gta["_bs.bn"].TItem,this.$$gta["_bs.bn"].TUpdate).initializeBase(this);_a.b.a(n,"itemStore");_a.b.a(t,"updates");_a.b.a(i,"deletedIds");this.h=n;this.g=t;this.k=i};_bs.bn.$$=function(n,t){var f=_bs.__tc=_bs.__tc||{};var i="bn"+"$"+n.getName().replace(/\./g,"_")+"$"+t.getName().replace(/\./g,"_");if(!f[i]){var u=f[i]=function(){for(var t=[],n=0;n<arguments.length;++n)t[n]=arguments[n];_bs.bn.apply(this,t)};var s=_bs.k;u.registerClass("_bs.__tc."+i,s,_bs.cu);var h={"_bs.bn":{TItem:n,TUpdate:t},ctor:_bs.bn};u.prototype.$$gta=h;var o=_bs.bn.prototype;for(var e in o){var r={key:e,value:o[e]};"constructor"!==r.key&&(u.prototype[r.key]=r.value)}}return f[i]};_bs.bn.prototype={h:null,k:null,g:null,f:1,i:null,j:null,a:function(){return this.i?_ff.i.a(this.i):0},b:function(){return this.j?this.j.length:0},e:function(n){_a.b.a(n,"tx");this.o(n,null)},l:function(n){_a.b.d(this.f!==1&&!!this.f,"This method should not be used to persist changes in sync code or service command");var i=this,r=this,t=this;this.h.a(new _e.a("ItemSyncChangeUpdater.PersistChangesFromNonSyncSources",!1),function(n){i.e(n)},function(){_bs.b.c(n)},function(n){_j.e.b(_bs.f.a,"Unable to save non sync data to the clientStore. SaveMode={0}, error={1}",t.f,n.a)})},o:function(n,t){_a.b.a(n,"tx");var u=!1;var r=!1;var o=this;var i=function(){u&&r&&_bs.b.c(t)};var e=this;_bs.k.f(this.$$gta["_bs.bn"].TItem,this.$$gta["_bs.bn"].TUpdate,this.h,n,this.g,function(){u=!0;i()},this.f);var f=this;_bs.k.i(n,this.h,this.k,function(){r=!0;i()})},d:function(n,t,i){this.i={};_bs.k.b(this.$$gta["_bs.bn"].TItem,n,this.h,t,this.i,i)},c:function(n){if(this.j)for(var i=this.j,u=i.length,t=0;t<u;++t){var r=i[t];var f=this;_bs.k.c(this.$$gta["_bs.bn"].TItem,this.$$gta["_bs.bn"].TUpdate,this.h,n,r,null,function(n){})}},p:function(n){if(this.f===1){var t=new _e.d(_bs.j.a,10,1,0);this.h.f(n,t,null)}}};_bs.R=function(){_bs.R.initializeBase(this)};_bs.R.b=function(n){return n.OutboxItemContext};_bs.R.c=function(n,t,i,r){n.a(new _e.a("OutboxItem.SetActionId",!1),function(u){_bs.R.a(u,n,t,r,"SetActionId",function(n){n.c().ActionId=i})},function(){},function(n){_bs.b.a(n,function(n){_bs.R.e(n,t,i,r)})})};_bs.R.e=function(n,t,i,r){var u=String.format("Unable to set Action id. Error '{0}' ItemId {1} Action Id {2}",n.a(),t.Id,i.toString());_j.e.c(r,u);throw Error.invalidOperation(u);};_bs.R.f=function(n,t,i,r,u){_a.b.a(u,"response");_bs.R.a(n,t,i,r,"SetContextResponse",function(n){_bs.R.d(n.c(),u)})};_bs.R.g=function(n,t,i,r,u,f){_bs.R.a(n,t,i,r,"SetContextResponseCode",function(n){if(n.c().LastResponseCode==="NoError"||u!=="ErrorInvalidIdMalformed"){n.c().LastResponseCode=u;_bs.R.d(n.c(),f)}})};_bs.R.a=function(n,t,i,r,u,f){_a.b.a(n,"transaction");_a.b.a(i,"outboxItemStore");_a.b.a(i,"outboxItemId");_a.b.a(u,"traceContext");_a.b.a(f,"updateCallback");t.bindIn(n,_bs.d.a(i.Id),function(t){if(!t){var e=String.format("OutboxItem.UpdateContext: {0} Unable to update outbox context. Outbox item {1} was not found in the client store",u,i.Id);_j.e.c(r,e);throw Error.invalidOperation(e);}f(t);t.b(n,null)},null)};_bs.R.d=function(n,t){n.LastResponse=t;n.LastResponseDateTime=_a.d.d(_a.d.a().o());n.IsSending=!1;_j.C.a(n.ResendCount)&&(n.ResendCount=0)};_bs.R.prototype={c:function(){return _bs.R.b(this.k)},l:function(){return _bs.e.a().n},f:function(n,t,i,r){var u=new _bc.OutboxItemContext;u.SendAction=n;u.ParentConversationNodeId=t;u.ComplianceId=i;u.LastResponseCode=r;u.LastResponse=null;u.LastResponseDateTime=null;u.IsSending=!0;u.ResendCount=0;this.k.OutboxItemContext=u},g:function(){this.k.OutboxItemContext=undefined}};_bs.dl=function(n,t){_bs.dl.initializeBase(this,[n,t])};_bs.dl.prototype={K:function(){return _bs.e.a().n.a()},getResendItemList:function(n,t,i,r){_j.e.a(_bs.f.a,"GetResendList: Starting transaction");var f=new _j.q;var u=0;var e=this,s=this,o=this;this.a(new _e.a("OutboxItemStore.ResendFailedSendActions"),function(o){e.v(o,null,function(o){o.a(n,function(n,o,s){_j.e.a(_bs.f.a,"GetResendList: Starting query succeeded callback");if(!o||!o.length){_j.e.a(_bs.f.a,"GetResendList: resendCallback will be called with no results");r(f,u);return}for(var a=_a.d.a().o(),l=0;l<o.length;l++){var v=o[l];var h=e.fromQueryResultEntry(v);var c=h.c();if(!c){_j.e.b(_bs.f.a,"GetResendList: Outbox item has no context. Subject: {0}",h.get_data().Subject);continue}if(c.LastResponse&&!c.IsSending&&c.ResendCount<i)if(_a.d.b(c.LastResponseDateTime).p(t).b(a)<0){_j.e.a(_bs.f.a,"GetResendList: Adding message to resend list. Subject: {0}",h.get_data().Subject);f.c(h);_j.e.a(_bs.f.a,"GetResendList: Incrementing ResendCount. Subject: {0}",h.get_data().Subject);h.c().ResendCount++;h.c().IsSending=!0;h.b(n,null)}else{u++;_j.e.a(_bs.f.a,"GetResendList: Incrementing futureResendCount. Subject: {0}",h.get_data().Subject)}}},null)})},function(){_j.e.a(_bs.f.a,"GetResendList: Calling resendCallback with resend item count: {0} future resend count: {1}",f.d.length,u);r(f,u)},function(n){_j.e.b(_bs.f.a,"GetResendList: Reporting store error");_bs.b.a(n,null)})},setContextResponseCodeWithoutAction:function(n,t,i,r,u){_bs.R.g(n,this,t,i,r,u)},setContextResponseWithoutAction:function(n,t,i,r){_bs.R.f(n,this,t,i,r)},N:function(n,t){var i=this;this.G.bindIn(n,_bs.d.a(this.p),function(n){var i=0;n&&(i=n.get_data().TotalCount);t(i)},null)},q:function(n,t){for(var i=0;i<n.length;++i){var u=this.fromQueryResultEntry(n[i]);var r=u.get_data();Array.add(t,r)}_j.e.a(_bs.f.a,"GetItems: Returning {0} results to the caller",t.length)}};_bs.V=function(n,t,i,r,u,f,e,o){this.k=Function.createDelegate(this,this.r);this.l=Function.createDelegate(this,this.t);this.g=Function.createDelegate(this,this.p);_a.b.b(n,"outboxItemStore");_a.b.b(t,"taskRunner");_a.b.b(i,"actionSubmitter");_a.b.b(r,"featureManager");_a.b.b(u,"eventAggregator");_a.b.b(f,"settings");_a.b.b(e,"offlineBootStrapper");if(f.f()&&e.a()){this.j=n;this.f=t;this.h=i;this.c=r;this.i=e;this.b=u;this.e=o;this.n();u.b(_a.cQ,this.g)}};_bs.V.prototype={j:null,f:null,a:null,h:null,c:null,i:null,b:null,d:!1,e:null,p:function(n){this.n()},n:function(){this.d=!0;this.a||this.q()},t:function(){if(!this.i.b()){this.b.c(_a.cQ,this.g);this.m();return}this.o()},q:function(){this.a=this.f.e(_bs.V.a,_bs.V.b,this.l,3e5)},o:function(){this.d=!1;this.j.getResendItemList(50,10,1,this.k)},r:function(n,t){try{for(var i=0;i<n.d.length;i++)this.s(n.d[i])}catch(r){_j.e.c(_bs.V.a,"Unable to resend. Error: {0}",r.message)}t||this.d||this.m()},m:function(){if(this.a){this.f.b(this.a);this.a=null}},s:function(n){_a.b.a(n,"outboxItem");_a.b.a(n.c(),"outboxItem.Context");_a.b.a(n.get_data(),"outboxItem.Data");var t=_g.g.a(n.get_data());if(!_g.i.isInstanceOfType(t)){_j.e.b(_bs.V.a,"OutboxMonitorService.ResendOutboxItem: Item is not an email message. Skipping resend. itemId: {0}",t.bD.ItemId.Id);return}_j.e.a(_bs.V.a,"OutboxMonitorService.ResendOutboxItem: Resending Outbox item. {0}",t.bD.ItemId.Id);var i=null;if(n.c().SendAction===1){var u=this;this.e.a(function(r){var f=r.e(t,u.c,u.b);f.e(n.c().ComplianceId);f.j(n.get_data().ItemId);f.h(1);f.f("AlwaysOverwrite");i=f})}else{var r=this;this.e.a(function(u){var f=u.b(t,r.c,r.b);f.o(n.c().ComplianceId);f.r(n.get_data().ItemId);f.h(1);i=f})}var f=this;i.c(function(n){var i=n.G?n.G.message:"";_j.e.b(_bs.V.a,"OutboxMonitorService.ResendOutboxItem: Resend of Outbox item failed. {0} Error {1}",t.bD.ItemId.Id,i)});this.h.a(i)}};_bs.bA=function(){_bs.bA.initializeBase(this)};_bs.bA.a=function(n,t,i){_a.b.a(n,"peopleFilterItemStore");_a.b.a(t,"successCallback");_a.b.a(i,"errorCallback");var r=[];n.a(new _e.a("PeopleFilterItem.GetPeopleFilters"),function(t){var f=t.a(_bs.e.a().z.a());var u=new _a.R("Data.SortGroupPriority");var i=new _a.bk(null,[new _a.ca(u,0)]);f.a(i,function(t){t.a(100,function(t,i,u){for(var f=0;f<i.length;++f)Array.add(r,n.fromQueryResultEntry(i[f]))},null)},null)},function(){t(r)},function(n){_bs.b.a(n,i)})};_bs.bA.prototype={l:function(){return _bs.e.a().z},getFolderId:function(){return this.c(this.k)},K:function(n){_a.b.a(n.FolderId,"FolderId");var t=this.c(n);_a.b.c(t,"Id")},H:function(n){return _bs.d.a(this.c(n))},I:function(n){return new ItemMetadata},c:function(n){var t=_g.m.e(n.FolderId);if(_g.l.isInstanceOfType(t)){var r=t;return r.Id}else if(_g.bH.isInstanceOfType(t)){var i=t;return i.Id}else throw Error.invalidOperation("unpexpected type for data.FolderId: "+t.__type);}};function PersistedDataRecord(){}PersistedDataRecord.prototype={Data:null,Metadata:null};_bs.j=function(){this.$$d_e=Function.createDelegate(this,this.e)};_bs.j.r=function(n,t,i,r){_a.b.a(t,"store");_a.b.a(i,"data");_a.b.c(r,"dataTimeZoneId");var u=new n;u.v(i);u.o(t,u.C(i),i,r,r);return u};_bs.j.h=function(n,t,i,r){_a.b.a(t,"store");_a.b.a(i,"e");_a.b.a(r,"destinationTimeZoneId");return _bs.j.g(n,t,i.b,i.a,r)};_bs.j.n=function(n,t,i,r,u,f){_a.b.a(i,"tx");_a.b.a(t,"store");_a.b.a(r,"id");_a.b.a(u,"destinationTimeZoneId");_a.b.a(f,"successCallback");var e=new n;var o=i.a(e.l().a());_bs.j.c(e,t,o,r,u,function(n){f(n)},null)};_bs.j.o=function(n,t,i,r,u,f,e){_a.b.a(t,"store");_a.b.a(i,"tx");_a.b.a(r,"ids");_a.b.a(u,"destinationTimeZoneId");_a.b.a(f,"successCallback");for(var s=[],c=0,l=i.a(_bs.j.b(n)),o=0;o<r.length;++o){var h=new n;_bs.j.c(h,t,l,r[o],u,function(n){n&&Array.add(s,n);++c===r.length&&f(s)},function(n){e(n)})}};_bs.j.v=function(n,t,i,r,u,f){_a.b.a(t,"store");_a.b.a(i,"tx");_a.b.a(r,"id");_a.b.a(f,"updaterCallback");var e=new n;_bs.j.t(e,t,i,r,u,f)};_bs.j.f=function(n,t,i,r){_a.b.a(t,"tx");_a.b.a(i,"id");_bs.j.i(t,i,_bs.j.b(n),r)};_bs.j.q=function(n,t,i,r){_a.b.a(t,"tx");_a.b.a(i,"filter");var u=new _j.q;_bs.j.u(n,t,i,100,function(t,i,f,e){f.length&&u.h(f);if(e){var h=n.getName();if(u.d.length)for(var c=0,o=0;o<u.d.length;o++){var s=u.d[o];i.d(s,function(){++c===u.d.length&&r&&r()},function(n){_j.e.c(_bs.j.e,"DeleteByFilterIn<{0}>: An error occured during deleting item #{1} (Id: {2}; Error: {3}-{4}).",h,o,s,n.b,n.a)})}else r&&r()}},null)};_bs.j.d=function(n,t,i,r,u,f){_a.b.a(t,"tx");if(r<1)throw Error.argumentOutOfRange("batchSize",r,"Batch size should be a positive integer.");var o=_bs.j.b(n);var e=t.a(o);e.a(i,function(n){_bs.j.k(n,r,function(n,t,i){u(n,e,t,i)},f)},null)};_bs.j.u=function(n,t,i,r,u,f){_a.b.a(t,"tx");_a.b.a(i,"filter");var o=_bs.j.b(n);var e=t.a(o);e.c(i,function(n){_bs.j.j(n,r,function(n,t,i){u(n,e,t,i)},f)},null)};_bs.j.p=function(n,t){_a.b.a(t,"tx");_bs.j.s(t,_bs.j.b(n))};_bs.j.g=function(n,t,i,r,u){var f=new n;f.o(t,_bs.d.b(i),r.Data,_bs.f.b,u);return f};_bs.j.b=function(n){var t=new n;return t.l().a()};_bs.j.i=function(n,t,i,r){var u=n.a(i);u.d(t.b(),r,null)};_bs.j.k=function(n,t,i,r){n.a(t,function(u,f,e){i(u,f,e);e||_bs.j.k(n,t,i,r)},r)};_bs.j.j=function(n,t,i,r){n.b(t,function(u,f,e){i(u,f,e);e||_bs.j.j(n,t,i,r)},r)};_bs.j.s=function(n,t){var i=n.a(t);i.e(null,null)};_bs.j.c=function(n,t,i,r,u,f,e){i.f(r.b(),function(i){var e=i;if(e){n.o(t,r,e.Data,_bs.f.b,u);f(n)}else f(null)},function(n){_bs.b.a(n,e)})};_bs.j.t=function(n,t,i,r,u,f){var e=i.a(n.l().a());_bs.j.c(n,t,e,r,u,function(n){var t=n?n.k:null;f(t);n&&n.b(i,null)},null)};_bs.j.prototype={k:null,s:null,m:null,p:null,a:function(){return this.p},d:function(){return this.k},b:function(n,t){this.v(this.k);this.i(n,0,t)},e:function(n){_a.b.a(n,"tx");_bs.j.i(n,this.p,this.l().a(),null)},i:function(n,t,i){_a.b.a(n,"tx");var r=this.E(_bs.f.b);var f=this.A(t,r);this.F(r,f);r.Metadata=this.D(r.Data);this.G(r);var u=n.a(this.l().a());var e=this;u.g(this.p.b(),r,function(n){_bs.b.d(_bs.d.b(n),i)},null)},E:function(n){var t;var i=new PersistedDataRecord;i.Data=this.k;if(this.s!==n){t=_ff.i.b(i);this.B(t.Data,this.s,n)}else t=i;return t},o:function(n,t,i,r,u){_a.b.a(n,"store");_a.b.a(i,"data");_a.b.a(t,"id");_a.b.c(r,"sourceTimeZoneId");_a.b.c(u,"destinationTimeZoneId");this.m=n;this.p=t;this.k=i;this.s=u},F:function(n,t){var i=_a.d.o(_a.d.get_utcNow());switch(t){case 1:_bs.j.m.c(n,i);break;default:_bs.j.l.c(n,i);break}_bs.j.a.c(n,t)},G:function(n){for(var f=this.l().e(),s=f.length,u=0;u<s;++u)for(var o=f[u],e=o.a,h=e.length,r=0;r<h;++r){var t=e[r];var i=t.a.b(n);if(i){if(Number.isInstanceOfType(i)){if(t.b!==1)throw Error.argumentType(t.a.a,Object.getType(i),Number);}else if(String.isInstanceOfType(i)&&t.b)throw Error.argumentType(t.a.a,Object.getType(i),String);}else t.a.c(n,_a.gd.a(t.b))}}};_bs.cy=function(){_bs.cy.$$(this.$$gta["_bs.cy"].R).initializeBase(this)};_bs.cy.$$=function(n){var u=_bs.__tc=_bs.__tc||{};var t="cy"+"$"+n.getName().replace(/\./g,"_");if(!u[t]){var r=u[t]=function(){for(var t=[],n=0;n<arguments.length;++n)t[n]=arguments[n];_bs.cy.apply(this,t)};var o=_bs.j;r.registerClass("_bs.__tc."+t,o,_bc.bz);var s={"_bs.cy":{R:n},ctor:_bs.cy};r.prototype.$$gta=s;var e=_bs.cy.prototype;for(var f in e){var i={key:f,value:e[f]};"constructor"!==i.key&&(r.prototype[i.key]=i.value)}}return u[t]};_bs.cy.prototype={get_data:function(){return this.k},J:function(){return!1},C:function(n){return this.H(n)},D:function(n){return this.I(n)},v:function(n){this.K(n)},B:function(n,t,i){this.t(n,t,i)},o:function(n,t,i,r,u){_bs.j.prototype.o.call(this,n,t,i,r,u);this.t(this.k,r,u)},t:function(n,t,i){var u=this.$$gta["_bs.cy"].R;var f="_TZ";var r=u[f];r&&r(n,t,i,this.m.a())},A:function(n,t){if(this.J()){var r=_bs.j.a.b(t);if(!_j.F.a(r)){var i=r;if(n!==1&&(i===10||i===11)||(n===10||n===11)&&i<10)return i}}return n}};_bs.J=function(){_bs.J.initializeBase(this)};_bs.J.e=function(n,t,i,r,u,f){_a.b.a(n,"reminderItemStore");_a.b.a(u,"successCallback");_a.b.e(t,_bs.J.d,_bs.J.a,"maxRemindersToReturn");_a.b.c(r,"endTime");_j.h.a(i)&&(i=_a.d.d(new _a.d(0,1,1)));if(_a.d.b(i).b(_a.d.b(r))>0)throw Error.argumentOutOfRange("beginTime","beginTime is greater than endTime");t||(t=_bs.J.a);var e=[];n.a(new _e.a("ReminderItem.GetReminders"),function(u){var c=u.a(_bs.e.a().p.a());var o=_bs.J.b;var h=new _e.e(o,n.h(i),n.h(r),0);var s=new _a.bk(h,[new _a.ca(o,0)]);c.a(s,function(i){i.a(t,function(t,i,r){for(var u=0;u<i.length;++u)Array.add(e,n.fromQueryResultEntry(i[u]))},_bs.b.b(f))},_bs.b.b(f))},function(){u(e)},_bs.b.b(f))};_bs.J.prototype={l:function(){return _bs.e.a().p},K:function(n){_a.b.a(n.ItemId,"ReminderType.ItemId");_a.b.a(n.UID,"ReminderType.UID");_a.b.c(n.ItemId.Id,"ReminderType.ItemId.Id");_a.b.c(n.ReminderTime,"ReminderType.ReminderTime")},H:function(n){return _bs.d.a(n.ItemId.Id)},I:function(n){return new ItemMetadata}};_bs.d=function(n){this.c=new _a.dd(n)};_bs.d.a=function(n){_a.b.c(n,"id");return new _bs.d(n)};_bs.d.c=function(n){return new _bs.d(n)};_bs.d.d=function(){return new _bs.d(null)};_bs.d.b=function(n){return new _bs.d(n.a)};_bs.d.prototype={c:null,a:function(){return this.c.a},b:function(){return this.c},toString:function(){return this.c.toString()}};_bs.bi=function(){_bs.bi.initializeBase(this)};_bs.bi.a=function(n){_a.b.a(n,"actionRecord");_a.b.a(n.request,"actionRecord.Request");return!!n.request.actionContext&&!_j.z.a(n.request.actionContext.shouldPrecedeOfflineSyncActions)&&n.request.actionContext.shouldPrecedeOfflineSyncActions};_bs.bi.prototype={l:function(){return _bs.e.a().i},H:function(n){return n.id?_bs.d.c(n.id):_bs.d.d()},I:function(n){return new ActionItemMetadata(_bs.bi.a(n))},K:function(n){},o:function(n,t,i,r,u){var f=i;if(f.request.actionHandler){_j.e.b(_a.a.dE,"An ActionItem with id={0} has an ActionHandler.  It is being removed.",t.a());f=_ff.e.a(f,!0);f.request.actionHandler=null}_bs.cy.prototype.o.call(this,n,t,f,r,u)}};function ActionItemMetadata(n){ActionItemMetadata.initializeBase(this);this.IsHighPriority=n.toString()}ActionItemMetadata.a=function(){return new _a.R("Metadata.IsHighPriority")};ActionItemMetadata.prototype={IsHighPriority:null};_bs.w=function(){};_bs.w.h=function(n,t){var i=new AddressbookOperation;i.Type=n;i.PersonaId=t;return i};_bs.w.e=function(n){var t=_bs.w.f(n);_bs.w.g(n,t,!0);return t};_bs.w.i=function(n){var t=_bs.w.f(n);_bs.w.g(n,t,!1);return t};_bs.w.d=function(n){_a.b.a(n,"persona");_a.b.a(n.PersonaId,"persona.PersonaId");_a.b.c(n.PersonaId.Id,"persona.PersonaId.Id");return n.PersonaId.Id};_bs.w.f=function(n){_a.b.a(n,"persona");var t=new AddressbookPersona;t.PersonaId=_bs.w.d(n);_j.h.d(n.GivenName)||(t.FirstName=n.GivenName);_j.h.d(n.YomiFirstName)||(t.YomiFirstName=n.YomiFirstName);_j.h.d(n.MiddleName)||(t.MiddleName=n.MiddleName);_j.h.d(n.Surname)||(t.LastName=n.Surname);_j.h.d(n.YomiLastName)||(t.YomiLastName=n.YomiLastName);_j.h.d(n.DisplayNamePrefix)||(t.NamePrefix=n.DisplayNamePrefix);_j.h.d(n.Generation)||(t.NameSuffix=n.Generation);_j.h.d(n.Nickname)||(t.Nickname=n.Nickname);_j.h.d(n.DisplayName)||(t.DisplayName=n.DisplayName);_j.h.d(n.CompanyName)||(t.CompanyName=n.CompanyName);return t};_bs.w.g=function(n,t,i){var r=_bs.w.k(n.AttributionsArray);var s=_bs.w.a([n.Emails1Array,n.Emails2Array,n.Emails3Array],r,_bs.w.j,["PersonaEmails1","PersonaEmails2","PersonaEmails3"],i);s.length>0&&(t.Emails=s);var h=_bs.w.a([n.BusinessPhoneNumbersArray,n.BusinessPhoneNumbers2Array],r,_bs.w.b,["PersonaBusinessPhoneNumbers","PersonaBusinessPhoneNumbers2"],i);h.length>0&&(t.BusinessPhoneNumbers=h);var c=_bs.w.a([n.HomePhonesArray,n.HomePhones2Array],r,_bs.w.b,["PersonaHomePhones","PersonaHomePhones2"],i);c.length>0&&(t.HomePhoneNumbers=c);var o=_bs.w.a([n.MobilePhonesArray,n.CarPhonesArray],r,_bs.w.b,["PersonaMobilePhones","PersonaCarPhones"],i);o.length>0&&(t.MobilePhoneNumbers=o);var u=_bs.w.a([n.BusinessAddressesArray],r,_bs.w.c,["PersonaBusinessAddresses"],i);u.length>0&&(t.BusinessPostalAddresses=u);var f=_bs.w.a([n.HomeAddressesArray],r,_bs.w.c,["PersonaHomeAddresses"],i);f.length>0&&(t.HomePostalAddresses=f);var e=_bs.w.a([n.OtherAddressesArray],r,_bs.w.c,["PersonaOtherAddresses"],i);e.length>0&&(t.OtherPostalAddresses=e)};_bs.w.k=function(n){var r=new _j.q;if(!n)return r;for(var i=0;i<n.length;i++){var t=n[i];(t.DisplayName==="Facebook"||t.DisplayName==="LinkedIn")&&r.c(t.Id)}return r};_bs.w.a=function(n,t,i,r,u){for(var v=[],e=0,l,a=n,y=a.length,o=0;o<y;++o){var h=a[o];l={};if(!h){e++;continue}for(var c=h,p=c.length,f=0;f<p;++f){var s=c[f];s&&i(s,v,r[e],l,t,u)}e++}return v};_bs.w.j=function(n,t,i,r,u,f){if(n.Value&&!_j.h.b(_g.n.c(n.Value)))for(var s=0;s<n.Attributions.length;s++){var o=_g.n.c(n.Value);if(!u.g(n.Attributions[s])&&!(o in r)){r[o]=!0;if(f){var e=new AddressbookEmailAddressInfo;e.EmailAddress=o;e.EmailAddressProperty=new AddressbookItemMetaData;e.EmailAddressProperty.OldValue=o;e.EmailAddressProperty.PropertyUriEnum=i;e.EmailAddressProperty.Attributions=n.Attributions;e.EmailAddressProperty.OldEmailAddress=n.Value.EmailAddress;t[t.length]=e;break}else{t[t.length]=o;break}}}};_bs.w.b=function(n,t,i,r,u,f){if(n.Value&&!_j.h.b(n.Value.Number))for(var s=0;s<n.Attributions.length;s++){var o=n.Value.Number;if(!u.g(n.Attributions[s])&&!(o in r)){r[o]=!0;if(f){var e=new AddressbookPhoneNumberInfo;e.PhoneNumber=o;e.PhoneNumberProperty=new AddressbookItemMetaData;e.PhoneNumberProperty.OldValue=o;e.PhoneNumberProperty.PropertyUriEnum=i;e.PhoneNumberProperty.Attributions=n.Attributions;t[t.length]=e;break}else{t[t.length]=o;break}}}};_bs.w.c=function(n,t,i,r,u,f){if(n.Value){var e=new AddressbookPostalAddress;var o=n.Value;_j.h.b(o.State)||(e.State=o.State);_j.h.b(o.City)||(e.City=o.City);_j.h.b(o.Street)||(e.Street=o.Street);_j.h.b(o.Country)||(e.Country=o.Country);_j.h.b(o.PostalCode)||(e.PostalCode=o.PostalCode);var h=_g.bS.a(e.Street,e.City,e.State,e.PostalCode,e.Country);if(!(h in r)){r[h]=!0;if(f){var s=new AddressbookPostalAddressInfo;s.PostalAddress=e;s.PostalAddressProperty=new AddressbookItemMetaData;s.PostalAddressProperty.OldValue=h;s.PostalAddressProperty.PropertyUriEnum=i;s.PostalAddressProperty.Attributions=n.Attributions;t[t.length]=s}else t[t.length]=e}}};_bs.cS=function(){_bs.cS.initializeBase(this)};_bs.cS.prototype={l:function(){return _bs.e.a().v},H:function(n){return _bs.d.d()},I:function(n){return new ItemMetadata},K:function(n){_a.b.b(n,"data");_a.b.c(n.PersonaId,"data.PersonaId");_a.b.b(n.Type,"data.Type");_a.b.g(n.Type,0,"data.Type is invalid")}};_bs.cT=function(){_bs.cT.initializeBase(this)};_bs.cT.prototype={l:function(){return _bs.e.a().w},H:function(n){return _bs.d.a(n.PersonaId)},I:function(n){return new ItemMetadata},K:function(n){_a.b.b(n,"data");_a.b.c(n.PersonaId,"data.PersonaId")}};_bs.cU=function(){};_bs.cU.prototype={e:function(n,t,i,r){_a.b.a(i,"addressbookOperationItemStore");_a.b.a(r,"addressbookPersonaItemStore");this.f(n)?this.b(n,t,i,r,1):this.b(n,t,i,r,2)},d:function(n,t,i,r){_a.b.a(i,"addressbookOperationItemStore");_a.b.a(r,"addressbookPersonaItemStore");this.b(n,t,i,r,2)},c:function(n,t,i,r,u){var o=_bs.w.h(u,n.PersonaId.Id);var s=i.fromData(o);s.b(t,null);if(u===2)r.b(t,_bs.d.a(_bs.w.d(n)));else{var f=_bs.w.i(n);var e=r.fromData(f);e.b(t,null)}},b:function(n,t,i,r,u){_j.h.a(n.PersonaId.Id)||this.c(n,t,i,r,u)},f:function(n){if(_j.h.a(n.PersonaId.Id))return!1;for(var u=_g.m.d("contacts").Id,i=n.FolderIds,f=i.length,t=0;t<f;++t){var r=i[t];if(r.Id===u)return!0}return!1}};_bs.dV=function(n,t,i,r,u,f){this.k=Function.createDelegate(this,this.w);this.o=Function.createDelegate(this,this.v);_a.b.a(n,"clientStore");_a.b.a(t,"getter");_a.b.c(i,"timeZoneId");_a.b.a(u,"eventAggregator");this.f=n;this.m=t;this.n=i;this.i=r;this.g=u;this.l=f};_bs.dV.prototype={f:null,m:null,n:null,i:!1,g:null,l:0,d:null,e:null,b:function(){_j.e.a(_a.a.bB,"Subscribing to {0} DB notification handler callback",this.a());this.f.d().f(this.a(),this.o);this.y()},c:function(){_j.e.a(_a.a.bB,"Unsubscribing from {0} DB notification handler callback",this.a());this.f.d().h(this.a());this.z()},r:function(n){return n},x:function(n,t){return!1},h:function(n){return this.d[n.toString()]},v:function(n,t,i){_a.b.c(n,"objectStoreName");_a.b.a(t,"notificationData");_j.e.a(_a.a.bB,"{0} offline store genereated notification. Add Event Count: {1}. Update Event Count: {2}. Delete Event Count: {3}",this.a(),t.a().length,t.b().length,t.c().length);var r=this.r(t);if(r.d()){this.g.a(_a.dE,new _a.dE(this.l));this.x(i,r)&&this.t(i,r);this.q(i)&&this.s(r)}this.p()},q:function(n){return!n||n.f()},t:function(n,t){_j.e.a(_a.a.bB,"{0} raise DbTransactionItemInfoEvent SyncInitiatorId: {1}.",this.a(),n.e());var i=new _e.g(n.e(),t.a(),t.b());this.g.a(_e.g,i)},y:function(){if(this.i&&!this.e){_j.e.a(_a.a.bB,String.format("Subscribed to delete observation for store : {0}",this.a()));this.e=this.u(this.m);this.d={};this.e.s(this.k)}},z:function(){_j.e.a(_a.a.bB,String.format("Unsubscribed to delete observation for store : {0}",this.a()));this.i&&this.e&&this.e.x(this.k);this.p()},w:function(n,t){if(this.q(t.a().b())){var i=t.b();var r=this;n.e(t.a(),i,function(n){n&&(r.d[i.toString()]=n)},null)}},p:function(){this.d&&_ff.i.a(this.d)>0&&(this.d={})}};_bs.cY=function(n,t,i,r){_bs.cY.initializeBase(this,[n,t,i,!0,r,2])};_bs.cY.prototype={a:function(){return _bs.e.a().g.a()},s:function(n){this.j("RowAdded",n.a());this.j("RowModified",n.b());this.j("RowDeleted",n.c())},x:function(n,t){return!!n&&n.c()},u:function(n){return n.b()},j:function(n,t){for(var e=t,h=e.length,r=0;r<h;++r){var o=e[r];var i=null;var f="";if(n==="RowDeleted"){var u=this.h(o.b());if(!u)return;i=u.get_data()}else{var s=o.a();i=s.Data;_g.z._TZ(i,_bs.f.b,this.n,this.f.a())}f=i.ParentFolderId.Id;_bs.t.g(n,f,i)}}};_bs.de=function(n,t,i,r){_bs.de.initializeBase(this,[n,t,i,!1,r,0])};_bs.de.prototype={a:function(){return _bs.e.a().j.a()},A:function(){return!1},s:function(n){this.j(n.a());this.j(n.b())},u:function(n){return n.c()},j:function(n){for(var r=n,u=r.length,i=0;i<u;++i){var e=r[i];var f=e.d;var t=f.Data;_bs.t.c(t.FolderId.Id,t.ParentFolderId.Id,"RowModified","clientStore",t.TotalCount,t.UnreadCount,this.A())}}};_bs.ct=function(n,t,i,r){_bs.ct.initializeBase(this,[n,t,i,!1,r,1])};_bs.ct.a=function(n){return n.a().length>0||n.b().length>0||n.c().length>0};_bs.ct.prototype={a:function(){return _bs.e.a().p.a()},j:function(){return!0},s:function(n){_bs.ct.a(n)&&_bs.t.f(this.j())},u:function(n){return n.g()}};_bs.u=function(){_bs.u.initializeBase(this)};_bs.u.i=function(n){return _bs.u.f(n.ItemId)};_bs.u.f=function(n){return _bs.d.a(n.Id)};_bs.u.g=function(n,t,i,r){_a.b.a(n,"tx");_a.b.a(t,"calendarItemStore");_a.b.a(i,"uid");var e=new _e.b(_bs.u.c,i);var f=[new _a.ca(_a.R.a,0)];var u=new _a.bk(e,f);_bs.j.d(_bs.u,n,u,52,function(n,i,u,f){for(var e=0;e<u.length;e++){var o=t.fromQueryResultEntry(u[e]);r(o,!!(f&e===u.length-1))}},null)};_bs.u.e=function(n){var r=_a.d.b(n.Start);var i=_a.d.b(n.End);return Math.floor(i.e(r)/36e5)};_bs.u.prototype={n:0,q:null,r:null,j:function(){return this.k.ParentFolderId.Id},h:function(){return this.k.Start},u:function(){this.q||this.w();return this.q},y:function(){this.r||this.w();return this.r},z:function(){return this.n>24?Math.ceil(this.n/24):1},c:function(){return this.k.UID},g:function(){return this.k.End},f:function(){return this.n},l:function(){return _bs.e.a().g},K:function(n){_a.b.a(n.ItemId,"ItemId");_a.b.a(n.ParentFolderId,"ParentFolderId");_a.b.a(n.UID,"UID");_a.b.c(n.ItemId.Id,"ItemId.Id");_a.b.c(n.ParentFolderId.Id,"ParentFolderId.Id");_a.b.c(n.Start,"Start");_a.b.c(n.End,"End")},H:function(n){return _bs.u.i(n)},o:function(n,t,i,r,u){this.n=_bs.u.e(i);_bs.cy.prototype.o.call(this,n,t,i,r,u)},t:function(n,t,i){if(t!==i&&n){n.RequiredAttendees&&this.x(n.RequiredAttendees,t,i);n.OptionalAttendees&&this.x(n.OptionalAttendees,t,i)}_bs.cy.prototype.t.call(this,n,t,i)},x:function(n,t,i){for(var r=0;r<n.length;r++){n[r].ProposedStart=this.m.a().b(t,i,n[r].ProposedStart);n[r].ProposedEnd=this.m.a().b(t,i,n[r].ProposedEnd)}},I:function(n){return new CalendarItemMetadata(_bs.u.e(n))},w:function(){var i=this.k.unfoldedIndex;var t=this.k.Start;var n=_a.d.b(t);if(i>0){n=n.d().c(i);t=_a.d.d(n)}this.q=t;this.r=n}};function CalendarItemMetadata(n){CalendarItemMetadata.initializeBase(this);this.DurationInHours=n}CalendarItemMetadata.prototype={DurationInHours:0};_bs.Q=function(){_bs.Q.initializeBase(this)};_bs.Q.a=function(n,t,i,r){_a.b.a(n,"tx");_a.b.a(t,"calendarRecurrenceMasterItemStore");_a.b.a(i,"uid");_a.b.a(r,"successCallback");var e=n.a(_bs.e.a().l.a());var f=new _e.b(_bs.Q.c,i);var u=new _a.bk(f,null);e.a(u,function(n){n.a(2,function(n,i,u){if(i.length===1)r(t.fromQueryResultEntry(i[0]));else{_a.b.e(i.length,0,0,"UID should be unique.");r(null)}},null)},null)};_bs.Q.b=function(n){return _bs.d.a(n.ItemId.Id)};_bs.Q.prototype={c:function(){return this.k.UID},l:function(){return _bs.e.a().l},K:function(n){_a.b.a(n.ItemId,"ItemId");_a.b.c(n.ItemId.Id,"ItemId.Id");_a.b.a(n.UID,"UID")},H:function(n){return _bs.Q.b(n)},I:function(n){return new ItemMetadata}};_bs.P=function(n){this.a=n};_bs.P.prototype={a:null,f:function(n,t,i,r,u,f){_a.b.a(r,"shape");_a.b.f(r.BaseShape,"IdOnly","shape.BaseShape");var l=this;var e=function(n){_bs.b.a(n,f)};var h=[];var o=[];var s=this,c=this;this.a.a(new _e.a("Calendar.GetCalendarView"),function(u){var f=u.a(_bs.e.a().g.a());s.m(f,n,t,i,r,o,e);s.n(f,n,t,i,r,h,e)},function(){u(c.l(h,o))},e)},k:function(n,t,i,r){var o=new _e.d(_bs.u.b,24,0,0);var h=this;var u=function(n){_bs.b.a(n,r)};var f=[];var e=this,s=this;this.b(o,function(i){var r=new _bs.P.b(n);e.d(i,r,t,f,u)},function(){i(f)},u)},i:function(n,t,i,r,u,f){_a.b.a(n,"calendarFolderId");_a.b.a(t,"initialDate");_a.b.a(r,"shape");_a.b.f(r.BaseShape,"IdOnly","shape.BaseShape");_a.b.a(u,"successCallback");var l=this;var e=function(n){_bs.b.a(n,f)};var h=[];var o=0;var s=this,c=this;this.b(null,function(u){u.b(function(n){o=n},e);var f=s.e(t);u.c(0,f,function(t){t&&u.a(i,function(t,i,u){var f=new _bs.P.b(n);s.c(i,f,r,h)},e)},e)},function(){u(h,o)},e)},h:function(n,t,i,r,u,f){_a.b.a(r,"shape");_a.b.f(r.BaseShape,"IdOnly","shape.BaseShape");var l=this;var e=function(n){_bs.b.a(n,f)};var s=[];var o=0;var h=this,c=this;this.b(null,function(u){u.b(function(n){o=n},e);u.d(t,function(){u.a(i,function(t,i,u){var f=new _bs.P.b(n);h.c(i,f,r,s)},e)},e)},function(){u(s,o)},e)},o:function(n,t,i){_a.b.a(n,"date");_a.b.a(t,"successCallback");var u=-1;var o=this;var r=function(n){_bs.b.a(n,i)};var f=this,e=this;this.b(null,function(t){var i=f.e(n);t.c(0,i,function(n){u=t.e()},r)},function(){t(u)},r)},e:function(n){return new _e.d(_bs.u.a,n,1,0)},b:function(n,t,i,r){var u=this;this.a.a(new _e.a("Calendar.QueryCalendarItemsInTransaction"),function(i){var e=i.a(_bs.e.a().g.a());var f=[new _a.ca(_bs.u.a,0)];var u=new _a.bk(n,f);e.a(u,t,r)},i,r)},l:function(n,t){for(var f=_j.n.b(_bs.P.a,2,"FindItems_MergeResults"),r=t,e=r.length,i=0;i<e;++i){var u=r[i];var o=this;_ff.s.b(n,u,function(n,t){var r=n.k.Start;var i=t.k.Start;return r.localeCompare(i)})}_j.n.a(f);return n},n:function(n,t,i,r,u,f,e){var v=_j.n.b(_bs.P.a,2,"ReadCalendarViewShortDurationItems");var a=this.a.h(i);var y=_a.d.b(a);var w=y.A(-25);var p=w.i();var s=this.a.h(r);var o=new _e.e(_bs.u.a,p,s,2);var h=[new _a.ca(_bs.u.a,0)];var l=new _a.bk(o,h);var c=new _bs.P.d(t,i,r);this.g(n,l,c,u,f,e);_j.n.a(v)},m:function(n,t,i,r,u,f,e){var h=_j.n.b(_bs.P.a,2,"ReadCalendarViewLongDurationItems");var c=new _e.d(_bs.u.b,25,1,0);var o=new _a.bk(c,null);var s=new _bs.P.c(t,i,r);this.g(n,o,s,u,f,e);_j.n.a(h)},g:function(n,t,i,r,u,f){var s=String.format("ReadCalendarViewItems_{0}",t.b.a[0].a);var o=_j.n.b(_bs.P.a,517,s);var e=this;n.a(t,function(n){_j.n.a(o);e.d(n,i,r,u,f)},f)},d:function(n,t,i,r,u){var e=_j.n.b(_bs.P.a,517,"FindItems_ReadCalendarViewQueryResult");var f=this;n.a(350,function(o,s,h){_j.e.a(_bs.P.a,"resultSet.Length = "+s.length);if(s.length>0){var c=_j.n.b(_bs.P.a,2,"ProcessCalendarViewQueryResult_"+s.length);f.c(s,t,i,r);_j.n.a(c)}_j.n.a(e);h||f.d(n,t,i,r,u)},u)},c:function(n,t,i,r){for(var e=_j.n.b(_bs.P.a,2,"FindItem_ProcessCalendarViewQueryResult_"+n.length),u=0;u<n.length;u++){var f=this.j(n[u],i);t.e(f)&&Array.add(r,f)}_j.n.a(e)},j:function(n,t){var o=n.a;var r=o.Data;var i=new _g.z;i.ItemId=r.ItemId;for(var s=t.AdditionalProperties,c=s.length,u=0;u<c;++u){var e=s[u];switch(e.FieldURI){case"ItemParentId":i.ParentFolderId=r.ParentFolderId;break;case"Sensitivity":i.Sensitivity=r.Sensitivity;break;case"AppointmentState":i.AppointmentState=r.AppointmentState;break;case"IsCancelled":i.IsCancelled=r.IsCancelled;break;case"IsSeriesCancelled":i.IsSeriesCancelled=r.IsSeriesCancelled;break;case"HasAttachments":i.HasAttachments=r.HasAttachments;break;case"LegacyFreeBusyStatus":i.FreeBusyType=r.FreeBusyType;break;case"CalendarItemType":i.CalendarItemType=r.CalendarItemType;break;case"Start":i.Start=r.Start;i.StartWallClock=r.StartWallClock;i.StartTimeZoneId=r.StartTimeZoneId;break;case"End":i.End=r.End;i.EndWallClock=r.EndWallClock;i.EndTimeZoneId=r.EndTimeZoneId;break;case"MyResponseType":i.ResponseType=r.ResponseType;break;case"IsAllDayEvent":i.IsAllDayEvent=r.IsAllDayEvent;break;case"EnhancedLocation":i.Location=r.Location;break;case"Organizer":i.Organizer=r.Organizer;break;case"AppointmentReplyTime":i.AppointmentReplyTime=r.AppointmentReplyTime;break;case"Subject":i.Subject=r.Subject;break;case"IsMeeting":i.IsMeeting=r.IsMeeting;break;case"UID":i.UID=r.UID;break;case"InstanceKey":i.InstanceKey=r.InstanceKey;break;case"ItemEffectiveRights":i.EffectiveRights=r.EffectiveRights;break;case"JoinOnlineMeetingUrl":i.JoinOnlineMeetingUrl=r.JoinOnlineMeetingUrl;break;case"ConversationId":i.ConversationId=r.ConversationId;break;case"CalendarIsResponseRequested":i.IsResponseRequested=r.IsResponseRequested;break;case"Categories":i.Categories=r.Categories;break;case"IsRecurring":i.IsRecurring=r.IsRecurring;break;case"IsOrganizer":i.IsOrganizer=r.IsOrganizer;break;case"Charm":i.Charm=r.Charm;break;case"SuggestionCategory":i.SuggestionCategory=r.SuggestionCategory;break;case"EntityNamesMap":i.EntityNamesMap=r.EntityNamesMap;break;default:throw Error.invalidOperation(String.format("Invalid calendar shape property URI: {0}",e.FieldURI));}}var f=new PersistedDataRecord;f.Data=i;f.Metadata=o.Metadata;var h=new _a.eq(n.b,f);return this.a.fromQueryResultEntry(h)}};_bs.P.b=function(n){this.b=n};_bs.P.b.prototype={b:null,e:function(n){return n.j()===this.b&&this.a(n)},a:function(n){return!0}};_bs.P.e=function(n,t,i){_bs.P.e.initializeBase(this,[n]);this.d=t;this.c=i};_bs.P.e.prototype={d:null,c:null,a:function(n){return _bs.P.b.prototype.a.call(this,n)&&this.f(n)},f:function(n){var t=n.g().localeCompare(this.d);var i=n.h().localeCompare(this.c);return t>0&&i<0||!t&&n.h()===n.g()}};_bs.P.d=function(n,t,i){_bs.P.d.initializeBase(this,[n,t,i])};_bs.P.d.prototype={a:function(n){return _bs.P.e.prototype.a.call(this,n)&&n.f()<25}};_bs.P.c=function(n,t,i){_bs.P.c.initializeBase(this,[n,t,i])};_bs.P.c.prototype={a:function(n){return _bs.P.e.prototype.a.call(this,n)&&n.f()>=25}};_bs.cX=function(n,t,i){_bs.cX.initializeBase(this);_a.b.a(n,"calendarRecurrenceMasterItemStore");_a.b.a(t,"calendarItemStore");this.b=n;this.a=t;this.c=i};_bs.cX.prototype={b:null,a:null,c:null,e:function(n){_a.b.a(n,"tx");this.b.c(n);this.a.c(n);this.c.b(n,_bs.d.a("CalendarSyncState"))}};_bs.bL=function(n,t){_a.b.a(n,"calendarItemStore");_a.b.a(t,"calendarRecurrenceMasterStore");this.a=n;this.b=t};_bs.bL.a=function(n){_a.b.a(n,"itemStoreGetter");return new _bs.bL(n.b(),n.f())};_bs.bL.prototype={a:null,b:null,d:function(n,t,i){var r=this;this.c(n,t,function(t){t?r.b.i(n,t.a(),i):i()})},c:function(n,t,i){_a.b.a(n,"tx");_a.b.a(t,"id");var r=this;this.b.bindIn(n,t,function(t){if(t){var u=new _e.b(_bs.u.c,t.c());r.a.f(n,u,function(){_bs.b.d(t,i)})}else _bs.b.d(t,i)},null)}};_bs.ch=function(n){_bs.ch.initializeBase(this);_a.b.a(n,"itemStore");this.a=n};_bs.ch.prototype={a:null,e:function(n){_a.b.a(n,"tx");this.a.c(n)}};_bs.f=function(n,t,i,r){this.u=new Sys.EventHandlerList;this.x=n;this.z=t;this.y=i;this.s=r};_bs.f.prototype={x:0,y:null,z:null,s:null,n:null,p:null,w:"owa_offline_db",o:null,v:!1,r:null,t:!1,q:null,f:function(n){this.u.addHandler("IsAvailable",n)},h:function(n){this.u.removeHandler("IsAvailable",n)},c:function(){return this.v},G:function(n){if(n!==this.v){this.v=n;var t=this.u.getHandler("IsAvailable");t&&t(this.t)}return n},d:function(){return this.n},i:function(){return this.p},a:function(){return this.N()},N:function(){this.r||(this.r=new _a.es);return this.r},g:function(){return this.q},b:function(n){return _bs.d.a(n)},F:function(n,t,i,r){var u=this;_bs.bD.a(n,t,function(n){for(var r=new Array(n.length),t=0;t<n.length;t++)r[t]=n[t].k;u.r.h(r);_bs.b.c(i)},r)},j:function(n,t){_a.b.a(n,"succeededCallback");_a.b.a(t,"failedCallback");var r=this.D();_a.b.a(r,"Databases are not supported by this browser. Check UserAgent.OfflineSupported before calling Install.");this.t=!1;var i=this,u=this;this.S(r,function(){i.G(!0);i.r=new _a.es;var r=new(_bs.bO.$$(_bc.I,_bs.bD))(i,_bs.f.b);r.a(new _e.a("ClientStore.Install.LoadTimeZones"),function(n){var t=n.a(i.m().d().a());i.F(r,n,function(){},function(n){_j.e.c(_bs.f.a,"Failed to load the time zone offsets table: {0}",n.a())})},function(){n()},function(n){var r=Error.create(n.a);_j.e.c(_bs.f.a,"Unexpected error during ClientStore Install: {0}",r.message);i.e();t(r)})},function(n){_j.e.c(_bs.f.a,"Unexpected error during ClientStore Install: {0}",n.message);u.e();t(n)})},l:function(n,t){_a.b.a(n,"succeededCallback");_a.b.a(t,"failedCallback");var r=this.D();if(this.n){this.n.j();this.n=null}var i=this,u=this;r.a(this.w,function(){i.e();n()},function(n){_j.e.c(_bs.f.a,"Unexpected error during ClientStore Uninstall: {0}",n.a);t(new _bs.b(n).b())})},e:function(){this.R()},k:function(n,t){_a.b.c(n,"timezoneId");_a.b.a(t,"eventAggregator");if(!this.o){this.o=new _bs.cW(t);this.o.f(this,n)}},D:function(){return this.y},m:function(){return this.z},J:function(){this.q=new _bs.cZ(this.m().c(),this.n)},S:function(n,t,i){var f=this;var u=function(n){i(new _bs.b(n).b())};var r=this;n.b(this.w,this.x,function(n){n.e()!==r.m().b()?r.V(n,function(){r.t=!0;r.E(n);r.C(t,i)},u):r.W(n,function(){r.E(n);r.U(t,i)},u)},u)},W:function(n,t,i){for(var u={},h=n.a(),s=0;s<h.length;++s)u[h[s]]=null;var r=new _j.q;var o=new _j.q;this.P(n,u,r,o);for(var e=0;e<r.a();++e)delete u[r.b(e).a()];var c=this.O(u);if(r.a()||o.a()||c.length){this.t=!0;var f=this;n.c(this.m().b(),this.B(),function(n){f.L(n,o);f.M(n,r);f.K(n,c)},t,i)}else t()},B:function(){return _bs.e.e(this.m(),this.s)},P:function(n,t,i,r){for(var e=_ff.i.b(t),l=this.m(),h=this.m().a(),f=0;f<h.length;++f){var o=h[f];o.a()in e&&!this.T(n,o)&&delete e[o.a()]}var a=e;for(var c in a){var s={key:c,value:a[c]};var u=l.e(s.key);if(u){i.g(u)||i.c(u);u.d().d(i,r)}else i.c(new _bs.z(s.key,"obsolete",new Array(0),new Array(0),_bs.D.a,0,0,!1,new _bs.y(l)))}},T:function(n,t){var i=!1;n.l(t.a())!==t.b()?i=!0:this.Q(n,t)&&(i=!0);return i},Q:function(n,t){for(var s=!1,e=t.c(),h=e.length,u=0;u<h;++u){var i=e[u];var f=i.a;var r=this.s.g(f);var o=Array.indexOf(n.k(),f)>=0;if(r!==o)if(!i.b&&r)return!0;else if(i.b!==1||r){if(i.b===2)return!0}else return!0}return s},M:function(n,t){for(var i=0;i<t.a();++i)n.d(t.b(i).a())},L:function(n,t){for(var i=0;i<t.a();++i){var r=t.b(i);n.c(r.c().a(),r.b().b())}},K:function(n,t){for(var i=0;i<t.length;++i)this.A(t[i],n)},O:function(n){for(var r=[],t=0;t<this.m().a().length;++t){var i=this.m().a()[t];i.a()in n||Array.add(r,i)}return r},V:function(n,t,i){_j.e.a(_bs.f.a,"Wiping db.  Actual version '{0}' not equal to desired version '{1}'",n.e(),this.m().b());var r=this;n.i(function(){n.c(r.m().b(),r.B(),function(n){for(var t=0;t<r.m().a().length;++t)r.A(r.m().a()[t],n)},t,i)},i)},U:function(n,t){var r=_bs.E.a(this);var i=this;r.j(function(r){if(_j.h.a(r))i.C(n,t);else{i.p=r;n()}},t)},C:function(n,t){this.p=(_a.d.a().h().toString()+Math.random().toString().substr(2)).substr(0,32);var r=_bs.E.a(this);var i=this;r.q(this.p,n,function(n){_j.e.c(_bs.f.a,"Unexpected error setting the DatabaseId: {0}",n.message);i.p=null;i.l(function(){t(n)},function(i){_j.e.c(_bs.f.a,"Failed to uninstall database after failing to set the database Id: {0}",i.message);t(Error.create(n.message+" "+i.message))})})},A:function(n,t){t.b(n.a(),n.b(),n.h()===1,n.f());this.H(n,t);this.I(n,t)},H:function(n,t){for(var u=n.e(),f=u.length,i=0;i<f;++i){var r=u[i];t.a(n.a()+"_"+r.b,n.a(),r.a)}},I:function(n,t){for(var f=n.c(),s=f.length,u=0;u<s;++u){var i=f[u];if(this.s.g(i.a))for(var e=i.c,h=e.length,r=0;r<h;++r){var o=e[r];t.a(n.a()+"_"+i.a+"_"+o.b,n.a(),o.a)}}},E:function(n){this.n=n;this.J()},R:function(){if(this.n){this.o&&this.o.d(this.n);this.n.m()}this.q&&this.q.dispose();this.q=null;this.o=null;this.n=null;this.p=null;this.G(!1)}};_bs.cZ=function(n,t){this.i=Function.createDelegate(this,this.o);this.h=Function.createDelegate(this,this.n);this.g=Function.createDelegate(this,this.m);this.j=Function.createDelegate(this,this.l);_bs.cZ.initializeBase(this);this.c={};this.e=t;this.d=n;this.p()};_bs.cZ.prototype={d:null,c:null,f:null,e:null,p:function(){this.f=new Array(this.d.length);for(var t=0;t<this.d.length;t++){var i=this.d[t];this.c[i]={};this.e.f(i,this.j);var n=this.e.d(i);this.f[t]=n;n.d(this.g);n.b(this.h);n.e(this.i)}},D:function(){for(var n=0;n<this.d.length;n++){var i=this.d[n];this.e.h(i);var t=this.f[n];t.f(this.g);t.c(this.h);t.g(this.i);delete this.c[i]}},a:function(n,t){var r=null;var i=this.c[n];i&&(r=i[t]);return r},b:function(n,t,i){var r=this.c[n];r&&(r[t]=i)},o:function(n,t){var r=n.a();var i=this.c[r];delete i[t.a().toString()]},n:function(n,t){var r=n.a();var i=this.c[r];delete i[t.a().toString()]},m:function(n,t){this.c[n.a()]={}},l:function(n,t,i){var r=this.c[n];this.k(r,t.a(),n);this.k(r,t.b(),n)},k:function(n,t,i){for(var f=t,e=f.length,r=0;r<e;++r){var u=f[r];n[u.c.toString()]=u.d.Data}}};_bs.b=function(n){this.e=this.toString;this.f=n;if(n.b===3){_j.e.b(_bs.f.a,"QuotaError handled.");var t=_bs.b.e.getHandler(_a.dy.toString(3));t&&t()}};_bs.b.g=function(n){_bs.b.h(n)};_bs.b.i=function(n){_bs.b.j(n)};_bs.b.d=function(n,t){t&&t(n)};_bs.b.c=function(n){n&&n()};_bs.b.a=function(n,t){var i=new _bs.b(n);t&&t(i)};_bs.b.f=function(n){return function(t){n(t.b())}};_bs.b.b=function(n){return function(t){_bs.b.a(t,n)}};_bs.b.h=function(n){_bs.b.e.addHandler(_a.dy.toString(3),n)};_bs.b.j=function(n){_bs.b.e.removeHandler(_a.dy.toString(3),n)};_bs.b.prototype={f:null,a:function(){return this.f.a},c:function(){return this.f.b===4},d:function(){return this.f.b===3},b:function(){var n=this;n.__type="clientStoreError";n.isTransientError=this.f.b===4||this.f.b===3;return Error.create(this.f.a,n)},toString:function(){return this.f.a}};_bs.bj=function(){_bs.bj.initializeBase(this)};_bs.bj.a=function(n){_a.b.a(n,"id");_a.b.c(n.Id,"id.Id");return _bs.d.a(n.Id)};_bs.bj.b=function(n,t,i,r){_g.bW._TZ(n,t,i,r)};_bs.bj.prototype={l:function(){return _bs.e.a().r},H:function(n){return _bs.bj.a(n.PersonaId)},I:function(n){return new ItemMetadata},K:function(n){_a.b.a(n.PersonaId,"PersonaId");_a.b.c(n.PersonaId.Id,"PersonaId.Id")},t:function(n,t,i){_bs.bj.b(n,t,i,this.m.a())}};_bs.db=function(n,t,i,r){_bs.db.initializeBase(this,[n,t,i,!1,r,6])};_bs.db.prototype={a:function(){return _bs.e.a().f.a()},s:function(n){},u:function(n){return n.d()}};_bs.bN=function(n,t){_bs.bN.initializeBase(this,[n,t])};_bs.bN.prototype={g:null,K:function(){return _bs.e.a().f.a()},i:function(n,t,i){this.G(n,t,!0,i)},deleteWithoutTombstoning:function(n,t){for(var r=t,f=r.length,i=0;i<f;++i){var u=r[i];this.G(n,u,!1,null)}},updateReadFlagDirtyConversations:function(n,t,i){_bs.C.i(n,this,t,i)},getConversations:function(n,t,i,r,u,f){_a.b.a(n,"folderId");_a.b.a(t,"request");_a.b.a(i,"actionContext");_a.b.a(r,"conversationViewData");_a.b.a(u,"successCallback");this.g=r;var e=this;_bs.co.prototype.L.call(this,t.Paging,_bs.C.e(),function(){var t=new _e.b(ConversationItemMetadata.b(),n);return new _a.bk(t,[new _a.ca(ConversationItemMetadata.a(),1)])},u,f)},N:function(n,t){t(this.g.TotalConversationsInView)},q:function(n,t){for(var f=this.p(this.g),o=f.h(),i=0;i<n.length;++i){var u=this.fromQueryResultEntry(n[i]);var r=u.get_data();var e=this.l(r.LastDeliveryOrRenewTime,r.LastDeliveryTime).h();if(e>=o)Array.add(t,r);else{_j.e.a(_bs.f.a,"Ignoring items outside the sync window, lastDeliveryTime = {0}, oldestLastDeliveryTime = {1}",u.get_data().LastDeliveryTime,f);break}}},G:function(n,t,i,r){_a.b.a(n,"tx");_a.b.a(t,"id");if(i){var u=this;this.bindIn(n,t,function(i){if(i){var o=i.get_data();var s=new _bs.cx(u.y,u.z);var f=TombstonedItemRecord.a(o.ConversationId.Id,"ConversationItem",null);var e=s.fromData(f);e.b(n,null)}_bs.bO.prototype.i.call(u,n,t,r)},null)}else _bs.bO.prototype.i.call(this,n,t,r)},l:function(n,t){var i=_a.d.a();var r=_a.d.b(t);_j.h.d(n)||(i=_a.d.b(n));return _g.g.g(i)?i.l(r.h()):r},p:function(n){if(n.LastRowInSyncWindow.length===2){var r=this.u(n.LastRowInSyncWindow[0].toString());var i=this.u(n.LastRowInSyncWindow[1].toString());return this.l(r,i)}else{var t=this.u(n.LastRowInSyncWindow[0].toString());return this.l(null,t)}}};_bs.ci=function(n,t){_bs.ci.initializeBase(this,[n,"ConversationNodeSyncStateId"]);_a.b.e(t,0,10,"maxDirtyConversationsToGet");this.c().l=t};_bs.ci.prototype={h:function(n){return new _bs.cj(this.g.i(),this.g.d(),this.g.k())}};_bs.e=function(){this.j=this.M();this.q=this.U();this.f=this.L();this.u=this.W();this.x=this.K();this.h=this.O();this.n=this.P();this.i=this.D();this.o=this.Q();this.r=this.J();this.g=this.H();this.l=this.I();this.v=this.E();this.w=this.F();this.A=this.T();this.z=this.R();this.p=this.S();this.k=this.G();this.t=this.V();this.y=this.N();var e=this.m("FolderHierarchySyncStateId");var f=this.m("ConversationSyncStateId");var s=this.m("MessageSyncStateId");var o=this.m("RemindersSyncStateId");var u=this.m("PeopleFiltersSyncStateId");var t=this.m("PeopleSyncStateId");var n=this.m("CalendarSyncState");var r=this.m("TimeZoneOffsetsSyncStateId");var h=this.m("OwaUserConfigurationSyncStateId");var i=this.m("AttachmentsStateId");this.j.i.b(e).f(1);this.q.i.f(1);this.f.i.b(f).a(this.x).a(this.k).a(this.h).a(this.u);this.u.i.c();this.x.i.a(this.f);this.h.i.b(s).a(this.k).a(this.f).a(this.u);this.o.i.a(this.r);this.r.i.b(t).a(this.o);this.g.i.b(n).a(this.l);this.l.i.a(this.g);this.v.i.a(this.w);this.w.i.a(this.v);this.A.i.e();this.t.i.b(r).e();this.k.i.b(i).a(this.y);this.p.i.b(o);this.z.i.b(u);this.y.i.c();this.n.i.c();this.i.i.c();this.s=[this.q,this.j,this.f,this.u,this.x,this.h,this.n,this.i,this.o,this.r,this.g,this.l,this.v,this.w,this.A,this.z,this.p,this.k,this.t,this.y]};_bs.e.a=function(){return _bs.e.c||(_bs.e.c=new _bs.e)};_bs.e.e=function(n,t){_a.b.a(n,"client store schema");_a.b.a(t,"flight manager");for(var s={},f=[],o=n.a(),l=o.length,u=0;u<l;++u)for(var h=o[u],e=h.c(),a=e.length,r=0;r<a;++r){var c=e[r];var i=c.a;if(t.g(i)&&!(i in s)){s[i]=null;Array.add(f,i)}}return f};_bs.e.prototype={s:null,B:null,j:null,q:null,f:null,u:null,x:null,h:null,n:null,i:null,o:null,r:null,g:null,l:null,v:null,w:null,A:null,z:null,p:null,k:null,t:null,y:null,b:function(){return _bs.e.d},a:function(){return this.s},c:function(){if(!this.B){this.B=new Array(0);for(var i=this.s,r=i.length,n=0;n<r;++n){var t=i[n];t.p&&Array.add(this.B,t.l)}}return this.B},d:function(){return this.t},e:function(n){for(var t=0;t<this.s.length;++t)if(this.s[t].a().toLowerCase()===n.toLowerCase())return this.s[t];return null},U:function(){return new _bs.z("Sync","15.0.0612.00",null,null,null,0,1,!0,new _bs.y(this))},M:function(){var r=[new _a.Q(FolderItemMetadata.c(),0),new _a.Q(FolderItemMetadata.a(),1)];var u=[new _a.Q(FolderItemMetadata.a(),1)];var i=[new _a.Q(FolderItemMetadata.b(),0)];var n=[new _bs.h("ParentId",r),new _bs.h("FolderPosition",u),new _bs.h("DistinguishedFolderId",i)];var t=new _bs.D("SuperStart",n,2);return new _bs.z("Folders","15.0.0742.00",n,null,[t],0,1,!1,new _bs.y(this))},L:function(){var u=[new _a.Q(ConversationItemMetadata.b(),0),new _a.Q(ConversationItemMetadata.a(),0)];var f=[new _a.Q(_bs.C.a(),1),new _a.Q(ConversationItemMetadata.a(),0)];var e=[new _a.Q(_bs.C.a(),1)];var r=[new _a.Q(_bs.C.b(),0)];var t=[new _a.Q(_bs.C.e(),0)];var n=[new _bs.h("ParentIdDateTimeSort",u),new _bs.h("DirtyState",f),new _bs.h("DirtyStateIndexAloneField",e),new _bs.h("ConversationId",r),new _bs.h("InstanceKey",t),new _bs.h("SaveMode",_bs.e.b)];var i=new _bs.D("OwaOfflinePinnedSupport",n,2);return new _bs.z("Conversations","16.0.0894.00",n,null,[i],0,1,!1,new _bs.y(this))},W:function(){var t=[new _a.Q(_bs.cw.a(),0)];var n=[new _bs.h("ItemType",t)];return new _bs.z("TombstonedItems","15.0.0503.00",n,null,_bs.D.a,0,1,!1,new _bs.y(this))},K:function(){var n=[new _bs.h("SaveMode",_bs.e.b)];return new _bs.z("ConversationNodes","15.0.0904.00",n,null,_bs.D.a,0,1,!1,new _bs.y(this))},O:function(){return this.C("Messages",1)},P:function(){return this.C("Outbox",0)},C:function(n,t){_a.b.c("name",n);var u=[new _a.Q(MessageItemMetadata.b(),0),new _a.Q(MessageItemMetadata.a(),0)];var f=[new _a.Q(MessageItemMetadata.c(),0),new _a.Q(MessageItemMetadata.a(),0)];var i=[new _a.Q(_bs.U.b(),0)];var r=[new _bs.h("DateTime",u),new _bs.h("IsDataSynced",f),new _bs.h("InstanceKey",i),new _bs.h("SaveMode",_bs.e.b)];return new _bs.z(n,"16.0.0793.00",r,null,_bs.D.a,0,t,!1,new _bs.y(this))},D:function(){var i=[new _a.Q(_bs.bi.b,1)];var t=[new _a.Q(ActionItemMetadata.a(),0)];var n=[new _bs.h("State",i),new _bs.h("IsHighPriority",t)];return new _bs.z("Actions","15.0.0526.00",n,null,null,1,0,!1,new _bs.y(this))},Q:function(){var l=[new _a.Q(_bs.g.g,0)];var a=[new _a.Q(_bs.g.c,0)];var h=[new _a.Q(_bs.g.a,0)];var c=[new _a.Q(_bs.g.b,0)];var v=[new _a.Q(_bs.g.c,0),new _a.Q(_bs.g.a,0)];var w=[new _a.Q(_bs.g.c,0),new _a.Q(_bs.g.b,0)];var b=[new _a.Q(_bs.g.d,0),new _a.Q(_bs.g.a,0)];var y=[new _a.Q(_bs.g.d,0),new _a.Q(_bs.g.b,0)];var p=[new _a.Q(_bs.g.f,0),new _a.Q(_bs.g.a,0)];var i=[new _a.Q(_bs.g.f,0),new _a.Q(_bs.g.b,0)];var r=[new _a.Q(_bs.g.h,0),new _a.Q(_bs.g.a,0)];var n=[new _a.Q(_bs.g.h,0),new _a.Q(_bs.g.b,0)];var t=[new _a.Q(_bs.g.e,0),new _a.Q(_bs.g.a,0)];var u=[new _a.Q(_bs.g.e,0),new _a.Q(_bs.g.b,0)];var o=[new _a.Q(_bs.g.k,1),new _a.Q(_bs.g.a,0)];var s=[new _a.Q(_bs.g.j,0)];var f=[new _a.Q(_bs.g.i,0)];var e=[new _bs.h("PersonaId",l),new _bs.h("FolderId",a),new _bs.h("DisplayNameFirstLast",h),new _bs.h("DisplayNameLastFirst",c),new _bs.h("ActualLastFirst",s),new _bs.h("ActualFirstLast",f),new _bs.h("CompanyNameFirstLast",b),new _bs.h("CompanyNameLastFirst",y),new _bs.h("HomeCityFirstLast",p),new _bs.h("HomeCityLastFirst",i),new _bs.h("WorkCityFirstLast",r),new _bs.h("WorkCityLastFirst",n),new _bs.h("CreationTimeFirstLast",t),new _bs.h("CreationTimeLastFirst",u),new _bs.h("RelevanceScoreFirstLast",o),new _bs.h("SaveMode",_bs.e.b),new _bs.h("FolderIdDisplayNameFirstLast",v),new _bs.h("FolderIdDisplayNameLastFirst",w)];return new _bs.z("PartialPersona","15.0.0692.00",e,null,null,0,1,!1,new _bs.y(this))},J:function(){var n=[new _bs.h("SaveMode",_bs.e.b)];return new _bs.z("CompletePersona","15.0.0692.00",n,null,_bs.D.a,0,1,!1,new _bs.y(this))},H:function(){var r=[new _a.Q(_bs.u.a,0)];var u=[new _a.Q(_bs.u.b,1)];var i=[new _a.Q(_bs.u.d,0)];var n=[new _a.Q(_bs.u.c,0)];var t=[new _bs.h("ShortDurationCalendarViewItemsIndices",r),new _bs.h("LongDurationCalendarViewItemsIndices",u),new _bs.h("PrunningFields",i),new _bs.h("RecurrenceIndices",n),new _bs.h("SaveMode",_bs.e.b)];return new _bs.z("CalendarItem","15.0.0594.00",t,null,_bs.D.a,0,1,!1,new _bs.y(this))},I:function(){var t=[new _a.Q(_bs.Q.c,0)];var n=[new _bs.h("RecurrenceIndices",t),new _bs.h("SaveMode",_bs.e.b)];return new _bs.z("CalendarRecurrenceMaster","15.0.0594.00",n,null,_bs.D.a,0,1,!1,new _bs.y(this))},E:function(){return new _bs.z("AddressbookOperation","15.0.0239.00",null,null,_bs.D.a,1,1,!1,new _bs.y(this))},F:function(){return new _bs.z("AddressbookPersona","15.0.0239.00",null,null,_bs.D.a,0,1,!1,new _bs.y(this))},T:function(){return new _bs.z("Settings","15.0.0380.00",null,null,_bs.D.a,0,0,!1,new _bs.y(this))},R:function(){var i=new _a.R("Data.SortGroupPriority");var t=[new _a.Q(i,1)];var n=[new _bs.h("sortGroupPriorityIndex",t)];return new _bs.z("PeopleFilter","15.0.0441.00",n,null,_bs.D.a,0,1,!1,new _bs.y(this))},G:function(){var r=[new _a.Q(_bs.x.c,0)];var u=[new _a.Q(_bs.x.d,0)];var f=[new _a.Q(_bs.x.b,1)];var n=[new _a.Q(_bs.x.a,1)];var t=[new _a.Q(_bs.x.a,1),new _a.Q(_bs.x.d,0)];var i=[new _bs.h("messageIdFields",r),new _bs.h("messageReceivedDateTimeFields",u),new _bs.h("attachmentTypeFields",f),new _bs.h("attachmentTypeAndSyncStatusFields",n),new _bs.h("attachmentTypeAndSyncStatusByMessageRecievedDateTimeFields",t)];return new _bs.z("AttachmentInfo","15.0.0557.00",i,null,_bs.D.a,0,1,!1,new _bs.y(this))},S:function(){var i=[new _a.Q(_bs.J.b,0)];var t=[new _a.Q(_bs.J.c,0)];var n=[new _bs.h("ReminderTime",i),new _bs.h("RecurrenceIndices",t)];return new _bs.z("Reminders","15.0.0575.00",n,null,_bs.D.a,0,1,!1,new _bs.y(this))},V:function(){return new _bs.z("TimeZoneOffsets","15.0.0314.00",null,null,_bs.D.a,0,0,!1,new _bs.y(this))},N:function(){return new _bs.z("InlineImages","15.0.0557.00",null,[_bs.cl.a],_bs.D.a,0,1,!1,new _bs.y(this))},m:function(n){return new _bs.df(_bs.d.a(n),this.q,new _bs.y(this))}};_bs.y=function(n){this.h=new _j.q;this.g=new _j.q;this.j=new _j.q;this.k=n;this.i=!1};_bs.y.prototype={h:null,g:null,j:null,k:null,i:!1,a:function(n){this.h.c(n);return this},e:function(){this.i=!0;return this},b:function(n){this.g.c(n);return this},c:function(){this.g.f();this.h.f();this.j.f();this.i=!1},f:function(n){if(!n)throw Error.invalidOperation("cannot add dependency on 'none'");this.j.c(n);return this},d:function(n,t){this.p(n,t);this.o(n,t)},p:function(n,t){if(this.i)for(var r=this.k.a(),f=r.length,i=0;i<f;++i){var u=r[i];this.l(u,n,t)}else{this.m(n,t);this.n(n,t)}},o:function(n,t){for(var r=0;r<this.g.a();++r){var i=this.g.b(r);if(!t.g(i)){t.c(i);i.a().d(n,t)}}},n:function(n,t){for(var i=0;i<this.k.a().length;++i){var r=this.k.a()[i];this.j.g(r.g())&&this.l(r,n,t)}},m:function(n,t){for(var i=0;i<this.h.a();++i){var r=this.h.b(i);this.l(r,n,t)}},l:function(n,t,i){if(!t.g(n)){t.c(n);n.d().d(t,i)}}};_bs.dd=function(n,t){_bs.dd.initializeBase(this,[n,t])};_bs.dd.prototype={l:function(n,t,i){_a.b.a(t,"successCallback");var r=[];var u=this,e=this,f=this;this.a(new _e.a("FolderHierarchy.GetSubfolders"),function(t){var e=t.a(_bs.e.a().j.a());var f=new _e.b(FolderItemMetadata.c(),n);var i=new _a.bk(f,[new _a.ca(FolderItemMetadata.a(),0)]);e.a(i,function(n){u.p(n,r)},null)},function(){t(r)},function(n){_bs.b.a(n,i)})},g:function(n,t){_a.b.a(n,"successCallback");var i=[];var r=this,f=this,u=this;this.a(new _e.a("FolderHierarchy.GetAllFolders"),function(n){var u=n.a(_bs.e.a().j.a());var t=new _a.bk(null,[new _a.ca(FolderItemMetadata.a(),0)]);u.a(t,function(n){r.p(n,i)},null)},function(){n(i)},function(n){_bs.b.a(n,t)})},p:function(n,t){var i=this;n.a(50,function(r,u,f){for(var e=0;e<u.length;++e)Array.add(t,i.fromQueryResultEntry(u[e]));u.length>0&&i.p(n,t)},null)}};_bs.I=function(){_bs.I.initializeBase(this)};_bs.I.e=function(n){_a.b.a(n,"id");_a.b.c(n.Id,"id.Id");return _bs.d.a(n.Id)};_bs.I.d=function(n){_a.b.a(n,"data");return _bs.I.e(n.FolderId)};_bs.I.a=function(n,t,i,r){_a.b.a(n,"folderItemStore");_a.b.a(i,"successCallback");var f=t;_a.b.c(f,"distinguishedFolderId");var u=null;n.a(new _e.a("FolderItem.FromDistinguishedFolderId"),function(t){var e=t.a(_bs.e.a().j.a());var r=new _e.b(FolderItemMetadata.b(),f);var i=new _a.bk(r,null);e.a(i,function(t){t.a(2,function(t,i,r){i.length>0&&(u=n.fromQueryResultEntry(i[0]))},null)},null)},function(){i(u)},function(n){_bs.b.a(n,r)})};_bs.I.b=function(n){return n.__FolderPositionIndex};_bs.I.c=function(n,t){n.__FolderPositionIndex=t};_bs.I.prototype={l:function(){return _bs.e.a().j},K:function(n){_a.b.a(n.FolderId,"FolderId");_a.b.c(n.FolderId.Id,"FolderId.Id");_a.b.a(n.ParentFolderId,"ParentFolderId");_a.b.c(n.ParentFolderId.Id,"ParentFolderId.Id");_a.b.b(_bs.I.b(n),"FolderPositionIndex");_a.b.e(_bs.I.b(n),0,2147483647,"FolderPositionIndex")},H:function(n){return _bs.I.d(n)},I:function(n){var t=_j.h.a(n.DistinguishedFolderId)?"":n.DistinguishedFolderId;return new FolderItemMetadata(n.ParentFolderId.Id,t,_bs.I.b(n))}};_bs.Y=function(n){_bs.Y.initializeBase(this,[n])};_bs.Y.a=function(n,t){_a.b.a(n,"folderId");_a.b.c(n.Id,"folderId.Id");_a.b.a(t,"itemId");_a.b.c(t.Id,"itemId.Id");return new _bs.Y(n.Id+":"+t.Id)};function FolderItemMetadata(n,t,i){FolderItemMetadata.initializeBase(this);this.ParentClientStoreId=n;this.DistinguishedFolderId=t;this.FolderPositionIndex=i}FolderItemMetadata.c=function(){return new _a.R("Metadata.ParentClientStoreId")};FolderItemMetadata.b=function(){return new _a.R("Metadata.DistinguishedFolderId")};FolderItemMetadata.a=function(){return new _a.R("Metadata.FolderPositionIndex")};FolderItemMetadata.prototype={ParentClientStoreId:null,DistinguishedFolderId:null,FolderPositionIndex:0};_bs.cl=function(){_bs.cl.initializeBase(this)};_bs.cl.prototype={l:function(){return _bs.e.a().y},getUri:function(){var n=_a.eA.a(this.k.Blob);return n.a()},H:function(n){return _bs.d.a(n.Id)},I:function(n){return new ItemMetadata},K:function(n){}};_bs.cm=function(n,t){_bs.cm.initializeBase(this,[n,t])};_bs.h=function(n,t){_a.b.c(n,"name");_a.b.a(t,"fields");_a.b.e(t.length,1,2,"fields must be a 1 or 2 length array");this.b=n;this.a=t};_bs.h.prototype={b:null,a:null};function ItemMetadata(){}_bs.df=function(n,t,i){this.e=n;this.f=t;this.d=i};_bs.df.prototype={e:null,f:null,d:null,b:function(){return this.e},c:function(){return this.f},a:function(){return this.d}};_bs.z=function(n,t,i,r,u,f,e,o,s){_a.b.c(n,"name");this.l=n.toLowerCase();this.q=t;this.o=f;this.j=r||[];this.k=i||[];this.n=u||_bs.D.a;this.m=e;this.p=o;this.i=s;this.r()};_bs.z.prototype={l:null,q:null,k:null,j:null,o:0,m:0,p:!1,i:null,n:null,a:function(){return this.l},b:function(){return this.q},e:function(){return this.k},f:function(){return this.j},h:function(){return this.o},g:function(){return this.m},d:function(){return this.i},c:function(){return this.n},r:function(){if(this.j.length>0){for(var e={},o=this.k,c=o.length,t=0;t<c;++t)for(var a=o[t],f=a.a,h=f.length,n=0;n<h;++n){var l=f[n];e[l.a.a]=1}for(var u=this.j,s=u.length,i=0;i<s;++i){var r=u[i];if(r.a in e)throw Error.invalidOperation(String.format("The path {0} is declared as both an index and a blob",r.a));}}}};_bs.D=function(n,t,i){this.a=n;this.c=t||new Array(0);this.b=i};_bs.D.prototype={a:null,c:null,b:0};_bs.bO=function(n,t){this.F=Function.createDelegate(this,this.X);this.O=Function.createDelegate(this,this.T);this.E=Function.createDelegate(this,this.U);this.P=Function.createDelegate(this,this.V);_a.b.a(n,"store");_a.b.c(t,"timeZoneId");this.A=new Sys.EventHandlerList;this.y=n;this.z=t;this.C=(new this.$$gta["_bs.bO"].TItem).l()};_bs.bO.$$=function(n,t){var f=_bs.__tc=_bs.__tc||{};var i="bO"+"$"+n.getName().replace(/\./g,"_")+"$"+t.getName().replace(/\./g,"_");if(!f[i]){var u=f[i]=function(){for(var t=[],n=0;n<arguments.length;++n)t[n]=arguments[n];_bs.bO.apply(this,t)};u.registerClass("_bs.__tc."+i,null,_bc.bA,_bc.bB);var s={"_bs.bO":{TInterface:n,TItem:t},ctor:_bs.bO};u.prototype.$$gta=s;var o=_bs.bO.prototype;for(var e in o){var r={key:e,value:o[e]};"constructor"!==r.key&&(u.prototype[r.key]=r.value)}}return f[i]};_bs.bO.prototype={y:null,z:null,C:null,A:null,D:0,B:null,r:function(n){var t=this;this.H("OnAvailable",n,function(){t.y.f(t.F)});this.t()&&n(this)},w:function(n){var t=this;this.I("OnAvailable",n,function(){t.y.h(t.F)})},s:function(n){var t=this;this.Q("OnDelete",n,function(){t.B.b(t.E)})},x:function(n){var t=this;this.W("OnDelete",n,function(){t.B.c(t.E)})},t:function(){return this.y.c()},j:function(){return this.y},a:function(n,t,i,r){this.y.d().b(n,t,i,r)},n:function(n,t,i,r){this.a(new _e.a(n),t,i,r)},bindIn:function(n,t,i,r){var u=this;_bs.j.n(this.$$gta["_bs.bO"].TItem,this.y,n,t,this.z,function(n){u.Y(n,t);i(n)})},bindInWithCache:function(n,t,i,r){var u=this.S(t);u?i(u):this.bindIn(n,t,i,r)},bindMultipleIn:function(n,t,i,r){var u=this;_bs.j.o(this.$$gta["_bs.bO"].TItem,this.y,n,t,this.z,function(n){i(n)},r)},saveIn:function(n,t,i,r){if(!this.$$gta["_bs.bO"].TItem.isInstanceOfType(t))throw Error.argumentNull("data");var u=t;u.i(n,i,r)},d:function(n,t,i){_bs.j.v(this.$$gta["_bs.bO"].TItem,this.y,n,t,this.z,i)},b:function(n,t){this.i(n,t,null)},i:function(n,t,i){_bs.j.f(this.$$gta["_bs.bO"].TItem,n,t,i)},c:function(n){_bs.j.p(this.$$gta["_bs.bO"].TItem,n)},f:function(n,t,i){_bs.j.q(this.$$gta["_bs.bO"].TItem,n,t,i)},m:function(n,t,i,r,u){_bs.j.d(this.$$gta["_bs.bO"].TItem,n,t,i,r,u)},v:function(n,t,i){_a.b.a(n,"tx");var r=n.a(this.C.a());r.a(t,i,null)},fromData:function(n){return _bs.j.r(this.$$gta["_bs.bO"].TItem,this.y,n,this.z)},fromQueryResultEntry:function(n){return _bs.j.h(this.$$gta["_bs.bO"].TItem,this.y,n,this.z)},u:function(n){return this.y.a().b(_bs.f.b,this.z,n)},h:function(n){return this.y.a().b(this.z,_bs.f.b,n)},e:function(n,t,i,r){this.bindIn(n,t,i,r)},o:function(n,t,i,r){this.saveIn(n,t,i,r)},k:function(n){return this.fromData(n)},Q:function(n,t,i){this.D++||(this.B=this.y.d().d(this.C.a()));this.H(n,t,i)},W:function(n,t,i){this.I(n,t,i);--this.D<=0&&this.R()},H:function(n,t,i){this.A.getHandler(n)||i();this.A.addHandler(n,t)},I:function(n,t,i){this.A.removeHandler(n,t);this.A.getHandler(n)||i()},R:function(){this.D=0;if(this.B){this.B.dispose();this.B=null}},X:function(n){if(this.y.c()){var t=this.A.getHandler("OnAvailable");t&&t(this)}},V:function(n,t){var i=this.A.getHandler("OnPut");if(i){var r=new(_bs.cn.$$(this.$$gta["_bs.bO"].TInterface))(t.b(),_bs.j.g(this.$$gta["_bs.bO"].TItem,this.y,t.a(),t.d(),this.z));i(this,r)}},U:function(n,t){var i=this.A.getHandler("OnDelete");if(i){var r=new(_bs.cn.$$(_a.iR))(t.b(),_bs.d.b(t.a()));i(this,r)}},T:function(n,t){var i=this.A.getHandler("OnClear");if(i){var r=new(_bs.cn.$$(this.$$gta["_bs.bO"].TInterface))(t.c(),this.$$gta["_bs.bO"].TInterface===Number||Type.isEnum(this.$$gta["_bs.bO"].TInterface)?0:this.$$gta["_bs.bO"].TInterface===Boolean?!1:null);i(this,r)}},S:function(n){var i=this.$$gta["_bs.bO"].TInterface===Number||Type.isEnum(this.$$gta["_bs.bO"].TInterface)?0:this.$$gta["_bs.bO"].TInterface===Boolean?!1:null;var t=this.y.g().a(this.C.a(),n.toString());t&&(i=this.fromData(t));return i},Y:function(n,t){n&&this.y.g().b(this.C.a(),t.toString(),n.k)}};_bs.cn=function(n,t){this.c=this.$$gta["_bs.cn"].T===Number||Type.isEnum(this.$$gta["_bs.cn"].T)?0:this.$$gta["_bs.cn"].T===Boolean?!1:null;_bs.cn.$$(this.$$gta["_bs.cn"].T).initializeBase(this);this.d=n;this.c=t};_bs.cn.$$=function(n){var u=_bs.__tc=_bs.__tc||{};var t="cn"+"$"+n.getName().replace(/\./g,"_");if(!u[t]){var r=u[t]=function(){for(var t=[],n=0;n<arguments.length;++n)t[n]=arguments[n];_bs.cn.apply(this,t)};var o=Sys.EventArgs;r.registerClass("_bs.__tc."+t,o,_bc.bD);var s={"_bs.cn":{T:n},ctor:_bs.cn};r.prototype.$$gta=s;var e=_bs.cn.prototype;for(var f in e){var i={key:f,value:e[f]};"constructor"!==i.key&&(r.prototype[i.key]=i.value)}}return u[t]};_bs.cn.prototype={d:null,a:function(){return this.d},b:function(){return this.c}};_bs.bQ=function(n,t){_a.b.a(t,"syncStateId");this.g=new _bs.bh(n,_bs.f.b);this.k=this.h(t)};_bs.bQ.prototype={k:null,g:null,c:function(){return this.k},a:function(){return this.g},d:function(n,t){var i=this;this.c().c(function(t){var r=i.c().g(t);n(r)},t)},f:function(n,t,i,r,u,f,e){_j.e.a(_bs.bQ.a,"SyncTo");_a.b.a(n,"syncState");var o=this,h=this,s=this;this.g.l(new _e.a("ItemSynchronizer.SyncTo",!1,t,i,r),function(t){o.j(t,n,u)},function(){_bs.b.c(f)},function(n){_bs.b.a(n,e)})},b:function(n,t,i,r){var u=this,e=this,f=this;this.g.l(new _e.a("ItemSynchronizer.Cleanup",!1),function(i){t.e(i);n!==2&&u.c().f(i)},function(){_bs.b.c(i)},function(n){_j.e.c(_bs.f.a,"Database cleanup failed. Code = {0}, Message = {1}",n.b,n.a);_bs.b.a(n,r)})},e:function(n,t,i,r,u){var o=this,f=this,e=this;this.g.l(new _e.a("ItemSynchronizer.ReconcileClientData",!1),function(i){n.d(i,t,function(){})},function(){i(function(){f.g.l(new _e.a("ItemSynchronizer.ReconsileClientData",!1),function(t){n.c(t)},function(){_bs.b.c(r)},function(n){_bs.b.a(n,u)})})},function(n){_bs.b.a(n,u)})},h:function(n){return new _bs.bC(this.g.i(),n)},j:function(n,t,i){i.e(n);this.c().d(n,t)}};_bs.co=function(n,t){_bs.co.$$(this.$$gta["_bs.co"].TInterface,this.$$gta["_bs.co"].TItem,this.$$gta["_bs.co"].TResult).initializeBase(this,[n,t])};_bs.co.$$=function(n,t,i){var e=_bs.__tc=_bs.__tc||{};var r="co"+"$"+n.getName().replace(/\./g,"_")+"$"+t.getName().replace(/\./g,"_")+"$"+i.getName().replace(/\./g,"_");if(!e[r]){var f=e[r]=function(){for(var t=[],n=0;n<arguments.length;++n)t[n]=arguments[n];_bs.co.apply(this,t)};var h=_bs.bO.$$(n,t);f.registerClass("_bs.__tc."+r,h);var l={"_bs.co":{TInterface:n,TItem:t,TResult:i},ctor:_bs.co};var a=h.prototype.$$gta;for(var v in a){var c={key:v,value:a[v]};l[c.key]=c.value}f.prototype.$$gta=l;var o=_bs.co.prototype;for(var s in o){var u={key:s,value:o[s]};"constructor"!==u.key&&(f.prototype[u.key]=u.value)}}return e[r]};_bs.co.prototype={L:function(n,t,i,r,u){_a.b.a(n,"paging");_a.b.a(t,"seekToConditionKeyKeyPath");_a.b.a(i,"queryCreatorCallback");_a.b.a(r,"successCallback");if(_g.J.isInstanceOfType(n))this.ba(n,i,r,u);else if(_g.be.isInstanceOfType(n))this.bb(n,t,i,r,u);else throw Error.invalidOperation(String.format("Unsupported paging type {0} provided",n));},ba:function(n,t,i,r){_a.b.e(n.Offset,0,Number.MAX_VALUE,"offset");_a.b.e(n.MaxEntriesReturned,1,Number.MAX_VALUE,"maxEntriesToReturn");_a.b.d(n.BasePoint==="Beginning","Unsupported paging type provided");var s=n.MaxEntriesReturned;var o=n.Offset;var l=n.BasePoint;var f=new Array(0);var e=0;var u=this,c=this,h=this;this.a(new _e.a("ListViewItemStore.GetIndexedPageViewItems"),function(n){u.N(n,function(i){e=i;_a.b.e(e,0,Number.MAX_VALUE,"totalItemsInView");var h=n.a(u.K());var r=t();h.a(r,function(n){u.J(n,o,s,function(n,t,i){u.q(t,f)})},null)})},function(){i(f,e,o+f.length)},function(n){_bs.b.a(n,r)})},bb:function(n,t,i,r,u){_a.b.e(n.MaxEntriesReturned,1,Number.MAX_VALUE,"maxEntriesToReturn");var c=n.MaxEntriesReturned;var y=n.BasePoint;var l=y==="Beginning";var h=!1;var o=0;var v=n.Condition.Item.FieldURIOrConstant.Item;var a=v.Value;var s=new Array(0);var e=0;var f=this,w=this,p=this;this.a(new _e.a("ListViewItemStore.GetSeekToConditionPageViewItems"),function(n){f.N(n,function(r){e=r;_a.b.e(e,0,Number.MAX_VALUE,"totalItemsInView");var v=n.a(f.K());var u=i();v.a(u,function(n){l?f.Z(n,t,a,c,function(n,t,i){o=i;h=n;n&&f.q(t,s)}):f.M(n,t,a,function(n,t){h=n;if(n){o=t;var r=Math.max(0,t-c+1);var i=Math.min(c,t+1);v.a(u,function(n){f.J(n,r,i,function(n,t,i){f.q(t,s)})},null)}})},null)})},function(){var n;n=l?h?o+s.length:e:h?Math.max(0,e-o-1):0;r(s,e,n)},function(n){_bs.b.a(n,u)})},M:function(n,t,i,r){var u=this;n.c(0,new _e.b(t,i),function(t){r(t,n.e())},null)},Z:function(n,t,i,r,u){var f=this;this.M(n,t,i,function(t,i){t?n.a(r,function(n,r,f){u(t,r,i)},null):u(t,null,i)})},J:function(n,t,i,r){var u=this;n.d(t,function(){n.a(i,function(n,t,i){r(n,t,i)},null)},null)}};_bs.dh=function(n,t,i,r){_bs.dh.initializeBase(this,[n,t,i,!0,r,4])};_bs.dh.prototype={a:function(){return _bs.e.a().h.a()},A:function(){return!0},s:function(n){var t=null;if(n.a().length>0){var r=n.a()[0].a();t=r.Data}else if(n.b().length>0){var u=n.b()[0].a();t=u.Data}else if(n.c().length>0){var i=this.h(n.c()[0].b());i&&(t=i.get_data())}t&&t.IsDraft&&this.j(t.ParentFolderId.Id)},x:function(n,t){return!!n&&n.c()},u:function(n){return n.a()},j:function(n){_bs.t.d(n,"clientStore",this.A())}};_bs.cq=function(n,t){_bs.cq.initializeBase(this,[n,"MessageItemSyncStateId"]);_a.b.e(t,0,10,"maxUnsyncedItemsToGet");this.c().j=t};_bs.cq.prototype={h:function(n){return new _bs.cr(this.g.i(),this.g.a())}};_bs.di=function(n,t,i,r,u){_bs.di.initializeBase(this,[n,i,u]);_a.b.a(t,"attachmentItemStore");_a.b.a(r,"attachments");this.m=t;this.n=r};_bs.di.prototype={m:null,n:null,e:function(n){_a.b.a(n,"tx");var i=[];var r=this,t=this;_bs.k.e(this.h,n,this.g,function(n){return _bs.d.a(n.ItemId.Id)},function(r){for(var o=t.g,h=o.length,e=0;e<h;++e){var u=o[e];var f=r.c(u.ItemId.Id)?r.b[u.ItemId.Id].get_data():null;if(f&&u.ItemId.ChangeKey===f.ItemId.ChangeKey){var s=_gg.fg.a(f,u);Array.add(i,s)}else Array.add(i,u)}t.g=i;_bs.k.d(_bc.Q,AttachmentInfoRecord,t.m,n,t.n,null);_bs.bn.prototype.e.call(t,n)})}};_bs.cr=function(n,t){_a.b.a(n,"syncStateItemStore");_a.b.a(t,"messageItemStore");this.k=n;this.i=t};_bs.cr.a=function(n,t,i){_a.b.a(n,"tx");_a.b.a(t,"messageItemStore");_a.b.a(i,"itemIds");for(var u=i,e=u.length,r=0;r<e;++r){var f=u[r];t.bindIn(n,_bs.d.a(f.Id),function(i){if(i){var r=i.get_data();r.CustomSyncData.IsDataSynced="";t.saveIn(n,i,1,null)}},null)}};_bs.cr.prototype={k:null,i:null,j:0,c:function(n,t){_a.b.a(n,"successCallback");var i=this,r=this;_bs.U.f(this.i,this.j,_g.b.a,function(t,r,u){var f=i.k.fromData(new MessageItemSyncState(t,r,u));n(f)},function(n){_j.e.c(_bs.f.a,"ClientStore returned error while trying to fetch unsyned item list. Error = {0}",n.a());t&&t(n)})},h:function(n,t,i,r){r()},e:function(n,t){t()},d:function(n,t){_bs.cr.a(n,this.i,t.a)},f:function(n){throw Error.notImplemented("NYI");},b:function(){return new MessageItemSyncState([],{},!1)},g:function(n){return n?n.get_data():this.b()},a:function(n){throw Error.notImplemented("This is implemented only in MultiFolderSyncStateProvider");}};_bs.dj=function(n,t){_bs.dj.initializeBase(this,[n,t])};_bs.dj.prototype={b:function(){return new MultiFolderSyncState(this.j)},a:function(n){return new SyncState(n,"")}};_bs.cs=function(n,t){_bs.cs.initializeBase(this,[n,t])};_bs.cs.prototype={h:function(n){return new _bs.dj(this.g.i(),n)}};_bs.t=function(){};_bs.t.d=function(n,t,i){_bs.t.c(n,null,"Reload",t,_bs.t.a,_bs.t.a,i)};_bs.t.c=function(n,t,i,r,u,f,e){_a.b.c(n,"folderId");var o=new _no.j;o.id="HierarchyNotification";o.type="HierarchyNotification";o.folderId=n;o.parentFolderId=t;o.EventType=i;o.itemCount=u;o.unreadCount=f;o.clientGenerated=!0;o.forceSynchronousProcessing=!e;i==="Reload"&&(o.reason="OfflineSync");_bs.t.b(o)};_bs.t.f=function(n){var t=new _no.l;t.id="ReminderNotification";t.type="ReminderNotification";t.clientGenerated=!0;t.shouldGetReminders=!0;t.forceSynchronousProcessing=!n;_bs.t.b(t)};_bs.t.e=function(n,t,i){_a.b.c(n,"folderId");var r=new _g.jo;r.clientGenerated=!0;r.FolderId=n;r.EventType=t;r.id="RowNotification"+n;r.type="RowNotification";r.forceSynchronousProcessing=!i;_bs.t.b(r)};_bs.t.i=function(n){var t=new _a.iu;t.id="OwaUserConfigurationNotification";t.type="OwaUserConfigurationNotification";t.clientGenerated=!0;t.reload=n;_bs.t.b(t)};_bs.t.h=function(n){_a.b.a(n,"response");var t=new _g.jW;t.id="FolderHierarchyNotification";t.type="FolderHierarchyNotification";t.clientGenerated=!0;t.folderHierarchy=n;_bs.t.b(t)};_bs.t.g=function(n,t,i){_a.b.c(t,"GenerateCalendarItemNotification:folderId");_a.b.b(i,"GenerateCalendarItemNotification:calendarItem");var r=new _gg.nC;r.clientGenerated=!0;r.EventType=n;r.id="CalendarItemNotification"+t;r.type="CalendarItemNotification";r.FolderId=t;r.Item=i;r.Reload=!1;r.forceSynchronousProcessing=!0;_bs.t.b(r)};_bs.t.b=function(n){_a.b.f(n.clientGenerated,!0,"notification.ClientGenerated");_a.g.e().d(n)};_bs.dk=function(n,t,i,r){_bs.dk.initializeBase(this,[n,t,i,!0,r,5])};_bs.dk.prototype={a:function(){return _bs.e.a().n.a()},j:function(){return!0},s:function(n){var t=null;if(n.a().length>0){var r=n.a()[0].a();t=r.Data}else if(n.b().length>0){var u=n.b()[0].a();t=u.Data}else if(n.c().length>0){var i=this.h(n.c()[0].b());i&&(t=i.get_data())}t&&_bs.t.d(t.ParentFolderId.Id,"serviceCommand",this.j())},u:function(n){return n.e()}};_bs.dm=function(n,t,i,r){_bs.dm.initializeBase(this,[n,t,i,!1,r,7])};_bs.dm.prototype={a:function(){return _bs.e.a().A.a()},r:function(n){var t=new _e.p;this.j(t,n.a(),0);this.j(t,n.b(),1);this.j(t,n.c(),2);return t},s:function(n){},u:function(n){return n.u()},j:function(n,t,i){for(var f=t,e=f.length,r=0;r<e;++r){var u=f[r];u.b().toString()==="OwaUserConfiguration.1"&&n.e(u,i)}}};_bs.bp=function(){_bs.bp.initializeBase(this)};_bs.bp.b=function(n,t,i){_a.b.a(n,"syncStateItemStore");_a.b.a(t,"successCallback");var r=[];n.a(new _e.a("SyncStateItem.GetSyncStates"),function(t){var f=t.a(_bs.e.a().q.a());var u=new _a.bk(null,null);f.a(u,function(t){t.a(_bs.bp.a,function(t,i,u){for(var f=0;f<i.length;++f)Array.add(r,n.fromQueryResultEntry(i[f]))},_bs.b.b(i))},_bs.b.b(i))},function(){t(r)},_bs.b.b(i))};_bs.bp.prototype={l:function(){return _bs.e.a().q},K:function(n){_a.b.c(n.Id,"id")},H:function(n){return _bs.d.a(n.Id)},I:function(n){return new ItemMetadata}};_bs.k=function(){};_bs.k.d=function(n,t,i,r,u,f){_bs.k.f(n,t,i,r,u,f,1)};_bs.k.f=function(n,t,i,r,u,f,e){if(!u||!u.length){_bs.b.c(f);return}for(var c=0,h=function(){++c===u.length&&_bs.b.c(f)},o=0;o<u.length;o++){var s=u[o];s?_bs.k.g(i,r,s,null,function(){h()},e):h()}};_bs.k.c=function(n,t,i,r,u,f,e){_bs.k.g(i,r,u,f,e,1)};_bs.k.g=function(n,t,i,r,u,f){var e=n.k(i);r?r(e,t,u):n.o(t,e,f,u)};_bs.k.i=function(n,t,i,r){if(!i||!i.length){_bs.b.c(r);return}for(var o=0,e=function(){++o===i.length&&_bs.b.c(r)},u=0;u<i.length;u++){var f=i[u];f?t.i(n,f,function(){e()}):e()}};_bs.k.e=function(n,t,i,r,u){var o=0;var f=_a.I.a();i&&i.length||u(f);for(var e=0;e<i.length;e++)n.e(t,r(i[e]),function(n){o++;n&&f.a(n.a().a().toString(),n);o===i.length&&u(f)},null)};_bs.k.b=function(n,t,i,r,u,f){var o=new _e.b(_bs.j.a,0);var e=new _a.bk(o,null);i.m(t,e,r,function(t,i,r,e){for(var c=n.getName(),h=r.length,o=0;o<h;o++){var s=r[o].b.a;_j.e.b(_bs.k.a,"Dirty item (type: {0}) #{1}/{2}: {3}",c,o,h,s);u[s]=null}e&&f()},null)};_bs.k.h=function(n,t){var r=n;for(var i in r){var u={key:i,value:r[i]};t(u.key)}};_bs.bC=function(n,t){_a.b.a(n,"store");_a.b.a(t,"syncStateId");this.i=n;this.j=t};_bs.bC.prototype={i:null,j:null,c:function(n,t){_a.b.a(n,"successCallback");var i=null;var r=this,f=this,u=this;this.i.a(new _e.a("SyncStateProvider.GetState"),function(n){r.k(n,function(n){i=n})},function(){n(i)},function(n){_bs.b.a(n,t)})},k:function(n,t){_a.b.a(t,"successCallback");this.i.bindInWithCache(n,_bs.d.a(this.j),t,null)},l:function(n,t){var i=this;this.e(function(t){t.IsSynced=n},t)},h:function(n,t,i,r){var u=this;this.e(function(r){r.Diagnostics.SyncType=n;r.Diagnostics.SyncInProgress=t;r.Diagnostics.SyncError=i?i.message:""},r)},d:function(n,t){var i=this.i.fromData(t);i.b(n,null)},f:function(n){this.i.b(n,_bs.d.a(this.j))},b:function(){return new SyncState(this.j,"")},g:function(n){return n?n.get_data():this.b()},e:function(n,t){_a.b.a(n,"updateDelegate");_a.b.a(t,"completedCallback");var i=this,u=this,r=this;this.i.a(new _e.a("SyncStateProvicer.TryUpdateSyncStateProperties"),function(t){i.i.bindInWithCache(t,_bs.d.a(i.j),function(r){var u=i.g(r);n(u);i.d(t,u)},null)},function(){t()},function(n){t()})},a:function(n){throw Error.notImplemented("This is implemented only in MultiFolderSyncStateProvider");}};_bs.du=function(){};_bs.du.prototype={a:function(n){_a.b.a(n,"folderIds");_a.b.e(n.length,1,100,"folderIds should have at least one entry");for(var r=n,u=r.length,t=0;t<u;++t){var i=r[t];_j.e.a(_bs.f.a,"Generating onSync hierarchy notification. FolderId: {0}",i);_bs.t.d(i,"sync",!1)}},b:function(){_j.e.a(_a.a.bB,"Generating onSync reminder notification");_bs.t.f(!0)},d:function(n){_a.b.a(n,"folderIds");_a.b.f(n.length>0,!0,"folderIds should have at least one entry");for(var r=n,u=r.length,t=0;t<u;++t){var i=r[t];_j.e.a(_a.a.bB,"Generating onSync persona notification. FolderId: {0}",i);_bs.t.e(i,"RowModified",!0)}},e:function(n){_j.e.a(_a.a.bB,"Generating onSync owa user configuration notification.");_bs.t.i(n)},c:function(n){_a.b.a(n,"response");_j.e.a(_a.a.bB,"Generating onSync folder hierarchy notification.");_bs.t.h(n)}};_bs.C=function(){_bs.C.initializeBase(this)};_bs.C.b=function(){return new _a.R("Data.ConversationId.Id")};_bs.C.e=function(){return new _a.R("Data.InstanceKey")};_bs.C.a=function(){return new _a.R("Data.DirtyState")};_bs.C.f=function(n){_a.b.a(n,"data");return _bs.Y.a(n.FolderId,n.ConversationId)};_bs.C.g=function(n,t,i,r){_a.b.a(n,"tx");_a.b.a(r,"successCallback");_a.b.e(i,0,100,"maxEntriesToReturn");var e=[];var f={};var u={};var h=n.a(_bs.e.a().f.a());var s=new _e.b(_bs.C.a(),2);var o=new _a.bk(s,[new _a.ca(ConversationItemMetadata.a(),1)]);h.a(o,function(n){n.a(i*2,function(n,o,s){for(var w=0,y=o,p=y.length,c=0;c<p;++c){var v=y[c];var a=t.fromQueryResultEntry(v);var l=_bs.j.a.b(v.a);var h=a.get_data().ConversationId.Id;if(_j.F.a(u[h])&&l!==10&&l!==11){if(w++>=i)break;Array.add(e,new _g.e(h));f[h]=a.get_data().LastModifiedTime;u[h]=!0}}r(e,f)},null)},null)};_bs.C.c=function(n,t,i,r){_a.b.a(n,"tx");_a.b.a(t,"conversationItemStore");_a.b.a(i,"conversationId");_a.b.c(i.Id,"conversationId.Id");_a.b.a(r,"successCallback");var f=n.a(_bs.e.a().f.a());var o=new _e.b(_bs.C.b(),i.Id);var e=new _a.bk(o,null);var u=[];f.a(e,function(n){n.a(100,function(n,i,f){for(var o=i,h=o.length,e=0;e<h;++e){var s=o[e];Array.add(u,t.fromQueryResultEntry(s))}r(u)},null)},null)};_bs.C.i=function(n,t,i,r){var o=100;var s=new _a.bk(new _e.b(_bs.C.a(),1),null);var u=[];var f={};var e={};t.m(n,s,o,function(o,s,h,c){for(var y=h,w=y.length,v=0;v<w;++v){var b=y[v];var l=t.fromQueryResultEntry(b);var k=l.get_data().ConversationId.Id;e[k]=l.get_data().LastModifiedTime;if(l.get_data().GlobalItemReadFlags)for(var a=0;a<l.get_data().GlobalItemIds.length;a++){var p=l.get_data().GlobalItemIds[a];Array.add(u,p);f[p.Id]=l.get_data().GlobalItemReadFlags[a]}l.set_dirtyState(0);t.saveIn(n,l,1,null)}if(c){_bs.C.h(n,i,e);_bs.C.d(n,r,u,0,f)}},null)};_bs.C.h=function(n,t,i){var f=i;for(var u in f){var r={key:u,value:f[u]};t.bindIn(n,_bs.d.a(r.key),function(u){if(u){var f=i[u.get_data().ConversationId.Id];u.get_data().LastModifiedTime=f;t.saveIn(n,u,1,function(n){})}else _j.e.b(_bs.f.a,"Can't find ConversationNode with id:{0}",r.key)},null)}};_bs.C.d=function(n,t,i,r,u){var f=10;r+f>i.length&&(f=i.length-r);if(f)for(var s=0,e=0,o=0;o<f;o++){s++;t.bindIn(n,_bs.d.a(i[r+o].Id),function(o){if(o){s--;if(o.get_data().IsRead!==u[o.get_data().ItemId.Id]){o.get_data().IsRead=u[o.get_data().ItemId.Id];e++;t.saveIn(n,o,1,function(o){e--;e||_bs.C.d(n,t,i,r+f,u)})}else s||e||_bs.C.d(n,t,i,r+f,u)}},null)}};_bs.C.prototype={get_dirtyState:function(){return this.k.DirtyState},set_dirtyState:function(n){this.k.DirtyState=n;return n},l:function(){return _bs.e.a().f},J:function(){return!0},K:function(n){_a.b.a(n.ConversationId,"ConversationId");_a.b.c(n.ConversationId.Id,"ConversationId.Id");_a.b.c(n.LastDeliveryTime,"LastDeliveryTime");_a.b.a(n.FolderId,"FolderId");_a.b.a(n.FolderId.Id,"FolderId.Id")},H:function(n){return _bs.C.f(n)},I:function(n){return new ConversationItemMetadata(n.FolderId.Id,this.c(n))},c:function(n){var t=!1;if(!_j.h.d(n.LastDeliveryOrRenewTime)&&_h.b.b===_h.b.E){var i=_a.d.b(n.LastDeliveryOrRenewTime);t=_g.g.g(i)}return t?String.format("{0} {1}",n.LastDeliveryOrRenewTime,n.LastDeliveryTime):n.LastDeliveryTime}};function ConversationItemMetadata(n,t){ConversationItemMetadata.initializeBase(this);this.ParentClientStoreId=n;this.LastDeliveryTime=t}ConversationItemMetadata.b=function(){return new _a.R("Metadata.ParentClientStoreId")};ConversationItemMetadata.a=function(){return new _a.R("Metadata.LastDeliveryTime")};ConversationItemMetadata.prototype={ParentClientStoreId:null,LastDeliveryTime:null};_bs.bl=function(){_bs.bl.initializeBase(this)};_bs.bl.a=function(n){_a.b.a(n,"originalItem");var t=new _g.L;t.ItemId=n.ItemId;t.ConversationId=n.ConversationId;t.ParentFolderId=n.ParentFolderId;t.DateTimeCreated=n.DateTimeCreated;t.DateTimeSent=n.DateTimeSent;t.DateTimeReceived=n.DateTimeReceived;t.LastModifiedTime=_a.d.d(_a.d.a());t.__PlaceHolderItem=!0;return t};_bs.bl.c=function(n){_a.b.a(n,"data");_a.b.a(n.ConversationId,"data.ConversationId");return _bs.bl.b(n.ConversationId)};_bs.bl.b=function(n){_a.b.a(n,"conversationId");_a.b.c(n.Id,"conversationId.Id");return _bs.d.a(n.Id)};_bs.bl.prototype={l:function(){return _bs.e.a().x},K:function(n){_a.b.a(n.ConversationId,"ConversationId");_a.b.c(n.ConversationId.Id,"ConversationId.Id");_a.b.c(n.SyncState,"SyncState");_a.b.a(n.ConversationNodes,"ConversationNodes");_a.b.g(n.ConversationNodes.length,0,"ConversationNodes.Length");_a.b.a(n.LastModifiedTime,"LastModifiedTime")},H:function(n){return _bs.bl.c(n)},I:function(n){return new ItemMetadata}};_bs.cj=function(n,t,i){_a.b.a(n,"syncStateItemStore");_a.b.a(t,"conversationItemStore");_a.b.a(t,"conversationNodeItemStore");this.j=n;this.i=t;this.k=i};_bs.cj.a=function(n,t,i){_a.b.a(n,"tx");_a.b.a(t,"conversationItemStore");_a.b.a(i,"conversationIds");for(var u=i,s=u.length,r=0;r<s;++r){var h=u[r];var o=n.a(_bs.e.a().f.a());var f=new _e.b(_bs.C.b(),h.Id);var e=new _a.bk(f,null);o.a(e,function(i){i.a(100,function(i,r,u){for(var o=r,s=o.length,f=0;f<s;++f){var h=o[f];var e=t.fromQueryResultEntry(h);e.set_dirtyState(0);t.saveIn(n,e,1,null)}},null)},null)}};_bs.cj.prototype={j:null,i:null,k:null,l:0,c:function(n,t){_a.b.a(n,"successCallback");var r=null;var i=this,f=this,u=this;this.i.a(new _e.a("ConversationSyncStateProvider.GetState"),function(n){_bs.C.g(n,i.i,i.l,function(t,u){var o=0;var f={};if(t.length)for(var e=0;e<t.length;e++)i.k.bindIn(n,_bs.d.a(t[e].Id),function(n){n&&(f[n.get_data().ConversationId.Id]=n.get_data().SyncState);++o===t.length&&(r=i.j.fromData(new ConversationItemSyncState(t,u,f)))},null);else r=i.j.fromData(new ConversationItemSyncState(t,u,f))})},function(){n(r)},function(n){_j.e.c(_bs.f.a,"ClientStore returned error while trying to fetch dirty conversation list or conversation sync state. Error = {0}",n.a);t&&t(new _bs.b(n))})},h:function(n,t,i,r){r()},e:function(n,t){t()},d:function(n,t){_bs.cj.a(n,this.i,t.a)},f:function(n){throw Error.notImplemented("NYI");},b:function(){return new ConversationItemSyncState([],{},{})},g:function(n){return n?n.get_data():this.b()},a:function(n){throw Error.notImplemented("This is implemented only in MultiFolderSyncStateProvider");}};_bs.U=function(){_bs.U.initializeBase(this)};_bs.U.b=function(){return new _a.R("Data.InstanceKey")};_bs.U.d=function(n){_a.b.a(n,"data");_a.b.a(n.ItemId,"data.ItemId");_a.b.c(n.ItemId.Id,"data.ItemId.Id");return _bs.d.a(n.ItemId.Id)};_bs.U.f=function(n,t,i,r,u){_a.b.a(i,"folderMappings");_a.b.a(r,"successCallback");_a.b.e(t,0,10,"maxEntriesToReturn");var o=[];var f=0;var s={};var e=!1;n.a(new _e.a("MessageItem.GetUnsyncedItems"),function(r){var c=r.a(_bs.e.a().h.a());var h=new _e.b(MessageItemMetadata.c(),"false");var u=new _a.bk(h,[new _a.ca(MessageItemMetadata.a(),1)]);c.a(u,function(r){r.a(t*3,function(r,u,h){while(o.length<t&&f<u.length){var a=u[f];var v=_bs.j.a.b(a.a);if(v!==11&&v!==10){var c=n.fromQueryResultEntry(a).get_data();var l=c.ItemId.Id;f||(e=i.doesIdEqualName(c.ParentFolderId,"drafts"));if(e===i.doesIdEqualName(c.ParentFolderId,"drafts")){Array.add(o,new _g.e(l));s[l]=c.ItemId.ChangeKey}}f++}},null)},null)},function(){r(o,s,e)},function(n){_bs.b.a(n,u)})};_bs.U.c=function(n,t){_a.b.a(n,"item");var i=n;return!!i.CustomSyncData&&i.CustomSyncData.ItemShape>t};_bs.U.a=function(n,t,i){_a.b.a(n,"item");_a.b.a(t,"isDataSynced");n.CustomSyncData=new CustomSyncData(t,i)};_bs.U.e=function(n){if(_g.b.a.doesIdEqualName(n.ParentFolderId,"sentitems")){_j.h.d(n.DateTimeSent)&&_j.e.c(_a.a.Q,"For item with item id {0}, the parent folder id is sent items folder i.e. {1} and the date time sent is undefined",n.ItemId.Id,n.ParentFolderId.Id);return n.DateTimeSent}else if(_g.b.a.doesIdEqualName(n.ParentFolderId,"drafts")&&_g.a.a().B){_j.h.d(n.LastModifiedTime)&&_j.e.c(_a.a.Q,"For item with item id {0}, the parent folder id is consumer drafts folder i.e. {1} and the date time modified is undefined",n.ItemId.Id,n.ParentFolderId.Id);return n.LastModifiedTime}else if(_g.b.a.doesIdEqualName(n.ParentFolderId,"drafts")||_g.b.a.doesIdEqualName(n.ParentFolderId,"outbox")){_j.h.d(n.DateTimeCreated)&&_j.e.c(_a.a.Q,"For item with item id {0}, the parent folder id is drafts or outbox folder i.e. {1} and the date time created is undefined",n.ItemId.Id,n.ParentFolderId.Id);return n.DateTimeCreated}return n.DateTimeReceived};_bs.U.prototype={l:function(){return _bs.e.a().h},J:function(){return!0},t:function(n,t,i){var u=!1;if(n.__type===_g.cj._dataContractName){_g.cj._TZ(n,t,i,this.m.a());u=!0}else if(n.__type===_g.bV._dataContractName){if(t!==i&&n){var r=n;if(r.ChangeHighlights){r.ChangeHighlights.Start=this.m.a().b(t,i,r.ChangeHighlights.Start);r.ChangeHighlights.End=this.m.a().b(t,i,r.ChangeHighlights.End)}_g.bV._TZ(n,t,i,this.m.a());u=!0}}else if(n.__type===_g.ck._dataContractName){_g.ck._TZ(n,t,i,this.m.a());u=!0}else if(n.__type===_dg.be._dataContractName){_dg.be._TZ(n,t,i,this.m.a());u=!0}u||_bs.cy.prototype.t.call(this,n,t,i);if(n.ExtendedProperty)for(var o=n.ExtendedProperty,s=o.length,e=0;e<s;++e){var f=o[e];f.ExtendedFieldURI.PropertyTag===_g.c.bx().PropertyTag&&f.Value&&(f.Value=this.m.a().b(t,i,f.Value))}},K:function(n){_a.b.a(n.ItemId,"itemId");_a.b.c(n.ItemId.Id,"itemId.Id");_a.b.c(n.ItemId.ChangeKey,"itemId.ChangeKey");_a.b.a(n.ParentFolderId,"ParentFolderId");_a.b.c(n.ParentFolderId.Id,"ParentFolderId.Id");_a.b.c(n.DateTimeReceived,"DateTimeReceived");_a.b.c(n.InstanceKey,"InstanceKey");var t=n;t.CustomSyncData||_bs.U.a(n,"",2)},H:function(n){return _bs.U.d(n)},I:function(n){var t=_bs.U.e(n);return new MessageItemMetadata(n.ParentFolderId.Id,t,n.CustomSyncData.IsDataSynced)}};function MessageItemMetadata(n,t,i){MessageItemMetadata.initializeBase(this);this.ParentClientStoreId=n;this.SortDateTime=t;this.IsDataSynced=i}MessageItemMetadata.b=function(){return new _a.R("Metadata.ParentClientStoreId")};MessageItemMetadata.a=function(){return new _a.R("Metadata.SortDateTime")};MessageItemMetadata.c=function(){return new _a.R("Metadata.IsDataSynced")};MessageItemMetadata.prototype={ParentClientStoreId:null,SortDateTime:null,IsDataSynced:null};_bs.bR=function(n,t){_bs.bR.initializeBase(this,[n,t])};_bs.bR.prototype={K:function(){return _bs.e.a().h.a()},g:function(n,t,i){var r=this;this.d(n,t,function(n){if(_j.F.a(n)){_j.e.b(_a.a.Q,"Message with id {0} not found in local store",t);return}_bs.bv.b(n,i)})}};_bs.cp=function(n,t){_bs.cp.$$(this.$$gta["_bs.cp"].TInterface,this.$$gta["_bs.cp"].TItem).initializeBase(this,[n,t])};_bs.cp.$$=function(n,t){var f=_bs.__tc=_bs.__tc||{};var i="cp"+"$"+n.getName().replace(/\./g,"_")+"$"+t.getName().replace(/\./g,"_");if(!f[i]){var u=f[i]=function(){for(var t=[],n=0;n<arguments.length;++n)t[n]=arguments[n];_bs.cp.apply(this,t)};var c=_bs.co.$$(n,t,_g.L);u.registerClass("_bs.__tc."+i,c);var s={"_bs.cp":{TInterface:n,TItem:t},ctor:_bs.cp};var l=c.prototype.$$gta;for(var a in l){var h={key:a,value:l[a]};s[h.key]=h.value}u.prototype.$$gta=s;var e=_bs.cp.prototype;for(var o in e){var r={key:o,value:e[o]};"constructor"!==r.key&&(u.prototype[r.key]=r.value)}}return f[i]};_bs.cp.prototype={p:null,G:null,l:null,getMessages:function(n,t,i,r,u,f,e){_a.b.a(n,"folderId");_a.b.a(t,"folderItemStore");_a.b.a(i,"request");_a.b.a(r,"actionContext");_a.b.a(f,"successCallback");this.p=n;this.G=t;this.l=u;var o=this;_bs.co.prototype.L.call(this,i.Paging,_bs.U.b(),function(){var t=new _e.b(MessageItemMetadata.b(),n);return new _a.bk(t,[new _a.ca(MessageItemMetadata.a(),1)])},f,e)},N:function(n,t){t(this.l.TotalCount)},q:function(n,t){for(var e=this.u(this.l.OldestReceivedTime),o=_a.d.b(e).o().h(),r=0;r<n.length;++r){var f=this.fromQueryResultEntry(n[r]);var i=f.get_data();var u=_a.d.b(i.DateTimeReceived).o().h();if(u>=o){this.bc(i);Array.add(t,i)}else break}},bc:function(n){n.Body=null;n.NormalizedBody=null;n.UniqueBody=null;n.Attachments=null;n.ToRecipients=null;n.CcRecipients=null;n.BccRecipients=null;n.Mentions=null;n.Hashtags=null;n.PendingSocialActivityTagIds=null}};_bs.g=function(){_bs.g.initializeBase(this)};_bs.g.q=function(n,t){_a.b.a(n,"folderId");_a.b.a(t,"personaId");return _bs.Y.a(n,t)};_bs.g.n=function(n,t,i,r,u,f,e){_a.b.a(n,"store");_a.b.a(r,"folderId");_a.b.a(f,"successCallback");if(t<0)throw Error.argumentOutOfRange("offset");if(i<0)throw Error.argumentOutOfRange("maxItemsToReturn");var h=_bs.g.l(u);var o=[];var s=0;n.a(new _e.a("PartialPersonaItem.BrowsePeople"),function(u){var c=u.a(_bs.e.a().o.a());var e=new _e.b(_bs.g.c,r.Id);var f=new _a.bk(e,h);c.a(f,function(r){r.b(function(n){s=n},null);r.d(t,function(){r.a(i,function(t,i,r){for(var f=i,h=f.length,u=0;u<h;++u){var s=f[u];var e=n.fromQueryResultEntry(s);Array.add(o,e.get_data().Persona)}},null)},null)},null)},function(){f(o,s)},function(n){_bs.b.a(n,e)})};_bs.g.l=function(n){var i=null;if(n){i=new Array(n.length);for(var t=0;t<n.length;t++){var r=_bs.g.m(n[t].Path.FieldURI);if(r){var u=n[t].Order==="Ascending"?0:1;i[t]=new _a.ca(r,u)}}}return i};_bs.g.p=function(n,t){var i=n.Item;var e=i.Item.FieldURI;var o=_bs.g.m(e);var f=i.FieldURIOrConstant.Item.Value;var r=t[f];return new _e.d(o,r,1,0)};_bs.g.m=function(n){switch(n){case"PersonaCompanyName":return _bs.g.d;case"PersonaHomeCity":return _bs.g.f;case"PersonaCreationTime":return _bs.g.e;case"PersonaRelevanceScore":return _bs.g.k;case"PersonaDisplayNameFirstLast":return _bs.g.a;case"PersonaDisplayNameLastFirst":return _bs.g.b;case"PersonaWorkCity":return _bs.g.h;case"PersonaIsFavorite":return null;default:throw Error.invalidOperation(String.format("Sorting by '{0}' isn't supported",n));}};_bs.g.prototype={l:function(){return _bs.e.a().o},H:function(n){return _bs.g.q(n.FolderId,n.Persona.PersonaId)},I:function(n){return new ItemMetadata},K:function(n){_a.b.a(n.FolderId,"FolderId");_a.b.c(n.FolderId.Id,"FolderId.Id");_a.b.a(n.Persona.PersonaId,"Persona.PersonaId");_a.b.c(n.Persona.PersonaId.Id,"Persona.PersonaId.Id")},t:function(n,t,i){_bs.bj.b(n.Persona,t,i,this.m.a())}};_bs.dp=function(n,t,i,r){_bs.dp.initializeBase(this,[n,t,i,!0,r,3])};_bs.dp.prototype={a:function(){return _bs.e.a().r.a()},A:function(){return!0},s:function(n){this.j("RowAdded",n.a());this.j("RowModified",n.b());this.j("RowDeleted",n.c())},j:function(n,t){for(var o=t,l=o.length,u=0;u<l;++u){var s=o[u];var i=null;if(n==="RowDeleted"){var h=this.h(s.b());if(!h)return;i=h.get_data()}else{var c=s.a();i=c.Data}for(var e=i.FolderIds,a=e.length,r=0;r<a;++r){var f=e[r];f&&_bs.t.e(f.Id,n,this.A())}}},u:function(n){return n.m()}};_bs.dn=function(n){_bs.dn.initializeBase(this);this.a=n};_bs.dn.prototype={a:null,e:function(n){this.a.d(n)}};_bs.A=function(n,t,i,r,u){_a.b.a(n,"completePersonaItemStore");_a.b.a(t,"partialPersonaItemStore");_a.b.a(i,"addressbookOperationItemStore");_a.b.a(r,"addressbookPersonaItemStore");_a.b.a(u,"clientStoreSettings");this.f=n;this.e=t;this.g=i;this.h=r;this.i=u};_bs.A.$$cctor=function(){_bs.A.b=[]};_bs.A.a=function(n){_a.b.b(n,"storeGetter");return new _bs.A(n.m(),n.s(),n.w(),n.x(),new _bs.E(n))};_bs.A.d=function(n){_a.b.a(n,"observer");Array.add(_bs.A.b,n)};_bs.A.prototype={f:null,e:null,g:null,h:null,i:null,j:function(n,t,i,r,u,f){_bs.g.n(this.e,n,t,i,r,u,f)},s:function(n,t,i,r,u){_a.b.a(n,"condition");_a.b.a(t,"folderId");_a.b.a(i,"sortParams");_a.b.a(r,"successCallback");var f=-1;var e=this,s=this,o=this;this.e.a(new _e.a("PersonaStore.SeekToCondition"),function(r){e.r(r,function(u){var h=_bs.g.l(i);var c=_bs.g.p(n,u);var s=r.a(_bs.e.a().o.a());var e=new _e.b(_bs.g.c,t.Id);var o=new _a.bk(e,h);s.a(o,function(n){n.c(0,c,function(t){f=n.e()},null)},null)})},function(){r(f)},function(n){_bs.b.a(n,u)})},c:function(n,t,i,r){var u=this;this.f.bindIn(n,_bs.bj.a(t),function(n){i(n?n.get_data():null)},r)},b:function(n,t,i,r){var e=null;var s=this.f.fromData(t);var c=this;this.f.saveIn(n,s,i,function(n){e=new _g.e(n.toString())});var f={};var h=new _e.b(_bs.g.g,t.PersonaId.Id);var u=this;this.e.m(n,new _a.bk(h,null),100,function(o,s,h,c){for(var v=h,tt=v.length,l=0;l<tt;++l){var nt=v[l];var k=u.e.fromQueryResultEntry(nt);f[k.get_data().FolderId.Id]=k.a()}if(c){for(var it=u.n(t),ut=0,y=t.FolderIds,rt=y.length,a=0;a<rt;++a){var p=y[a];delete f[p.Id];var g=u.o(it,p);u.e.saveIn(n,g,i,function(n){++ut===t.FolderIds.length&&e&&_bs.b.d(e,r)})}var b=f;for(var w in b){var d={key:w,value:b[w]};u.e.b(n,d.value)}}},null);var o=this;Array.forEach(_bs.A.b,function(i){var r=i;r.e(t,n,o.g,o.h)})},a:function(n,t){var i=this;this.c(n,t,function(r){i.f.b(n,_bs.bj.a(t));var u=new _e.b(_bs.g.g,t.Id);i.e.f(n,u,null);r&&Array.forEach(_bs.A.b,function(t){var u=t;u.d(r,n,i.g,i.h)})},null)},d:function(n){this.f.c(n);this.e.c(n)},l:function(n,t,i){var u=2;var r=0;var e=this;this.k(n,t,1,function(){++r===u&&i()});var f=this;this.k(n,t,0,function(){++r===u&&i()})},q:function(n){var t=n.DisplayNameLastFirst||"";if(_j.h.b(t)){t+=n.Surname||"";t+=n.GivenName||""}return t},p:function(n){var t=n.DisplayNameFirstLast||"";if(_j.h.b(t)){t+=n.GivenName||"";t+=n.Surname||""}return t},k:function(n,t,i,r){var f=this.m(t,i);var u=this;this.e.v(n,f,function(n){n.a(1,function(n,f,e){u.t(t,i,f);r()},null)})},t:function(n,t,i){if(i.length>0){var r=this.e.fromQueryResultEntry(i[0]);if(t===1){n.DisplayNameFirstLastSortKey=(r.get_data().Persona.DisplayNameFirstLastSortKey||"")+"00";n.DisplayNameFirstLastHeader=r.get_data().Persona.DisplayNameFirstLastHeader}else{n.DisplayNameLastFirstSortKey=(r.get_data().Persona.DisplayNameLastFirstSortKey||"")+"00";n.DisplayNameLastFirstHeader=r.get_data().Persona.DisplayNameLastFirstHeader}}},m:function(n,t){var i=null;var r=null;if(t===1){i=_bs.g.i;r=this.p(n)}else{i=_bs.g.j;r=this.q(n)}var f=new _e.d(i,r,0,1);return new _a.bk(f,[new _a.ca(i,1)])},o:function(n,t){var i=new PartialPersonaRecord(n,t);return this.e.fromData(i)},n:function(n){var t=new _g.bW;t.PersonaId=n.PersonaId;t.ADObjectId=n.ADObjectId;t.PersonaTypeString=n.PersonaTypeString;t.EmailAddress=n.EmailAddress;t.CompanyName=n.CompanyName;t.DisplayName=n.DisplayName;t.DisplayNameFirstLast=n.DisplayNameFirstLast;t.DisplayNameLastFirst=n.DisplayNameLastFirst;t.GivenName=n.GivenName;t.Surname=n.Surname;t.EmailAddresses=n.EmailAddresses;t.ImAddress=n.ImAddress;t.FileAs=n.FileAs;t.HomeCity=n.HomeCity;t.WorkCity=n.WorkCity;t.CreationTimeString=n.CreationTimeString;t.DisplayNameFirstLastHeader=n.DisplayNameFirstLastHeader;t.DisplayNameLastFirstHeader=n.DisplayNameLastFirstHeader;t.RelevanceScore=n.RelevanceScore;t.ThirdPartyPhotoUrlsArray=n.ThirdPartyPhotoUrlsArray;t.AttributionsArray=n.AttributionsArray;t.Alias=n.Alias;t.CompanyNameSortKey=n.CompanyNameSortKey;t.DisplayNameFirstLastSortKey=n.DisplayNameFirstLastSortKey;t.DisplayNameLastFirstSortKey=n.DisplayNameLastFirstSortKey;t.HomeCitySortKey=n.HomeCitySortKey;t.WorkCitySortKey=n.WorkCitySortKey;return t},r:function(n,t){_bs.A.c?t(_bs.A.c):this.i.a(n,t)}};_bs.dq=function(n,t,i,r,u,f,e){_bs.dq.initializeBase(this);this.j=n;this.k=i;this.l=r;this.n=t;this.g=u;this.h=f;this.i=e};_bs.dq.prototype={j:null,g:null,h:null,k:null,l:null,f:null,m:null,i:null,n:null,a:function(){return this.f?_ff.i.a(this.f):0},b:function(){return this.m?this.m.length:0},d:function(n,t,i){this.f={};var r=this;_bs.k.b(_bc.T,n,this.k,t,this.f,function(){_bs.k.b(_bc.X,n,r.l,t,r.f,i)})},c:function(n){},e:function(n){this.g&&this.o(n,0);if(this.h)for(var i=this.h,u=i.length,t=0;t<u;++t){var r=i[t];this.j.a(n,r)}this.i&&this.n.b(n,this.i,null)},o:function(n,t){for(var e=0,o=this.g.length-t,i=Math.min(o,5),r=0;r<i;r++){var f=this.g[t+r];var u=this;this.j.b(n,f,1,function(){++e===i&&u.o(n,t+i)})}}};function ConfigChangeCleanupModuleItem(n,t){_a.b.a(t,"syncManagerStartTime");this.ModuleType=n;this.SyncManagerStartTime=t}ConfigChangeCleanupModuleItem.prototype={ModuleType:0,SyncManagerStartTime:null};function MessageItemRecord(){MessageItemRecord.initializeBase(this)}MessageItemRecord.prototype={CustomSyncData:null};_bs.v=function(){_bs.v.initializeBase(this)};_bs.v.b=function(n,t,i,r,u){var f=n===Number||Type.isEnum(n)?0:n===Boolean?!1:null;t.a(new _e.a(String.format("SettingItem.GetValue({0})",i)),function(r){_bs.v.d(n,t,r,i,function(n){f=n})},function(){r(f)},_bs.b.b(u))};_bs.v.d=function(n,t,i,r,u){t.bindIn(i,_bs.d.a(r),function(t){if(t){var i=t.get_data();u(i.Value)}else u(n===Number||Type.isEnum(n)?0:n===Boolean?!1:null)},null)};_bs.v.e=function(n,t,i,r,u,f){t.a(new _e.a(String.format("SettingItem.SetValue({0})",i)),function(n){_bs.v.a(t,n,i,r,null)},function(){u()},_bs.b.b(_bs.b.f(f)))};_bs.v.a=function(n,t,i,r,u){var f=new SettingRecord;f.Id=i;f.Value=r;var e=n.fromData(f);e.b(t,function(){_bs.b.c(u)})};_bs.v.c=function(n,t){_bs.j.f(_bs.v,n,_bs.d.a(t),null)};_bs.v.prototype={l:function(){return _bs.e.a().A},I:function(n){return new ItemMetadata},H:function(n){return _bs.d.a(n.Id)},K:function(n){}};_bs.E=function(n){this.c=n.u();this.f=n.p()};_bs.E.a=function(n){var t=new _bs.bh(n,_bs.f.b);return new _bs.E(t)};_bs.E.b=function(n){_bs.v.c(n,"CalendarFolders")};_bs.E.c=function(n){_bs.v.c(n,"FavoriteFolders")};_bs.E.d=function(n){_bs.v.c(n,"OtherMailboxConfiguration")};_bs.E.prototype={c:null,f:null,j:function(n,t){var i=this;_bs.v.b(String,this.c,"DatabaseId",n,function(n){t(n.b())})},o:function(n,t){var i=this;_bs.v.b(Boolean,this.c,"Provisioned",n,function(n){t(n.b())})},d:function(n,t){_bs.v.b(_g.ct,this.c,"OwaUserConfiguration.1",n,t)},x:function(n,t,i){_bs.v.e(Boolean,this.c,"Provisioned",n,t,i)},u:function(n,t){var i=this,r=this;this.d(function(r){if(r){(r.UserOptions.ConversationSortOrder!==n.ConversationSortOrder||r.UserOptions.HideDeletedItems!==n.HideDeletedItems)&&i.g();r.UserOptions.ConversationSortOrder=n.ConversationSortOrder;r.UserOptions.HideDeletedItems=n.HideDeletedItems;r.UserOptions.ShowSenderOnTopInListView=n.ShowSenderOnTopInListView;r.UserOptions.ShowPreviewTextInListView=n.ShowPreviewTextInListView;r.UserOptions.ShowUpNext=n.ShowUpNext;r.UserOptions.ShowInferenceUiElements=n.ShowInferenceUiElements;i.c.a(new _e.a("Settings.SetLayoutSettings"),function(n){i.e(n,r,null)},function(){t()},function(n){_j.e.c(_a.a.Q,"SetLayoutSettings to offline store failed with dbError: {0}",n.a);t()})}else{_j.e.b(_a.a.Q,"When user changes the UserConfig via inline settings, the OwaUserConfiguration has not been synced yet");t()}},function(n){_j.e.c(_a.a.Q,"Mark email data outdated when we failed to GetOwaUserConfiguration with clientStoreError: {0}",n.a());r.g();t()})},g:function(){var n=new _bs.bE(_a.bm.a());n.c(11,"")},e:function(n,t,i){_bs.v.a(this.c,n,"OwaUserConfiguration.1",t,i)},w:function(n,t,i){var r=this;this.d(function(u){if(u){u.ViewStateConfiguration||(u.ViewStateConfiguration=new _g.cY);n(u.ViewStateConfiguration);r.c.a(new _e.a("Settings.SetOwaViewStateConfiguration"),function(n){r.e(n,u,null)},function(){t()},function(n){i(new _bs.b(n))})}else t()},i)},y:function(n,t){var i=this,r=this;this.d(function(r){if(r){r.UserOptions.TimeZone=n;i.c.a(new _e.a("Settings.SetTimeZone"),function(t){_bs.bD.a(i.f,t,function(u){for(var f=0;f<u.length;f++)u[f].k.TimeZoneId===n&&(r.UserOptions.MailboxTimeZoneOffset=[u[f].k]);i.e(t,r,null)},function(n){_j.e.c(_a.a.Q,"Failed to load the time zone offsets table: {0}",n.a())})},function(){t()},function(i){_j.e.c(_a.a.Q,"SetTimeZone {0} to offline store failed with dbError: {1}",n,i.a);t()})}else t()},function(i){_j.e.c(_a.a.Q,"SetTimeZone can't retrieve OwaUserConfiguration from offline store, new timezone {0} can't be updated to offline store. ClientStoreError is {1}",n,i.a());t()})},l:function(n,t){_bs.v.d(_g.hu,this.c,n,"IdentityCorrelationTable",t)},s:function(n,t,i){_bs.v.a(this.c,n,"IdentityCorrelationTable",t,i)},h:function(n,t){_bs.v.c(n,"IdentityCorrelationTable")},i:function(n,t){_bs.v.b(_g.fM,this.c,"CalendarFolders",n,t)},p:function(n,t,i){_bs.v.a(this.c,n,"CalendarFolders",t,i)},k:function(n,t){_bs.v.b(_g.fS,this.c,"FavoriteFolders",n,t)},n:function(n,t){_bs.v.b(_g.gk,this.c,"OtherMailboxConfiguration",n,t)},r:function(n,t,i){_bs.v.a(this.c,n,"FavoriteFolders",t,i)},v:function(n,t,i){_bs.v.a(this.c,n,"OtherMailboxConfiguration",t,i)},m:function(n,t){_bs.v.d(Boolean,this.c,n,"IsOfflineComponentReadyToUse",t)},t:function(n,t,i){_bs.v.a(this.c,n,"IsOfflineComponentReadyToUse",t,i)},a:function(n,t){_bs.v.d(Object,this.c,n,"PersonaJumpHeaderMappings",t)},b:function(n,t,i){_bs.v.a(this.c,n,"PersonaJumpHeaderMappings",t,i)},q:function(n,t,i){_bs.v.e(String,this.c,"DatabaseId",n,t,i)}};_bs.bD=function(){_bs.bD.initializeBase(this)};_bs.bD.a=function(n,t,i,r){_a.b.a(n,"timeZoneOffsetsItemStore");_a.b.a(i,"successCallback");var u=[];var f=t.a(_bs.e.a().t.a());f.a(null,function(t){t.a(1e3,function(t,r,f){for(var e=0;e<r.length;++e)Array.add(u,n.fromQueryResultEntry(r[e]));i(u)},null)},function(n){_bs.b.a(n,r)})};_bs.bD.prototype={l:function(){return _bs.e.a().t},K:function(n){_a.b.a(n.TimeZoneId,"TimeZoneId")},H:function(n){return _bs.d.a(n.TimeZoneId)},I:function(n){return new ItemMetadata}};_bs.cw=function(){_bs.cw.initializeBase(this)};_bs.cw.a=function(){return new _a.R("Data.TombstoneType")};_bs.cw.prototype={l:function(){return _bs.e.a().u},I:function(n){return new ItemMetadata},H:function(n){return _bs.d.a(n.Id)},K:function(n){_a.b.c(n.Id,"id")}};_bs.cx=function(n,t){_bs.cx.initializeBase(this,[n,t])};_bs.cx.prototype={g:function(n,t,i,r,u){_a.b.a(n,"tx");_a.b.a(i,"tombstonedItemsToBeDeleted");_a.b.a(r,"perItemCallback");_a.b.a(u,"completedCallback");var o=100;var s=[];var h=new _e.b(_bs.cw.a(),t);var e=new _a.bk(h,null);var f=this;this.m(n,e,o,function(t,e,o,h){_j.e.a(_bs.f.a,"Found {0} tombstoned items",s.length);for(var a=o,v=a.length,c=0;c<v;++c){var y=a[c];var l=f.fromQueryResultEntry(y);r(l.get_data());Array.add(i,l.a())}if(h){_bs.T.b(n,f,i);u()}},null)}};_bs.cu=function(){};_bs.cu.registerInterface("_bs.cu");_bs.dr=function(n){_bs.dr.initializeBase(this,[n,"CalendarSyncState"]);this.i=750};_bs.dr.prototype={i:0,j:function(n,t,i){var r=t;var f=i;if(r.TryToIncrementWindowSizeOnNextSync){_j.e.a(_a.a.cE,"CalendarSyncState.TryToIncrementWindowSizeOnNextSync is true. Need to count the existing items in the store.");var u=this;f.y(n,function(){_bs.bB.b(n,function(t){if(t>=u.i){_j.e.a(_a.a.cE,"Calendar sync have exceeded the limit ({0} stored items,) and therefore won't grow the sync window anymore (Approximate Window Size: {1} months).",u.i,r.ApproximateWindowSize);r.TryToIncrementWindowSizeOnNextSync=!1}else _j.e.a(_a.a.cE,"The number of stored calendar items ({0}) are below the limit --> Sync will try to grow the window on next attempt.",t);u.c().d(n,r)},function(n){_j.e.c(_a.a.cE,"Unable to count the existing items in the store (Error: {0}).",n.e())})})}else _bs.bQ.prototype.j.call(this,n,t,i)}};_bs.bB=function(n,t,i,r,u,f,e,o,s){this.u=Function.createDelegate(this,this.z);_bs.bB.initializeBase(this);this.h=_a.I.a();this.m=n;this.f=_bs.bL.a(n);this.s=t;this.n=i;this.i=r;this.k=u;this.r=f;this.l=e;this.j=o;this.t=s};_bs.bB.b=function(n,t,i){_a.b.a(n,"tx");_a.b.a(t,"callback");var f=-1;var u=-1;var r=function(n){_bs.b.a(n,i)};var o=n.a(_bs.e.a().g.a());o.c(null,function(n){n.a(function(n){u!==-1?t(n+u):f=n},r)},r);var e=n.a(_bs.e.a().l.a());e.c(null,function(n){n.a(function(n){f!==-1?t(n+f):u=n},r)},r)};_bs.bB.a=function(n){};_bs.bB.prototype={f:null,i:null,k:null,r:null,l:null,j:null,t:null,n:null,s:!1,m:null,g:null,h:null,a:function(){return this.g?_ff.i.a(this.g):0},b:function(){return this.h?this.h.f():0},d:function(n,t,i){this.g={};var r=this;_bs.k.b(_bc.u,n,this.m.f(),t,this.g,function(){_bs.k.b(_bc.t,n,r.m.b(),t,r.g,i)})},v:function(n){_bs.k.h(this.g,n)},c:function(n){var t=this;this.v(function(i){var r=t.h.b[i];r?r.CalendarItemType==="RecurringMaster"?_bs.k.c(_bc.u,_g.z,t.f.b,n,r,null,_bs.bB.a):_bs.k.c(_bc.t,_g.z,t.f.a,n,r,null,_bs.bB.a):_j.e.a(_bs.k.a,"Item data not found to reconcile (Id: {0}).",i)})},e:function(n){this.y(n,null)},y:function(n,t){var i=this;this.B(n,function(){_j.e.a(_bs.k.a,"CalendarSyncChangeUpdater: Successfully finished prunning calendar items.");i.A(n,function(){_j.e.a(_bs.k.a,"CalendarSyncChangeUpdater: Successfully finished persisting deletes.");i.q(n,0,1,function(){_j.e.a(_bs.k.a,"CalendarSyncChangeUpdater: Successfully finished persisting recurrence masters.");i.p(n,0,25,t)})})})},o:function(n,t,i,r,u){var f=t.length;if(t&&f){var o;var l=this;var c=function(t){l.f.d(n,t,function(){--f||u()})};if(r){var v=this;o=function(t){v.f.a.i(n,t,function(){c(t)})}}else o=c;for(var s=t,y=s.length,e=0;e<y;++e){var a=s[e];var h=i(a);h?o(h):f===1?u():--f}}else u()},A:function(n,t){var i=this;this.o(n,this.l,_bs.u.f,!0,function(){i.o(n,i.r,_bs.Q.b,!1,function(){i.o(n,i.i,function(n){return n.CalendarItemType==="Single"?_bs.Q.b(n):null},!1,t)})})},q:function(n,t,i,r){var o=this.k.length-t;var u=Math.min(o,i);_j.e.a(_bs.k.a,"CalendarSyncChangeUpdater: Persisting reucrrence masters with instances (startIndex: {0}; remaining: {1}; count: {2})...",t,o,u);if(u)for(var s=0,f=0;f<u;f++){var c=this.k[t+f];var e=this.w(c);if(e){var h=this;_bs.k.c(_bc.u,_g.L,this.f.b,n,e,this.u,function(f){++s===u&&h.q(n,t+u,i,r)})}else{_j.e.b(_bs.k.a,"CalendarSyncChangeUpdater: The data is null/undefined in the RecurrenceMastersWithInstances list.");++s===u&&this.q(n,t+u,i,r)}}else{_j.e.a(_bs.k.a,"CalendarSyncChangeUpdater: Done persisting {0} recurrence masters...",this.k.length);r()}},p:function(n,t,i,r){var o=this.i.length-t;var u=Math.min(o,i);_j.e.a(_bs.k.a,"CalendarSyncChangeUpdater: Persisting updates (startIndex: {0}; remaining: {1}; count: {2})...",t,o,u);if(u)for(var s=0,e=0;e<u;e++){var c=this.i[t+e];var f=this.w(c);if(f){var h=this;_bs.k.c(_bc.t,_g.L,this.f.a,n,f,null,function(f){++s===u&&h.p(n,t+u,i,r)})}else{_j.e.b(_bs.k.a,"CalendarSyncChangeUpdater: The data is '{0}' in the UpdatedItems list.",f);++s===u&&this.p(n,t+u,i,r)}}else{_j.e.a(_bs.k.a,"CalendarSyncChangeUpdater: Done persisting {0} updates.",this.i.length);_bs.b.c(r)}},x:function(n){for(var i=this.l,u=i.length,t=0;t<u;++t){var r=i[t];if(r.Id===n)return!0}return!1},w:function(n){var t;if(this.x(n.ItemId.Id)){_j.e.a(_bs.k.a,"Item present in delete list: {0}",n.ItemId.Id);return null}if(n.CalendarItemType==="Occurrence"){var i=this.t.b[n.UID];if(i)if(this.x(i)){_j.e.b(_bs.k.a,"The master item is deleted for the occurrence with Id {0}",n.ItemId.Id);return null}else{t=this.j.b[i];t.ItemId=n.ItemId;t.CalendarItemType=n.CalendarItemType;t.Start=n.Start;t.StartWallClock=n.StartWallClock;t.End=n.End;t.EndWallClock=n.EndWallClock;t.Recurrence=undefined;t.IsRecurring=!0;t.ItemClass="IPM.Appointment.Occurrence"}else{_j.e.a(_bs.k.a,"The master item is not downloaded for the occurrence with UID {0}",n.UID);t=this.j.b[n.ItemId.Id]}}else t=this.j.b[n.ItemId.Id];if(!t){var r=String.format("Could not find the data for item (Type: {0}; ID: {1}; UID: {2}).",n.CalendarItemType,n.ItemId.Id,n.UID);_j.e.c(_bs.k.a,r);throw Error.create(r);}return t},B:function(n,t){if(this.s){_j.e.a(_bs.k.a,"Prune calendar items ending before (not including) the sync window's start time ('{0}')...",this.n);var i=new _e.d(_bs.u.d,this.n,0,1);var r=this;this.f.a.f(n,i,function(){t()})}else t()},z:function(n,t,i){var r=this;this.f.c(t,n.a(),function(u){u||r.f.a.b(t,n.a());r.f.b.saveIn(t,n,1,i)})}};_bs.bo=function(n,t,i){_bs.bo.initializeBase(this);_a.b.b(n,"calendarFolderId");_a.b.b(t,"windowStart");_a.b.b(i,"windowEnd");t.localeCompare(i)>0&&Error.argumentOutOfRange("windowStart",t,String.format("Window start has to be less than window end ({0}).",i));this.b=n;this.d=t;this.c=i;this.a=-1};_bs.bo.prototype={b:null,d:null,c:null,a:0};_bs.bS=function(n){_bs.bS.initializeBase(this);_a.b.a(n,"cleaner");this.a=n};_bs.bS.prototype={a:null,e:function(n){_a.b.a(n,"tx");this.a(n)}};function ConversationItemSyncState(n,t,i){ConversationItemSyncState.initializeBase(this,["ConversationNodeSyncStateId",n,t]);this.b=i}ConversationItemSyncState.prototype={b:null};_bs.ds=function(n,t,i,r,u){_bs.ds.initializeBase(this);_a.b.a(n,"itemStoreGetter");_a.b.a(t,"conversationChanges");_a.b.a(i,"itemChanges");_a.b.a(r,"itemIds");_a.b.a(u,"attachments");this.f=n;this.j=t;this.l=i;this.m=r;this.i=u};_bs.ds.prototype={f:null,j:null,l:null,m:null,i:null,g:null,h:null,k:null,p:null,a:function(){return this.g?_ff.i.a(this.g)+_ff.i.a(this.h):0},b:function(){return this.k?this.k.length+this.p.length:0},o:function(){return this.f.a()},n:function(){return this.f.k()},q:function(){return this.f.j()},r:function(){return this.f.q()},e:function(n){this.s(n,this.j,this.l,this.i,this.m)},d:function(n,t,i){this.g={};this.h={};var r=this;_bs.k.b(_bc.E,n,this.f.k(),t,this.g,function(){_bs.k.b(_bc.A,n,r.f.a(),t,r.h,i)})},c:function(n){},s:function(n,t,i,r,u){_a.b.a(n,"tx");var f=this;this.t(n,t,u,function(){var u=[];_bs.k.e(f.o(),n,i,function(n){return _bs.d.a(n.ItemId.Id)},function(e){for(var l=i,a=l.length,c=0;c<a;++c){var o=l[c];var s=e.c(o.ItemId.Id)?e.b[o.ItemId.Id].get_data():null;var h=_gg.El.a(s,o);s&&(h=_gg.fg.a(s,h));Array.add(u,h)}_bs.k.d(_bc.E,_g.hb,f.n(),n,t,null);_bs.k.d(_bc.A,_g.L,f.o(),n,u,null);_bs.k.d(_bc.Q,AttachmentInfoRecord,f.q(),n,r,null)})})},t:function(n,t,i,r){for(var s=0,f=t,h=f.length,u=0;u<h;++u){var o=f[u];var e=this;this.n().bindIn(n,_bs.d.a(o.ConversationId.Id),function(u){if(u){var a=u.get_data();if(a.ConversationNodes)for(var v=a.ConversationNodes,p=v.length,f=0;f<p;++f)for(var l=v[f],o=0;o<l.Items.length;o++){var h=l.Items[o];var c=h.ItemId.Id;if(!i.b[c]){var y=e.r().fromData(TombstonedItemRecord.a(c,"MessageItem",h));y.i(n,1,null)}}}++s===t.length&&r()},null)}}};_bs.bT=function(n,t,i){_bs.bT.initializeBase(this,[n,t,i])};_bs.bT.prototype={e:function(n){var t=this;this.n(n,function(){_bs.bn.prototype.o.call(t,n,function(){t.p(n)})})},m:function(n,t){if(!n.GlobalItemChangeKeys||!n.GlobalItemReadFlags||!t.GlobalItemChangeKeys||!t.GlobalItemReadFlags)return!1;for(var u=0;u<n.GlobalItemIds.length;u++);for(var f=0;f<t.GlobalItemIds.length;f++);if(n.GlobalItemIds.length!==t.GlobalItemIds.length)return!1;var r=n.GlobalItemIds.length;if(n.GlobalItemChangeKeys.length!==r||t.GlobalItemChangeKeys.length!==r)return!1;for(var i=0;i<r;i++)if(n.GlobalItemIds[i].Id!==t.GlobalItemIds[i].Id||n.GlobalItemChangeKeys[i]!==t.GlobalItemChangeKeys[i])return!1;return!0},n:function(n,t){if(!this.g.length){t();return}var r=[];var u=this,i=this;_bs.k.e(this.h,n,this.g,function(n){return _bs.Y.a(n.FolderId,n.ConversationId)},function(n){for(var c=i.g,l=c.length,e=0;e<l;++e){var u=c[e];var h=_bs.Y.a(u.FolderId,u.ConversationId);u.DirtyState=2;var f=n.c(h.c.a.toString())?n.b[h.c.a.toString()].get_data():null;if(f){var o=i.f===11||i.f===10;if(!o||!(_a.d.b(f.LastModifiedTime).b(_a.d.b(u.LastModifiedTime))>=0)){f.DirtyState!==2&&i.m(u,f)&&(u.DirtyState=1);if(o){var s=f.SaveMode;u.SaveMode=s;_j.e.a(_a.a.Q,"Stamped conversation: {0} with saveMode: {1}",u.ConversationId.Id,s)}Array.add(r,u)}}else Array.add(r,u)}i.g=r;t()})}};function EmailItemSyncState(n,t,i){EmailItemSyncState.initializeBase(this,[n,""]);_a.b.a(t,"itemIds");this.c=i;this.a=t}EmailItemSyncState.prototype={a:null,c:null};_bs.dt=function(n,t,i,r){_bs.dt.initializeBase(this,[n,t]);_a.b.c(i,"outboxFolderId");_a.b.e(r,0,2147483647,"outboxFolderPositionIndex");this.c=i;this.d=r};_bs.dt.prototype={c:null,d:0,e:function(n){_a.b.a(n,"tx");var t=this;this.a.e(n,_bs.d.a(this.c),function(i){var u=i;var r=t.b[t.d];if(u){r.TotalCount=u.get_data().TotalCount;r.UnreadCount=u.get_data().UnreadCount}else{r.TotalCount=0;r.UnreadCount=0}_bs.bM.prototype.e.call(t,n)},null)}};function MessageItemSyncState(n,t,i){MessageItemSyncState.initializeBase(this,["MessageItemSyncStateId",n,t]);this.b=i}MessageItemSyncState.prototype={b:!1};_bs.bU=function(n,t,i,r,u){_bs.bU.initializeBase(this,[n,t,i]);this.n=r;this.m=u};_bs.bU.prototype={n:null,m:null,e:function(n){_a.b.a(n,"tx");var i=[];var r=this,t=this;_bs.k.e(this.h,n,this.g,function(n){return _bs.d.a(n.ItemId.Id)},function(r){for(var o=t.g,s=o.length,u=0;u<s;++u){var f=o[u];var h=r.c(f.ItemId.Id)?r.b[f.ItemId.Id].get_data():null;var e=t.q(h,f);e&&Array.add(i,e)}t.g=i;t.m&&t.m.g(n,t.k,0,function(){});t.r(n);_bs.bn.prototype.o.call(t,n,function(){t.p(n)})})},r:function(n){for(var t=0;t<this.n.length;t++){var i=this.n[t];var r=this;this.h.e(n,_bs.d.a(i.ItemId.Id),function(t){var r=t;if(r){r.get_data().IsRead=i.IsRead;r.i(n,1,null)}},null)}},q:function(n,t){var i;var u=this.f===11||this.f===10;if(n&&t.ItemId.ChangeKey===n.ItemId.ChangeKey){if(u&&n.IsRead===t.IsRead)return null;i=_gg.fg.b(t,n)}else i=t;_bs.U.a(i,"false",0);if(n&&u){var r=n.SaveMode;i.SaveMode=r;_j.e.a(_a.a.Q,"Stamped message: {0} with saveMode: {1}",i.ItemId.Id,r)}return i}};_bs.cv=function(n,t){this.b=this.$$gta["_bs.cv"].TItem===Number||Type.isEnum(this.$$gta["_bs.cv"].TItem)?0:this.$$gta["_bs.cv"].TItem===Boolean?!1:null;_bs.cv.$$(this.$$gta["_bs.cv"].TItem).initializeBase(this);_a.b.a(n,"setting");_a.b.a(t,"persister");this.b=n;this.a=t};_bs.cv.$$=function(n){var u=_bs.__tc=_bs.__tc||{};var t="cv"+"$"+n.getName().replace(/\./g,"_");if(!u[t]){var r=u[t]=function(){for(var t=[],n=0;n<arguments.length;++n)t[n]=arguments[n];_bs.cv.apply(this,t)};var o=_bs.k;r.registerClass("_bs.__tc."+t,o);var s={"_bs.cv":{TItem:n},ctor:_bs.cv};r.prototype.$$gta=s;var e=_bs.cv.prototype;for(var f in e){var i={key:f,value:e[f]};"constructor"!==i.key&&(r.prototype[i.key]=i.value)}}return u[t]};_bs.cv.prototype={a:null,e:function(n){_a.b.a(n,"tx");this.a(this.b,n)}};_bs.q=function(){this.z=Function.createDelegate(this,this.Q);this.v={};_bs.q.initializeBase(this);this.j(this.z)};_bs.q.prototype={s:0,t:0,h:function(n){this.apcl(_bs.q.d.a,n)},j:function(n){this.apcl(_bs.q.e.a,n)},f:function(n){this.apcl(_bs.q.c.a,n)},g:function(n){this.apcl(_bs.q.b.a,n)},q:function(n){this.apcl(_bs.q.b.a,n)},i:function(n){this.bA("HighPriorityActionEmptyChanged",n)},m:function(){return this.eJ(_bs.q.d)},P:function(n){this.eH(_bs.q.d,n);return n},o:function(){return this.eJ(_bs.q.e)},D:function(n){this.eH(_bs.q.e,n);return n},l:function(){return this.eJ(_bs.q.c)},b:function(n){this.eH(_bs.q.c,n);return n},c:function(){return this.eJ(_bs.q.b)},O:function(n){this.eH(_bs.q.b,n);return n},a:function(){return this.s>0},y:function(n){var t=this.s;this.s=n;(t<=0&&this.s>0||t>0&&this.s<=0)&&this.cd("HighPriorityActionEmptyChanged");return n},n:function(){return this.t},k:function(n,t,i){var r=new _g.H(n);var u=this;this.x(r,function(n){r.id=n;_j.e.a(_bs.q.a,"{0} enqueued",_g.H.a(r));u.L(r);u.P(r);u.D(!0);u.J(r);t(r)},i)},r:function(n,t,i){n.state=0;var r=this;this.E(n,function(){_j.e.a(_bs.q.a,"{0} updated in the database.",_g.H.a(n));t()},i)},p:function(n,t){var i=this;this.B(function(t){if(t){_j.e.a(_bs.q.a,"{0} retrieved as next request.",_g.H.a(t));i.N(t)}else{_j.e.a(_bs.q.a,"No requests available.");i.D(!1)}n(t)},t)},d:function(n,t){this.A(n,t)},e:function(n,t,i,r){this.M(n);var u=this;this.C(r,n,function(i,r){if(i){_j.e.a(_bs.q.a,"Action Record {0} removed.",n);u.K(r)}else _j.e.a(_bs.q.a,"Action Record {0} was not present.",n);t(i)},i)},Q:function(n,t){_j.e.a(_bs.q.a,"RequestAvailable : {0}",this.o());this.O(!this.o())},L:function(n){var t=n.request.actionHandler;if(t){this.v[n.id.toString()]=t;n.request.hasActionHandler=!0}},N:function(n){n.request.hasActionHandler&&(n.request.actionHandler=this.v[n.id.toString()])},M:function(n){delete this.v[n.toString()]},J:function(n){_bs.bi.a(n)?this.y(this.s+1):this.t++},K:function(n){_bs.bi.a(n)?this.s<=0?_j.e.b(_bs.q.a,"Trying to decrement HighPriorityActionCount when it is already <= 0, value = {0}",this.s):this.y(this.s-1):this.t<=0?_j.e.b(_bs.q.a,"Trying to decrement LowPriorityActionCount when it is already <= 0, value = {0}",this.t):this.t--}};_bs.ec=function(n,t){this.l=Function.createDelegate(this,this.N);this.t=Function.createDelegate(this,this.L);this.u=Function.createDelegate(this,this.M);this.r=Function.createDelegate(this,this.J);this.s=Function.createDelegate(this,this.K);this.a=t;this.b=n};_bs.ec.prototype={b:null,c:null,d:"",i:!1,a:null,I:function(){return this.c?this.c.id:0},z:function(n){this.c=n;this.d=_g.H.a(n);return n},N:function(n,t){this.j()},j:function(){if(this.i)_j.e.a(this.a,"Deferring ProcessNextRecord until current record completes: {0}",this.d);else if(this.m()){if(this.w()){_j.e.a(this.a,"Fetching next record.");this.i=!0;this.d="Fetching next record...";this.v(this.s,this.r)}}else this.x()},x:function(){},K:function(n){this.z(n);if(this.c){this.c.webrequestCompletedCount=0;this.y(this.u,this.t)}else this.h()},J:function(n){_j.e.b(this.a,"Failed to fetch next record: {0}",n.message);this.h()},M:function(){this.h()},L:function(n){_j.e.b(this.a,"Processing of {0} failed: {1}",this.d,n.message);this.h()},h:function(){this.i=!1;this.z(null);this.j()}};_bs.bf=function(n){_bs.bf.initializeBase(this,[n.K]);_a.b.a(n.t,"clientStore");this.jp=n};_bs.bf.prototype={jp:null,k:function(n,t,i,r){var e=new _bs.bu(t,this.jp,n);var f=this,u=this;e.f(function(){_gg.a.prototype.k.call(f,n,t,i,r)},r,function(){_j.e.b(_a.a.bc,"ApplyConversationAction was rejected by the offline proxy.");_gg.a.prototype.k.call(u,n,t,i,r)})},d:function(n,t,i,r){var f=t;if(f.isQueued){var u=new _bs.bv(f,this.jp,n);var o=this,e=this;u.f(function(){_gg.a.prototype.d.call(o,n,t,function(n,t){n.response=_g.bB.a(u.e,-2);i(n,u.e)},r)},r,function(){_j.e.b(_a.a.bc,"CreateAttachment was rejected by the offline proxy.");e.jp.b().d(n,t,i,r)})}else this.jp.b().d(n,t,i,r)},p:function(n,t,i,r){var f=t;if(f.isQueued){this.jp.c().a(n);var u=new _bs.c(f,this.jp,n);var o=this,e=this;u.f(function(){_gg.a.prototype.p.call(o,n,t,function(t,r){n.Body.MessageDisposition==="SendAndSaveCopy"&&f.clientStoreItem===2&&u.bG(f.itemIds[0],t.id);t.response=_g.bB.a(u.s,-2);i(t,u.s)},r)},r,function(){e.jp.b().p(n,t,i,function(n){var i=new _bc.l(u.m,n);var t=Error.create("OfflineErrorInfo",i);r(t)})})}else this.jp.b().p(n,t,i,r)},q:function(n,t,i,r){var u=new _bs.bw(t,this.jp,n.Body.PropertyUpdates,n.Body.ParentFolderId,n.Body.PersonTypeString,this.jp.a());var e=this,o=this,f=this;u.f(function(){_gg.a.prototype.q.call(e,n,t,function(n,t){n.response=_g.bB.a(u.b,-2);i(n,u.b)},function(n){var i=new _bc.l(0,n);var t=Error.create(_bs.bf.a,i);r(t)})},function(n){var i=new _bc.l(0,n);var t=Error.create(_bs.bf.a,i);r(t)},function(){_gg.a.prototype.q.call(f,n,t,function(n,t){n.response=_g.bB.a(null,-2);i(n,t)},function(n){var i=new _bc.l(0,n);var t=Error.create(_bs.bf.a,i);r(t)})})},u:function(n,t,i,r,u){var f=i;n=f.personaId=this.jp.c().b(n);var s=new _bs.cb(f,this.jp,n,this.jp.a());var o=this,e=this;s.f(function(){_gg.a.prototype.u.call(o,n,t,i,r,u)},u,function(){_gg.a.prototype.u.call(e,n,t,i,r,u)})},r:function(n,t,i,r){var u=new _bs.bk(t,this.jp,n);var e=this,f=this;u.f(function(){_gg.a.prototype.r.call(e,n,t,function(n,t){n.response=_g.bB.a(u.e,-2);i(n,u.e)},r)},r,function(){_j.e.b(_a.a.bc,"DeleteAttachment service command was rejected by the offline proxy.");_gg.a.prototype.r.call(f,n,t,i,r)})},br:function(n,t,i,r){var u=new _bs.bb(t,this.jp,n,_g.b.a,this.jp.a());var e=this,o=this,f=this;u.f(function(){_gg.a.prototype.br.call(e,n,t,i,r)},function(n){_j.e.c(_a.a.bc,"EmptyFolder service command failed. Exception: {0}",n);var i=new _bc.l(u.e,n);var t=Error.create(_bs.bf.a,i);r(t)},function(){_j.e.b(_a.a.bc,"EmptyFolder service command was rejected by the offline proxy.");f.jp.b().br(n,t,i,function(n){var i=new _bc.l(u.e,n);var t=Error.create("OfflineErrorInfo",i);r(t)})})},bv:function(n,t,i,r){var u=new _bs.be(t,this.jp,n,this.jp.a(),_g.b.a,this.jp.P);var e=this,f=this;u.f(function(){i(null,u.e)},r,function(){_gg.a.prototype.bv.call(f,n,t,i,r)})},x:function(n,t,i){var r=new _bs.bI(n,this.jp,this.jp.a());var f=this,u=this;r.f(function(){t(null,r.b)},i,function(){_gg.a.prototype.x.call(u,n,t,i)})},g:function(n,t,i,r){var u=new _bs.bx(t,this.jp,n,this.jp.a());var e=this,f=this;u.f(function(){i(null,u.e)},r,function(){_gg.a.prototype.g.call(f,n,t,i,r)})},v:function(n,t,i,r){var u=new _bs.cc(t,this.jp,n,this.jp.a());var e=this,f=this;u.f(function(){i(null,u.d)},r,function(){_gg.a.prototype.v.call(f,n,t,i,r)})},e:function(n,t,i,r){var u=new _bs.m(t,this.jp,n,this.jp.a(),_g.b.a);var e=this,f=this;u.f(function(){i(null,u.i)},r,function(){_gg.a.prototype.e.call(f,n,t,i,r)})},bu:function(n,t,i,r){var u=new _bs.L(t,this.jp,n,this.jp.a());var e=this,f=this;u.f(function(){i(null,u.d)},r,function(){_gg.a.prototype.bu.call(f,n,t,i,r)})},bR:function(n,t,i,r){var u=new _bs.N(t,this.jp,n);var e=this,f=this;u.f(function(){i(null,u.e)},r,function(){_gg.a.prototype.bR.call(f,n,t,i,r)})},D:function(n,t,i){var r=new _bs.dQ(n,this.jp,this.jp.a());var f=this,u=this;r.f(function(){t(null,r.b)},i,function(){_gg.a.prototype.D.call(u,n,t,i)})},cl:function(n,t,i,r){var u=new _bs.dR(t,this.jp,n,this.jp.a());var o=this;var f=function(){i(null,u.d)};var e=this;u.f(f,r,function(){u.e?_gg.a.prototype.cl.call(e,n,t,i,function(n){_j.e.b(_a.a.bc,"GetPersona service command failed on the server. Falling back to the client store. Error: {0}",n.message);u.f(f,r,function(){r(n)})}):_gg.a.prototype.cl.call(e,n,t,i,r)})},c:function(n,t,i,r){this.jp.c().a(n);var u=t;if(u.clientStoreItem===1){var e=new _bs.H(u,this.jp,n);var c=this,h=this;e.f(function(){_gg.a.prototype.c.call(c,n,t,function(n,t){n.response=_g.bB.a(e.i,-2);i(n,e.i)},r)},r,function(){h.jp.b().c(n,t,i,function(n){var i=new _bc.l(e.k,n);var t=Error.create("OfflineErrorInfo",i);r(t)})})}else{var f=new _bs.p(u,this.jp,n);var o=this,s=this;f.f(function(){_gg.a.prototype.c.call(o,n,t,function(t,r){t.response=_g.bB.a(f.i,-2);n.Body.MessageDisposition==="SendAndSaveCopy"&&u.clientStoreItem===2&&f.I(u.itemIds[0],t.id);i(t,f.i)},r)},r,function(){_j.e.b(_a.a.bc,"UpdateItem service command was rejected by the offline proxy.");s.jp.b().c(n,t,i,r)})}},a:function(n,t,i,r){this.jp.p.a(n);var u=new _bs.G(t,this.jp,n);var e=this,f=this;u.f(function(){i(null,u.k)},r,function(){_gg.a.prototype.a.call(f,n,t,i,function(n){var i=new _bc.l(u.r,n);var t=Error.create("OfflineErrorInfo",i);r(t)})})},t:function(n,t,i,r){this.jp.c().a(n);var u=new _bs.F(t,this.jp,n);var e=this,f=this;u.f(function(){_gg.a.prototype.t.call(e,n,t,i,r)},r,function(){f.jp.b().t(n,t,i,function(n){var i=new _bc.l(u.i,n);var t=Error.create("OfflineErrorInfo",i);r(t)})})},F:function(n,t,i,r){var u=new _bs.cd(t,this.jp,n,this.jp.a());var e=this,f=this;u.f(function(){i(null,u.d)},r,function(){_gg.a.prototype.F.call(f,n,t,i,r)})},cH:function(n,t,i,r){var u=new _bs.S(t,this.jp,n,this.jp.a());var e=this,f=this;u.f(function(){_gg.a.prototype.cH.call(e,n,t,function(n){n.response=_g.bB.a(u.d,-2);i(n)},r)},r,function(){f.jp.b().cH(n,t,i,r)})},R:function(n,t,i,r){var f=t;if(f.isOnlineOnlyCall)_gg.a.prototype.R.call(this,n,t,i,r);else{n.Body.PersonaId=f.personaId=this.jp.c().b(n.Body.PersonaId);var u=new _bs.dU(f,this.jp,n.Body.PersonaId,n.Body.PropertyUpdates,n.Body.PersonTypeString);var o=this,s=this,e=this;u.f(function(){_gg.a.prototype.R.call(o,n,t,function(n,t){n.response=_g.bB.a(u.b,-2);i(n,u.b)},function(n){var i=new _bc.l(0,n);var t=Error.create(_bs.bf.a,i);r(t)})},function(n){var i=new _bc.l(0,n);var t=Error.create(_bs.bf.a,i);r(t)},function(){_j.e.b(_a.a.bc,"UpdatePersona service command was rejected by the offline proxy.");_gg.a.prototype.R.call(e,n,t,i,r)})}},h:function(n,t,i){var r=new _bs.by(n,this.jp);var f=this,u=this;r.f(function(){t(null,r.b)},i,function(){_gg.a.prototype.h.call(u,n,t,i)})},S:function(n,t,i,r){var e=new _bs.cR(t,this.jp,n);var f=this,u=this;e.f(function(){_gg.a.prototype.S.call(f,n,t,i,r)},r,function(){_j.e.b(_a.a.bc,"UpdateUserConfiguration service command was rejected by the offline proxy.");_gg.a.prototype.S.call(u,n,t,i,r)})},ig:function(n,t,i,r){var u=this;_gg.a.prototype.ig.call(this,n,t,function(f,e){var o=new _bs.cf(t,u.jp,n);o.f(function(){i(f,e)},r,function(){r(Error.create("SetLayoutSettings was rejected by the offline proxy."))})},r)},iq:function(n,t,i,r){var u=this;_gg.a.prototype.iq.call(this,n,t,function(f,e){var o=new _bs.dT(t,u.jp,n);o.f(function(){i(f,e)},r,function(){_j.e.b(_a.a.bc,"SetTimeZone service command was rejected by the offline proxy.")})},r)},A:function(n,t,i){var r=new _bs.cM(n,this.jp,this.jp.a());var f=this,u=this;r.f(function(){t(null,r.b)},i,function(){_gg.a.prototype.A.call(u,n,t,i)})},cg:function(n,t,i){var r=new _bs.cN(n,this.jp,this.jp.a());var f=this,u=this;r.f(function(){t(null,r.b)},i,function(){_gg.a.prototype.cg.call(u,n,t,i)})},J:function(n,t,i,r){var u=new _bs.bz(t,this.jp,n);var e=this,f=this;u.f(function(){_gg.a.prototype.J.call(e,n,t,i,r)},r,function(){f.jp.b().J(n,t,i,function(n){var i=new _bc.l(u.i,n);var t=Error.create("OfflineErrorInfo",i);r(t)})})},o:function(n,t,i,r){var u=new _g.hc(t.source);u.clientStoreItem=1;u.calendarFolderId=t.calendarFolderId;var f=new _g.ds;f.Body=new _g.cR;f.Body.Items=n.Body.Items;f.Header=n.Header;var e=new _bs.c(u,this.jp,f);var s=this,o=this;e.f(function(){var f=t;f.itemIds=u.itemIds;_gg.a.prototype.o.call(s,n,t,i,r)},r,function(){var f=t;f.itemIds=u.itemIds;o.jp.b().o(n,t,i,function(n){var i=new _bc.l(e.m,n);var t=Error.create("OfflineErrorInfo",i);r(t)})})},s:function(n,t,i,r){var e=new _g.hd(t.source);e.clientStoreItem=1;var u=new _g.em;u.Body=new _g.en;u.Body.ItemIds=[n.Body.EventId];u.Header=n.Header;var f=new _bs.F(e,this.jp,u);var s=this,o=this;f.f(function(){_gg.a.prototype.s.call(s,n,t,i,r)},r,function(){o.jp.b().s(n,t,i,function(n){var i=new _bc.l(f.i,n);var t=Error.create("OfflineErrorInfo",i);r(t)})})},bL:function(n,t,i,r){var u=new _bs.cL(t,this.jp,n);var e=this,f=this;u.f(function(){i(null,u.i)},r,function(){_gg.a.prototype.bL.call(f,n,t,i,function(n){var i=new _bc.l(u.r,n);var t=Error.create("OfflineErrorInfo",i);r(t)})})}};_bs.bE=function(n){this.b=n};_bs.bE.prototype={b:null,f:function(){var t=this.a();if(t)for(var n=0;n<t.length;n++){var i=t[n];if(i.ModuleType===11)return!0}return!1},a:function(){return this.h(Array,"ConfigChangeCleanupModuleList")},e:function(n){n&&this.b.a("ConfigChangeCleanupModuleList",JsonParser.serialize(n));return n},c:function(n,t){var f=new ConfigChangeCleanupModuleItem(n,t);var i=this.a();if(i){for(var e=!1,u=i,s=u.length,r=0;r<s;++r){var o=u[r];if(o.ModuleType===n){e=!0;break}}e||Array.add(i,f)}else i=[f];this.e(i)},d:function(n){var t=this.a();if(t)for(var i=0;i<t.length;i++){var r=t[i];if(r.ModuleType===n){Array.removeAt(t,i);this.e(t);return}}_j.e.b(_a.a.dg,"We didn't find {0} in the cleanup module list",n)},g:function(n){var r=null;var i=this.a();if(i){r=[];for(var t=0;t<i.length;t++){var u=i[t];u.SyncManagerStartTime!==n&&Array.add(r,u.ModuleType)}}return r},h:function(n,t){var i=this.b.b(t);return i?JsonParser.deserialize(i):n===Number||Type.isEnum(n)?0:n===Boolean?!1:null}};_bs.OfflineCreateItemResponseProcessor=function(n,t){_bs.OfflineCreateItemResponseProcessor.initializeBase(this,[n,t])};_bs.OfflineCreateItemResponseProcessor.prototype={u:function(){return this.e.f()},x:function(){var n=this.a();n&&_db.UpdateItemResponseProcessor.g(this.g().Body.MessageDisposition,n.itemIds,n.clientStoreItem,this.b,this.d(),this.e,this.f,this.c.response,this.c.id)},j:function(n,t){var i=this.a();if(i&&i.itemIds){var r=i.itemIds[n];if(t.ResponseClass==="Success")if(i.clientStoreItem===1)r&&this.y(r,t);else if(i.clientStoreItem===2||i.clientStoreItem===3){var u=this.g().Body;this.E(r,t,u.Items[n])}else i.clientStoreItem===4?this.z(n,t):i.clientStoreItem===5&&this.F(n,t);else this.g().Body.MessageDisposition==="SendAndSaveCopy"&&(i.clientStoreItem===2||i.clientStoreItem===3)&&this.D(r,t)}_h.CreateItemResponseProcessor.prototype.j.call(this,n,t)},i:function(n){return new _h.eD(this.b,n,this.f)},y:function(n,t){this.t(n,t)},z:function(n,t){var l=this.g().Body.MessageDisposition;var s=t.Items;if(!s||!s.length)throw Error.argument("Response message items","Response for meeting request doesn't contain any items.");for(var f=this.a().itemIds[n],v=!1,a=s,it=a.length,o=0;o<it;++o){var y=a[o];if(y){var i=_a.m.c(_g.g,y);if(_dg.t.isInstanceOfType(i)){if(l==="SaveOnly"){var e=i.bD.ItemId;this.m(f,e);var g=this.d().h().b(f.Id);var nt=this.d().h().b(e.Id);this.b.b().b(!1);var tt=this.i(this.d().a());var rt=this;tt.c(g,nt,function(n){n.get_data().ItemId=e})}}else if(_dg.a.isInstanceOfType(i)){var u=this.a().createdCalendarItemIds[n];v=!0;var r=i.bD.ItemId;if(!u||u.Id===r.Id)continue;this.m(u,r);var h=this.d().h().b(u.Id);var c=this.d().h().b(r.Id);var w=this.i(this.d().b());var ut=this;w.c(h,c,function(n){n.get_data().ItemId=r});var b=this.i(this.d().g());var ft=this;b.c(h,c,function(n){n.get_data().ItemId=r})}else if(_dg.m.isInstanceOfType(i)){var k=i.bD.ItemId;var p=this.g().Body.Items[0];var d=p.ReferenceItemId;this.m(d,k)}}}if(l==="SendAndSaveCopy"){if(!f)throw Error.invalidOperation("ClientIdentity shouldn't be null or undefined");this.b&&this.u().a().a(this.b,f,this.e)}if(!v)throw Error.invalidOperation("Meeting request response doesn't contain a calendar item id");},F:function(n,t){var f=t.Items;if(!f||!f.length)throw Error.argument("Response message items","Response for remove item doesn't contain any items.");for(var v=this.g().Body.Items[n],s=v.ReferenceItemId,o=f,a=o.length,r=0;r<a;++r){var e=o[r];if(e){var u=_g.g.a(e);if(_dg.q.isInstanceOfType(u)){var i=new _g.e(u.bD.ItemId.Id);i.ChangeKey=u.bD.ItemId.ChangeKey;this.m(s,i);var l=this.d().h().b(s.Id);var c=this.d().h().b(i.Id);this.b.b().b(!1);var h=this.i(this.d().a());var y=this;h.c(l,c,function(n){n.get_data().ItemId=i})}}}},E:function(n,t,i){var u=this.g().Body.MessageDisposition;if(u==="SaveOnly"){var r=i;r.UpdateResponseItemId?this.e.u(this.b,r.UpdateResponseItemId,t.Items[0].ItemId):this.t(n,t)}else u==="SendAndSaveCopy"&&this.b&&this.u().a().a(this.b,n,this.e)},t:function(n,t){var i=t.Items[0].ItemId;this.m(n,i);this.G(n,i)},m:function(n,t){this.e.z(this.b,n,t);var r=new _g.e(n.Id);var i=new _g.e(t.Id);this.e.z(this.b,r,i)},G:function(n,t){var r=this.d().h().b(n.Id);var i=this.d().h().b(t.Id);if(this.a().clientStoreItem===2){this.b.b().b(!1);var e=this.i(this.d().a());var s=this;e.c(r,i,function(n){n.get_data().ItemId=t})}else if(this.a().clientStoreItem===1){var u=this.i(this.d().b());var h=this;u.c(r,i,function(n){n.get_data().ItemId=t});var f=this.i(this.d().g());var o=this;f.c(r,i,function(n){n.get_data().ItemId=t})}},D:function(n,t){this.b&&this.d().e().setContextResponseCodeWithoutAction(this.b,n,this.f,t.ResponseCode,this.c.response);this.e.v.a(_a.cQ,new _a.cQ)}};_bs.dv=function(){};_bs.dv.prototype={a:function(n,t,i){return new _bs.OfflineCreateItemResponseProcessor(n,t)}};_bs.r=function(n,t,i,r,u,f,e,o,s,h,c,l,a){this.H=Function.createDelegate(this,this.X);_bs.r.initializeBase(this,[n,i,r,u,f]);_a.b.c(t,"timeZoneId");this.C=t;this.s=new _bs.bh(n,t);this.O=new _bs.dS(this.s);this.y=o?"MOWA":"DOWA";this.w=s;this.x=h;this.P=l;this.Q=a;_j.e.a(_bs.r.a,"Protocol: {0}",this.y);_j.e.a(_bs.r.a,"DeviceId: {0}",this.w);_j.e.a(_bs.r.a,"DeviceType: {0}",this.x);Sys.Net.WebRequestManager.add_invokingRequest(this.H);this.B=new _bs.E(this.s);this.p=new _gg.ff;c&&this.p.i(c);this.b().jx=this.p;this.o=e;this.M=new _bs.dw(e,this.p);this.K=new _gg.mW(this.b(),this.M);this.L=new _bs.bf(this)};_bs.r.prototype={B:null,M:null,K:null,L:null,p:null,Q:null,y:null,w:null,x:null,s:null,O:null,o:null,C:null,r:!1,N:null,P:null,J:null,A:function(){return this.L},j:function(){return _bs.O.c()},f:function(){return this.O},e:function(){return this.o},c:function(){return this.p},d:function(){return this.s},a:function(){return this.Q.a()},g:function(){return this.C},l:function(){return this.r},W:function(n){this.N=new _bs.dx(this,n,this.v,this.R)},z:function(n,t,i){this.p.f(t,i);this.T(n)},u:function(n,t,i){this.p.g(t,i);this.T(n)},q:function(n){return this.p.b(n)},i:function(n,t,i){var r=!1;var f=!1;var u=this,o=this,e=this;this.t.d().b(new _e.a("OfflineMailboxDataContext.RemoveSendAction"),function(i){u.s.e().bindIn(i,_bs.d.a(n),function(e){if(!e||!e.get_data()){_j.e.b(_bs.r.a,"RemoveSendAction - Outbox item not found: {0}",n);t(r,f,null,null);return}_j.e.a(_bs.r.a,"RemoveSendAction - Item found: {0}",n);var o=e.c();if(!o){_j.e.b(_bs.r.a,"RemoveSendAction - Outbox item context is null: {0}",n);r=!0;t(r,f,null,null);return}_j.e.a(_bs.r.a,"RemoveSendAction - Calling ActionQueue.Remove, action {0}: {1}",o.ActionId,n);u.o.e(o.ActionId,function(i){_j.e.a(_bs.r.a,"RemoveSendAction - Removed Action {0} for item {1}. Results {2}",o.ActionId,n,i);r=o.ActionId!==u.N.I();t(r,o.SendAction===1,o.ParentConversationNodeId,o.ComplianceId)},function(n){_j.e.c(_bs.r.a,"Failed to remove action from action queue, action id = {0}, Error = {1}",o.ActionId,n.message)},i)},null)},function(){_j.e.a(_bs.r.a,"RemoveSendAction succeeded for outbox item id {0}.",n)},function(n){_j.e.c(_bs.r.a,"RemoveSendAction failed. Error code: '{0}'  Error message: '{1}'",n.b,n.a);var t=new _bs.b(n);i(t.b())})},E:function(n,t,i,r,u){if(!this.J||this.J()){_j.e.a(_bs.r.a,"ExecuteWithActionQueue enqueueing: {0}",n);var f=new _g.dh(n,i,null);f.actionHandler=t;f.hasActionHandler=!0;this.o.k(f,r,u)}else _g.k.prototype.E.call(this,n,t,i,r,u)},U:function(){_j.e.a(_bs.r.a,"Deprovisioning {0}-{1}-{2}",this.y,this.w,this.x);this.o.b(!1);var t=new _gg.gn(this.w,this.x);t.HasPAL=this.y==="MOWA";var n=new _g.cr("Exchange2013");n.TimeZoneContext=new _g.dN;n.TimeZoneContext.TimeZoneDefinition=new _g.cK;n.TimeZoneContext.TimeZoneDefinition.Id=this.C;var i=this,r=this;this.b().jU(new _gg.gm(n,t),null,function(n,t){"Success"===t.Body.ResponseMessages.Items[0].ResponseClass?_j.e.a(_bs.r.a,"...deprovisioning succeeded."):_j.e.c(_bs.r.a,"Deprovision command failed. We're explicitly ignoring this failure. {0}",t.Body.ResponseMessages.Items[0].MessageText);Sys.Net.WebRequestManager.remove_invokingRequest(i.H)},function(n){_j.e.c(_bs.r.a,"Deprovision call failed. We're explicitly ignoring this failure. {0}",n)})},k:function(n,t,i){if(this.r===n){_j.e.b(_bs.r.a,"IsOfflineComponentReadyToUse: value ({0}) has not changed. Skipping the write to the store.",this.r);_bs.b.c(t)}else{var f=this,u=this,r=this;this.s.l(new _e.a("OfflineMailboxDataContext.SetIsOfflineComponentReadyToUse"),function(t){f.B.t(t,n,null)},function(){u.r=n;_j.e.a(_bs.r.a,"Successfully saved the new value for IsOfflineComponentReadyToUse: {0}",n);_bs.b.c(t)},function(t){_j.e.c(_bs.r.a,"IsOfflineComponentReadyToUse: Failed to persist the new value {0} and reverting to the old value {1}. Error: {2}",n,r.r,t.a);_bs.b.a(t,i)})}},V:function(n){var t=this,i=this,r=this;this.s.l(new _e.a("OfflineMailboxDataContext.LoadIsOfflineComponentReadyToUse"),function(n){t.B.m(n,function(n){t.r=n})},function(){i.r?_j.e.a(_bs.r.a,"Offline component is ready to use."):_j.e.b(_bs.r.a,"Offline is enabled but not ready to use yet.");n()},function(t){_j.e.c(_bs.r.a,"IsOfflineComponentReadyToUse: Failed to fetch the setting. Falling back to kiosk mode. Error: {0}",t.a);n()})},X:function(n,t){t.get_webRequest().get_headers()["X-OWA-Protocol"]=this.y;t.get_webRequest().get_headers()["X-OWA-DeviceId"]=this.w;t.get_webRequest().get_headers()["X-OWA-DeviceType"]=this.x},D:function(){Sys.Net.WebRequestManager.remove_invokingRequest(this.H);_g.k.prototype.D.call(this)},T:function(n){if(n){var t=this;this.B.s(n,this.p.h(),function(){_j.e.a(_bs.r.a,"Identity correlation table persisted.")})}}};_bs.dw=function(n,t){_bs.dw.initializeBase(this);_a.b.a(n,"actionQueue");_a.b.a(t,"identityCorrelationTable");this.jo=n;this.jr=t};_bs.dw.prototype={jo:null,jr:null,jp:function(n,t,i,r,u,f){var e=this;this.jq(t,i,r,function(t){u(t,n===Number||Type.isEnum(n)?0:n===Boolean?!1:null)},f)},jq:function(n,t,i,r,u){_a.b.a(r,"invokeSucceeded");_a.b.a(u,"invokeFailed");var f=new _g.dh(n,t,i);this.jr.a(t);this.jo.k(f,r,u)}};_bs.dx=function(n,t,i,r){this.E=Function.createDelegate(this,this.S);this.B=Function.createDelegate(this,this.P);this.C=Function.createDelegate(this,this.Q);this.D=Function.createDelegate(this,this.R);this.A=Function.createDelegate(this,this.O);_bs.dx.initializeBase(this,[n.o,_a.a.fq]);this.n=n;this.k=n.n;this.o=n.b();this.q=n.G;this.f=t;this.b.j(this.l);this.b.h(this.A);this.b.f(this.l);this.p=r;i.b(_a.cN,this.D);i.b(_a.cj,this.C);i.b(_a.cv,this.B);this.j()};_bs.dx.prototype={q:null,n:null,k:null,o:null,f:null,p:null,e:null,g:null,m:function(){return this.b.o()},w:function(){if(this.b.l())if(this.k.a)return!0;else{_j.e.a(this.a,"Deferring FetchNextRecord (a.k.a. fetching of the next action record) because the application has lost network connectivity.");return!1}else{_j.e.a(this.a,"Deferring FetchNextRecord (a.k.a. fetching of the next action record). This could happen due to multiple reasons. e.g. SyncManager is currently syncing OR this is not the primary window.");return!1}},v:function(n,t){this.b.p(n,t)},y:function(n,t){_j.e.a(this.a,"Processing {0} with an online call.",this.d);this.c.actionType=2;var i=this;this.o.jF(this.c,function(){_j.e.a(i.a,"Online processing of {0} completed.",_g.H.a(i.c));i.T(n,t)})},x:function(){this.G();this.F()},T:function(n,t){var r=this.c;var u=_a.d.a();var i=this;this.q.c(r,this.n,function(f){_g.H.c(r,u.o());if(f){_j.e.a(i.a,"Processing {0} response.",i.d);i.p(r,function(){_j.e.a(i.a,"Processing response from {0} succeeded.",i.d);_g.H.c(r,u.o());i.H(n,t)},function(r){_j.e.b(i.a,"Processing response from {0} failed: {1}",i.d,r.message);i.H(n,t)})}else{var e=3e4;r.response.fault&&r.response.fault.BackOffPeriodInMs&&(e=Math.min(r.response.fault.BackOffPeriodInMs,e));_j.e.b(i.a,"Response from {0} was rejected. Updating count and delaying {1} ms before trying again.",i.d,e);_g.dS.a(r,!1,0);i.b.r(r,function(){i.f.a(i.a,"ProcessResponse",n,e)},t)}})},H:function(n,t){_j.e.a(this.a,"Removing {0} from the action queue.",this.d);var i=this.c;_g.dS.a(i,!0,0);var r=this;this.b.e(i.id,function(t){n()},t,null)},O:function(n,t){_j.e.a(this.a,"Ensuring connectivity to process {0}",_g.H.a(this.b.m()));this.k.f()},R:function(n){this.j()},Q:function(n){if(this.m()){this.e=n.a.c("RequestQueueProcessor","REQQ");this.g=this.f.a(this.a,"HandleApplicationSuspendingEvent",this.E,6e4)}},P:function(n){this.G();this.e=null},S:function(){_j.e.b(this.a,"Failed to drain action queue in a reasonable time. Calling queueEmptyCallback.");this.F()},G:function(){if(this.g){this.f.b(this.g);this.g=null}},F:function(){if(this.e){this.e();this.e=null}}};_bs.bd=function(n){_bs.bd.initializeBase(this);_a.b.a(n,"clientStore");this.u=new(_bs.bO.$$(_bc.bg,_bs.bi))(n,"UTC")};_bs.bd.prototype={u:null,V:function(n,t){var r=n.a(_bs.e.a().i.a());var i=new _a.bk(null,_bs.bd.a);var u=this;this.G(n,r,i,function(n){t(!n)})},S:function(n){this.T(n);this.U(n)},x:function(n,t,i){var r=this.u.fromData(n);delete n.id;var f=this,u=this;this.w(function(t,i){r.b(t,function(t){n.id=t.a()})},function(){t(n.id)},i)},E:function(n,t,i){var r=this;this.x(n,function(n){t()},i)},B:function(n,t){this.R(_bs.bd.c,n,t)},A:function(n,t){var i=[];var u=this,r=this;this.w(function(n,t){t.a(_bs.bd.b,function(n){n.a(1e3,function(n,t,r){for(var u=0;u<t.length;++u){var e=t[u].a;var f=e.Data;f.id=t[u].b.a;Array.add(i,f)}},null)},null)},function(){n(i)},t)},C:function(n,t,i,r){var f=!1;var u=null;if(n)this.H(n,t,i);else{var e=this,o=this;this.w(function(n,i){e.H(n,t,function(n,t){f=n;u=t})},function(){i(f,u)},r)}},T:function(n){var r=n.a(_bs.e.a().i.a());var u=new _e.b(ActionItemMetadata.a(),"true");var t=new _a.bk(u,null);var i=this,f=this;r.a(t,function(n){n.b(function(n){i.y(n)},null)},function(n){_j.e.c(_a.a.D,"Unable to retreive the number of high priority actions from the clientstore. Error = {0}",n.a)})},U:function(n){var r=n.a(_bs.e.a().i.a());var u=new _e.b(ActionItemMetadata.a(),"false");var t=new _a.bk(u,null);var i=this,f=this;r.a(t,function(n){n.b(function(n){i.t=n},null)},function(n){_j.e.c(_a.a.D,"Unable to retrieve the number of low priority actions from the clientstore. Error = {0}",n.a)})},R:function(n,t,i){var r=null;var u=this,f=this;this.w(function(t,i){u.G(t,i,n,function(n){r=n})},function(){t(r)},i)},G:function(n,t,i,r){var u=this;t.a(i,function(n){n.a(1,function(n,t,i){if(t.length>0){var f=t[0].a;var u=f.Data;u.id=t[0].b.a;r(u)}else r(null)},null)},null)},H:function(n,t,i){var r=!1;var u=null;var f=_bs.d.c(t);var e=this;this.u.bindIn(n,f,function(t){if(t){r=!0;t.e(n)}u=r?t.get_data():null;i(r,u)},null)},w:function(n,t,i){var f=this,u=this,r=this;this.u.a(new _e.a("DatabaseActionQueue.ExecuteTransaction"),function(t){var i=t.a(_bs.e.a().i.a());n(t,i)},function(){t()},function(n){var t=Error.create(n.a,n);i(t)})}};_bs.bV=function(n,t){_a.b.b(n,"nativeBridge");_a.b.b(t,"eventAggregator");this.b=n;var i=this;t.b(_a.di,function(){i.c()&&_bs.A.d(i.c())})};_bs.bV.prototype={b:null,a:null,c:function(){if(!this.a)switch(this.b.g().a().a()){case 1:this.a=new _bs.cU;break;case 2:this.a=new _bs.cV(this.b.g());break;case 0:break}return this.a}};_bs.bW=function(){};_bs.bW.a=function(n,t,i){var r=null;n.b()?r=_bs.bW.c(t,i):n.c()?r=_bs.bW.b(t):n.a()&&(r=new _bs.dz(n.a(),t));return r};_bs.bW.b=function(n){var t=window.self;return new _bs.cF(t,n)};_bs.bW.c=function(n,t){var i=new _bs.dM(t.u(),_j.m.a());return new _bs.cF(i,n)};_bs.ef=function(){};_bs.ed=function(){};_bs.ee=function(){};_bs.ee.registerInterface("_bs.ee");_bs.eg=function(){};_bs.eg.registerInterface("_bs.eg");_bs.eh=function(){};_bs.eh.registerInterface("_bs.eh");_bs.dy=function(n,t,i){this.r=n;this.s=t;this.v=i;this.w();this.y=0};_bs.dy.prototype={r:null,s:null,v:null,q:null,t:null,u:null,p:null,n:null,o:null,y:0,e:function(){return this.u},a:function(){return this.o.g()},k:function(){return this.p.a||new Array(0)},c:function(n,t,i,r,u){var f=this;this.E(function(){f.G(n,t,i,r,u)},u)},b:function(n,t,i,r){var e=this.y++;var f=this.n.transaction(this.a(),"readwrite");var u=new _bs.dA(f,this.o,this.q,this.t,n);this.v.b(e);_j.e.a(_a.a.G,"starting transaction {0}",n.a());var s=this,o=this;_bs.bY.a(n.a(),f,function(){_j.e.a(_a.a.G,"transaction {0} ended in success.",n.a());s.v.a(e);u.l();_bs.s.b(i)},function(t){_j.e.a(_a.a.G,"transaction {0} ended in error.",n.a());o.v.a(e);t=u.j?new _a.bO(5,"Transaction manually aborted."):t;_bs.s.d(t,r)});try{t(u)}catch(h){_j.e.d(_a.a.G,h,"IDB caught an exception on the transaction callback and will abort.");f.abort()}},g:function(n,t,i,r){this.b(new _e.a(n),t,i,r)},i:function(n,t){this.j();var i=this.r.deleteDatabase(this.s);_bs.l.d("IdbBrowserDb.Wipe",i,n);_bs.l.b("IdbBrowserDb.Wipe",i,t)},j:function(){if(this.n){this.n.close();this.w()}},f:function(n,t){_a.b.c(n,"objectStoreName");_a.b.a(t,"notificationCallback");n=n.toLowerCase();this.x(n);this.q.c(n,t)},h:function(n){_a.b.c(n,"objectStoreName");n=n.toLowerCase();this.q.d(n)},m:function(){this.q.e()},l:function(n){_a.b.c(n,"objectStoreName");n=n.toLowerCase();this.x(n);return this.o.c[n].g},d:function(n){_a.b.c(n,"objectStoreName");n=n.toLowerCase();this.x(n);var t=new _bs.dy.a(n,this.t);this.t.d(t);return t},A:function(n,t){var r=this.r.open(this.s);_bs.l.b("IdbBrowserDb.Initialize",r,t);var i=this;_bs.l.a("IdbBrowserDb.Initialize",r,function(r){i.n=r.target.result;if(i.H()){var u=i.n.transaction(i.n.objectStoreNames,"readwrite");_bs.bY.a("IdbBrowserDb.Initialize",u,n,t);i.K(u)}else _bs.s.b(n)})},H:function(){return this.B()&&this.z()},z:function(){return Array.indexOf(this.n.objectStoreNames,"__indexes")>=0},B:function(){return Array.indexOf(this.n.objectStoreNames,"__versions")>=0},F:function(){this.B()||this.n.createObjectStore("__versions",_e.f.b());this.z()||this.n.createObjectStore("__indexes",_e.f.a())},K:function(n){this.N(n);this.J(n);this.M(n)},J:function(n){var r=n.objectStore("__indexes");var i=r.openCursor(_e.c.a(),"next");var t=this;_bs.l.a("IdbBrowserDb.PopulateIndexInformation",i,function(n){if(n.target.result){var i=n.target.result.value;var r=_bs.bq.b(i);t.o.e(i.storeName,r);_e.h.a(n.target.result)}})},N:function(n){var t=n.objectStore("__versions");this.I(t);this.L(t)},L:function(n){for(var t=0;t<this.n.objectStoreNames.length;++t)if(!this.n.objectStoreNames[t].startsWith("__")){var r=n.get(this.n.objectStoreNames[t]);var i=this;_bs.l.a("IdbBrowserDb.PopulateObjectStoreVersion",r,function(n){var t=n.target.result;i.o.d(t.name,t.version)})}},M:function(n){var r=n.objectStore("__versions");var i=r.get("__settings");var t=this;_bs.l.a("IdbBrowserDb.PopulateSettingsInformation",i,function(n){var i=n.target.result;i&&(t.p=i)})},I:function(n){var i=n.get("__db");var t=this;_bs.l.a("",i,function(n){_bs.s.b(function(){var i=n.target.result;t.u=i.version})})},D:function(n,t,i){var r=new _bs.dH(this.n,i,t);try{n(r)}catch(u){_j.e.c(_a.a.G,"aborting transaction due to exception during schema update: "+u.message);i.abort()}},P:function(n,t){var i=t.objectStore("__versions");i.put(new _bs.cE("__db",n),"__db")},O:function(n,t){var r=t.objectStore("__versions");var i=this.C(this.p);i.a=n;r.put(i,"__settings")},G:function(n,t,i,r,u){var s=this.o.f();var h=this.n.version+1;this.n.close();this.w();var e=this.r.open(this.s,h);var f="IdbBrowserDb.InternalChangeSchema";var o=this;_bs.l.e(f,e,function(r){o.n=r.target.result;o.Q(n,t,s,r.target.transaction,i,u)});_bs.l.d(f,e,r);_bs.l.b(f,e,u)},Q:function(n,t,i,r,u,f){var e=this;_bs.bY.a("UpgradeDatabaseVersion",r,function(){e.o=i;e.u=n;e.p.a=t},f);this.F();this.P(n,r);this.O(t,r);this.D(u,i,r)},x:function(n){if(!this.o.b(n))throw Error.invalidOperation("The object store "+n+" does not exist.");},w:function(){this.n=null;this.u="";this.p=new _bs.cA;this.o=new _bs.cz;this.q=new _e.r(this);this.t=new _e.t},E:function(n,t){this.n?n():this.A(n,t)},C:function(n){var t=new _bs.cA;t.a=n.a;return t}};_bs.dy.a=function(n,t){_bs.dy.a.initializeBase(this,[n,t])};_bs.s=function(n,t){_bs.s.initializeBase(this,[n,t])};_bs.s.a=function(n,t){var i=n;var r=_bs.s.f(n);_j.e.c(_a.a.G,"IndexedDb Error: {0}",i);_bs.s.e(r,i,t)};_bs.s.e=function(n,t,i){_bs.s.d(new _bs.s(n,t),i)};_bs.s.d=function(n,t){t&&t(n)};_bs.s.b=function(n){n&&n()};_bs.s.c=function(n,t){t&&t(n)};_bs.s.f=function(n){var t=0;switch(n){case"UnknownError":t=0;break;case"ConstraintError":t=1;break;case"DataError":t=0;break;case"TransactionInactiveError":t=0;break;case"ReadOnlyError":t=1;break;case"VersionError":t=0;break;case"NotFoundError":t=2;break;case"InvalidStateError":t=0;break;case"InvalidAccessError":t=0;break;case"TimeoutError":t=4;break;case"AbortError":t=5;break;case"QuotaExceededError":t=3;break;case"SyntaxError":t=0;break;case"DataCloneError":t=1;break}return t};_bs.dz=function(n,t){_bs.dz.initializeBase(this);this.c=n;this.d=t};_bs.dz.prototype={c:null,d:null,b:function(n,t,i,r){_a.b.a(i,"successCallback");_a.b.c(n,"name");var u=new _bs.dy(this.c,n,this.d);var f=this;u.A(function(){i(u)},r)},a:function(n,t,i){_a.b.a(t,"successCallback");_a.b.c(n,"name");this.c.deleteDatabase(n);t()}};_bs.bX=function(n,t,i,r){this.h=n;this.j=t;this.i=i;this.k=r};_bs.bX.a=function(n){_a.b.a(n,"id");var t=n.a;_a.b.a(t,"id must be provided");_a.b.c(t.toString(),"id must be provided");return t};_bs.bX.prototype={h:null,j:null,i:null,k:null,l:0,b:function(){return this.i.e()},f:function(n,t,i){var f=_bs.bX.a(n);_a.b.a(t,"successCallback");var u=this.j.get(f);var r="IdbBrowserDbObjectStore.GetItem";var e=this;_bs.l.c(r,u,function(n){_j.e.c(_a.a.G,"Error getting object from store:{0} with id:{1}. Error:{2}",e.b(),f,n.target.error);_bs.s.a(n.target.error.name,i)});var o=this;_bs.l.a(r,u,function(n){var r=null;var i=n.target.result;i&&(r=i.data);_bs.s.c(r,t)})},d:function(n,t,i){this.k.f(this,n);this.h.e()(this.b(),2,n,null);var e=_bs.bX.a(n);var u=_e.i.a(this.j,e);var r="IdbBrowserDbObjectStore.DeleteItem";_bs.l.d(r,u,t);var f=this;_bs.l.c(r,u,function(t){_j.e.c(_a.a.G,"Error deleting from object store:{0} the id:{1}. ErrorCode:{2}",f.b(),n.a,t.target.error);_bs.s.a(t.target.error.name,i)})},e:function(n,t){this.k.e(this);var r=this.j.clear();var i="IdbBrowserDbObjectStore.Clear";_bs.l.d(i,r,n);var u=this;_bs.l.c(i,r,function(n){_j.e.c(_a.a.G,"Error clearing from object store:{0}. ErrorCode:{1}",u.b(),n.target.error);_bs.s.a(n.target.error.name,t)})},g:function(n,t,i,r){_a.b.a(t,"json");this.k.g(this,n,t);for(var a=new _bs.dG(t,{}),o=0;o<this.i.c().length;++o)this.i.c()[o].c(a,n,this.b());var u=n.a;if(u===null){var e=_a.d.get_utcNow().h();e<=this.l&&(e=this.l+1);u=this.l=e}var c=!0;var y=!1;if(this.h.b().d()){var v=this.j.count(_e.c.d(u));var l="IdbBrowserDbObjectStore.Count";var p=this;_bs.l.b(l,v,function(t){_j.e.a(_a.a.Q,"Database query with ClientStoreId = {0} failed with error: {1}",n.toString(),t.a)});var w=this;_bs.l.a(l,v,function(n){c=!!n.target.result})}var s=this.j.put(a,u);var h="IdbBrowserDbObjectStore.Put";_bs.l.b(h,s,r);var f=this;_bs.l.a(h,s,function(r){y=!0;_bs.s.c(new _a.dd(r.target.result),i);c?f.h.e()(f.b(),1,n,t):f.h.e()(f.b(),0,n,t)})},a:function(n,t,i){_a.b.a(t,"successCallback");n&&this.m(n);var r=this;this.n(n,function(u){_bs.i.c(r.h.d(),r.j,r.i,n,0,function(n){var i=new _bs.dF(r.h,n,u);_bs.s.c(i,t)},i)},i)},c:function(n,t,i){_a.b.a(t,"successCallback");var u=n?new _a.bk(n,null):null;u&&this.m(u);var r=this;this.n(u,function(n){_bs.i.c(r.h.d(),r.j,r.i,u,1,function(i){var u=new _bs.dE(r.h,i,n);_bs.s.c(u,t)},i)},i)},n:function(n,t,i){var r=n?new _a.bk(n.b,null):null;var u=this;_bs.i.c(this.h.d(),this.j,this.i,r,1,function(n){t(n)},i)},m:function(n){this.o(n);this.p(n)},p:function(n){if(n.a)for(var t=0;t<n.a.length;++t)if(!this.i.d(n.a[t].a.a)){var i=String.format("KeyPath {0} is being sorted but it is not an indexed field",n.a[t].a.a);_a.bO.a(1,i)}},o:function(n){if(n.b)for(var i=n.b.a,t=0;t<i.length;++t)if(!this.i.d(i[t].a)){var r=String.format("KeyPath {0} is being queried but it is not an indexed field",i[t].a);_a.bO.a(1,r)}}};_bs.dA=function(n,t,i,r,u){this.f=n;this.k=new _e.s(this,r);this.g=t;this.h=new _e.q(i);this.i=u};_bs.dA.prototype={f:null,g:null,k:null,h:null,i:null,j:!1,b:function(){return this.i},d:function(){return this.f},e:function(){return this.h.c},l:function(){this.h.d(this.i)},a:function(n){n=n.toLowerCase();if(!this.g.b(n))throw Error.invalidOperation("storeName "+n+" does not exist.");var t=this.f.objectStore(n);return new _bs.bX(this,t,this.g.a(n),this.k)},c:function(){this.j=!0;this.f.abort()}};_bs.dB=function(n,t){_bs.dB.initializeBase(this,[n,t,new _a.R("metadata."+n)])};_bs.dB.prototype={c:function(n,t,i){_bs.bq.a(this.a[0],n,t,i);_bs.bq.a(this.a[1],n,t,i);var u=this.a[0].b(n.data);var r=this.a[1].b(n.data);n.metadata[this.b]=_bs.bc.a(u,r)}};_bs.bq=function(n,t,i){this.b=n;this.a=new Array(0);this.d=i;for(var r=0;r<t.length;++r)Array.add(this.a,new _a.R(t[r]))};_bs.bq.b=function(n){if(n.keyPaths.length===1)return new _bs.dI(n.indexName,n.keyPaths);else if(n.keyPaths.length===2)return new _bs.dB(n.indexName,n.keyPaths);else throw Error.argument("fields","composite keys can only have two columns");};_bs.bq.a=function(n,t,i,r){var u=n.b(t.data);if(_j.F.a(u)){var f=String.format("KeyPath {0} is a declared index on store {1} but does not exist in object with id {2}",n.a,r,i.a);_j.e.c(_a.a.G,f);throw Error.invalidOperation(f);}if(!String.isInstanceOfType(u)&&!Number.isInstanceOfType(u)){var e=String.format("KeyPath {0} is a declared index on store {1} but the object with id {2} is attempting to store the non-primitive type {3}.",n.a,r,i.a,Object.getType(u).getName());throw Error.invalidOperation(e);}};_bs.bq.prototype={b:null,a:null,d:null};_bs.dC=function(n,t,i,r){this.storeName=n;this.indexName=t;this.keyPaths=new Array(i.length);this.storeVersion=r;for(var u=0;u<i.length;++u)this.keyPaths[u]=i[u].a.a};_bs.dC.prototype={storeName:null,indexName:null,keyPaths:null,storeVersion:null};_bs.cA=function(){};_bs.cA.prototype={a:null};_bs.cz=function(){this.c={}};_bs.cz.prototype={c:null,g:function(){var i=[];var t=this.c;for(var n in t){var r={key:n,value:t[n]};Array.add(i,r.key)}return i},a:function(n){return this.c[n]},d:function(n,t){this.c[n]=new _bs.cz.a(n,t)},b:function(n){return n in this.c},f:function(){var n=new _bs.cz;n.c={};var r=this.c;for(var i in r){var t={key:i,value:r[i]};var u=t.value;n.c[t.key]=u.n()}return n},i:function(n){delete this.c[n]},e:function(n,t){var i=this.c[n];i.m(t)},h:function(n,t){var i=this.c[n];return i.o(t)}};_bs.cz.a=function(n,t){this.k=n;this.g=t;this.j={};this.l={};this.i={};this.f=[];this.h=[]};_bs.cz.a.prototype={g:null,k:null,j:null,l:null,i:null,f:null,h:null,e:function(){return this.k},c:function(){return this.h},m:function(n){this.j[n.b]=n;for(var t=0;t<n.a.length;++t)Array.indexOf(this.f,n.a[t].a)<0&&Array.add(this.f,n.a[t].a);n.a.length===1?this.l[n.a[0].a]=n:this.i[n.a[0].a+n.a[1].a]=n;Array.add(this.h,n)},o:function(n){return n in this.j},d:function(n){if(n===_a.R.a.a)return!0;else{for(var t=0;t<this.f.length;++t)if(this.f[t]===n)return!0;return!1}},a:function(n,t){var i=null;if(t.a===_a.R.a.a)i=n;else{var r=this.l[t.a];r&&(i=n.index(r.b))}return i},b:function(n,t,i){var r=null;if(t===i)r=this.a(n,t);else{var u=this.i[t.a+i.a];u&&(r=n.index(u.b))}return r},n:function(){for(var t=new _bs.cz.a(this.k,this.g),i=this.h,u=i.length,n=0;n<u;++n){var r=i[n];t.m(r)}return t}};_bs.W=function(n,t){_bs.W.initializeBase(this,[null]);_a.b.a(n,"idbCursorRequest");this.j=new(_bs.cB.$$(_e.v))(n,t)};_bs.W.prototype={j:null,r:function(){return this.j.h()},n:function(){return this.j.g()},q:function(){return""},c:function(n,t){this.j.f(n,t)},B:function(n,t,i){this.j.m(n,t,i)},k:function(n,t){this.j.l(n,t)},s:function(n,t){this.j.k(n,t)}};_bs.cB=function(n,t){this.d=Function.createDelegate(this,this.i);this.e=Function.createDelegate(this,this.j);_a.b.a(n,"idbCursorRequest");this.b=null;this.a=n;this.c=t;var i="IdbQueryCursorStrategyImpl";_bs.l.a(i,this.a,this.e);_bs.l.c(i,this.a,this.d)};_bs.cB.$$=function(n){var u=_bs.__tc=_bs.__tc||{};var t="cB"+"$"+n.getName().replace(/\./g,"_");if(!u[t]){var r=u[t]=function(){for(var t=[],n=0;n<arguments.length;++n)t[n]=arguments[n];_bs.cB.apply(this,t)};r.registerClass("_bs.__tc."+t);var o={"_bs.cB":{TCursor:n},ctor:_bs.cB};r.prototype.$$gta=o;var e=_bs.cB.prototype;for(var f in e){var i={key:f,value:e[f]};"constructor"!==i.key&&(r.prototype[i.key]=i.value)}}return u[t]};_bs.cB.prototype={a:null,c:null,b:null,h:function(){var n=null;this.a.result&&(n=this.a.result.value);return n},g:function(){var n=null;this.a.result&&(n=this.a.result.primaryKey);return n},f:function(n,t){var r="IdbQueryCursorStrategyImpl.Count";var i=this.c?this.a.source.count(this.c):this.a.source.count();_bs.l.b(r,i,t);var u=this;_bs.l.a(r,i,function(t){_bs.s.c(t.target.result,n)})},m:function(n,t,i){this.b=new _bs.cC(t,i);this.a.result.advance(n)},l:function(n,t){this.b=new _bs.cC(n,t);_e.h.a(this.a.result)},k:function(n,t){n()},j:function(n){var t=this;_bs.s.b(function(){var n=t.b;t.b=null;n.b()})},i:function(n){var t=this.b;this.b=null;t.a(n.target.error)}};_bs.cC=function(n,t){this.b=n;this.a=t};_bs.cC.prototype={b:null,a:null};_bs.bF=function(n,t){_bs.bF.initializeBase(this,[t]);this.j=n};_bs.bF.prototype={j:null,r:function(){return this.h.d()},n:function(){return this.h.a()},q:function(){return this.h.A()},k:function(n,t){var i=this,r=this;this.h.e(function(){i.h.i===2?n():i.j.f(i.h.a(),i.h.d().data)?n():i.k(n,t)},function(n){t(n)})}};_bs.dD=function(n,t){_bs.dD.initializeBase(this,[t]);this.o=n};_bs.dD.prototype={o:null,r:function(){return this.h.d()},n:function(){return this.h.a()},q:function(){for(var i="",n=0;n<this.o.length;++n){var t=this.o[n].a===_a.R.a.a?this.h.a():this.o[n].b(this.h.d().data);_j.F.a(t)||(i+=t.toString())}return i},k:function(n,t){this.h.e(n,t)}};_bs.dE=function(n,t,i){this.d=Function.createDelegate(this,this.e);this.c=new _bs.cD(n,t,i)};_bs.dE.prototype={c:null,a:function(n,t){this.c.h(n,t)},b:function(n,t,i){this.c.i(_a.dd,n,this.d,t,i)},e:function(n){return new _a.dd(n.a())}};_bs.dF=function(n,t,i){this.g=Function.createDelegate(this,this.h);this.f=new _bs.cD(n,t,i)};_bs.dF.prototype={f:null,e:function(){return this.f.c},b:function(n,t){this.f.h(n,t)},a:function(n,t,i){_a.b.a(t,"successCallback");var r=this;this.f.i(_a.eq,n,this.g,function(n,i,r){t(n,i,r)},i)},c:function(n,t,i,r){this.f.j(n,t,i,r)},d:function(n,t,i){this.f.k(n,t,i)},h:function(n){var i=n.d();var t=n.a();return new _a.eq(new _a.dd(t),i.data)}};_bs.cD=function(n,t,i){this.d=n;this.b=t;this.e=i;this.c=0};_bs.cD.prototype={d:null,b:null,e:null,c:0,a:0,h:function(n,t){this.e.c(n,t)},i:function(n,t,i,r,u){_a.b.a(r,"successCallback");this.f();if(this.b.b()===2)r(this.d,[],!0);else{this.a++;var e=this,f=this;this.g(n,t,[],i,function(n,t,i){e.a--;r&&r(n,t,i)},function(n){f.a--;u&&u(n)})}},j:function(n,t,i,r){_a.b.a(i,"successCallback");_a.b.a(t,"condition");this.f();this.a++;var u=this,f=this;this.b.f(t,function(n,t){u.c+=t;u.a--;!n&&t>0&&u.c--;i&&i(n)},function(n){f.a--;r&&r(n)})},k:function(n,t,i){this.c+=n;this.f();this.a++;var u=this,r=this;this.b.g(n,function(){u.a--;t&&t()},function(n){r.a--;i&&i(n)})},g:function(n,t,i,r,u,f){var e=this,o=this;this.b.e(function(){e.c++;if(e.b.b()===2)u(e.d,i,!0);else{Array.add(i,r(e.b));t--;t>0?e.g(n,t,i,r,u,f):u(e.d,i,!1)}},function(n){_bs.s.a(n.name,f)})},f:function(){if(this.a>0)throw Error.invalidOperation("an asynchronous operation is already in progress");}};_bs.Z=function(n,t,i,r){this.C=Function.createDelegate(this,this.H);_bs.Z.initializeBase(this,[[t],r]);this.x=n;this.p=t;this.y=i;this.l=0;this.j=new Array(0)};_bs.Z.prototype={x:null,p:null,y:0,w:null,v:null,u:null,j:null,l:0,r:function(){return this.w},n:function(){return this.v},q:function(){return this.u.toString()},k:function(n,t){this.E(null,null);if(this.l<this.j.length)this.J(n,t);else if(this.h.i===2)n();else{var i=this;this.I(function(){i.k(n,t)},t)}},s:function(n,t){var i=this;this.h.e(function(){i.k(n,t)},t)},I:function(n,t){this.j=new Array(0);this.l=0;var i="";if(this.h.i===2)n();else{i=this.h.A();this.D(i,n,t)}},D:function(n,t,i){if(this.h.i===1&&this.h.A()===n){var u=this.p.a===_a.R.a.a?this.h.a():this.p.b(this.h.d().data);Array.add(this.j,new _bs.Z.a(this.h.a(),u));var r=this;this.h.e(function(){r.D(n,t,i)},i)}else{this.K();t()}},K:function(){this.j.length>0&&this.j.sort(this.C)},H:function(n,t){var r=n;var i=t;return this.y?i.c(r):r.c(i)},J:function(n,t){var u=this.j[this.l].b;var i=this.x.get(u);this.j[this.l]=null;this.l++;var r="IdbQuerySortStrategy.Next";var f=this;_bs.l.a(r,i,function(t){f.E(u,t.target.result);n()});var e=this;_bs.l.c(r,i,function(){t(i.error)})},E:function(n,t){this.v=n;this.w=t;this.u=t?this.p.b(t.data):null}};_bs.Z.a=function(n,t){this.b=n;this.a=t};_bs.Z.a.prototype={b:null,a:null,c:function(n){return Number.isInstanceOfType(this.a)&&Number.isInstanceOfType(n.a)?this.a-n.a:String.isInstanceOfType(this.a)&&String.isInstanceOfType(n.a)?this.a===n.a?0:this.a>n.a?1:-1:0}};_bs.i=function(n){this.h=n;this.i=0;this.m=null};_bs.i.c=function(n,t,i,r,u,f,e){_a.b.a(t,"object store");_a.b.a(f,"success");f=_bs.i.j(n,f,e);r?_bs.i.C(r)?_bs.i.o(t,i,r,u,f):_bs.i.D(r)?_bs.i.u(t,i,r,u,f):_bs.i.E(r)&&_bs.i.y(t,i,r,u,f):_bs.i.h(t,f)};_bs.i.o=function(n,t,i,r,u){switch(_bs.i.g(i)){case 0:_bs.i.h(n,u);break;case 1:_bs.i.p(n,t,i,r,u);break;case 2:_bs.i.n(n,t,i,u);break}};_bs.i.u=function(n,t,i,r,u){switch(_bs.i.g(i)){case 0:_bs.i.w(n,t,i,r,u);break;case 1:_bs.i.x(n,t,i,u);break;case 2:_bs.i.v(n,t,i,u);break}};_bs.i.y=function(n,t,i,r,u){switch(_bs.i.g(i)){case 0:_bs.i.A(n,t,i,r,u);break;case 1:_bs.i.B(n,t,i,u);break;case 2:_bs.i.z(n,t,i,u);break}};_bs.i.p=function(n,t,i,r,u){var o=i.a[0].a;var e=i.a[0].b;var f=t.a(n,o);f?_bs.i.a(n,f,e,null,r,u):_bs.i.m(n,u,o,e)};_bs.i.n=function(n,t,i,r){var f=t.b(n,i.a[0].a,i.a[1].a);var u=i.a[0].b;var e=i.a[1].b;u===e&&f?_bs.i.a(n,f,u,null,0,r):_bs.i.l(n,i.a[0],i.a[1],r)};_bs.i.w=function(n,t,i,r,u){_bs.i.i(n,t,i,r,u)};_bs.i.x=function(n,t,i,r){var u=i.b;var f=i.a[0];if(u.a[0].a===f.a.a){var o=t.a(n,u.a[0]);if(o){var h=_bs.i.b(u);_bs.i.a(n,o,f.b,h,0,r)}else{_j.e.b(_a.a.G,"This query would run faster with an index on {0}",u.a[0].a);_bs.i.e(n,u,f,r)}}else{var e=t.b(n,u.a[0],f.a);if(e){var s=_e.c.b(_bs.bc.a(u.b,""),_bs.bc.a(u.b,"￿"),!0,!0);_bs.i.a(n,e,f.b,s,0,r)}else{_j.e.b(_a.a.G,"This query would run faster with an index on {0}:{1}",u.a[0].a,f.a.a);_bs.i.e(n,u,f,r)}}};_bs.i.v=function(n,t,i,r){var f=i.b;var u=i.a[0];var e=i.a[1];var o=t.b(n,f.a[0],u.a);if(o){var s=_e.c.b(_bs.bc.a(f.b,""),_bs.bc.a(f.b,"￿"),!0,!0);_bs.i.r(n,o,f,s,_bs.i.f(u.b),[f.a[0],u.a],e,r)}else if(u.b===e.b){o=t.b(n,u.a,e.a);if(o)_bs.i.q(n,o,null,f,r);else{_j.e.b(_a.a.G,"This query would run faster with an index on {0}:{1}",u.a.a,e.a.a);_bs.i.d(n,f,u,e,r)}}else{_j.e.b(_a.a.G,"This query would run faster with an index on {0}:{1}",f.a[0].a,u.a.a);_bs.i.d(n,f,u,e,r)}};_bs.i.A=function(n,t,i,r,u){_bs.i.i(n,t,i,r,u)};_bs.i.B=function(n,t,i,r){var u=i.b;var f=i.a[0];var e=t.a(n,u.a[0]);if(e){var o=_bs.i.b(u);u.a[0].a===f.a.a?_bs.i.a(n,e,f.b,o,0,r):_bs.i.t(n,e,o,f,r)}else{_j.e.b(_a.a.G,"This query would run faster with an index on {0}",u.a[0].a);_bs.i.e(n,u,f,r)}};_bs.i.z=function(n,t,i,r){var u=i.b;var o=i.a[0];var e=i.a[1];var f=t.a(n,u.a[0]);if(f){var s=_bs.i.b(u);_bs.i.s(n,f,s,o,e,r)}else{_j.e.b(_a.a.G,"This query would run faster with an index on {0}",u.a[0].a);_bs.i.d(n,u,o,e,r)}};_bs.i.i=function(n,t,i,r,u){var f=t.a(n,i.b.a[0]);if(f){var e=_bs.i.b(i.b);_bs.i.a(n,f,0,e,r,u)}else{_j.e.b(_a.a.G,"This query would run faster with an index on {0}",i.b.a[0].a);_bs.i.k(n,i.b,u)}};_bs.i.t=function(n,t,i,r,u){_j.e.a(_a.a.G,"Creating Sort(Index) strategy.");var f=t.openCursor(i,"next");_bs.l.a("CreateIndexSortStrategy",f,function(t){var e=new _bs.W(t.target,i);var f=new _bs.Z(n,r.a,r.b,e);u(f)})};_bs.i.q=function(n,t,i,r,u){_j.e.a(_a.a.G,"Creating Filter(Index) strategy.");var f=t.openCursor(i,"next");_bs.l.a("CreateIndexFilterStrategy",f,function(n){var f=new _bs.W(n.target,i);var t=new _bs.bF(r,f);u(t)})};_bs.i.s=function(n,t,i,r,u,f){_j.e.a(_a.a.G,"Creating Sort(Sort(Index)) strategy.");var e=t.openCursor(i,"next");_bs.l.a("CreateIndexSortSortStrategy",e,function(t){var s=new _bs.W(t.target,i);var o=new _bs.Z(n,r.a,r.b,s);var e=new _bs.Z(n,u.a,u.b,o);f(e)})};_bs.i.r=function(n,t,i,r,u,f,e,o){_j.e.a(_a.a.G,"Creating Sort(Group((Index)) strategy.");var s=t.openCursor(r,u);_bs.l.a("CreateIndexGroupSortStrategy",s,function(t){var s=new _bs.W(t.target,r);var u=new _bs.dD(f,s);var i=new _bs.Z(n,e.a,e.b,u);o(i)})};_bs.i.e=function(n,t,i,r){_j.e.a(_a.a.G,"Creating Sort(Filter((Cursor)) strategy.");var u=_e.c.a();var f=n.openCursor(u,"next");_bs.l.a("CreateCursorFilterSortStrategy",f,function(f){var s=new _bs.W(f.target,u);var o=new _bs.bF(t,s);var e=new _bs.Z(n,i.a,i.b,o);r(e)})};_bs.i.d=function(n,t,i,r,u){_j.e.a(_a.a.G,"Creating Sort(Sort(Filter((Cursor))) strategy.");var f=_e.c.a();var e=n.openCursor(f,"next");_bs.l.a("CreateCursorFilterSortSortStrategy",e,function(e){var h=new _bs.W(e.target,f);var c=new _bs.bF(t,h);var o=new _bs.Z(n,i.a,i.b,c);var s=new _bs.Z(n,r.a,r.b,o);u(s)})};_bs.i.k=function(n,t,i){_j.e.a(_a.a.G,"Creating Filter(Cursor) strategy.");var r=_e.c.a();var u=n.openCursor(r,"next");_bs.l.a("CreateCursorFilterStrategy",u,function(n){var f=new _bs.W(n.target,r);var u=new _bs.bF(t,f);i(u)})};_bs.i.l=function(n,t,i,r){_j.e.a(_a.a.G,"Creating Sort(Sort(Cursor)) strategy.");var u=_e.c.a();var f=n.openCursor(u,"next");_bs.l.a("CreateCursorSortSortStrategy",f,function(f){var s=new _bs.W(f.target,u);var o=new _bs.Z(n,t.a,t.b,s);var e=new _bs.Z(n,i.a,i.b,o);r(e)})};_bs.i.m=function(n,t,i,r){_j.e.a(_a.a.G,"Creating Sort(Cursor) strategy.");var u=_e.c.a();var f=n.openCursor(u,_bs.i.f(r));_bs.l.a("CreateCursorSortStrategy",f,function(f){var o=new _bs.W(f.target,u);var e=new _bs.Z(n,i,r,o);t(e)})};_bs.i.a=function(n,t,i,r,u,f){_j.e.a(_a.a.G,"Creating Index strategy.");var e=t.openCursor(r,_bs.i.f(i));_bs.l.a("CreateIndexStrategy",e,function(n){f(new _bs.W(n.target,r))})};_bs.i.h=function(n,t){_j.e.a(_a.a.G,"Creating Cursor strategy.");var i=_e.c.a();var r=n.openCursor(i,"next");_bs.l.a("CreateCursorStrategy",r,function(n){t(new _bs.W(n.target,i))})};_bs.i.g=function(n){return n.a&&n.a.length?n.a.length===1?1:n.a.length===2?2:0:0};_bs.i.D=function(n){return!!n&&!!n.b&&_e.b.isInstanceOfType(n.b)};_bs.i.C=function(n){return!!n&&!n.b};_bs.i.E=function(n){return!!n&&!!n.b&&(_e.e.isInstanceOfType(n.b)||_e.d.isInstanceOfType(n.b))};_bs.i.f=function(n){return n?"prev":"next"};_bs.i.b=function(n){var i=null;if(_e.e.isInstanceOfType(n)){var t=n;switch(t.d){case 0:i=_e.c.b(t.b,t.c,!1,!1);break;case 3:i=_e.c.b(t.b,t.c,!0,!0);break;case 1:i=_e.c.b(t.b,t.c,!0,!1);break;case 2:i=_e.c.b(t.b,t.c,!1,!0);break;default:break}}else if(_e.d.isInstanceOfType(n)){var r=n;var u=!r.c;i=r.d?_e.c.f(r.b,u):_e.c.e(r.b,u)}else if(_e.b.isInstanceOfType(n)){var f=n;i=_e.c.d(f.b)}return i};_bs.i.j=function(n,t,i){var r=n.onerror;n.onerror=function(t){n.onerror=r;_bs.s.a(t.target.error.name,i);r&&r(t)};var u=t;t=function(t){n.onerror=r;u(t)};return t};_bs.i.prototype={h:null,i:0,m:0,d:function(){this.z();return this.r()},a:function(){this.z();return this.n()},A:function(){this.z();return this.q()},b:function(){return this.i},c:function(n,t){if(this.m===null){_j.e.b(_a.a.G,"Asking for Count on anything other than a cusor strategy will require query traversal.");var i=this;this.F(0,function(t){i.m=t;n(i.m)},t)}else n(this.m)},e:function(n,t){switch(this.i){case 0:var r=this;this.s(function(){r.t();n()},t);break;case 1:var i=this;this.k(function(){i.t();n()},t);break;case 2:throw Error.invalidOperation("The end of the content was reached by the previous call to next!");}},f:function(n,t,i){this.G(n,0,t,i)},g:function(n,t,i){if(n&&this.i!==2)switch(this.i){case 0:var r=this,e=this;this.s(function(){r.t();r.g(n-1,t,i)},function(n){_bs.s.a(n.name,i)});break;case 1:var u=this,f=this;this.B(n,function(){u.t();_bs.s.b(t)},function(n){_bs.s.a(n.name,i)});break;case 2:throw Error.invalidOperation("The end of the content was reached by the previous call to next!");}else _bs.s.b(t)},s:function(n,t){this.k(n,t)},B:function(n,t,i){if(n&&this.i!==2){var r=this;this.e(function(){r.B(n-1,t,i)},i)}else t()},F:function(n,t,i){if(this.i===2)t(n);else{var r=this,u=this;this.e(function(){r.F(n+1,t,i)},function(n){_bs.s.a(n.name,i)})}},G:function(n,t,i,r){var f=this.i?1:0;var u=this,e=this;this.e(function(){t+=f;if(u.i===2)i(!1,t);else if(n.f(u.a(),u.d().data)){u.i=0;i(!0,t)}else u.G(n,t,i,r)},function(n){_bs.s.a(n.name,r)})},z:function(){if(!this.i)throw Error.invalidOperation("cannot ask for value before calling next");},t:function(){this.i=this.n()!==null?1:2}};_bs.dG=function(n,t){this.data=n;this.metadata=t};_bs.dG.prototype={data:null,metadata:null};_bs.dH=function(n,t,i){this.f=n;this.h=t;this.e=i;this.i=t.objectStore("__versions");this.g=t.objectStore("__indexes")};_bs.dH.prototype={f:null,h:null,i:null,g:null,e:null,b:function(n,t,i,r){if(this.e.b(n))throw Error.invalidOperation("the object store: "+n+" already exists.");if(n.startsWith("__"))throw Error.invalidOperation("the object store: "+n+" begins with the reserved prefix __.");this.f.createObjectStore(n,new _e.f(null,i));this.e.d(n,t);this.i.put(new _bs.cE(n,t),n)},d:function(n){if(this.e.b(n)){var u=this.f.deleteObjectStore(n);this.e.i(n);var r=_e.i.a(this.i,n);var t=this.g.openCursor(_e.c.a(),"next");var i=this;_bs.l.a("RemoveObjectStore",t,function(t){if(t.target.result){var r=t.target.result.value;i.j(n,r)&&_e.h.b(t.target.result);_e.h.a(t.target.result)}})}},c:function(n,t){if(this.e.b(n)){var r=t.a;var i=this.h.objectStore(n);_e.i.a(i,r)}},a:function(n,t,i){if(!this.e.b(t))throw Error.invalidOperation("the object store: "+t+" does not exist.");if(this.e.h(t,n))throw Error.invalidOperation("the object store: "+t+" already has index "+n+" declared.");var f=this.e.c[t].g;var r=new _bs.dC(t,n,i,f);this.g.put(r);var e=this.h.objectStore(t);var u=_bs.bq.b(r);e.createIndex(n,u.d.a,_e.j.a);this.e.e(r.storeName,u)},j:function(n,t){var i=!1;if(t.storeName===n){i=!0;if(this.e.b(n)){var u=this.e.c[n].g;var r=t.storeVersion||"";u===r&&(i=!1)}}return i}};_bs.dI=function(n,t){_bs.dI.initializeBase(this,[n,t,new _a.R("data."+t[0])])};_bs.dI.prototype={c:function(n,t,i){_bs.bq.a(this.a[0],n,t,i)}};_bs.bY=function(){};_bs.bY.a=function(n,t,i,r){t.oncomplete=function(){_j.e.a(_a.a.G,"idb transaction successfully completed");var t=new _a.cc(_a.bc.b(_a.a.G),n);_a.bc.a(t,function(){_bs.s.b(i)})};t.onabort=function(t){_j.e.a(_a.a.G,"idb transaction aborted!");var i="AbortError";if(t.target.error){i=t.target.error.name;_j.e.c(_a.a.G,"aborted due to error: "+i)}var u=new _a.cc(_a.bc.b(_a.a.G),n);_a.bc.a(u,function(){_bs.s.a(i,r)})}};_bs.cE=function(n,t){this.name=n.toLowerCase();this.version=t};_bs.cE.prototype={name:null,version:null};_bs.ej=function(){};_bs.ei=function(){};_bs.ei.registerInterface("_bs.ei");_bs.bg=function(n,t){this.w=Function.createDelegate(this,this.y);this.r=n;this.n=_bs.br.a();this.q=new _e.r(this);this.s=new _e.t;this.t="";this.o=t;this.u=0;this.p=new Array(0)};_bs.bg.a=function(n,t,i){var r=null;try{r=new _bs.bt(t,i);n(r)}finally{r&&r.dispose()}};_bs.bg.c=function(n){var i=String.format("CREATE TABLE IF NOT EXISTS {0}({1} TEXT, {2} TEXT, {3} TEXT)","__OBJECTSTORE","StoreName","IndexName","IndexKeyPath");var t=new Array(0);_bs.o.a(n,"SqlBrowserDb.CreateObjectStoreMetaTable",i,t,null,null)};_bs.bg.e=function(n){var i=String.format("CREATE TABLE IF NOT EXISTS {0}({1} TEXT PRIMARY KEY, {2} TEXT)","__VERSIONS","EntityName","VersionName");var t=new Array(0);_bs.o.a(n,"SqlBrowserDb.CreateVersionMetaTable",i,t,null,null)};_bs.bg.b=function(n){var i=String.format("CREATE TABLE IF NOT EXISTS {0}({1} TEXT PRIMARY KEY, {2} TEXT)","__BLOBS","StoreName","Blobs");var t=new Array(0);_bs.o.a(n,"SqlBrowserDb.CreateBlobMetaTable",i,t,null,null)};_bs.bg.d=function(n){var i=String.format("CREATE TABLE IF NOT EXISTS {0}({1} TEXT PRIMARY KEY, {2} TEXT)","__SETTINGS","Id","Value");var t=new Array(0);_bs.o.a(n,"SqlBrowserDb.CreateBlobMetaTable",i,t,null,null)};_bs.bg.h=function(n,t){var r=String.format("INSERT OR REPLACE INTO {0} ({1}, {2}) VALUES(?, ?)","__VERSIONS","EntityName","VersionName");var i=["db",t];_bs.o.a(n,"SqlBrowserDb.UpdateVersionMetaTable",r,i,null,null)};_bs.bg.g=function(n,t){var r=String.format("INSERT OR REPLACE INTO {0} ({1}, {2}) VALUES(?, ?)","__SETTINGS","Id","Value");var i=["Features",JsonParser.serialize(t)];_bs.o.a(n,"SqlBrowserDb.UpdateActivatedFeatures",r,i,null,null)};_bs.bg.prototype={r:null,o:null,n:null,q:null,s:null,t:null,p:null,u:0,e:function(){return this.t},a:function(){return this.n.h()},k:function(){return this.p},c:function(n,t,i,r,u){var o=this.n.e();var e=this.u++;this.o.b(e);var h=this,s=this,f=this;this.r.transaction(function(r){_bs.bg.a(i,r,o);_bs.bg.h(r,n);_bs.bg.g(r,t)},function(n){s.o.a(e);_bs.K.a(n,u)},function(){f.o.a(e);f.n=o.e();f.t=n;f.p=t;r&&r()})},b:function(n,t,i,r){var u=null;var f=this.u++;this.o.b(f);var e=this,o=this,s=this;this.r.transaction(function(i){_j.e.a(_a.a.bN,"queuing transaction {0} with id {1}",n.a(),f);u=new _bs.o(i,e.n,e.q,e.s,n);t(u)},function(t){var i=_j.n.b(_a.a.bN,0,"SqlDbFailure");try{_j.e.a(_a.a.bN,"transaction {0} ended in error.",n.a());o.o.a(f);u&&u.g?_bs.K.b(5,"transaction aborted",r):_bs.K.c(t)?o.o.c():u&&u.j()?_bs.K.a(u.j(),r):_bs.K.a(t,r)}finally{_j.n.a(i)}},function(){_j.e.a(_a.a.bN,"transaction {0} with id {1} ended in success.",n.a(),f);var t=_j.n.b(_a.a.bN,0,"SqlDbSuccess");try{s.o.a(f);u&&u.l();_bs.K.e(i,u.d.a())}finally{_j.n.a(t)}})},g:function(n,t,i,r){this.b(new _e.a(n),t,i,r)},i:function(n,t){var r=this,i=this;this.c("",new Array(0),this.w,function(){n&&n()},function(n){t&&t(n)})},f:function(n,t){this.q.c(n,t)},h:function(n){this.q.d(n)},m:function(){this.q.e()},d:function(n){if(!this.n.c(n))throw Error.invalidOperation(String.format("The object store {0} does not exist",n));var t=new _bs.bg.f(n,this.s);this.s.d(t);return t},x:function(n,t){_a.b.a(n,"success");var i=this,u=this,r=this;this.r.transaction(function(n){_bs.bg.c(n);_bs.bg.e(n);_bs.bg.b(n);_bs.bg.d(n);i.z(n)},function(n){_bs.K.a(n,t)},function(){n()})},l:function(n){var t=this.n.c(n);t||Error.invalidOperation(String.format("The storeName {0} doesn't exist",n));return t.k},j:function(){},y:function(n){for(var t=n,r=this.a(),i=0;i<r.length;++i)t.d(r[i]);t.t();t.v();t.s();t.u()},z:function(n){var r=null;var u=null;var f=null;var i=null;var t=String.format("SELECT * FROM {0}","__OBJECTSTORE");var e=new Array(0);var h=this;_bs.o.a(n,"SqlBrowserDb.PopulateMetadataFromDatabase1",t,e,function(n,t){r=t;h.v(r,u,f,i)},null);t=String.format("SELECT * FROM {0}","__VERSIONS");var c=this;_bs.o.a(n,"SqlBrowserDb.PopulateMetadataFromDatabas2",t,e,function(n,t){u=t;c.v(r,u,f,i)},null);t=String.format("SELECT * FROM {0}","__BLOBS");var o=this;_bs.o.a(n,"SqlBrowserDb.PopulateMetadataFromDatabase3",t,e,function(n,t){f=t;o.v(r,u,f,i)},null);t=String.format("SELECT * FROM {0}","__SETTINGS");var s=this;_bs.o.a(n,"SqlBrowserDb.PopulateMetadataFromDatabase4",t,e,function(n,t){i=t;s.v(r,u,f,i)},null)},v:function(n,t,i,r){if(n&&t&&i&&r){this.n=_bs.br.b(n,t,i);this.B(t);this.A(r)}},B:function(n){for(var t=0;t<n.rows.length;++t){var i=n.rows.item(t);if(i.EntityName==="db"){this.t=i.VersionName;break}}},A:function(n){for(var t=0;t<n.rows.length;++t){var i=n.rows.item(t);if(i.Id==="Features"){var r=i.Value;this.p=JsonParser.deserialize(r);break}}this.p=this.p||new Array(0)}};_bs.bg.f=function(n,t){_bs.bg.f.initializeBase(this,[n,t])};_bs.K=function(n,t){_bs.K.initializeBase(this,[n,t])};_bs.K.a=function(n,t){var r=n.message;var i=_bs.K.f(n);_j.e.c(_a.a.bN,"SQL Error - code "+i+": {0}",r);_bs.K.b(i,r,t)};_bs.K.b=function(n,t,i){if(i){var r=new _a.cc(_a.bc.b(_a.a.bN),"SQLBrowserDBError.ReportError");r.a=r.c+"_"+t;_a.bc.a(r,function(){i(new _bs.K(n,t))})}};_bs.K.d=function(n,t,i,r){if(n){var u=new _a.cc(_a.bc.b(_a.a.bN),"SQLBrowserDBError.ReportStatementSuccess_"+r);_a.bc.a(u,function(){n(t,i)})}};_bs.K.e=function(n,t){if(n){var i=new _a.cc(_a.bc.b(_a.a.bN),"SQLBrowserDBError.ReportTransactionSuccess_"+t);_a.bc.a(i,function(){n()})}};_bs.K.c=function(n){var r=n.code;var i=(n.message||"").toLowerCase();var t=!r&&i.indexOf("closed")>=0;_j.e.b(_a.a.bN,"returning {0} for the sql error with code {1} and message {2} in IsDatabaseClosedError.",t,r,i);return t};_bs.K.f=function(n){var t=0;switch(n.code){case 6:t=1;break;case 1:t=0;break;case 4:t=3;break;case 5:t=0;break;case 7:t=4;break;case 3:t=0;break;case 0:t=0;break;case 2:t=0;break}return t};_bs.cF=function(n,t){_bs.cF.initializeBase(this);this.d=n;this.c=t};_bs.cF.prototype={d:null,c:null,b:function(n,t,i,r){_a.b.a(i,"success");var f;var u;var s,h,e;if(e=this.e(n,t,s={val:f},h={val:u}),f=s.val,u=h.val,e){var o=new _bs.bg(f,this.c);var l=this,c=this;o.x(function(){i(o)},function(n){r&&r(n)})}else r&&r(new _a.bO(0,u))},a:function(n,t,i){var u=this,r=this;this.b(n,5,function(n){n.i(function(){t()},function(n){i&&i(n)})},function(n){i&&i(n)})},e:function(n,t,i,r){_a.b.c(n,"name");i.val=null;r.val="";try{i.val=this.d.openDatabase(n,"",_fs.T.BN,t*1048576,null)}catch(u){r.val=u.message;i.val=null}return!!i.val}};_bs.cG=function(n,t,i,r){this.i=n;this.h=t;this.j=i;this.l=r};_bs.cG.a=function(n,t){var i=null;n.rows.length&&(i=_bs.ca.a(0,n,t).a);return i};_bs.cG.prototype={i:null,h:null,j:null,l:null,b:function(){return this.h.a()},k:function(){return this.h.e()},f:function(n,t,i){_a.b.a(n,"id must be provided");_a.b.a(n.a,"id must be provided");_a.b.a(t,"success callback must be provided");var r=n.a;_a.b.a(r,"id must be provided");_a.b.c(r.toString(),"id must be provided");var e=String.format("SELECT * FROM [{0}] WHERE {1} = ?",this.h.a(),_bs.ba.a);var f=[r];var u=this;_bs.o.a(this.i.e,this.i.d.a(),e,f,function(n,i){var r=_bs.cG.a(i,u.h.b());t(r)},i)},d:function(n,t,i){_a.b.a(n,"id must be provided");var u=n.a;_a.b.a(u,"id must be provided");_a.b.c(u.toString(),"id must be provided");var f=String.format("DELETE FROM [{0}] WHERE {1} = ?",this.h.a(),_bs.ba.a);var e=[u];this.l.f(this,n);var r=this;_bs.o.a(this.i.e,this.i.d.a(),f,e,function(){r.j&&r.j(r.b(),2,n,null);t&&t()},i)},e:function(n,t){var r=String.format("DELETE FROM [{0}]",this.h.a());var i=[];this.l.e(this);var u=this;_bs.o.a(this.i.e,this.i.d.a(),r,i,function(){n&&n()},t)},g:function(n,t,i,r){_a.b.a(n,"id must be provided");_a.b.a(t,"json must be provided");var f=!0;var h=!1;if(this.i.d.d()){var s=String.format("SELECT COUNT(*) FROM [{0}] WHERE {1} = ?",this.h.a(),_bs.ba.a);var c=[n.a];var l=this,a=this;_bs.o.a(this.i.e,this.i.d.a(),s,c,function(n,t){var i=t.rows.item(0)["COUNT(*)"];f=!!i},function(t){_j.e.a(_a.a.Q,"Database query with ClientStoreId = {0} failed with error: {1}",n.toString(),t.a)})}var e=String.format("INSERT OR REPLACE INTO [{0}] {1} VALUES {2}",this.h.a(),this.n(),this.p());var o=this.o(n.a,t);this.l.g(this,n,t);var u=this;_bs.o.a(this.i.e,this.i.d.a(),e,o,function(r,e){h=!0;u.j&&(f?u.j(u.b(),1,n,t):u.j(u.b(),0,n,t));n.a||(n=new _a.dd(e.insertId));i&&i(n)},r)},a:function(n,t,i){_a.b.a(t,"success");this.m(n);t(new _bs.ca(this.i,n,this.h.a(),this.h.b()))},c:function(n,t,i){_a.b.a(t,"success");var r=new _a.bk(n,null);this.m(r);t(new _bs.bZ(this.i,r,this.h.a()))},m:function(n){if(n){this.q(n);this.r(n)}},r:function(n){if(n.a)for(var t=0;t<n.a.length;++t)if(!this.h.d(n.a[t].a.a)){var i=String.format("KeyPath {0} is being sorted but it is not an indexed field",n.a[t].a.a);_a.bO.a(1,i)}},q:function(n){if(n.b)for(var i=n.b.a,t=0;t<i.length;++t)if(!this.h.d(i[t].a)){var r=String.format("KeyPath {0} is being queried but it is not an indexed field",i[t].a);_a.bO.a(1,r)}},o:function(n,t){var r=[];var u={};Array.add(r,n);for(var c=0;c<this.h.b().length;++c){var h=this.h.b()[c];var p=h.b(t);u[h.a]=p;h.d(t)}try{Array.add(r,JsonParser.serialize(t));for(var l=0;l<this.k().length;++l){var s=this.k()[l];var f=u[s];this.t(n,s,f);this.u(n,s,f);Array.add(r,f)}for(var e=0;e<this.h.c().length;++e){var v=this.h.c()[e].a;var i=u[v];i=undefined===i?null:i;this.s(n,v,i);Array.add(r,i)}}finally{for(var o=0;o<this.h.b().length;++o){var a=this.h.b()[o];var y=u[a.a];a.c(t,y)}}return r},t:function(n,t,i){if(_j.F.a(i)){var r=String.format("KeyPath {0} is a declared index on store {1} but does not exist in object with id {2}",t,this.h.a(),n);_a.bO.a(1,r)}},s:function(n,t,i){if(i&&!String.isInstanceOfType(i)){var r=String.format("KeyPath {0} is a blob store {1} but it is not a string {2}",t,this.h.a(),n);_a.bO.a(1,r)}},u:function(n,t,i){if(!String.isInstanceOfType(i)&&!Number.isInstanceOfType(i)){var r=String.format("KeyPath {0} is a declared index on store {1} but the object with id {2} is attempting to store the non-primitive type {3}.",t,this.h.a(),n,Object.getType(i).getName());_a.bO.a(1,r)}},p:function(){for(var n=new Sys.StringBuilder("(?, ?"),i=0;i<this.k().length;++i)n.append(", ?");for(var t=0;t<this.h.c().length;++t)n.append(", ?");n.append(")");return n.toString()},n:function(){for(var n=new Sys.StringBuilder(String.format("({0}, {1}",_bs.ba.a,"json")),i=0;i<this.k().length;++i)n.append(String.format(", [{0}]",this.k()[i]));for(var t=0;t<this.h.c().length;++t)n.append(String.format(", [{0}]",this.h.c()[t].a));n.append(")");return n.toString()}};_bs.o=function(n,t,i,r,u){this.e=n;this.h=t;this.i=new _e.s(this,r);this.f=null;this.d=u;i&&(this.f=new _e.q(i))};_bs.o.a=function(n,t,i,r,u,f){var h="";var s="";if(_j.e.f&&_j.e.e===5){for(var e="{ ",o=0;o<r.length;++o){e+=r[o]?r[o].toString():"null";o<r.length-1&&(e+=", ")}e+=" }";h=String.format("ExecuteSql => {0} {1}",i,e.substr(0,50));s=String.format("ExecuteSql => {0} {1}",i,e.substr(0,256))}n.executeSql(i,r,function(n,i){var r=_j.n.b(_a.a.bN,0,"ExecuteSqlSuccess");try{_bs.K.d(u,n,i,t)}finally{_j.n.a(r)}},function(t,r){var u=_j.n.b(_a.a.bN,0,"ExecuteSqlFailure");try{n.lastBrowserDbTransactionError=r;i!=="BOGUS SQL STATEMENT TO FORCE ROLLBACK"&&_bs.K.a(r,f);return!0}finally{_j.n.a(u)}})};_bs.o.prototype={e:null,h:null,f:null,i:null,d:null,g:!1,b:function(){return this.d},j:function(){return this.e.lastBrowserDbTransactionError},k:function(){var n=null;this.f&&(n=this.f.c);return n},c:function(){this.g=!0;_bs.o.a(this.e,"SqlBrowserDbTransaction.Abort","BOGUS SQL STATEMENT TO FORCE ROLLBACK",[],null,null)},a:function(n){var t=this.h.a(n);if(!t)throw Error.invalidOperation(String.format("Object store {0} does not exist",n));return new _bs.cG(this,t,this.k(),this.i)},l:function(){this.f&&this.f.d(this.d)}};_bs.ba=function(){};_bs.dN=function(n,t,i){_bs.dN.initializeBase(this,[n,t,i]);this.a=n.b};_bs.dN.prototype={a:null,e:function(){return"WHERE ["+this.a.a[0].a+"] = ?"},c:function(){return[this.a.b]}};_bs.dO=function(n,t,i){_bs.dO.initializeBase(this,[n,t,i]);this.a=n.b};_bs.dO.prototype={a:null,e:function(){var n=" ["+this.a.a[0].a+"] ";return"WHERE"+n+this.i()+" ? AND"+n+this.j()+" ?"},c:function(){return[this.a.b,this.a.c]},i:function(){var n=">";this.a.d&&this.a.d!==2||(n+="=");return n},j:function(){var n="<";this.a.d&&this.a.d!==1||(n+="=");return n}};_bs.dP=function(n,t,i){_bs.dP.initializeBase(this,[n,t,i]);this.a=n.b};_bs.dP.prototype={a:null,e:function(){var n;switch(this.a.d){case 0:n=this.a.c===1?">=":">";break;case 1:n=this.a.c===1?"<=":"<";break;default:throw Error.invalidOperation("OperatorType is not supported.");}return"WHERE ["+this.a.a[0].a+"] "+n+" ?"},c:function(){return[this.a.b]}};_bs.br=function(){this.b=[]};_bs.br.a=function(){return new _bs.br};_bs.br.b=function(n,t,i){for(var b=new _bs.br,k={},s={},h=0;h<t.rows.length;++h){var w=t.rows.item(h);var y=w.EntityName.toLowerCase();k[y]=w.VersionName;s[y]=null}for(var r=0;r<i.rows.length;++r){for(var p=i.rows.item(r),rt=p.StoreName.toLowerCase(),nt=JsonParser.deserialize(p.Blobs),d=[],l=nt,tt=l.length,f=0;f<tt;++f){var it=l[f];Array.add(d,new _a.R(it))}s[rt]=d}for(var v=n.rows,e=0;e<v.length;++e){var u=v.item(e);var o=u.StoreName;var a=u.IndexName;var c=u.IndexKeyPath;var g=b.f(o,k[o.toLowerCase()],s[o.toLowerCase()]);_j.h.a(a)||g.l(a);_j.h.a(c)||g.m(new _a.R(c))}return b};_bs.br.prototype={h:function(){for(var t=[],n=0;n<this.b.length;++n){var i=this.b[n];Array.add(t,i.f)}return t},g:function(n,t,i){this.f(n,t,i)},i:function(n){for(var t=0;t<this.b.length;++t){var i=this.b[t];if(i.n(n.f)){Array.removeAt(this.b,t);break}}},e:function(){for(var t=new _bs.br,n=0;n<this.b.length;++n){var i=this.b[n];Array.add(t.b,i.o())}return t},d:function(n){return!!this.c(n)},c:function(n){for(var r=null,t=0;t<this.b.length;++t){var i=this.b[t];if(i.n(n)){r=i;break}}return r},a:function(n){return this.c(n)},f:function(n,t,i){var r=this.c(n);if(!r){r=new _bs.cH(n,t,i);Array.add(this.b,r)}return r}};_bs.cH=function(n,t,i){this.f=n;this.k=t;this.j=i||[];this.i=Array.clone(this.j);this.h={};this.g={}};_bs.cH.prototype={f:null,k:null,j:null,i:null,h:null,g:null,a:function(){return this.f},e:function(){var i=[];var t=this.g;for(var n in t){var r={key:n,value:t[n]};Array.add(i,r.value)}return i},b:function(){return this.i},c:function(){return this.j},n:function(n){return this.f.toLowerCase()===n.toLowerCase()},o:function(){var n=new _bs.cH(this.f,this.k,this.j);n.h=_ff.i.b(this.h);n.g=_ff.i.b(this.g);n.i=Array.clone(this.i);return n},l:function(n){this.h[n.toLowerCase()]=n},m:function(n){this.g[n.a.toLowerCase()]=n.a;Array.add(this.i,n)},p:function(n){return n.toLowerCase()in this.h},d:function(n){return n.toLowerCase()in this.g||n.toLowerCase()===_bs.ba.a}};_bs.bH=function(n,t,i){this.b=n;this.h=t;this.g=i};_bs.bH.a=function(n,t,i){var r=null;n&&n.b?_e.b.isInstanceOfType(n.b)?r=new _bs.dN(n,t,i):_e.e.isInstanceOfType(n.b)?r=new _bs.dO(n,t,i):_e.d.isInstanceOfType(n.b)&&(r=new _bs.dP(n,t,i)):r=new _bs.bH(n,t,i);return r};_bs.bH.b=function(n){return n?"DESC":"ASC"};_bs.bH.prototype={b:null,h:null,g:0,m:function(){return this.g===1?this.d("*"):this.d(_bs.ba.a)},l:function(){return this.d("COUNT(*)")},f:function(){var n=[];this.c()&&Array.addRange(n,this.c());return n},e:function(){return""},c:function(){return[]},k:function(){var t="";if(this.n()){t="ORDER BY";for(var n=0;n<this.b.a.length;++n){var i=this.b.a[n];t+=" ["+i.a.a+"] "+_bs.bH.b(i.b)+(n<this.b.a.length-1?",":"")}}return t},o:function(){for(var i=[],t=0;t<arguments.length;++t)i[t]=arguments[t];for(var r="",n=0;n<i.length;++n){r+="["+i[n].a+"]";n+1<i.length&&(r+=", ")}return this.d(r)},n:function(){return!!this.b&&!!this.b.a&&this.b.a.length>0},d:function(n){var t="SELECT "+n+" FROM ["+this.h+"]";var r=this.e();r&&(t+=" "+r);var i=this.k();i&&(t+=" "+i);return t}};_bs.bZ=function(n,t,i){this.c=new _bs.bs(n,_bs.bH.a(t,i,0))};_bs.bZ.a=function(n,t){var r=t.rows.item(n);var i=r[_bs.ba.a];return new _a.dd(i)};_bs.bZ.prototype={c:null,a:function(n,t){this.c.e(n,t)},b:function(n,t,i){this.c.g(n,_bs.bZ.a,t,i)}};_bs.ca=function(n,t,i,r){this.f=new _bs.bs(n,_bs.bH.a(t,i,1));this.g=r};_bs.ca.a=function(n,t,i){for(var e=t.rows.item(n),c=e.json,o=JsonParser.deserialize(c),u=i,h=u.length,r=0;r<h;++r){var f=u[r];var s=e[f.a];f.c(o,s)}return new _a.eq(_bs.bZ.a(n,t),o)};_bs.ca.prototype={f:null,g:null,e:function(){return this.f.d},b:function(n,t){this.f.e(n,t)},a:function(n,t,i){var f=this;var u=t?function(n,i,r){t(n,i,r)}:null;var r=this;this.f.g(n,function(n,t){return _bs.ca.a(n,t,r.g)},u,i)},c:function(n,t,i,r){this.f.i(n,t,i,r)},d:function(n,t,i){this.f.j(n,t,i)}};_bs.bs=function(n,t){this.a=n;this.b=t};_bs.bs.b=function(n,t){for(var i=0;i<n.rows.length;++i)if(t.g(n.rows.item(i)))return i;return-1};_bs.bs.a=function(n,t,i){var r=String.format(" LIMIT {0} OFFSET {1}",i,t);return n+r};_bs.bs.prototype={b:null,a:null,d:0,c:!1,e:function(n,t){var i=this;_bs.o.a(this.a.e,this.a.d.a(),this.b.l(),this.b.f(),function(t,i){var r=i.rows.item(0)["COUNT(*)"];n(r)},t)},g:function(n,t,i,r){this.h();this.c=!0;var e=_bs.bs.a(this.b.m(),this.d,n);this.d+=n;var u=this,f=this;_bs.o.a(this.a.e,this.a.d.a(),e,this.b.f(),function(r,f){u.c=!1;if(i){for(var o=f.rows.length,c=_j.n.b(_a.a.bN,2,"SqlQueryResultImpl.Next_BuildResultsFromRow_"+o),s=new Array(o),e=0;e<o;++e){var h=t(e,f);s[e]=h}_j.n.a(c);i(u.a,s,s.length<n)}},function(n){f.c=!1;r&&r(n)})},i:function(n,t,i,r){this.h();_a.b.a(t,"condition cannot be null");this.c=!0;this.f(t,this.d,i,r)},j:function(n,t,i){this.d+=n;t()},f:function(n,t,i,r){var f;var o=_bs.bs.a((f=this.b).o.apply(f,n.a),t,500);var u=this,e=this;_bs.o.a(this.a.e,this.a.d.a(),o,this.b.f(),function(f,e){var s=_bs.bs.b(e,n);var o=s!==-1;var h=e.rows.length>0;if(o||!h){u.c=!1;u.d=t+s;i(o)}else u.f(n,t+e.rows.length,i,r)},function(n){e.c=!1;r&&r(n)})},h:function(){if(this.c)throw Error.invalidOperation("An async operation is currently in progress");}};_bs.bt=function(n,t){_bs.bt.initializeBase(this);this.e=n;this.f=t};_bs.bt.b=function(n){if(n.startsWith("__"))throw Error.create("An object store cannot be created with a name beginning with __");};_bs.bt.a=function(n){for(var i="(",t=0;t<n.length;++t){t>0&&(i+=", ");i+=String.format("[{0}]",n[t].a.a)}i+=")";return i};_bs.bt.d=function(n){if(n.length>2)throw Error.invalidOperation("Cannot create a multi-column index with more than two fields");};_bs.bt.c=function(n,t){if(n.p(t))throw Error.invalidOperation(String.format("The index {0} already exists",t));};_bs.bt.prototype={f:null,e:null,b:function(n,t,i,r){this.q(n);_bs.bt.b(n);this.h(n);this.p(n,i,r);this.l(n,t);this.i(n,t,r);this.k(n,t,r)},d:function(n){if(this.f.d(n)){var t=this.g(n);this.h(t.f);this.w(t)}},c:function(n,t){if(this.f.d(n)){var r=String.format("DELETE FROM [{0}] WHERE {1} = ?",n,_bs.ba.a);var i=[t.a];_bs.o.a(this.e,"SqlSchemaUpdater.RemoveItem",r,i,null,null)}},a:function(n,t,i){_bs.bt.d(i);var r=this.g(t);_bs.bt.c(r,n);this.n(n,i,r);this.o(n,r,i);r.l(n)},t:function(){var t=String.format("DELETE FROM {0}","__OBJECTSTORE");var n=new Array(0);_bs.o.a(this.e,"SqlSchemaUpdater.PurgeObjectStoreMetadata",t,n,null,null)},v:function(){var t=String.format("DELETE FROM {0}","__VERSIONS");var n=new Array(0);_bs.o.a(this.e,"SqlSchemaUpdater.PurgeVersionMetadata",t,n,null,null)},s:function(){var t=String.format("DELETE FROM {0}","__BLOBS");var n=new Array(0);_bs.o.a(this.e,"SqlSchemaUpdater.PurgeBlobMetadata",t,n,null,null)},u:function(){var t=String.format("DELETE FROM {0}","__SETTINGS");var n=new Array(0);_bs.o.a(this.e,"SqlSchemaUpdater.PurgeSettingsMetadata",t,n,null,null)},D:function(){this.e=null},n:function(n,t,i){for(var u=0;u<t.length;++u){var r=t[u];if(!i.d(r.a.a)){this.m(i,r);this.j(i,n,r)}}},p:function(n,t,i){var f=t?"INTEGER PRIMARY KEY AUTOINCREMENT":"TEXT PRIMARY KEY";var e=this.r(i);var r=String.format("CREATE TABLE [{0}]({1} {3}, {2} BLOB"+e+")",n,_bs.ba.a,"json",f);var u=new Array(0);_bs.o.a(this.e,"SqlSchemaUpdater.CreateUnderlyingObjectStoreTable",r,u,null,null)},r:function(n){var r="";if(n&&n.length>0){for(var t=new Sys.StringBuilder,i=0;i<n.length;++i){t.append(", [");t.append(n[i].a);t.append("] BLOB")}r=t.toString()}return r},l:function(n,t){var r=String.format("INSERT OR REPLACE INTO {0} ({1}, {2}) VALUES (?, ?)","__VERSIONS","EntityName","VersionName");var i=[n,t];_bs.o.a(this.e,"SqlSchemaUpdater.AddStoreVersionToVersionsTable",r,i,null,null)},i:function(n,t,i){var f="[]";if(i){for(var e=[],u=i,h=u.length,r=0;r<h;++r){var c=u[r];Array.add(e,c.a)}f=JsonParser.serialize(e)}var o=String.format("INSERT OR REPLACE INTO {0} ({1}, {2}) VALUES (?,?)","__BLOBS","StoreName","Blobs");var s=[n,f];_bs.o.a(this.e,"SqlSchemaUpdater.AddBlobPathsToBlobTable",o,s,null,null)},k:function(n,t,i){var u=String.format("INSERT INTO {0} VALUES(?,?,?)","__OBJECTSTORE");var r=[n,"",""];_bs.o.a(this.e,"SqlSchemaUpdater.AddStoreNameToObjectStoreMetadata",u,r,null,null);this.f.g(n,t,i)},w:function(n){var i=String.format("DELETE FROM {0} WHERE {1} = ?","__OBJECTSTORE","StoreName");var t=[n.f];_bs.o.a(this.e,"SqlSchemaUpdater.RemoveStoreNameFromObjectStoreMetadata",i,t,null,null);this.f.i(n)},h:function(n){var i=String.format("DROP TABLE IF EXISTS [{0}]",n);var t=new Array(0);_bs.o.a(this.e,"SqlSchemaUpdater.RemoveUnderlyingObjectStoreTable",i,t,null,null)},q:function(n){if(this.f.d(n)){var t=new _bs.K(1,String.format("The object store {0} already exists.",n));throw Error.create(t.a,t);}},g:function(n){var i=this.f.c(n);if(!i){var t=new _bs.K(1,String.format("The object store {0} was not found.",n));throw Error.create(t.a,t);}return i},o:function(n,t,i){var f=_bs.bt.a(i);var u=String.format("CREATE INDEX [{0}] ON [{1}] {2}",n,t.a(),f);var r=new Array(0);_bs.o.a(this.e,"SqlSchemaUpdater.CreateSqlIndexOnColumns",u,r,null,null)},j:function(n,t,i){var u=String.format("INSERT INTO {0} VALUES(?,?,?)","__OBJECTSTORE");var r=[n.f,t,i.a.a];_bs.o.a(this.e,"SqlSchemaUpdater.AddIndexInformationToMetaTable",u,r,null,null);n.m(i.a)},m:function(n,t){var r=String.format("ALTER TABLE [{0}] ADD COLUMN [{1}] {2}",n.a(),t.a.a,_a.gd.b(t.b));var i=new Array(0);_bs.o.a(this.e,"SqlSchemaUpdater.AlterTableToAddColumnForIndex",r,i,null,null)}};_bs.dJ=function(n,t){this.d=n;this.c=t;this.a=[];this.b=!1};_bs.dJ.prototype={d:null,c:null,b:!1,a:null,transaction:function(n,t,i){_a.b.a(n,"transaction");var r=new _bs.X(this.d,this.c,i,t);try{n(r);Array.enqueue(this.a,r);this.e()}catch(e){_j.e.d(_a.a.bN,e,"Exception caught in transaction callback.");if(t){var f=String.format("Exception caught in transaction callback. {0}",e.message);var u=new _a.ge(0,f);t(u)}}},e:function(){if(!this.b&&this.a.length>0){this.b=!0;var t=Array.dequeue(this.a);var n=this;t.A(function(){n.b=!1;n.e()})}}};_bs.dK=function(n){_bs.dK.initializeBase(this);this.insertId=n.insertId;this.rowsAffected=n.rowsAffected;this.rows=new _bs.dL(n)};_bs.dL=function(n){_bs.dL.initializeBase(this);this.length=n.rows.length;this.a=n};_bs.dL.prototype={a:null,item:function(n){for(var i={},u=this.a.rows[n],t=0;t<this.a.columnNames.length;++t){var r=this.a.columnNames[t];i[r]=u[t]}return i}};_bs.bG=function(n,t,i,r){_a.b.c(n,"sql");_a.b.a(t,"args");_a.b.a(i,"successCallback");_a.b.a(r,"errorCallback");this.c=n;this.a=t;this.d=i;this.b=r};_bs.bG.prototype={c:null,a:null,d:null,b:null,e:function(n){var i=this,t=this;n.a(this.c,this.a,function(n){i.d(n)},function(n){t.b(n)})}};_bs.X=function(n,t,i,r){this.n=Function.createDelegate(this,this.p);this.j=n;this.f=t;this.i=this.w(i);this.h=this.v(r);this.a=0;this.b=[];this.x(r)};_bs.X.prototype={f:null,i:null,h:null,j:null,g:null,a:0,b:null,d:!1,m:!1,e:!1,executeSql:function(n,t,i,r){this.m=!0;if(this.a===2)throw Error.invalidOperation("ExecuteSql cannot be invoked on a completed transaction.");var f=new _bs.bG(n,t,this.u(i),this.t(r));Array.enqueue(this.b,f);if(this.a&&!this.e){this.e=!0;var u=this;this.f.a(_a.a.dx,"ExecuteSql",function(){u.e=!1;u.c()},0)}},A:function(n){this.k(0);this.g=n;if(this.m){_j.e.a(_bs.X.a,"Starting transaction.");this.a=1;this.c()}else{this.a=2;this.f.a(_a.a.dx,"ExecuteSql",this.n,0)}},r:function(){_j.e.a(_bs.X.a,"Committing transaction");this.k(1);this.a=2;var i=this,t=this;var n=new _bs.bG("COMMIT TRANSACTION",[],function(){i.p()},function(n){_j.e.c(_bs.X.a,"Commit error: {0}",n.message);t.l(n)});Array.enqueue(this.b,n);this.c()},p:function(){this.o();this.i&&this.i()},l:function(n){this.o();this.h&&this.h(n)},o:function(){this.j=null;this.g&&this.g()},z:function(n){var t=new _a.ge(0,"Exception occurred on a transaction callback. "+n.message);this.q(t)},q:function(n){_j.e.a(_bs.X.a,"Rolling back transaction");this.k(1);this.a=2;Array.clear(this.b);var r=this,i=this;var t=new _bs.bG("ROLLBACK TRANSACTION",[],function(){r.l(n)},function(t){_j.e.b(_bs.X.a,"Rollback error: {0}",t.message);i.l(n)});Array.enqueue(this.b,t);this.c()},v:function(n){if(n){var t=this;return function(t){try{n(t)}catch(i){_j.e.d(_bs.X.a,i,"Exception during transaction error callback.")}}}else return null},w:function(n){if(n){var t=this;return function(){try{n()}catch(t){_j.e.d(_bs.X.a,t,"Exception during transaction success callback.")}}}else return null},u:function(n){var t=this;return function(i){t.a!==2&&n&&t.y(n,i)}},t:function(n){var t=this;return function(i){t.a!==2&&t.q(i);n&&n(t,i)}},y:function(n,t){try{n(this,new _bs.dK(t))}catch(i){_j.e.d(_bs.X.a,i,"Exception during transaction callback.");this.z(i)}},s:function(){this.b.length||this.r()},x:function(n){var i=this,r=this;var t=new _bs.bG("BEGIN IMMEDIATE TRANSACTION",[],function(){},function(t){_j.e.c(_bs.X.a,"BEGIN error: {0}",t.message);n&&n(t)});Array.enqueue(this.b,t)},c:function(){if(!this.d&&this.b.length>0){for(var t=this.j.a();this.b.length>0&&t.c()<4194304;){var i=Array.dequeue(this.b);i.e(t)}this.d=!0;var n=this;t.b(function(){n.d=!1;n.a!==2&&n.s();n.c()})}},k:function(n){if(this.a!==n)throw Error.invalidOperation(String.format("transaction state expected {0}.  Actual {1}.",n,this.a));}};_bs.dM=function(n,t){this.a=n;this.b=t};_bs.dM.prototype={a:null,b:null,openDatabase:function(n,t,i,r,u){return new _bs.dJ(this.a,this.b)}};_bs.bu=function(n,t,i){_bs.bu.initializeBase(this,[n,t,i,i.Body.ConversationActions.length])};_bs.bu.prototype={i:null,e:null,k:!1,l:function(){return"ApplyConversationAction"},bK:function(n,t,i){this.g(n,t,i)},bJ:function(n,t,i,r){this.e=this.b.Body.ConversationActions[n];if(this.a&&this.a.isActionGlobal)this.s(t,i);else{var u=null;if(this.e.ContextFolderId)u=this.e.ContextFolderId.BaseFolderId;else if(this.a&&this.a.folderIdForInstanceKeysToRemoveFromPendingOperations)u=new _g.l(this.a.folderIdForInstanceKeysToRemoveFromPendingOperations);else{_j.e.a(_a.a.bc,"This action {0}:{1} does not contain a valid folder id. Completing the service command without performing any real action.",this.l(),this.e.Action);t();return}this.r(u,t,i)}},r:function(n,t,i){var u=_bs.Y.a(n,this.e.ConversationId);var r=this,f=this;this.h(function(n){r.i=n;r.c.d().bindIn(r.i,u,function(n){r.m(n,u)},null)},function(){t()},_bs.b.b(i))},s:function(n,t){this.k=!0;var i=this,r=this;this.h(function(n){i.i=n;_bs.C.c(n,i.c.d(),i.e.ConversationId,function(n){for(var u=n,e=u.length,t=0;t<e;++t){var r=u[t];var f=_bs.Y.a(r.get_data().FolderId,i.e.ConversationId);i.m(r,f)}})},function(){n()},_bs.b.b(t))},m:function(n,t){if(n){var i=n.get_data();var u=i.FolderId;var r=this;this.c.c().bindIn(this.i,_bs.d.a(u.Id),function(u){r.w(u,i);r.v(t,n,i);r.A(i)},null)}},w:function(n,t){if(n){var u=n.get_data();var i=u;switch(this.e.Action){case"Delete":case"AlwaysDelete":case"Move":t.UnreadCount>0&&(i.UnreadCount-=t.UnreadCount);i.TotalCount-=t.MessageCount;break;case"SetReadState":if(this.e.IsRead)t.UnreadCount>0&&(i.UnreadCount-=t.UnreadCount);else{var r=t.MessageCount;t.UnreadCount>0&&(r=t.MessageCount-t.UnreadCount);i.UnreadCount+=r}break;default:_j.e.a(_bs.bu.a,"{0} not implemented in client store.",this.e.Action);break}n.b(this.i,null)}},v:function(n,t,i){switch(this.e.Action){case"Delete":case"AlwaysDelete":case"Move":case"SetClutterState":this.c.d().b(this.i,n);break;case"SetReadState":i.UnreadCount=this.e.IsRead?0:i.MessageCount;this.k&&(i.GlobalUnreadCount=this.e.IsRead?0:i.GlobalMessageCount);this.c.d().saveIn(this.i,t,0,null);break;case"Flag":i.FlagStatus=this.e.Flag.FlagStatus;this.c.d().saveIn(this.i,t,0,null);break;default:_j.e.a(_bs.bu.a,"UpdateConversation: {0} not implemented in client store.",this.e.Action);break}},A:function(n){var i=n.ItemIds;if(i)for(var u=i.length,t=0;t<u;t++){var r=i[t];this.z(r)}},z:function(n){if(n&&n.Id){var t=_bs.d.a(n.Id);switch(this.e.Action){case"Delete":case"AlwaysDelete":case"Move":case"SetClutterState":this.c.a().b(this.i,t);break;case"SetReadState":var r=this;this.n(t,function(n,t){t.get_data().IsRead=r.e.IsRead});break;case"Flag":var i=this;this.n(t,function(n,t){t.get_data().Flag=i.e.Flag});break;default:_j.e.a(_bs.bu.a,"UpdateMessages: {0} not implemented in client store.",this.e.Action);break}}},n:function(n,t){var i=this;this.c.a().bindIn(this.i,n,function(n){if(n){t(i.e,n);n.b(i.i,null)}},null)}};_bs.cI=function(n,t,i){_bs.cI.$$(this.$$gta["_bs.cI"].TRequest,this.$$gta["_bs.cI"].TActionContext).initializeBase(this,[n,t]);_a.b.b(i,"request");_a.b.b(i.Header,"request.Header");_a.b.b(i.Header.TimeZoneContext,"request.Header.TimeZoneContext");_a.b.b(i.Header.TimeZoneContext.TimeZoneDefinition,"request.Header.TimeZoneContext.TimeZoneDefinition");this.b=i};_bs.cI.$$=function(n,t){var f=_bs.__tc=_bs.__tc||{};var i="cI"+"$"+n.getName().replace(/\./g,"_")+"$"+t.getName().replace(/\./g,"_");if(!f[i]){var u=f[i]=function(){for(var t=[],n=0;n<arguments.length;++n)t[n]=arguments[n];_bs.cI.apply(this,t)};var c=_bs.cP.$$(t);u.registerClass("_bs.__tc."+i,c);var s={"_bs.cI":{TRequest:n,TActionContext:t},ctor:_bs.cI};var l=c.prototype.$$gta;for(var a in l){var h={key:a,value:l[a]};s[h.key]=h.value}u.prototype.$$gta=s;var e=_bs.cI.prototype;for(var o in e){var r={key:o,value:e[o]};"constructor"!==r.key&&(u.prototype[r.key]=r.value)}}return f[i]};_bs.cI.prototype={b:null};_bs.cJ=function(n,t,i,r,u){_bs.cJ.$$(this.$$gta["_bs.cJ"].TRequest,this.$$gta["_bs.cJ"].TActionContext).initializeBase(this,[n,t,i,r]);this.e=u};_bs.cJ.$$=function(n,t){var f=_bs.__tc=_bs.__tc||{};var i="cJ"+"$"+n.getName().replace(/\./g,"_")+"$"+t.getName().replace(/\./g,"_");if(!f[i]){var u=f[i]=function(){for(var t=[],n=0;n<arguments.length;++n)t[n]=arguments[n];_bs.cJ.apply(this,t)};var c=_bs.cO.$$(n,t);u.registerClass("_bs.__tc."+i,c);var s={"_bs.cJ":{TRequest:n,TActionContext:t},ctor:_bs.cJ};var l=c.prototype.$$gta;for(var a in l){var h={key:a,value:l[a]};s[h.key]=h.value}u.prototype.$$gta=s;var e=_bs.cJ.prototype;for(var o in e){var r={key:o,value:e[o]};"constructor"!==r.key&&(u.prototype[r.key]=r.value)}}return f[i]};_bs.cJ.prototype={H:!1,z:null,e:null,n:function(){this.z||(this.z=this.br());return this.z},R:function(n,t,i,r,u){var e=null;_j.e.a(this.e,"Opening transaction to move message to Outbox. {0}",this.d);var f=this,s=this,o=this;this.h(function(i){if(n){_j.e.a(f.e,"Getting message to move to Outbox. {0}",f.d);f.c.a().bindIn(i,_bs.d.a(n.Id),function(n){_j.e.a(f.e,"Calling getMessageToSaveCallback. {0}",f.d);e=t(n,i);_j.e.a(f.e,"Checking for existing Outbox item before save. {0}",f.d);f.bt(e,n,i);_j.e.a(f.e,"Deleting message from Drafts. {0}",f.d);f.bo(n,i);f.Q(e,i)},null)}else{_j.e.a(f.e,"Calling getMessageToSaveCallback. {0}",f.d);e=t(null,i);_j.e.a(f.e,"Saving message to Outbox. {0}",f.d);f.U(e,null,!0,i);f.Q(e,i)}},function(){_j.e.a(s.e,"Successfully moved message to Outbox. {0}",s.d);s.T(e);r()},function(n){_j.e.a(o.e,"Reporting store error. {0}",o.d);o.T(e);o.j(i,new _bs.b(n),u)})},S:function(n,t,i,r,u){_j.e.a(this.e,"Opening transaction to move Outbox item to Drafts. {0}",this.d);var o=this,f=this,e=this;this.h(function(i){o.bs(i,n,t)},function(){if(f.H){_j.e.a(f.e,"Generating notifications to refresh inbox count. {0}",f.d);_bs.t.c(f.n().d.Id,null,"Reload","serviceCommand",_bs.t.a,_bs.t.a,!0)}_j.e.a(f.e,"Successfully moved message from outbox to drafts. {0}",f.d);r()},function(n){_j.e.a(e.e,"Reporting store error {0}. {1}",n.a,e.d);e.j(i,new _bs.b(n),u)})},P:function(n){var f=10;var o="; ";var t;var u="";t=n?n.length<=f?n.length:f:0;for(var r=0;r<=t-1;r++){var i=n[r].Name;if(i&&i.length>0){var e=u.length?o:"";u+=e+i}}return u},bs:function(n,t,i){_j.e.a(this.e,"Getting OutboxItem for move back to Drafts. {0}",this.d);var r=this;this.c.e().bindIn(n,_bs.d.a(this.n().c.Id),function(u){var s=null;var e=null;var o=null;if(u){s=u.get_data().NormalizedBody;e=u.get_data().UniqueBody;o=u.get_data().Preview;_j.e.a(r.e,"Deleting OutboxItem. {0}",r.d);r.t().c(n,null,"HardDelete",u,null,_g.k.a,!0)}else _j.e.b(_bs.f.a,"Outbox item with id {0} was not found in the client store. {1}",r.n().c.Id,r.d);_j.e.a(r.e,"Calling getMessageToSaveCallback. {0}",r.d);var f=t(n);f.get_data().NormalizedBody=s;f.get_data().UniqueBody=e;f.get_data().Preview=o;if(i){_j.e.a(r.e,"Saving item to drafts. {0}",r.d);r.A(f,!0,n)}else{_j.e.a(r.e,"Checking for existing draft before save. {0}",r.d);r.bu(f,n)}},null)},V:function(n,t,i){this.bv(n,t);n.b(i,null)},bv:function(n,t){n.f(this.bq(),t,this.bp(),"NoError");var i=n.get_data();i.IsRead=!0},T:function(n){if(n){n.g();n.get_data().IsRead=undefined}},bt:function(n,t,i){var r=this;this.c.e().bindIn(i,_bs.d.a(n.get_data().ItemId.Id),function(u){var f=!1;u?_j.e.b(r.e,"Message from Drafts is already in the Outbox. Folder count won't be incremented since message will be replaced. {0}",r.d):f=!0;r.U(n,t,f,i)},null)},U:function(n,t,i,r){_j.e.a(this.e,"Moving to outbox: Id="+(n.a()?n.a().toString():"null")+"; ItemId="+(n.get_data()?JsonParser.serialize(n.get_data().ItemId):"null")+"; Subject="+(n.get_data()?n.get_data().Subject:"null"));if(t&&t.get_data().ConversationId){var f=t.get_data();_j.e.a(this.e,"Removing item part from conversation for conversation id={0}. {1}",f.ConversationId.Id,this.d);var u=this;this.q().a(r,f.ConversationId,f.ParentFolderId,f,_g.k.a,function(t){_j.e.a(u.e,"Removed item part from conversation. ParentConversationNodeId={0}. {1}",t||"null",u.d);_j.e.a(u.e,"Saving item to Outbox. {0}",u.d);u.V(n,t,r)})}else{_j.e.a(this.e,"Saving item to Outbox. {0}",this.d);this.V(n,null,r)}if(i){_j.e.a(this.e,"Incrementing Outbox folder count. {0}",this.d);this.c.c().g(r,n.get_data().ParentFolderId,1,0)}},bo:function(n,t){if(n){_j.e.a(this.e,"Draft message found - deleting from Drafts. {0}",this.d);this.t().c(t,this.q(),"HardDelete",n,null,_g.k.a,!0)}else _j.e.a(this.e,"Draft message not found. {0}",this.d)},Q:function(n,t){if(n&&n.get_data()&&_bs.c.e(n.get_data().__type)){var i=n.get_data();if(i.ReferenceItemId&&i.ReferenceItemId.__type===_g.e._dataContractName){_j.e.a(this.e,"Deleting approval request message with id {0}. {1}",i.ReferenceItemId.Id,this.d);this.t().d(t,this.q(),"HardDelete",i.ReferenceItemId,null,_g.k.a)}}},bu:function(n,t){var i=this;this.c.a().bindIn(t,_bs.d.a(n.get_data().ItemId.Id),function(r){if(r)if(r.get_data().ConversationId){_j.e.a(i.e,"Draft message with id {0} was found in the client store. Removing from conversation {1}",n.get_data().ItemId.Id,i.d);var u=r.get_data();i.q().a(t,u.ConversationId,u.ParentFolderId,u,_g.k.a,function(r){_j.e.a(i.e,"RemoveItemPartFromConversation success callback. {0}",i.d);i.A(n,!1,t)})}else{_j.e.a(i.e,"Draft message with id {0} was found in the client store. It does not have a ConversationId. {1}",n.get_data().ItemId.Id,i.d);i.A(n,!1,t)}else{_j.e.a(i.e,"Draft message with id {0} was not found in the client store. {1}",n.get_data().ItemId.Id,i.d);i.A(n,!0,t)}},null)},A:function(n,t,i){_j.e.a(this.e,"Saving to Drafts via update: Id={0}; ItemId={1}; Subject={2}. {3}",n.a()?n.a().toString():"null",n.get_data()?JsonParser.serialize(n.get_data().ItemId):"null",n.get_data()?n.get_data().Subject:"null",this.d);n.b(i,null);if(t){_j.e.a(this.e,"Increment drafts folder count after message is moved to drafts. {0}",this.d);this.c.c().g(i,n.get_data().ParentFolderId,1,0)}if(!!(!!this.n().b&!!this.n().a)){_j.e.a(this.e,"Adding item to conversation. {0}",this.d);this.bn(i,n.get_data())}},bn:function(n,t){if(!this.n().a){_j.e.a(this.e,"Skipping AddItemToConversation: ParentConversationNodeId is null");return}var i=this;this.q().e(n,this.n().b,t,this.n().a,this.n().e,_g.k.a,function(n){if(n){_j.e.a(i.e,"Item was added to the conversation. ItemId '{0}' ConversationId '{1}' ParentConversationNodeId '{2}'",t.ItemId.Id,i.n().b.Id,i.n().a);i.H=!0}else _j.e.a(i.e,"Conversation not found. ItemId '{0}' ConversationId '{1}' ParentConversationNodeId '{2}'",t.ItemId.Id,i.n().b.Id,i.n().a)})}};_bs.bv=function(n,t,i){_bs.bv.initializeBase(this,[n,t,i,i.Body.Attachments.length]);this.a.parentItemId=this.b.Body.ParentItemId;this.a.attachmentIds=new Array(this.o);this.i=new _gg.fK;this.i.ResponseCode="NoError";this.i.ResponseClass="Success";this.i.Attachments=new Array(this.o);this.e=new _gg.fW;this.e.Header=_bs.B.a;this.e.Body.ResponseMessages=new _gg.k;this.e.Body.ResponseMessages.Items=[this.i]};_bs.bv.b=function(n,t){var i=n;i.Attachments||(i.Attachments=[]);i.HasAttachments=!0;Array.add(i.Attachments,t)};_bs.bv.prototype={e:null,i:null,l:function(){return"CreateAttachment"},bK:function(n,t,i){this.g(n,t,i)},bJ:function(n,t,i,r){if(this.a.clientStoreItem===2){var u=this.b.Body.Attachments[n];var f=this.b.Body.ParentItemId;var s=new _bc.h;var e=s.d();this.a.attachmentIds[n]=e;u.AttachmentId=new _g.bh(e.Id);this.i.Attachments[n]=u;var o=this,c=this,h=this;this.h(function(n){o.c.a().g(n,o.c.h().b(f.Id),u)},function(){_j.e.a(_bs.bv.a,"Successfully updated message with server id {0} in local store.",f.Id);u.AttachmentId.RootItemId=f.Id;u.AttachmentId.RootItemChangeKey=f.ChangeKey;t()},function(n){_bs.b.a(n,i)})}else{_j.e.b(_bs.bv.a,"ClientStoreItem type {0} is not supported.",this.a.clientStoreItem);t();return}}};_bs.c=function(n,t,i){this.w=null;_bs.c.initializeBase(this,[n,t,i,i.Body.Items.length,_bs.c.a]);this.a.itemIds=new Array(i.Body.Items.length);this.a.uIds=new Array(i.Body.Items.length);this.a.createdCalendarItemIds=new Array(i.Body.Items.length);this.k=new Array(this.o);this.s=new _g.fs;this.s.Header=_bs.B.a;this.s.Body.ResponseMessages=new _gg.k;this.s.Body.ResponseMessages.Items=this.k};_bs.c.d=function(n,t,i){var r=null;_j.h.d(i)?t&&t.BodyType==="Text"&&!_j.h.d(t.Value)&&(r=t.Value):r=i;if(r){var f=_a.A.b(r,!0,!0);var u=new _g.s("HTML",f);n.NormalizedBody=u;n.UniqueBody=u;n.Preview=r}};_bs.c.c=function(n){return n===_g.bY._dataContractName||n===_g.bJ._dataContractName||n===_g.bs._dataContractName||n===_g.bO._dataContractName};_bs.c.e=function(n){return n===_gg.Z._dataContractName||n===_gg.bV._dataContractName};_bs.c.f=function(n){return n===_g.cP._dataContractName||n===_g.cS._dataContractName||n===_g.dd._dataContractName};_bs.c.b=function(n,t,i,r){t.val=n.__type===_g.cP._dataContractName;i.val=n.__type===_g.dd._dataContractName;r.val=n.__type===_g.cS._dataContractName};_bs.c.prototype={s:null,k:null,v:null,i:!1,m:0,I:!1,l:function(){return"CreateItem"},bG:function(n,t){_bs.R.c(this.c.e(),n,t,_bs.c.a)},br:function(){return _bs.bJ.a(this.a)},bp:function(){return this.b.Body.ComplianceId},bq:function(){return 0},bK:function(n,t,i){if(this.a.clientStoreItem){var r=this,u=this;this.g(function(){if(r.i){_j.e.a(_bs.c.a,"CreateItem: Call rejected by create item service command. The call should be forwarded to online proxy.");i(-1)}else{r.a.clientStoreItem===4&&(r.b.Body.GenerateResponseMessageOnFailure=!0);n()}},function(n){if(u.i){_j.e.a(_bs.c.a,"CreateItem: Rollback happened. Call rejected by create item service command. The call should be forwarded to online proxy.");i(-1)}else t(n)},i)}else{_j.e.b(_bs.c.a,"The item will not be created in the local store because ClientStoreItem.None was passed.");i(-1)}},bJ:function(n,t,i,r){if(this.i){t();return}var f=this.b.Body.Items[n];var u=new _g.dA;u.ResponseCode="NoError";u.ResponseClass="Success";u.Items=[new _g.L];this.k[n]=u;if(this.a.clientStoreItem===2)this.bz(f,n,t,i);else if(this.a.clientStoreItem===1)this.bx(f,n,t,i);else if(this.a.clientStoreItem===4)this.by(f,n,t,i);else if(this.a.clientStoreItem===5)this.bA(f,n,t,i);else{_j.e.b(_bs.c.a,"ClientStoreItem type {0} is not supported.",this.a.clientStoreItem);t();return}},bz:function(n,t,i,r){_j.e.a(_bs.c.a,"ExecuteMessageItemStep");if(this.a&&this.a.explicitLogonUser){_j.e.a(_bs.c.a,"MessageRequest - operations on this mailbox is not supported in offline: {0}",this.a.explicitLogonUser);this.i=!0;this.m=17;i();return}if(this.a.resendItemId){_j.e.a(_bs.c.a,"Action is a resend of outbox item. itemId: {0}",this.a.resendItemId.Id);this.a.itemIds[t]=this.a.resendItemId;i();return}_a.b.a(this.a.parentFolderId,"ParentFolderId");this.bH(n);this.bl(n.ItemId);this.b.Body.MessageDisposition==="SaveOnly"&&(this.k[t].Items[0].ItemId=n.ItemId);var f=!1;var u=null;if(_bs.c.c(n.__type)){f=!0;u=n}if(this.b.Body.MessageDisposition==="SendAndSaveCopy"){var e=null;var h=null;if(f){var c=this;e=function(n,i){c.a.itemIds[t]=u.ItemId;n&&(u.ConversationId=n.get_data().ConversationId);return c.c.e().fromData(u)};h=u.UpdateResponseItemId}else{var o=this;e=function(i,r){var u=o.c.e().fromData(n);o.a.itemIds[t]=n.ItemId;return u}}_j.e.a(_bs.c.a,"Moving item to Outbox. {0}",this.d);var v=this,y=this;this.R(h,e,this.k[t],function(){v.r(n);i()},function(t){y.r(n);r(t)})}else if(this.a.outboxItemId){_j.e.a(_bs.c.a,"Moving a message from Outbox back to Drafts. {0}",this.d);var s=this,a=this,l=this;this.S(function(i){var r=s.c.a().fromData(n);s.a.itemIds[t]=n.ItemId;return r},!f,this.k[t],function(){a.r(n);i()},function(t){l.r(n);r(t)})}else if(f){_j.e.a(_bs.c.a,"Creating a SmartResponse for ReferenceItemId={0}. {1}",JsonParser.serialize(u.ReferenceItemId),this.d);if(u.UpdateResponseItemId)if(this.b.Body.MessageDisposition==="SaveOnly"){_j.e.a(_bs.c.a,"Updating an existing SmartResponse. {0}",this.d);this.bI(u,t,i,r)}else throw Error.invalidOperation("Unknown SmartResponse operation.");else{_j.e.a(_bs.c.a,"Creating a SmartResponse in Drafts. {0}",this.d);this.be(n,t,i,r)}}else{_j.e.a(_bs.c.a,"Creating a message in the Drafts or Outbox. {0}",this.d);this.be(n,t,i,r)}},bd:function(n,t){if(!_j.h.d(this.a.clientStoreBodyValue)){this.v=n.Value;this.w=n.BodyType;n=new _g.s(t,this.a.clientStoreBodyValue);this.a.clientStoreBodyValue=null}return n},bI:function(n,t,i,r){this.a.itemIds[t]=n.UpdateResponseItemId;_j.e.a(_bs.c.a,"Opening transaction to update a SmartResponse. {0}",this.d);var u=this,e=this,f=this;this.O(new _e.a("CreateItem.UpdateSmartResponse",!1),function(t){_j.e.a(_bs.c.a,"Updating SmartResponse. {0}",u.d);u.c.a().d(t,_bs.d.a(n.ItemId.Id),function(t){if(_j.F.a(t)){_j.e.b(_bs.c.a,"Message with id {0} not found in local store",n.ItemId.Id);return}_j.e.a(_bs.c.a,"Retrieved SmartResponse from the local store for update. {0}",u.d);var i=t;i.__type=n.__type;i.ReferenceItemId=n.ReferenceItemId;i.NewBodyContent=n.NewBodyContent;i.BccRecipients=n.BccRecipients;i.CcRecipients=n.CcRecipients;i.ToRecipients=n.ToRecipients;i.From=n.From;i.Subject=n.Subject;i.Importance=n.Importance;i.NormalizedBody=n.NormalizedBody;i.UniqueBody=i.NormalizedBody;i.Preview=n.Preview;i.RightsManagementLicenseData=n.RightsManagementLicenseData;if(n.ExtendedProperty)for(var e=0;e<n.ExtendedProperty.length;e++){var f=n.ExtendedProperty[e];var r=f.ExtendedFieldURI;r.DistinguishedPropertySetId==="Common"?r.PropertyId===34229?_bs.p.b(i,r,f.Value):r.PropertyId===34232?_bs.p.b(i,r,f.Value):r.PropertyId===34230?_bs.p.b(i,r,f.Value):r.PropertyId===34231&&_bs.p.b(i,r,f.Value):r.DistinguishedPropertySetId==="PublicStrings"&&r.PropertyName.startsWith("cecp-")&&_bs.p.b(i,r,f.Value)}_j.e.a(_bs.c.a,"Smart response with updates going to client store via create: ReferenceItemId={0}; Subject={1}. {2}",JsonParser.serialize(i.ReferenceItemId),i.Subject,u.d)})},function(){_j.e.a(_bs.c.a,"Successfully updated message in local store. {0}",e.d);e.r(n);i()},function(t){_j.e.a(_bs.c.a,"Reporting store error. {0}",f.d);f.r(n);_bs.b.a(t,r)})},be:function(n,t,i,r){var o=this.c.a().fromData(n);this.a.itemIds[t]=n.ItemId;var s=null;_j.e.a(_bs.c.a,"Opening transaction to save message item via create. Id={0}; Subject={1}; {2}",o.a()?o.a().toString():"null",n.Subject,this.d);var u=this,f=this,e=this;this.h(function(t){_j.e.a(_bs.c.a,"Saving item. {0}",u.d);o.b(t,function(n){s=n});_j.e.a(_bs.c.a,"Incrementing folder count. {0}",u.d);u.c.c().g(t,n.ParentFolderId,1,0);if(_bs.c.c(n.__type)&&u.b.Body.MessageDisposition==="SaveOnly"){_j.e.a(_bs.c.a,"Adding item (SmartResponse) to conversation. {0}",u.d);u.bw(t,n)}},function(){_j.e.a(_bs.c.a,"Successfully created message in local store id={0}. {1}",s,f.d);f.r(n);if(f.I){_j.e.a(_bs.c.a,"Generating notifications to refresh inbox count. {0}",f.d);_bs.t.c(f.a.inboxFolderId.Id,null,"Reload","serviceCommand",_bs.t.a,_bs.t.a,!0)}_j.e.a(_bs.c.a,"Calling succeededCallback. {0}",f.d);i()},function(i){_j.e.a(_bs.c.a,"Reporting store error {0}. {1}",i.a,e.d);e.r(n);e.j(e.k[t],new _bs.b(i),r)})},bw:function(n,t){if(!this.a.parentConversationNodeId){_j.e.a(_bs.c.a,"Skipping AddItemToConversation: ParentConversationNodeId is null");return}var i=this;this.q().e(n,this.a.conversationId,t,this.a.parentConversationNodeId,this.a.itemPartsOrderDescending,_g.k.a,function(n){if(n){_j.e.a(_bs.c.a,"Item was added to the conversation. ItemId '{0}' ConversationId '{1}' ParentConversationNodeId '{2}'",t.ItemId.Id,i.a.conversationId.Id,i.a.parentConversationNodeId);i.I=!0}else _j.e.a(_bs.c.a,"Conversation not found. ItemId '{0}' ConversationId '{1}' ParentConversationNodeId '{2}'",t.ItemId.Id,i.a.conversationId.Id,i.a.parentConversationNodeId)})},bx:function(n,t,i,r){var u=n;if(this.bD(u)){this.i=!0;this.m=1;i()}else if(u.Recurrence){this.i=!0;this.m=2;i()}else if(this.bC(u)){this.i=!0;this.m=10;i()}else{var e=this,f=this;this.p().g(u.Start,u.End,function(){var n=_ff.e.a(u,!0,!0);n.ParentFolderId||(n.ParentFolderId=e.a.calendarFolderId);e.bF(n,t,i,r)},function(){f.i=!0;f.m=11;i()})}},bC:function(n){return!!n.ParentFolderId&&n.ParentFolderId.Id!==this.a.calendarFolderId.Id||!!this.b.Body.SavedItemFolderId&&this.b.Body.SavedItemFolderId.BaseFolderId.__type===_g.l._dataContractName&&this.b.Body.SavedItemFolderId.BaseFolderId.Id!==this.a.calendarFolderId.Id},bH:function(n){var i=_bs.c.c(n.__type);var t=i?n:null;var r=new _bc.h;n.InstanceKey="INSK:"+r.a;n.ItemId=i&&t.UpdateResponseItemId?t.UpdateResponseItemId:r.b;this.b.Body.MessageDisposition==="SendAndSaveCopy"&&(n.ItemId=_bc.OutboxItemContext.b(n.ItemId,_bs.c.a));n.DateTimeCreated=_a.d.d(_a.d.a());n.DateTimeReceived=n.DateTimeCreated;n.LastModifiedTime=_a.d.d(_a.d.a());n.ParentFolderId=this.a.parentFolderId;var f=i?t.NewBodyContent:null;var u=this.a.bodySubstring||"";_bs.c.d(n,f,u);i?t.NewBodyContent=this.bd(t.NewBodyContent,t.NewBodyContent.BodyType):n.Body=this.bd(n.Body,"Text");this.b.Body.MessageDisposition==="SaveOnly"&&(n.IsDraft=!0);n.RightsManagementLicenseData=this.a.rightsManagementLicenseData;this.a.conversationId&&(n.ConversationId=this.a.conversationId);_bs.c.e(n.__type)&&(n.ItemClass=n.__type===_gg.Z._dataContractName?"IPM.Note.Microsoft.Approval.Reply.Approve":"IPM.Note.Microsoft.Approval.Reply.Reject");n.DisplayTo=this.P(n.ToRecipients)},r:function(n){n.ItemId=undefined;n.InstanceKey=undefined;n.DateTimeCreated=undefined;n.DateTimeReceived=undefined;n.LastModifiedTime=undefined;n.ParentFolderId=undefined;n.NormalizedBody=undefined;n.UniqueBody=undefined;n.Preview=undefined;n.IsDraft=undefined;n.ConversationId=undefined;n.InternetMessageId=undefined;n.ItemClass=undefined;n.DisplayTo=undefined;this.v&&(_bs.c.c(n.__type)?n.NewBodyContent.Value=this.v:n.Body.Value=this.v);this.w!==null&&(_bs.c.c(n.__type)?n.NewBodyContent.BodyType=this.w:n.Body.BodyType=this.w);n.RightsManagementLicenseData=undefined},bF:function(n,t,i,r){var e=new _bc.h;var u=e.b;this.Y(n);n.ItemId=u;n.UID="CLUID:"+e.a;n.IsMeeting=!1;n.HasAttachments=!1;n.ResponseType="Organizer";n.IsOrganizer=!0;n.ResponseObjects=new Array(1);n.ResponseObjects[0]=new _g.bJ;n.Organizer=new _g.O;n.Organizer.Mailbox=new _g.f;n.Organizer.Mailbox.EmailAddress=this.a.userEmailAddress;n.Organizer.Mailbox.Name=this.a.userDisplayName;n.Organizer.Mailbox.RoutingType="SMTP";n.Organizer.Mailbox.MailboxType="Mailbox";n.StartWallClock=n.Start;n.StartTimeZoneId=this.b.Header.TimeZoneContext.TimeZoneDefinition.Id;n.EndWallClock=n.End;n.EndTimeZoneId=this.b.Header.TimeZoneContext.TimeZoneDefinition.Id;_bs.M.b(n);var s=this.c.b().fromData(n);var h=this,f=this,o=this;this.h(function(t){s.b(t,function(i){_j.e.a(_bs.c.a,"Successfully created calendar item with id {0} to local store.",i.toString());if(n.ReminderIsSet){_j.e.a(_bs.c.a,"A reminder is set on calendar item with Id {0}. Creating a reminder.",u.Id);h.p().c(t,n,u,function(n){_j.e.a(_bs.c.a,"Successfully created reminder for calendar item with id {0} to local store.",i.toString())})}})},function(){_j.e.a(_bs.c.a,"Successfully created calendar item and reminder with id {0} to local store.",u);f.k[t].Items[0].ItemId=u;f.a.itemIds[t]=u;f.a.uIds[t]="CLUID:"+e.a;i()},function(n){o.j(o.k[t],new _bs.b(n),r)})},bD:function(n){return!!n.RequiredAttendees&&n.RequiredAttendees.length>0||!!n.OptionalAttendees&&n.OptionalAttendees.length>0},by:function(n,t,i,r){if(!_bs.c.f(n.__type)){_j.e.b(_bs.c.a,"MeetingRequest - Response type not support in offline: {0}",n.__type);this.i=!0;this.m=15;i();return}var e=n;var y,v,b;var w,a,p;_bs.c.b(e,w={val:y},a={val:v},p={val:b}),y=w.val,v=a.val,b=p.val;if(e.ReferenceItemId.__type!==_g.e._dataContractName&&e.ReferenceItemId.__type!==_g.bm._dataContractName){this.i=!0;this.m=14;i();return}var f=e.ReferenceItemId;var h=_a.d.d(_a.d.a());if(this.a.isReferencedItemMeetingRequest){this.k[t].Items=new Array(3);var s=_bs.d.a(f.Id);var u=this,k=this,c=this;this.h(function(n){u.c.a().bindIn(n,s,function(i){if(!i||!i.get_data()){_j.e.b(_bs.c.a,"MeetingRequest - Message with id {0} not found in local store",s);u.i=!0;return}var r=i.get_data();if(r.IsDelegated){_j.e.a(_bs.c.a,"MeetingRequest - Message with id {0} is delegated and will not be processed by offline service command",s);u.i=!0;u.m=3;return}if(r.IsOutOfDate){_j.e.c(_bs.c.a,"MeetingRequest - Message with id {0} is out of date and should not be used to respond to a meeting request",s);return}r.ResponseType=u.ba(e);r.FreeBusyType=u.Z(e,r.IntendedFreeBusyStatus);r.AppointmentReplyTime=h;var f=new _g.bV;f.ItemId=r.ItemId;u.k[t].Items[2]=f;u.t().c(n,u.q(),"MoveToDeletedItems",i,u.a.deletedItemsFolderId,_g.k.a);u.bE(n,t,i,e,h)},null)},function(){_j.e.a(_bs.c.a,"Successfully responded to message with id {0}.",s);i()},function(n){if(c.i&&n.b===5)r(new _bs.b(n));else{_j.e.c(_bs.c.a,"MeetingRequest - Error while processing message with id:{0}. Error: {1}",s,n.a);c.j(c.k[t],new _bs.b(n),r)}})}else{this.k[t].Items=new Array(2);var o=this,d=this,l=this;this.h(function(n){f.__type===_g.bm._dataContractName?o.p().d(n,f,function(i){_bs.Q.a(n,o.c.f(),i,function(r){if(!r||!r.get_data()){_j.e.b(_bs.c.a,"MeetingRequest - Calendar master item with uid {0} could not be found in client store.",i);o.i=!0;return}_j.e.a(_bs.c.a,"MeetingRequest - Calendar master item with uid {0} found in client store.",i);o.bi(n,t,r,e,h);o.bB(e,r)})},function(){o.i=!0}):o.bb(n,_bs.d.a(f.Id),t,e,h,null)},function(){f.__type===_g.bm._dataContractName?_j.e.a(_bs.c.a,"Successfully responded to calendar master item with occurrence id {0}.",f.OccurrenceId):_j.e.a(_bs.c.a,"Successfully responded to calendar item with id {0}.",f.Id);i()},function(n){if(l.i&&n.b===5)r(new _bs.b(n));else{f.__type===_g.bm._dataContractName?_j.e.c(_bs.c.a,"MeetingRequest - Error while processing calendar master item with ocurrence id:{0}. Error: {1}",f.OccurrenceId,n.a):_j.e.c(_bs.c.a,"MeetingRequest - Error while processing calendar item with id:{0}. Error: {1}",f.Id,n.a);l.j(l.k[t],new _bs.b(n),r)}})}},bE:function(n,t,i,r,u){var f=i.get_data();if(f.AssociatedCalendarItemId&&f.AssociatedCalendarItemId.Id){var e=_bs.d.a(f.AssociatedCalendarItemId.Id);this.bb(n,e,t,r,u,i)}else{if(f.CalendarItemType!=="Single"){var o=String.format("MeetingRequest: No associated calendar item found in meeting request. Cannot create recurring meeting calendar item for the recurring meeting request with id {0}. The call should be forwarded to online proxy. Rolling back.",f.ItemId.Id);_j.e.b(_bs.c.a,o);this.i=!0;this.m=4;n.c();return}this.W(n,t,i,r,u,!1)}},bb:function(n,t,i,r,u,f){if(this.a.referencedCalendarItemType==="RecurringMaster"){var o=this;this.c.f().bindIn(n,t,function(f){if(!f||!f.get_data())if(o.a.isReferencedItemMeetingRequest){var e=String.format("MeetingRequest: Recurring master with id {0} not found. Cannot create recurring meeting calendar item for a recurring meeting request. The call should be forwarded to online proxy. Rolling back.",t);_j.e.b(_bs.c.a,e);o.i=!0;o.m=4;n.c();return}else{_j.e.b(_bs.c.a,"MeetingRequest: Recurring master with id {0} not found in local store.",t);o.i=!0;return}o.bi(n,i,f,r,u)},null)}else{var e=this;this.c.b().bindIn(n,t,function(o){if(!o||!o.get_data()){if(e.a.isReferencedItemMeetingRequest&&e.a.referencedCalendarItemType==="Single"){_j.e.b(_bs.c.a,"MeetingRequest - Calendar with id {0} not found in local store, creating one while sync doesn't happen.",t);e.W(n,i,f,r,u,!0)}else{_j.e.b(_bs.c.a,"MeetingRequest - Calendar with id {0} not found in local store",t);e.i=!0}return}e.bf(n,i,o,r,u)},null)}},Y:function(n){var t=new _g.cC;t.CreateAssociated=!1;t.CreateContents=!1;t.CreateHierarchy=!1;t.Delete=!0;t.Modify=!0;t.Read=!0;t.ViewPrivateItems=!0;n.EffectiveRights=t;n.CalendarItemType="Single";n.IsCancelled=!1},W:function(n,t,i,r,u,f){var o=i.get_data();var e=new _g.z;this.Y(e);var c=new _bc.h;var s;s=f?o.AssociatedCalendarItemId:c.b;e.ParentFolderId=this.a.calendarFolderId;e.ItemId=s;e.UID="CLUID:"+c.a;e.ResponseType=o.ResponseType;e.Start=o.Start;e.End=o.End;e.ResponseObjects=o.ResponseObjects;e.IsResponseRequested=o.IsResponseRequested;e.ConversationId=o.ConversationId;e.Subject=o.Subject;e.IsMeeting=!0;e.Organizer=o.From;e.IsOrganizer=o.IsOrganizer;e.Location=o.Location;e.HasAttachments=o.HasAttachments;e.Body=o.UniqueBody;e.ReminderIsSet=!0;e.ReminderMinutesBeforeStart=5;e.StartWallClock=o.StartWallClock;e.StartTimeZoneId=o.StartTimeZoneId;e.EndWallClock=o.EndWallClock;e.EndTimeZoneId=o.EndTimeZoneId;_bs.M.b(e);var l=this.c.b().fromData(e);var h=this;l.b(n,function(a){_j.e.a(_bs.c.a,"Successfully created calendar item with id {0} to local store.",a.toString());h.a.createdCalendarItemIds[t]=s;h.a.uIds[t]="CLUID:"+c.a;var v=new _g.z;v.ItemId=s;h.k[t].Items[0]=v;if(e.ReminderIsSet){_j.e.a(_bs.c.a,"A reminder is set on calendar item with Id {0}. Creating a reminder.",s.Id);h.p().c(n,e,s,function(n){_j.e.a(_bs.c.a,"Successfully created reminder for calendar item with id {0} to local store.",a.toString())})}if(!f){_j.e.a(_bs.c.a,"Created calendar item without associated calendar item id. Updating meeting request with new value.");o.AssociatedCalendarItemId=e.ItemId;i.b(n,function(n){_j.e.a(_bs.c.a,"Successfully updated meeting request {0} with new Associated calendar item id {1}.",n,o.AssociatedCalendarItemId.Id)})}h.bf(n,t,l,r,u)})},bi:function(n,t,i,r,u){var o,s,e;var l,a,c;_bs.c.b(r,l={val:o},a={val:s},c={val:e}),o=l.val,s=a.val,e=c.val;var f=i.get_data();var h=new _g.z;h.ItemId=f.ItemId;this.k[t].Items[0]=h;this.bh(f,r,u);if(o||s){var v=this;_bs.u.g(n,this.c.b(),f.UID,function(t,i){var f=t.get_data();(f.CalendarItemType==="Occurrence"||e)&&v.bg(n,t,r,u)});var y=this;i.b(n,function(n){_j.e.a(_bs.c.a,"Successfully updated calendar master item with id {0}.",n)})}else{_j.e.a(_bs.c.a,"Response is declient, deleting occurrences/exceptions and reminders for master item with id {0}.",i.a());this.p().a(n,i.a(),i.get_data());_j.e.a(_bs.c.a,"Response is decline, deleting calendar master item with id {0}.",i.a());this.c.f().b(n,i.a())}this.X(n,t,f,r,u)},bf:function(n,t,i,r,u){var e=i.get_data();var f=new _g.z;f.ItemId=e.ItemId;this.k[t].Items[0]=f;this.bg(n,i,r,u);this.X(n,t,e,r,u)},bg:function(n,t,i,r){var f,u,s;var h,e,o;_bs.c.b(i,h={val:f},e={val:u},o={val:s}),f=h.val,u=e.val,s=o.val;var c=t.get_data();this.bh(c,i,r);if(f||u){var l=this;t.b(n,function(n){_j.e.a(_bs.c.a,"Successfully updated calendar item with id {0}.",n)})}else{_j.e.a(_bs.c.a,"Response is decline, deleting calendar item with id {0}.",t.a());this.c.b().b(n,t.a());_j.e.a(_bs.c.a,"Response is decline, deleting reminder with id {0}.",t.a());this.c.g().b(n,t.a())}},bh:function(n,t,i){this.a.referencedCalendarItemType!=="RecurringMaster"&&t.ReferenceItemId.__type!==_g.bm._dataContractName&&n.CalendarItemType==="Occurrence"&&(n.CalendarItemType="Exception");n.ResponseType=this.ba(t);n.FreeBusyType=this.Z(t,n.IntendedFreeBusyStatus);n.AppointmentReplyTime=i},X:function(n,t,i,r,u){var v=!1;var c,l,k;var a,w,p;_bs.c.b(r,a={val:c},w={val:l},p={val:k}),c=a.val,l=w.val,k=p.val;var f=new _g.ck;var b=new _bc.h;var y=b.b;_j.e.a(_bs.c.a,"Create meeting response called. Populating properties.");f.ItemId=y;f.InstanceKey="INSK:"+b.a;f.DateTimeCreated=u;f.DateTimeReceived=u;f.LastModifiedTime=u;f.Start=i.Start;f.End=i.End;f.Location=i.Location;f.Sensitivity=i.Sensitivity;f.Importance=i.Importance;f.AssociatedCalendarItemId=i.ItemId;f.Body=i.Body;f.ToRecipients=[i.Organizer.Mailbox];var e=new _g.O;e.Mailbox=new _g.f;e.Mailbox.EmailAddress=this.a.userEmailAddress;e.Mailbox.Name=this.a.userDisplayName;e.Mailbox.RoutingType="SMTP";e.Mailbox.MailboxType="Mailbox";f.From=e;f.Sender=e;f.IsRead=!0;f.HasAttachments=!1;if(this.b.Body.MessageDisposition==="SaveOnly"){f.IsDraft=!0;f.ParentFolderId=this.a.draftsFolderId}else{f.IsDraft=!1;f.ParentFolderId=this.a.outboxFolderId;v=!0}f.ResponseType=i.ResponseType;var o;if(c){f.ItemClass="IPM.Schedule.Meeting.Resp.Pos";o=_u.n.Id}else if(l){f.ItemClass="IPM.Schedule.Meeting.Resp.Tent";o=_u.n.Ls}else{f.ItemClass="IPM.Schedule.Meeting.Resp.Neg";o=_u.n.Bg}f.Subject=o+i.Subject;f.ResponseObjects=[new _g.bO,new _g.bs,new _g.bJ];var s;s=v?this.c.e().fromData(f):this.c.a().fromData(f);_j.e.a(_bs.c.a,"Saving meeting response with id {0} into client store.",f.ItemId.Id);var h=this;s.b(n,function(i){_j.e.a(_bs.c.a,"Successfully saved meeting response with id {0} into client store.",f.ItemId.Id);var r=new _g.ck;r.ItemId=f.ItemId;h.k[t].Items[1]=r;h.a.itemIds[t]=y;h.c.c().g(n,f.ParentFolderId,1,0)})},ba:function(n){var t=null;var u,r,i;var o,e,f;_bs.c.b(n,o={val:u},e={val:r},f={val:i}),u=o.val,r=e.val,i=f.val;if(u)t="Accept";else if(r)t="Tentative";else if(i)t="Decline";else throw Error.argumentType("responseItem has invalid response type");return t},Z:function(n,t){var i=null;_j.u.a(t)&&(t="NoData");var f,u,r;var s,o,e;_bs.c.b(n,s={val:f},o={val:u},e={val:r}),f=s.val,u=o.val,r=e.val;if(u)i=t==="Free"?"Free":"Tentative";else if(f)i=t==="NoData"?"Busy":t;else if(r)i="Free";else throw Error.argumentType("responseItem has invalid response type");return i},bB:function(n,t){var r=n.ReferenceItemId;_j.e.a(_bs.c.a,"MeetingRequest - Filling Conflict Info for master for occurrence with id {0}",r.OccurrenceId);var i=t.get_data();n.AdditionalInfo||(n.AdditionalInfo=new _dg.ca);n.AdditionalInfo.Organizer=i.Organizer;n.AdditionalInfo.Start=i.Start;n.AdditionalInfo.End=i.End;n.AdditionalInfo.Subject=i.Subject;n.AdditionalInfo.IsResponseRequested=i.IsResponseRequested;n.AdditionalInfo.ConversationId=i.ConversationId;n.AdditionalInfo.Recurrence=i.Recurrence;n.AdditionalInfo.Location=i.Location},bA:function(n,t,i,r){if(!(n.__type===_g.db._dataContractName)){_j.e.b(_bs.c.a,"Remove item wasn't supposed to receive an item type that's not a RemoveItemType : {0}.",Object.getType(n));throw Error.argumentType("item",Object.getType(n),Object.getType(new _g.db),"Remove item wasn't supposed to receive an item type that's not a RemoveItemType.");}var s=n;var o=s.ReferenceItemId;var f=_bs.d.a(o.Id);var u=this,h=this,e=this;this.h(function(n){u.c.a().bindIn(n,f,function(i){if(!i||!i.get_data()){_j.e.b(_bs.c.a,"RemoveItem - Message with id {0} not found in local store",f);u.i=!0;return}_j.e.a(_bs.c.a,"RemoveItem - Cancellation message with id {0} found in client store.",f);var r=i.get_data();if(r.IsDelegated){_j.e.a(_bs.c.a,"RemoveItem - Message with id {0} is delegated and will not be processed by offline service command",f);u.i=!0;u.m=3;return}if(r.IsOutOfDate){_j.e.c(_bs.c.a,"RemoveItem - Message with id {0} is out of date and should not be used to respond to a meeting request",f);return}if(!r.AssociatedCalendarItemId){_j.e.b(_bs.c.a,"RemoveItem - Meeting cancelation message doesn't have associated calendar item and cannot be processed offline",f);u.i=!0;return}u.t().c(n,u.q(),"MoveToDeletedItems",i,_g.m.d("deleteditems"),_g.k.a);u.a.referencedCalendarItemType==="RecurringMaster"?u.bc(_bc.u,n,r.AssociatedCalendarItemId,u.c.f()):u.bc(_bc.t,n,r.AssociatedCalendarItemId,u.c.b());u.k[t].Items=new Array(2);var o=new _dg.be;o.ItemId=r.ItemId;u.k[t].Items[0]=o;var e=new _g.z;e.ItemId=r.AssociatedCalendarItemId;u.k[t].Items[1]=e},null)},function(){_j.e.a(_bs.c.a,"Successfully remove item from calendar referred by cancellation message with id {0}.",o.Id);i()},function(n){if(e.i&&n.b===5)r(new _bs.b(n));else{_j.e.c(_bs.c.a,"RemoveItem - Error while processing message with id:{0}. Error: {1}",o.Id,n.a);e.j(e.k[t],new _bs.b(n),r)}})},bc:function(n,t,i,r){var u=this;r.bindIn(t,_bs.d.a(i.Id),function(r){if(!r||!r.get_data()){_j.e.b(_bs.c.a,"RemoveItem - Associated calendar item (type: '{0}') with id {1} could no be found in client store. Rolling back transaction.",n.getName(),i.Id);u.i=!0;u.m=13;t.c();return}_j.e.a(_bs.c.a,"RemoveItem - Associated calendar item (type: '{0}') with id {1} found in client store. Deleting it.",n.getName(),i.Id);u.p().a(t,r.a(),r.get_data())},null)}};_bs.a=function(){};_bs.a.w=function(n,t){for(var r=[],wt=n.AttributionsArray,yi=wt.length,d=0;d<yi;++d){var gt=wt[d];gt.IsWritable&&Array.add(r,gt.Id)}if(!r.length){var ai=n.AttributionsArray.length;var o=new _g.cq(ai.toString(),new _g.e("TEMPID"),"Outlook");o.IsWritable=!0;o.IsQuickContact=!1;o.IsHidden=!1;o.FolderId=null;for(var b=new Array(n.AttributionsArray.length+1),c=0;c<n.AttributionsArray.length;++c)b[c]=n.AttributionsArray[c];b[n.AttributionsArray.length]=o;n.AttributionsArray=b;Array.add(r,o.Id)}for(var u=!1,dt=!1,f=!1,s=!1,ni="",ii="",ti="",pt=t,pi=pt.length,y=0;y<pi;++y){var i=pt[y];var yt=i.Path;if(!yt)break;switch(yt.FieldURI){case"PersonaFileAsIds":n.FileAsIdsArray=_bs.a.a(r,n.FileAsIdsArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);if(n.FileAsId===i.OldValue||_j.h.b(n.FileAsId)&&_j.h.b(i.OldValue)){n.FileAsId=i.NewValue;u=!0}break;case"PersonaDisplayNamePrefixes":n.DisplayNamePrefixesArray=_bs.a.a(r,n.DisplayNamePrefixesArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);if(n.DisplayNamePrefix===i.OldValue||_j.h.b(n.DisplayNamePrefix)&&_j.h.b(i.OldValue)){n.DisplayNamePrefix=i.NewValue;u=!0}break;case"PersonaGivenNames":n.GivenNamesArray=_bs.a.a(r,n.GivenNamesArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);if(n.GivenName===i.OldValue||_j.h.b(n.GivenName)&&_j.h.b(i.OldValue)){n.GivenName=i.NewValue;u=!0}break;case"PersonaMiddleNames":n.MiddleNamesArray=_bs.a.a(r,n.MiddleNamesArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);if(n.MiddleName===i.OldValue||_j.h.b(n.MiddleName)&&_j.h.b(i.OldValue)){n.MiddleName=i.NewValue;u=!0}break;case"PersonaSurnames":n.SurnamesArray=_bs.a.a(r,n.SurnamesArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);if(n.Surname===i.OldValue||_j.h.b(n.Surname)&&_j.h.b(i.OldValue)){n.Surname=i.NewValue;u=!0}break;case"PersonaDisplayNames":n.DisplayNamesArray=_bs.a.a(r,n.DisplayNamesArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);if(n.DisplayName===i.OldValue||_j.h.b(n.DisplayName)&&_j.h.b(i.OldValue)){n.DisplayName=i.NewValue;u=!0;dt=!0}break;case"PersonaGenerations":n.GenerationsArray=_bs.a.a(r,n.GenerationsArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);if(n.Generation===i.OldValue||_j.h.b(n.Generation)&&_j.h.b(i.OldValue)){n.Generation=i.NewValue;u=!0}break;case"PersonaNicknames":n.NicknamesArray=_bs.a.a(r,n.NicknamesArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);if(n.Nickname===i.OldValue||_j.h.b(n.Nickname)&&_j.h.b(i.OldValue)){n.Nickname=i.NewValue;u=!0}break;case"PersonaInitials":n.InitialsArray=_bs.a.a(r,n.InitialsArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);break;case"PersonaYomiCompanyNames":n.YomiCompanyNamesArray=_bs.a.a(r,n.YomiCompanyNamesArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);break;case"PersonaYomiFirstNames":n.YomiFirstNamesArray=_bs.a.a(r,n.YomiFirstNamesArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);if(n.YomiFirstName===i.OldValue||_j.h.b(n.YomiFirstName)&&_j.h.b(i.OldValue)){n.YomiFirstName=i.NewValue;u=!0}break;case"PersonaYomiLastNames":n.YomiLastNamesArray=_bs.a.a(r,n.YomiLastNamesArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);if(n.YomiLastName===i.OldValue||_j.h.b(n.YomiLastName)&&_j.h.b(i.OldValue)){n.YomiLastName=i.NewValue;u=!0}break;case"PersonaBusinessPhoneNumbers":n.BusinessPhoneNumbersArray=_bs.a.a(r,n.BusinessPhoneNumbersArray,i.OldValue,i.NewValue,_bs.a.h,"Business",_bs.a.i,_bs.a.k,_bs.a.m,_bs.a.j,_bs.a.l);s=!0;break;case"PersonaBusinessPhoneNumbers2":n.BusinessPhoneNumbers2Array=_bs.a.a(r,n.BusinessPhoneNumbers2Array,i.OldValue,i.NewValue,_bs.a.h,"Business",_bs.a.i,_bs.a.k,_bs.a.m,_bs.a.j,_bs.a.l);break;case"PersonaHomePhones":n.HomePhonesArray=_bs.a.a(r,n.HomePhonesArray,i.OldValue,i.NewValue,_bs.a.h,"Home",_bs.a.i,_bs.a.k,_bs.a.m,_bs.a.j,_bs.a.l);s=!0;break;case"PersonaHomePhones2":n.HomePhones2Array=_bs.a.a(r,n.HomePhones2Array,i.OldValue,i.NewValue,_bs.a.h,"Home",_bs.a.i,_bs.a.k,_bs.a.m,_bs.a.j,_bs.a.l);break;case"PersonaMobilePhones":n.MobilePhonesArray=_bs.a.a(r,n.MobilePhonesArray,i.OldValue,i.NewValue,_bs.a.h,"Mobile",_bs.a.i,_bs.a.k,_bs.a.m,_bs.a.j,_bs.a.l);s=!0;break;case"PersonaAssistantPhoneNumbers":n.AssistantPhoneNumbersArray=_bs.a.a(r,n.AssistantPhoneNumbersArray,i.OldValue,i.NewValue,_bs.a.h,"Assistant",_bs.a.i,_bs.a.k,_bs.a.m,_bs.a.j,_bs.a.l);break;case"PersonaCallbackPhones":n.CallbackPhonesArray=_bs.a.a(r,n.CallbackPhonesArray,i.OldValue,i.NewValue,_bs.a.h,"Callback",_bs.a.i,_bs.a.k,_bs.a.m,_bs.a.j,_bs.a.l);break;case"PersonaCarPhones":n.CarPhonesArray=_bs.a.a(r,n.CarPhonesArray,i.OldValue,i.NewValue,_bs.a.h,"Car",_bs.a.i,_bs.a.k,_bs.a.m,_bs.a.j,_bs.a.l);break;case"PersonaHomeFaxes":n.HomeFaxesArray=_bs.a.a(r,n.HomeFaxesArray,i.OldValue,i.NewValue,_bs.a.h,"HomeFax",_bs.a.i,_bs.a.k,_bs.a.m,_bs.a.j,_bs.a.l);break;case"PersonaOrganizationMainPhones":n.OrganizationMainPhonesArray=_bs.a.a(r,n.OrganizationMainPhonesArray,i.OldValue,i.NewValue,_bs.a.h,"OrganizationMain",_bs.a.i,_bs.a.k,_bs.a.m,_bs.a.j,_bs.a.l);break;case"PersonaOtherFaxes":n.OtherFaxesArray=_bs.a.a(r,n.OtherFaxesArray,i.OldValue,i.NewValue,_bs.a.h,"OtherFax",_bs.a.i,_bs.a.k,_bs.a.m,_bs.a.j,_bs.a.l);break;case"PersonaOtherTelephones":n.OtherTelephonesArray=_bs.a.a(r,n.OtherTelephonesArray,i.OldValue,i.NewValue,_bs.a.h,"Other",_bs.a.i,_bs.a.k,_bs.a.m,_bs.a.j,_bs.a.l);s=!0;break;case"PersonaOtherPhones2":n.OtherPhones2Array=_bs.a.a(r,n.OtherPhones2Array,i.OldValue,i.NewValue,_bs.a.h,"Other",_bs.a.i,_bs.a.k,_bs.a.m,_bs.a.j,_bs.a.l);break;case"PersonaPagers":n.PagersArray=_bs.a.a(r,n.PagersArray,i.OldValue,i.NewValue,_bs.a.h,"Pager",_bs.a.i,_bs.a.k,_bs.a.m,_bs.a.j,_bs.a.l);break;case"PersonaRadioPhones":n.RadioPhonesArray=_bs.a.a(r,n.RadioPhonesArray,i.OldValue,i.NewValue,_bs.a.h,"Radio",_bs.a.i,_bs.a.k,_bs.a.m,_bs.a.j,_bs.a.l);break;case"PersonaTelexNumbers":n.TelexNumbersArray=_bs.a.a(r,n.TelexNumbersArray,i.OldValue,i.NewValue,_bs.a.h,"Telex",_bs.a.i,_bs.a.k,_bs.a.m,_bs.a.j,_bs.a.l);break;case"PersonaTTYTDDPhoneNumbers":n.TTYTDDPhoneNumbersArray=_bs.a.a(r,n.TTYTDDPhoneNumbersArray,i.OldValue,i.NewValue,_bs.a.h,"TTYTDD",_bs.a.i,_bs.a.k,_bs.a.m,_bs.a.j,_bs.a.l);break;case"PersonaWorkFaxes":n.WorkFaxesArray=_bs.a.a(r,n.WorkFaxesArray,i.OldValue,i.NewValue,_bs.a.h,"BusinessFax",_bs.a.i,_bs.a.k,_bs.a.m,_bs.a.j,_bs.a.l);break;case"PersonaEmails1":var kt=new _g.f;kt.EmailAddress=i.OldValue;var bt=new _g.f;bt.EmailAddress=i.NewValue;n.Emails1Array=_bs.a.a(r,n.Emails1Array,kt,bt,_bs.a.n,0,_bs.a.o,_bs.a.q,_bs.a.s,_bs.a.p,_bs.a.r);f=!0;ni=i.OldValue;break;case"PersonaEmails1DisplayNames":var hi=new _g.f;hi.Name=i.OldValue;var li=new _g.f;li.Name=i.NewValue;n.Emails1Array=_bs.a.a(r,n.Emails1Array,hi,li,_bs.a.n,1,_bs.a.o,_bs.a.q,_bs.a.s,_bs.a.p,_bs.a.r);f=!0;break;case"PersonaEmails1OriginalDisplayNames":var ci=new _g.f;ci.OriginalDisplayName=i.OldValue;var ui=new _g.f;ui.OriginalDisplayName=i.NewValue;n.Emails1Array=_bs.a.a(r,n.Emails1Array,ci,ui,_bs.a.n,2,_bs.a.o,_bs.a.q,_bs.a.s,_bs.a.p,_bs.a.r);f=!0;break;case"PersonaEmails2":var fi=new _g.f;fi.EmailAddress=i.OldValue;var oi=new _g.f;oi.EmailAddress=i.NewValue;n.Emails2Array=_bs.a.a(r,n.Emails2Array,fi,oi,_bs.a.n,0,_bs.a.o,_bs.a.q,_bs.a.s,_bs.a.p,_bs.a.r);f=!0;ii=i.OldValue;break;case"PersonaEmails2DisplayNames":var ei=new _g.f;ei.Name=i.OldValue;var ri=new _g.f;ri.Name=i.NewValue;n.Emails2Array=_bs.a.a(r,n.Emails2Array,ei,ri,_bs.a.n,1,_bs.a.o,_bs.a.q,_bs.a.s,_bs.a.p,_bs.a.r);f=!0;break;case"PersonaEmails2OriginalDisplayNames":var si=new _g.f;si.OriginalDisplayName=i.OldValue;var vt=new _g.f;vt.OriginalDisplayName=i.NewValue;n.Emails2Array=_bs.a.a(r,n.Emails2Array,si,vt,_bs.a.n,2,_bs.a.o,_bs.a.q,_bs.a.s,_bs.a.p,_bs.a.r);f=!0;break;case"PersonaEmails3":var tt=new _g.f;tt.EmailAddress=i.OldValue;var ut=new _g.f;ut.EmailAddress=i.NewValue;n.Emails3Array=_bs.a.a(r,n.Emails3Array,tt,ut,_bs.a.n,0,_bs.a.o,_bs.a.q,_bs.a.s,_bs.a.p,_bs.a.r);f=!0;ti=i.OldValue;break;case"PersonaEmails3DisplayNames":var rt=new _g.f;rt.Name=i.OldValue;var g=new _g.f;g.Name=i.NewValue;n.Emails3Array=_bs.a.a(r,n.Emails3Array,rt,g,_bs.a.n,1,_bs.a.o,_bs.a.q,_bs.a.s,_bs.a.p,_bs.a.r);f=!0;break;case"PersonaEmails3OriginalDisplayNames":var it=new _g.f;it.OriginalDisplayName=i.OldValue;var nt=new _g.f;nt.OriginalDisplayName=i.NewValue;n.Emails3Array=_bs.a.a(r,n.Emails3Array,it,nt,_bs.a.n,2,_bs.a.o,_bs.a.q,_bs.a.s,_bs.a.p,_bs.a.r);f=!0;break;case"PersonaBusinessHomePages":n.BusinessHomePagesArray=_bs.a.a(r,n.BusinessHomePagesArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);break;case"PersonaPersonalHomePages":n.PersonalHomePagesArray=_bs.a.a(r,n.PersonalHomePagesArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);break;case"PersonaOfficeLocations":n.OfficeLocationsArray=_bs.a.a(r,n.OfficeLocationsArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);break;case"PersonaImAddresses":n.ImAddressesArray=_bs.a.a(r,n.ImAddressesArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);(n.ImAddress===i.OldValue||_j.h.b(n.ImAddress)&&_j.h.b(i.OldValue))&&(n.ImAddress=i.NewValue);break;case"PersonaBusinessAddresses":n.BusinessAddressesArray=_bs.a.a(r,n.BusinessAddressesArray,i.OldValue,i.NewValue,_bs.a.x,"Business",_bs.a.y,_bs.a.B,_bs.a.D,_bs.a.A,_bs.a.C);break;case"PersonaHomeAddresses":n.HomeAddressesArray=_bs.a.a(r,n.HomeAddressesArray,i.OldValue,i.NewValue,_bs.a.x,"Home",_bs.a.y,_bs.a.B,_bs.a.D,_bs.a.A,_bs.a.C);break;case"PersonaOtherAddresses":n.OtherAddressesArray=_bs.a.a(r,n.OtherAddressesArray,i.OldValue,i.NewValue,_bs.a.x,"Other",_bs.a.y,_bs.a.B,_bs.a.D,_bs.a.A,_bs.a.C);break;case"PersonaTitles":n.TitlesArray=_bs.a.a(r,n.TitlesArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);(n.Title===i.OldValue||_j.h.b(n.Title)&&_j.h.b(i.OldValue))&&(n.Title=i.NewValue);break;case"PersonaDepartments":n.DepartmentsArray=_bs.a.a(r,n.DepartmentsArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);(n.Department===i.OldValue||_j.h.b(n.Department)&&_j.h.b(i.OldValue))&&(n.Department=i.NewValue);break;case"PersonaCompanyNames":n.CompanyNamesArray=_bs.a.a(r,n.CompanyNamesArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);if(n.CompanyName===i.OldValue||_j.h.b(n.CompanyName)&&_j.h.b(i.OldValue)){n.CompanyName=i.NewValue;n.CompanyNameSortKey=null}break;case"PersonaManagers":n.ManagersArray=_bs.a.a(r,n.ManagersArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);break;case"PersonaAssistantNames":n.AssistantNamesArray=_bs.a.a(r,n.AssistantNamesArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);break;case"PersonaProfessions":n.ProfessionsArray=_bs.a.a(r,n.ProfessionsArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);break;case"PersonaBodies":n.BodiesArray=_bs.a.a(r,n.BodiesArray,i.OldValue,i.NewValue,_bs.a.H,null,_bs.a.I,_bs.a.Q,_bs.a.U,_bs.a.L,_bs.a.S);break;case"PersonaSpouseNames":n.SpouseNamesArray=_bs.a.a(r,n.SpouseNamesArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);break;case"PersonaChildren":n.ChildrenArray=_bs.a.a(r,n.ChildrenArray,i.OldValue,i.NewValue,_bs.a.J,null,_bs.a.K,_bs.a.R,_bs.a.V,_bs.a.M,_bs.a.T);break;case"PersonaHobbies":n.HobbiesArray=_bs.a.a(r,n.HobbiesArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);break;case"PersonaSchools":n.SchoolsArray=_bs.a.a(r,n.SchoolsArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);break;case"PersonaWeddingAnniversariesLocal":n.WeddingAnniversariesLocalArray=_bs.a.a(r,n.WeddingAnniversariesLocalArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);break;case"PersonaBirthdaysLocal":n.BirthdaysLocalArray=_bs.a.a(r,n.BirthdaysLocalArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);break;case"PersonaLocations":n.LocationsArray=_bs.a.a(r,n.LocationsArray,i.OldValue,i.NewValue,_bs.a.b,null,_bs.a.c,_bs.a.e,_bs.a.g,_bs.a.d,_bs.a.f);(n.Location===i.OldValue||_j.h.b(n.Location)&&_j.h.b(i.OldValue))&&(n.Location=i.NewValue);break;case"PersonaType":(n.PersonaTypeString===i.OldValue||_j.h.b(n.PersonaTypeString)&&_j.h.b(i.OldValue))&&(n.PersonaTypeString=i.NewValue);break;default:break}}if(u){dt||(n.DisplayName=_gg.e.c(n.DisplayNamePrefix,n.GivenName,n.MiddleName,n.Surname,n.Generation,n.YomiFirstName,n.YomiLastName));n.FileAs=_gg.e.e(n.FileAsId,n.GivenName,n.MiddleName,n.Surname,n.Generation,n.DisplayName,n.CompanyName)}if(f){var e=[];if(n.Emails1Array)for(var ft=n.Emails1Array,wi=ft.length,l=0;l<wi;++l){var ct=ft[l];var bi=ct.Value.Name===ni;_bs.a.v(e,ct,bi)}if(n.Emails2Array)for(var lt=n.Emails2Array,vi=lt.length,v=0;v<vi;++v){var at=lt[v];var gi=at.Value.Name===ii;_bs.a.v(e,at,gi)}if(n.Emails3Array)for(var ht=n.Emails3Array,di=ht.length,a=0;a<di;++a){var et=ht[a];var ki=et.Value.Name===ti;_bs.a.v(e,et,ki)}if(e.length>0){for(var p=new Array(e.length),h=0;h<e.length;++h)p[h]=e[h];n.EmailAddresses=p;n.EmailAddress=p[0]}}if(u||f||s){var k;var w;var ot,st;_gg.e.d(n.GivenName,n.MiddleName,n.Surname,n.DisplayName,n.CompanyName,n.EmailAddress,n.MobilePhonesArray,n.HomePhonesArray,n.BusinessPhoneNumbersArray,n.OtherTelephonesArray,_bs.a.O,_bs.a.N,ot={val:k},st={val:w}),k=ot.val,w=st.val;n.DisplayNameFirstLast=k;n.DisplayNameLastFirst=w;n.DisplayNameFirstLastSortKey=null;n.DisplayNameLastFirstSortKey=null;n.DisplayNameFirstLastHeader=_bs.a.u;n.DisplayNameLastFirstHeader=_bs.a.u}};_bs.a.P=function(n){var t=null;n&&n.length>0&&n[0].Value&&!_j.h.b(n[0].Value.Number)&&(t=n[0].Value.Number);return t};_bs.a.O=function(n){var t=null;n&&!_j.h.b(n.EmailAddress)&&(t=n.RoutingType.toUpperCase()==="EX"?n.OriginalDisplayName:n.EmailAddress);return t};_bs.a.N=function(n){if(Array.isInstanceOfType(n)){var t=n;return _bs.a.P(t)}return null};_bs.a.v=function(n,t,i){(_j.F.a(t.Value.Name)||i)&&(t.Value.Name=t.Value.EmailAddress);_j.F.a(t.Value.RoutingType)&&(t.Value.RoutingType="SMTP");Array.add(n,t.Value)};_bs.a.b=function(n,t){return new _dg.p(n)};_bs.a.c=function(n){for(var i=new Array(n.length),t=0;t<n.length;++t)i[t]=n[t];return i};_bs.a.e=function(n){return n.Value};_bs.a.g=function(n,t,i){n.Value=t};_bs.a.d=function(n){return n.Attributions};_bs.a.f=function(n,t){n.Attributions=t};_bs.a.J=function(n,t){var i=new _g.dM;i.Values=n.split(",;");return i};_bs.a.K=function(n){for(var i=new Array(n.length),t=0;t<n.length;++t)i[t]=n[t];return i};_bs.a.R=function(n){return n.Values.join(", ")};_bs.a.V=function(n,t,i){n.Values=t.split(",;")};_bs.a.M=function(n){return n.Attributions};_bs.a.T=function(n,t){n.Attributions=t};_bs.a.h=function(n,t){return new _dg.u(new _g.o(n,t))};_bs.a.i=function(n){for(var i=new Array(n.length),t=0;t<n.length;++t)i[t]=n[t];return i};_bs.a.k=function(n){return n.Value.Number};_bs.a.m=function(n,t,i){var r=n.Value.Type;n.Value=new _g.o(t,r)};_bs.a.j=function(n){return n.Attributions};_bs.a.l=function(n,t){n.Attributions=t};_bs.a.n=function(n,t){var i=new _dg.bb;i.Value=n;return i};_bs.a.o=function(n){for(var i=new _j.q,t=0;t<n.length;++t){var r=_bs.a.E(n[t]);_bs.a.t(r)||i.c(n[t])}return i.d.length>0?i.i():null};_bs.a.q=function(n){return _bs.a.E(n)};_bs.a.E=function(n){var t=new _g.f;t.Name=n.Value.Name;t.EmailAddress=n.Value.EmailAddress;t.RoutingType=n.Value.RoutingType;t.OriginalDisplayName=n.Value.OriginalDisplayName;return t};_bs.a.s=function(n,t,i){n.Value||(n.Value=new _g.f);var r=t;var u=i;switch(u){case 1:n.Value.Name=r.Name;break;case 2:n.Value.OriginalDisplayName=r.OriginalDisplayName;break;case 0:n.Value.EmailAddress=r.EmailAddress;if(n.Value.EmailAddress===""){n.Value.Name="";n.Value.RoutingType=""}break;default:throw Error.notImplemented("Invalid enum type: "+u);}};_bs.a.p=function(n){return n.Attributions};_bs.a.r=function(n,t){n.Attributions=t};_bs.a.x=function(n,t){var i=_g.bS.c(n,t);return new _dg.bf(i)};_bs.a.y=function(n){for(var i=new Array(n.length),t=0;t<n.length;++t)i[t]=n[t];return i};_bs.a.B=function(n){var t=n.Value;return _g.bS.a(t.Street,t.City,t.State,t.PostalCode,t.Country)};_bs.a.D=function(n,t,i){var r=_g.bS.c(t,n.Value.Type);n.Value=r};_bs.a.A=function(n){return n.Attributions};_bs.a.C=function(n,t){n.Attributions=t};_bs.a.H=function(n,t){var i=new _g.s("Text",n);return new _dg.bA(i)};_bs.a.I=function(n){for(var i=new Array(n.length),t=0;t<n.length;++t)i[t]=n[t];return i};_bs.a.Q=function(n){return n.Value.Value};_bs.a.U=function(n,t,i){var r=new _g.s("Text",t);n.Value=r};_bs.a.L=function(n){return n.Attributions};_bs.a.S=function(n,t){n.Attributions=t};_bs.a.a=function(n,t,i,r,u,f,e,o,s,h,c){var l=[];if(t&&t.length)for(var vt=t,pt=vt.length,rt=0;rt<pt;++rt){var a=vt[rt];var k=o(a);var lt=h(a);if(_bs.a.t(k)&&_bs.a.t(i)||_bs.a.G(i,k,f)){for(var it=!1,tt=!1,at=lt,yt=at.length,d=0;d<yt;++d){var bt=at[d];Array.contains(n,bt)?it=!0:tt=!0}if(it&&!tt){if(!_bs.a.F(r)){s(a,r,f);Array.add(l,a)}}else if(it&&tt){for(var et=u(r,f),ct=u(k,f),w=[],p=[],ft=lt,wt=ft.length,g=0;g<wt;++g){var nt=ft[g];Array.contains(n,nt)?Array.add(w,nt):Array.add(p,nt)}for(var ut=new Array(w.length),y=0;y<w.length;++y)ut[y]=w[y];c(et,ut);for(var ot=new Array(p.length),v=0;v<p.length;++v)ot[v]=p[v];c(ct,ot);_bs.a.F(r)||Array.add(l,et);Array.add(l,ct)}else Array.add(l,a)}else Array.add(l,a)}else if(!_bs.a.t(r)){for(var st=u(r,f),ht=new Array(n.length),b=0;b<n.length;++b)ht[b]=n[b];c(st,ht);Array.add(l,st)}t=l.length>0?e(l):null;return t};_bs.a.G=function(n,t,i){if(!_j.F.a(n)&&!_j.F.a(t)){if(String.isInstanceOfType(n))return t===n;if(_g.n.b(n)){var u=n;var r=t;var f=i;switch(f){case 0:return _j.h.b(u.EmailAddress)&&_j.h.b(r.EmailAddress)?!0:r.EmailAddress===u.EmailAddress;case 1:return _j.h.b(u.Name)&&_j.h.b(r.Name)?!0:r.Name===u.Name;case 2:return _j.h.b(u.OriginalDisplayName)&&_j.h.b(r.OriginalDisplayName)?!0:r.OriginalDisplayName===u.OriginalDisplayName;default:throw Error.notImplemented("Invalid enum type: "+f);}}throw Error.notImplemented("Unimplemented object type "+Object.getType(n).toString());}return!1};_bs.a.t=function(n){if(_j.F.a(n))return!0;if(String.isInstanceOfType(n))return _j.h.b(n);if(_g.n.b(n))return _j.h.b(n.EmailAddress)&&_j.h.b(n.Name);throw Error.notImplemented("Unimplemented object type "+Object.getType(n).toString());};_bs.a.F=function(n){if(String.isInstanceOfType(n))return _bs.a.t(n)||n===_g.bS.b;if(_g.n.b(n))return _j.F.a(n);throw Error.notImplemented("Unimplemented object type "+Object.getType(n).toString());};_bs.cQ=function(n,t,i,r){_bs.cQ.$$(this.$$gta["_bs.cQ"].TActionContext).initializeBase(this,[n,t]);this.i=i;this.e=r};_bs.cQ.$$=function(n){var u=_bs.__tc=_bs.__tc||{};var t="cQ"+"$"+n.getName().replace(/\./g,"_");if(!u[t]){var r=u[t]=function(){for(var t=[],n=0;n<arguments.length;++n)t[n]=arguments[n];_bs.cQ.apply(this,t)};var h=_bs.cP.$$(n);r.registerClass("_bs.__tc."+t,h);var o={"_bs.cQ":{TActionContext:n},ctor:_bs.cQ};var c=h.prototype.$$gta;for(var l in c){var s={key:l,value:c[l]};o[s.key]=s.value}r.prototype.$$gta=o;var f=_bs.cQ.prototype;for(var e in f){var i={key:e,value:f[e]};"constructor"!==i.key&&(r.prototype[i.key]=i.value)}}return u[t]};_bs.cQ.prototype={i:null,b:null,e:null};_bs.bw=function(n,t,i,r,u,f){_bs.bw.initializeBase(this,[n,t,i,u]);_a.b.b(i,"propertyUpdates");_a.b.b(r,"parentFolder");_a.b.b(n.personaId,"actionContext.PersonaId");_a.b.c(n.personaId.Id,"actionContext.PersonaId.Id");this.k=r;this.m=f};_bs.bw.prototype={k:null,m:null,d:null,l:function(){return"CreatePersona"},bK:function(n,t,i){if(this.e===_bs.a.z){i(-1);return}var u=this.k.BaseFolderId;if(_g.r.isInstanceOfType(u)){var r=this;this.m.a(2,new _a.cp,function(f){if(f){var e=u.Id;_bs.I.a(r.c.c(),e,function(u){if(u){r.d=u.get_data().FolderId;r.g(n,t,i)}else{_j.e.b(_bs.bw.a,"Couldn't find a folder with the distinguished id '{0}', so reject this command.",e);i(-1)}},function(n){_j.e.c(_bs.bw.a,"Couldn't find a folder with the distinguished id because of failure: '{0}'",n.a());t(n.b())})}else{_j.e.b(_bs.bw.a,"Couldn't find a folder with the distinguished id because folder hierarchy wasn't synced.");i(-1)}})}else{this.d=u;this.g(n,t,i)}},bL:function(n,t,i){var r=new _g.bW;r.PersonaId=this.a.personaId;r.PersonaTypeString="Person";r.FolderIds=[this.d];this.a.createPersonaUnderMyContactsFolder&&Array.add(r.FolderIds,_g.m.d("mycontacts"));r.CreationTimeString=_a.d.d(_a.d.a());r.DisplayNameFirstLastHeader=_bs.a.u;r.DisplayNameLastFirstHeader=_bs.a.u;r.FileAsId="LastCommaFirst";var u=new _g.cq("0",new _g.e(this.a.personaId.Id),"Outlook");u.IsWritable=!0;u.IsQuickContact=!1;u.IsHidden=!1;u.FolderId=null;r.AttributionsArray=[u];_bs.a.w(r,this.i);var f=this,o=this,e=this;this.h(function(n){var t=_bs.A.a(f.c);t.l(n,r,function(){t.b(n,r,0,null)});f.b=r},function(){n()},function(n){_bs.b.a(n,function(n){t(n)})})}};_bs.cb=function(n,t,i,r){_bs.cb.initializeBase(this,[n,t]);_a.b.b(i,"personaId");this.b=i;this.d=r};_bs.cb.prototype={b:null,d:null,l:function(){return"DeletePersona"},bK:function(n,t,i){var r=this;this.d.a(8,new _a.cp,function(u){if(u)r.g(n,t,i);else{_j.e.b(_bs.cb.a,"Couldn't find the persona because people module wasn't synced.");i(-1)}})},bL:function(n,t,i){var r=this,f=this,u=this;this.h(function(n){var t=_bs.A.a(r.c);t.c(n,r.b,function(i){i?t.a(n,i.PersonaId):_a.bO.a(2,"PersonaId to delete is not present in persona store")},null)},function(){n()},function(n){_bs.b.a(n,t)})}};_bs.bk=function(n,t,i){_bs.bk.initializeBase(this,[n,t,i,i.Body.AttachmentIds.length]);this.i=new Array(this.o);this.e=new _gg.gh;this.e.Header=_bs.B.a;this.e.Body.ResponseMessages=new _gg.k;this.e.Body.ResponseMessages.Items=this.i};_bs.bk.prototype={e:null,i:null,l:function(){return"DeleteAttachment"},bK:function(n,t,i){this.g(n,t,i)},bJ:function(n,t,i,r){var e=this.a.itemContexts[n];if(e.clientStoreItem===2){var u=new _gg.gj;u.ResponseCode="NoError";u.ResponseClass="Success";var f=e.parentItemId;u.RootItemId=new _gg.js;u.RootItemId.RootItemId=f.Id;u.RootItemId.RootItemChangeKey=f.ChangeKey;this.i[n]=u;var o=this,h=this,s=this;this.h(function(t){o.c.a().d(t,_bs.d.a(f.Id),function(t){if(_j.F.a(t)){_j.e.b(_bs.bk.a,"Message with id {0} not found in local store",f.Id);return}o.k(t,o.b.Body.AttachmentIds[n].Id,e)})},function(){t()},function(n){_bs.b.a(n,i)})}else{_j.e.b(_bs.bk.a,"ClientStoreItem type {0} is not supported.",e.clientStoreItem);t();return}},k:function(n,t,i){var r=n;if(!r.Attachments){_j.e.b(_bs.bk.a,"Item with id {0} has no attachments in local store",r.ItemId.Id);return}var u=this.m(r,t);i.deletedAttachment=u;if(!u){_j.e.b(_bs.bk.a,"Attachment with id {0} not found on item with id {1} in local store",t,r.ItemId.Id);return}if(!r.Attachments.length){r.Attachments=undefined;r.HasAttachments=!1}},m:function(n,t){for(var u=n.Attachments,f=u.length,i=0;i<f;++i){var r=u[i];if(r.AttachmentId.Id===t){Array.remove(n.Attachments,r);return r}}return null}};_bs.F=function(n,t,i){_bs.F.initializeBase(this,[n,t,i,i.Body.ItemIds.length])};_bs.F.prototype={e:!1,i:0,l:function(){return"DeleteItem"},bK:function(n,t,i){if(this.a.clientStoreItem){var r=this;this.g(function(){r.e?i(-1):n()},t,i)}else{_j.e.a(_bs.F.a,"ClientStoreItem.None was passed. Request will be sent to the server.");n()}},bJ:function(n,t,i,r){if(this.e){t();return}var f=this.b.Body.ItemIds[n];if(this.a.clientStoreItem===2){var u=f;_j.e.a(_bs.F.a,"Step {0} called for delete message item with id {1}",n.toString(),u.Id);var o=this,e=this;this.r(u,function(){_j.e.a(_bs.F.a,"Successfully deleted message with id {0} from client store.",u.Id);t()},function(n){i(n)})}else if(this.a.clientStoreItem===1){_j.e.a(_bs.F.a,"Step {0} called for deleting an calendar item",n.toString());this.n(f,t,i)}else{_j.e.b(_bs.F.a,"ClientStoreItem {0} is not supported.",this.a.clientStoreItem);t()}},n:function(n,t,i){if(n.__type!==_g.e._dataContractName&&n.__type!==_g.bm._dataContractName){this.e=!0;this.i=14;t();return}var r=this,u=this,f=this;this.h(function(t){if(n.__type===_g.bm._dataContractName)r.p().d(t,n,function(n){_bs.Q.a(t,r.c.f(),n,function(i){if(!i||!i.get_data()){_j.e.b(_bs.F.a,"DeleteCalendarItem - Calendar master item with uid {0} could not be found in client store.",n);r.e=!0;return}_j.e.a(_bs.F.a,"DeleteCalendarItem - Calendar master item with uid {0} found in client store. Deleting it.",n);r.k(t,i)})},function(){r.e=!0});else{var u=n;var i=_bs.d.a(u.Id);r.a.isReferencedItemRecurringMaster?r.m(_bc.u,t,i,r.c.f()):r.m(_bc.t,t,i,r.c.b())}},function(){if(n.__type===_g.bm._dataContractName)_j.e.a(_bs.F.a,"Successfully deleted calendar master, occurrences, exceptions and reminders with from master of occurrence with id {0} from local store.",n.OccurrenceId);else{var i=n;u.a.isReferencedItemRecurringMaster?_j.e.a(_bs.F.a,"Successfully deleted calendar master, occurrences, exceptions and reminders with from calendar master with id {0} from local store.",i.Id):_j.e.a(_bs.F.a,"Successfully deleted calendar item and reminder with id {0} from local store.",i.Id)}t()},function(n){i(new _bs.b(new _a.bO(0,n.a)))})},m:function(n,t,i,r){var u=this;r.bindIn(t,i,function(r){if(!r||!r.get_data()){_j.e.b(_bs.F.a,"Calendar item (type: {0}) with id {1} could no be found in client store.",n.getName(),i);u.e=!0;return}_j.e.a(_bs.F.a,"Calendar item (type: {0}) with id {1} found in client store. Deleting it.",n.getName(),r.a());u.k(t,r)},null)},k:function(n,t){if(t.get_data().IsMeeting){_j.e.a(_bs.F.a,"Offline delete calendar item with id {0} was rejected because it's a meeting. Request will go directly to the server.",t.a());this.e=!0;this.i=5;return}this.p().a(n,t.a(),t.get_data())},r:function(n,t,i){var r=this,u=this;this.h(function(t){r.t().d(t,r.q(),r.b.Body.DeleteType,n,_g.m.d("deleteditems"),_g.k.a)},function(){t()},_bs.b.b(i))}};_bs.bb=function(n,t,i,r,u){_bs.bb.initializeBase(this,[n,t,i,i.Body.FolderIds.length]);_a.b.b(r,"folderMappings");_a.b.b(u,"syncManager");this.m=r;this.n=u};_bs.bb.c=function(n,t,i,r){if(t&&t.explicitLogonUser){_j.e.a(_bs.bb.a,"Not-supported: Offline EmptyFolder only supports primary mailbox, other mailbox calls are not supported.");i.val=307;r.val=17;return!1}if(!t.b){_j.e.a(_bs.bb.a,"Not-supported: Offline EmptyFolder currently only supports conversation view.");i.val=312;r.val=20;return!1}i.val=-1;r.val=0;return!0};_bs.bb.b=function(n,t){for(var i=null,f=t,e=f.length,r=0;r<e;++r){var u=f[r];if(u.FolderId.Id===n.Id){i=u;break}}return i&&!_j.h.a(i.LastSuccessfulSyncTime)?_a.d.b(i.LastSuccessfulSyncTime):null};_bs.bb.prototype={m:null,n:null,e:0,i:-1,l:function(){return"EmptyFolder"},bK:function(n,t,i){var f,u,r;(r=_bs.bb.c(this.b.Body,this.a,f={val:this.i},u={val:this.e}),this.i=f.val,this.e=u.val,r)?this.g(n,t,i):this.k(i,this.i,this.e)},bJ:function(n,t,i,r){var e=this.b.Body.FolderIds[n];_a.b.a(e,"FolderId for current step cannot be null");var u=null;if(_g.r.isInstanceOfType(e)){var o=e;u=this.m.nameToId(o.Id)}else u=e;_a.b.d(!!u,"[EmptyFolder::ExecuteCurrentStep] currentFolderId should not be null.");var f=this;this.n.i(4,new _bc.i(u),function(n,e){_j.e.a(_bs.bb.a,"Offline EmptyFolder only supports synced folders.");if(n){var o=_bs.bb.b(u,e);_j.e.a(_bs.bb.a,"[EmptyFolder::ExecuteCurrentStep] folderLastSyncTime = '{0}'",o?o.toString():"null");if(o){f.b.Body.ClientLastSyncTime=o.i();f.r(u,t,i,r)}else{_j.e.c(_bs.bb.a,"[EmptyFolder::ExecuteCurrentStep] folderLastSyncTime is null for synced folder '{0}'.",u.Id);f.k(r,301,19)}}else{_j.e.a(_bs.bb.a,"[EmptyFolder::ExecuteCurrentStep] Offline EmptyFolder service command only supports synced folders.");f.k(r,301,18)}})},k:function(n,t,i){this.i=t;this.e=i;n(this.i)},r:function(n,t,i,r){var u=this,f=this;this.O(new _e.a("EmptyFolder.EmptyFolderInClientStore",!1),function(t){u.a.b?u.c.d().f(t,new _e.b(ConversationItemMetadata.b(),n.Id),function(){u.s(n,t)}):u.k(r,312,20)},function(){t()},_bs.b.b(i))},s:function(n,t){var i=this;this.c.c().bindIn(t,_bs.d.a(n.Id),function(n){if(n){var i=n.get_data();i.TotalCount=0;i.UnreadCount=0;n.b(t,null)}},null)}};_bs.L=function(n,t,i,r){_bs.L.initializeBase(this,[n,t,i]);_a.b.a(i.Body.ParentFolderId,"ParentFolderId");_a.b.a(i.Body.Paging,"Paging");_a.b.b(r,"syncManager");this.n=r;this.d=new _g.ep;this.d.Header=_bs.B.a;this.d.Body=new _g.er};_bs.L.$$cctor=function(){_bs.cP.$$(_g.bU).b("FindConversation")};_bs.L.prototype={n:null,d:null,k:null,m:!1,e:-1,l:function(){return"FindConversation"},bK:function(n,t,i){var f,u;if(!(u=_g.bU.b(this.b.Body,this.a,f={val:this.e}),this.e=f.val,u)){_j.e.a(_bs.L.a,"Not-supported: Request contains query string or view filter or explicit logon or from filter. rejectCode=",this.e);i(this.e);return}this.k=this.bM(this.b.Body.ParentFolderId.BaseFolderId);var r=this;this.g(function(){if(r.m){_j.e.a(_bs.L.a,"Client store unable to fulfil request. Forwarding request to the server.");i(r.e)}else n()},t,i)},bL:function(n,t,i){var r=this;this.r(4,new _bc.i(this.k),function(i,u){var f=null;var o,e;if(!i||!(e=r.s(r.b.Body,u,o={val:f}),f=o.val,e)){r.m=!0;r.e=i?100:301;_j.e.a(_bs.L.a,"Rejecting the request to the server with RejectCode {0}",r.e);n();return}_j.e.a(_bs.L.a,"FindConversationAction is trying to use client store to get {0} rows",r.b.Body.Paging.MaxEntriesReturned);r.c.d().getConversations(r.k.Id,r.b.Body,r.a,f,function(t,i,u){_j.e.a(_bs.L.a,"Obtained {0} conversations from the clientstore.  MoreItemsOnServer = {1}, IsConnected = {2}",t.length,f.MoreItemsOnServer,r.i());var e=r.b.Body.Paging.MaxEntriesReturned;if(t.length<e&&f.MoreItemsOnServer&&r.i()||!t.length&&f.MoreItemsOnServer){_j.e.a(_bs.L.a,"The client store was requested {0} rows but returned only {1} AND there are more changes on the server. Hence, rejecting the request to the server.",e,t.length);r.m=!0;r.e=302;n();return}_j.e.a(_bs.L.a,"FindConversationAction is returning {0} rows from client store. TotalConversationsInView={1}, indexOffset={2}",t.length,f.TotalConversationsInView,u);r.o(t,f.TotalConversationsInView,u);n()},function(n){r.j(r.d.Body,n,t)})})},r:function(n,t,i){this.n.i(n,t,i)},i:function(){return _g.k.a.n.a},s:function(n,t,i){i.val=null;for(var u=!0,s=t,l=s.length,e=0;e<l;++e){var o=s[e];if(o.FolderId.Id===this.k.Id){i.val=o;break}}if(i.val)if(_g.J.isInstanceOfType(n.Paging)){var r=n.Paging;if(r.MaxEntriesReturned<=0||r.BasePoint!=="Beginning"||r.Offset+r.MaxEntriesReturned>i.val.SyncMinimum&&this.i()){_j.e.a(_bs.L.a,"Non-supported IndexedPageView paging values. Offset={0}, MaxEntriesReturned={1}, BasePoint={2}, SyncMinimum={3}, IsConnected={4}",r.Offset,r.MaxEntriesReturned,r.BasePoint,i.val.SyncMinimum,this.i());u=!1}}else if(_g.be.isInstanceOfType(n.Paging)){var f=n.Paging;if(f.MaxEntriesReturned<=0||f.MaxEntriesReturned>i.val.SyncMinimum&&this.i()){_j.e.a(_bs.L.a,"Non-supported SeekToConditionPageView paging values. MaxEntriesReturned={0}, BasePoint={1}, SyncMinimum={2}, IsConnected={3}",f.MaxEntriesReturned,f.BasePoint,i.val.SyncMinimum,this.i());u=!1}else if(f.BasePoint==="Beginning"){var h=this.c.d().p(i.val);var c=_a.d.b(this.a.itemLastDeliveryTime).h();if(c<h.h()){_j.e.a(_bs.L.a,"Requested item's last delivery time [{0}] is less than the oldest synced item's last delivery time [{1}]. Rejecting the request.",this.a.itemLastDeliveryTime,h);u=!1}}}else{_j.e.a(_bs.L.a,"Non-supported paging type. PagingType={0}",n.Paging);u=!1}else{_j.e.a(_bs.L.a,"Could not find the conversation view data for the folder specified");u=!1}return u},o:function(n,t,i){this.d.Body.ResponseCode="NoError";this.d.Body.ResponseClass="Success";this.d.Body.Conversations=n;this.d.Body.TotalConversationsInView=t;this.d.Body.IndexedOffset=i}};_bs.be=function(n,t,i,r,u,f){_bs.be.initializeBase(this,[n,t,i,i.Body.ParentFolderIds.length]);_a.b.b(r,"syncManager");_a.b.b(u,"folderMappings");_a.b.b(f,"sessionSettings");this.r=r;this.i=u;this.m=f;this.k=new Array(this.o);this.e=new _g.es;this.e.Header=_bs.B.a;this.e.Body.ResponseMessages=new _gg.k;this.e.Body.ResponseMessages.Items=this.k};_bs.be.prototype={r:null,i:null,e:null,k:null,n:!1,m:null,l:function(){return"FindFolder"},bK:function(n,t,i){var r=this;this.r.a(2,new _a.cp,function(u){if(u){var f=r.b.Body.Traversal;if(f!=="Deep"&&f!=="Shallow"){_j.e.a(_bs.be.a,"Rejecting request: FindFolder requested with unsupported traversal {0}.",f);i(-1)}else r.g(function(){r.n?i(-1):n()},t,i)}else i(-1)})},bJ:function(n,t,i,r){var f=this.b.Body.ParentFolderIds[n];if(!this.A(f)){_j.e.a(_bs.be.a,"Not-supported: Request with DistinguishedFolderId.");this.n=!0;t();return}if(_g.r.isInstanceOfType(f)){var s=f.Id;var o=String.format("Failed to find distinguished folder with id '{0}'",s);_j.e.c(_bs.be.a,o);i(new _bs.b(new _a.bO(2,o)))}else{var e=f.Id;var u=new _g.fG;u.ResponseCode="NoError";u.ResponseClass="Success";u.RootFolder=new _g.fD;this.k[n]=u;this.b.Body.Traversal==="Shallow"?this.z(e,this.c.r(),u,t,i):this.b.Body.Traversal==="Deep"&&this.w(e,this.c.r(),u,t,i)}},z:function(n,t,i,r,u){_j.e.a(_bs.be.a,"Processing FindFolder with shallow traversal for folder {0} in client store.",n);var e=this,f=this;t.l(n,function(t){e.v(n,i,r,u,t)},function(n){f.j(i,n,u)})},w:function(n,t,i,r,u){_j.e.a(_bs.be.a,"Processing FindFolder with deep traversal for folder {0} in client store.",n);if(this.i.doesIdEqualName(new _g.l(n),"msgfolderroot")){_j.e.a(_bs.be.a,"Processing FindFolder with deep traversal for msgfolderroot in client store.");var e=this,o=this;t.g(function(n){var t=n[0].get_data();Array.removeAt(n,0);e.s(i,n,t);r()},function(n){o.j(i,n,u)})}else{var f="Deep traversal is supported only for msgrootFolder. Actual folderId = "+n;_j.e.c(_bs.be.a,f);u(new _bs.b(new _a.bO(1,f)))}},v:function(n,t,i,r,u){var f=this,o=this,e=this;this.h(function(i){f.c.c().bindIn(i,_bs.d.a(n),function(i){if(!i){_j.e.b(_a.a.bc,"Could not find folder with id = {0} in the ClientStore",n);return}f.s(t,u,i.get_data())},null)},function(){i()},function(n){t.ResponseCode="ErrorDataSourceOperation";t.ResponseClass="Error";t.MessageText=n.a;_bs.b.a(n,r)})},s:function(n,t,i){for(var u=n.RootFolder.Folders,r=0;r<t.length;++r)u[u.length]=t[r].get_data();n.RootFolder.ParentFolder=i},A:function(n){if(_g.r.isInstanceOfType(n)){var t=n;var r=t.Id;if(r==="archivemsgfolderroot"||t.Mailbox&&this.m&&t.Mailbox.EmailAddress!==this.m.bD.UserEmailAddress)return!1}else if(this.i.doesIdEqualName(n,"archivemsgfolderroot"))return!1;else{var i=n;if(i&&_a.ce.e(i.Id))return!1}return!0}};_bs.m=function(n,t,i,r,u){_bs.m.initializeBase(this,[n,t,i]);_a.b.b(r,"syncManager");_a.b.b(u,"folderMappings");this.s=r;this.o=u;this.i=new _g.et;this.i.Header=_bs.B.a;this.i.Body.ResponseMessages=new _gg.k;this.i.Body.ResponseMessages.Items=new Array(1);this.n=-1};_bs.m.$$cctor=function(){_bs.cP.$$(_g.br).b("FindItem")};_bs.m.c=function(n,t){var u=n;var r=t;var f=u.y();var e=r.y();var i=f.k(e);if(i)return i;!(u.n>24)&&r.n>24?i=1:u.n>24&&!(r.n>24)&&(i=-1);if(i)return i;i=r.z()-u.z();return i?i:f.b(e)};_bs.m.d=function(n,t,i,r){for(var e=n.length,o=e>0?n[e-1]:null,s=t.length,u=i;u<s;u++){var f=t[u];if(o&&f.u().localeCompare(o.k.Start)<=0)_ff.s.b(n,f,_bs.m.c);else if(n.length<r)Array.add(n,f);else break}};_bs.m.prototype={s:null,o:null,i:null,d:null,e:"none",k:!1,r:!1,n:0,l:function(){return"FindItem"},J:function(){return _g.br.d(this.b.Body)},bK:function(n,t,i){var s=_j.n.b(_a.a.cn,517,"FindItemCheckAndExecute-Preprocessing");var f=this;var u=function(){f.g(function(){f.r?i(f.n):n()},t,i)};if(this.R())if(_dg.K.isInstanceOfType(this.b.Body.Paging)){var r=this.b.Body.Paging;var o=new _bs.bo(this.d.Id,r.StartDate,r.EndDate);var h=this;this.L(10,o,function(n){if(n){_j.n.a(s);_j.e.a(_bs.m.a,"Processing the request by the offline store as the calendar module is synced.");u()}else{_j.e.a(_bs.m.a,"Rejecting the call as the calendar folder is not synced OR the date range is not synced. FolderId='{0}', StartDate={1}, EndDate={2}, ",h.d.Id,r.StartDate,r.EndDate);i(o.a)}})}else if(this.k&&this.e==="calendar")if(_dg.w.isInstanceOfType(this.b.Body.Paging)){_j.n.a(s);_j.e.a(_bs.m.a,"Processing the request by the offline store as the view is offline-only.");u()}else{var e=String.format("{0} isn't supported for calendar folders.",Object.getType(this.b.Body.Paging));_j.e.a(_bs.m.a,e);t(Error.invalidOperation(e))}else if(this.J())u();else{_j.e.a(_bs.m.a,"Rejecting the call as it is not supported in the client store");i(100)}else{_j.e.b(_bs.m.a,"Rejecting the call as parent folder id is not valid.");i(317)}},bL:function(n,t,i){var r=new _g.fJ;r.ResponseCode="NoError";r.ResponseClass="Success";r.RootFolder=new _g.fH;this.i.Body.ResponseMessages.Items[0]=r;var u=this.b.Body.Paging;if(_dg.K.isInstanceOfType(u))this.B(r,n,t);else if(this.k&&this.e==="calendar"&&_dg.w.isInstanceOfType(this.b.Body.Paging))this.H(r,n,t);else if(_g.br.e(u)||_g.br.f(u)){_j.e.a(_bs.m.a,"FindItem for {0} paging is using client store",Object.getType(u));if(this.k)if(this.e==="outbox")this.I(r,n,t);else if(this.e==="calendar")throw Error.invalidOperation("FindItem with IndexedPageView isn't supported for calendar folders.");else this.v(r,n,t);else this.v(r,n,t)}else{var f=String.format("FindItem called with invalid folder ID and paging. FID={0}, Paging={1}",this.d.Id,Object.getType(u));throw Error.invalidOperation(f);}},L:function(n,t,i){this.s.a(n,t,i)},P:function(n,t,i){this.s.i(n,t,i)},m:function(){return _g.k.a.n.a},R:function(){var i=!1;var n=_g.br.b(this.b.Body);if(_g.r.isInstanceOfType(n)){var t=n;if(t.Mailbox)_j.e.a(_bs.m.a,"This is a mailbox-specific call for ('{0}'). Multiple mailboxes are not supported in offline.",t.Mailbox.EmailAddress);else{this.d=this.o.nameToId(t.Id);this.e=t.Id;this.k=!0;i=!0;_j.e.a(_bs.m.a,"Converted distinguished folder id '{0}' to actual folder id '{1}'",this.e,this.d.Id)}}else if(_g.l.isInstanceOfType(n)){this.d=n;if(this.d.Id){var r=this.o.idToName(this.d);if(r!==_g.ba.a){this.e=r;this.k=!0}}i=!0}else _j.e.b(_bs.m.a,"FolderId {0} is not of a known folder type.",n);return i},H:function(n,t,i){_j.e.a(_bs.m.a,"FindCalendarItemsByIndex");if(this.b.Body.Paging.MaxEntriesReturned<0)throw Error.invalidOperation("FindCalendarItemsByIndex called with a negative MaxEntriesReturned in the paging.");var f=new _bs.P(this.c.b());var r=this.b.Body.Paging;var e=r.Condition.b;if(r.Offset){var o=_j.n.b(_a.a.cn,517,"FindCalendarItemsByIndex_SeekToConditionWithOffset");var u=this,s=this;f.o(e,function(e){_j.n.a(o);u.a.firstMatchingRowIndex=e;u.a.loadedStartIndex=Math.max(0,e+r.Offset);var s=new _g.J("Beginning");s.Offset=u.a.loadedStartIndex;s.MaxEntriesReturned=r.MaxEntriesReturned;u.K(n,f,s,t,i)},function(t){s.j(n,t,i)})}else{var h=_j.n.b(_a.a.cn,517,"FindCalendarItemsByIndex_SeekToConditionNoOffset");var c=this,l=this;f.i(this.d.Id,e,r.MaxEntriesReturned,this.b.Body.ItemShape,function(u,e){_j.n.a(h);c.w(n,t,i,f,u,e,r.MaxEntriesReturned)},function(t){l.j(n,t,i)})}},S:function(n,t,i){if(_bs.m.b&&!this.a.isReload){t(_bs.m.b);return}var r=this;n.k(this.d.Id,this.b.Body.ItemShape,function(n){for(var a=n.length,y=_j.n.b(_a.a.cn,2,"UnfoldMultidayItems_ProcessMultidayEvents_"+a),o=[],e=0,v=n.length;e<v;e++){var c=n[e];var f=c.k;var u=_a.d.b(f.Start);var i=_a.d.b(f.End);c.k.IsAllDayEvent&&(i=i.l(-1));for(var h=1;u.k(i)<0;){u=u.c(1);var l=_ff.e.a(f);var s=r.c.b().fromData(l);s.get_data().unfoldedIndex=h;_ff.s.b(o,s,_bs.m.c);h++}}_bs.m.b=o;_j.n.a(y);t(o)},i)},w:function(n,t,i,r,u,f,e){var s=_j.n.b(_a.a.cn,517,"ProcessAgendaViewItems_UnfoldMultidayItems");var o=this;this.S(r,function(i){_j.n.a(s);var c=i.length;var d=_j.n.b(_a.a.cn,2,"ProcessAgendaViewItems_ProcessUnfoldedMultidayItems_"+c);if(f>0){var k=o.a.loadedStartIndex;var h;o.a.tableSize=f+c;var b=u[0];var tt=b.k.Start;for(h=0;h<c;h++){var nt=i[h];if(tt.localeCompare(nt.u())<0)break}_bs.m.d(u,i,h,e);var l=o.b.Body.Paging;var g=l.Condition.a;var r;var a=u.length;for(r=0;r<a;r++){var w=u[r];if(w.u().localeCompare(g)>=0)break}r===a&&r--;o.a.firstMatchingRowIndex=r+k+h;o.a.loadedStartIndex=Math.max(0,o.a.firstMatchingRowIndex+l.Offset);var v=Math.max(r+l.Offset,0);var p=v+e;var y=u;u=y.slice(v,p);_j.e.a(_bs.m.a,"GetCalendarItemsByIndex will return {0} items.",u.length)}else{o.a.firstMatchingRowIndex=0;o.a.loadedStartIndex=0}_j.n.a(d);o.A(n,t,u)},i)},K:function(n,t,i,r,u){var o=_j.n.b(_a.a.cn,517,"GetCalendarItemsByIndex");var e=this,f=this;t.h(this.d.Id,i.Offset,i.MaxEntriesReturned,this.b.Body.ItemShape,function(f,s){_j.n.a(o);e.w(n,r,u,t,f,s,i.MaxEntriesReturned)},function(t){f.j(n,t,u)})},B:function(n,t,i){_j.e.a(_bs.m.a,"FindItem for CalendarPageView is trying to fetch data from the client store");var r=this.b.Body.Paging;var e=new _bs.P(this.c.b());var o=_j.n.b(_bs.m.a,517,"FindItem_GetCalendarView");var u=this,f=this;e.f(this.d.Id,r.StartDate,r.EndDate,this.b.Body.ItemShape,function(i){_j.n.a(o);var r=_j.n.b(_bs.m.a,2,"GetCalendarView_Success");u.A(n,t,i);_j.n.a(r)},function(t){f.j(n,t,i)})},A:function(n,t,i){var u=_j.n.b(_bs.m.a,2,"AddingtoResponseMsg_"+i.length);n.RootFolder.Items=new Array(i.length);for(var r=0;r<i.length;r++)n.RootFolder.Items[r]=i[r].k;_j.n.a(u);t()},I:function(n,t,i){var u=this.b.Body.Paging.MaxEntriesReturned;_j.e.a(_bs.m.a,"FindItem for folder outbox is trying to fetch {0} items from the client store",u);var f=this,r=this;this.c.e().getMessages(this.d.Id,this.c.c(),this.b.Body,this.a,null,function(i,r,u){f.z(n,i,r,u);_j.e.a(_bs.m.a,"FindItemAction is returning {0} rows from client store, total count={1}, indexOffset={2}",i.length,r,u);t()},function(n){r.j(r.i.Body.ResponseMessages.Items[0],n,i)})},v:function(n,t,i){var u=this.b.Body.Paging.MaxEntriesReturned;_j.e.a(_bs.m.a,"FindItem for folder '{0}' is trying to fetch {1} items from the client store",this.e,u);var r=this;this.P(5,new _bc.i(this.d),function(f,e){var o=e;if(!f||!r.Q(r.b.Body,o)){_j.e.a(_bs.m.a,"The folder is not synced in date mode or the request cannot be processed offline. Hence, rejecting the request to the server. isSynced={0}",f);r.r=!0;r.n=100;t();return}r.c.a().getMessages(r.d.Id,r.c.c(),r.b.Body,r.a,o,function(i,f,e){_j.e.a(_bs.m.a,"Obtained {0} messages from the clientstore.  MoreItemsOnServer = {1}, IsConnected = {2}",i.length,o.MoreItemsOnServer,r.m());if(i.length<u&&o.MoreItemsOnServer&&r.m()||!i.length&&o.MoreItemsOnServer){_j.e.a(_bs.m.a,"The client store was requested {0} rows but returned only {1} AND we are CONNECTED. Hence, rejecting the request to the server.",u,i.length);r.r=!0;r.n=302;t();return}r.z(n,i,o.TotalCount,e);_j.e.a(_bs.m.a,"FindItemAction is returning {0} rows from client store",i.length);t()},function(n){r.j(r.i.Body.ResponseMessages.Items[0],n,i)})})},Q:function(n,t){var u=!0;if(t)if(_g.J.isInstanceOfType(n.Paging)){var r=n.Paging;if(r.MaxEntriesReturned<=0||r.BasePoint!=="Beginning"||r.Offset+r.MaxEntriesReturned>t.SyncMinimum&&this.m()){_j.e.a(_bs.m.a,"Non-supported IndexedPageView paging values. Offset={0}, MaxEntriesReturned={1}, BasePoint={2}, SyncMinimum={3}, IsConnected={4}",r.Offset,r.MaxEntriesReturned,r.BasePoint,t.SyncMinimum,this.m());u=!1}}else if(_g.be.isInstanceOfType(n.Paging)){var i=n.Paging;if(_g.Z.isInstanceOfType(i.Condition.Item)){if(i.MaxEntriesReturned<=0||i.MaxEntriesReturned>t.SyncMinimum&&this.m()){_j.e.a(_bs.m.a,"Non-supported SeekToConditionPageView paging values. MaxEntriesReturned={0}, BasePoint={1}, SyncMinimum={2}, IsConnected={3}",i.MaxEntriesReturned,i.BasePoint,t.SyncMinimum,this.m());u=!1}else if(i.BasePoint==="Beginning"){var f=this.c.a().u(t.OldestReceivedTime);var o=_a.d.b(f).h();var e=_a.d.b(this.a.itemReceivedTime).h();if(e<o){_j.e.a(_bs.m.a,"Requested item's received time [{0}] is less than the oldest synced item's receivedtime [{1}]. Rejecting the request to the server.",this.a.itemReceivedTime,f);u=!1}}}else{_j.e.a(_bs.m.a,"Non-supported SeekToConditionPageView paging values. Paging type is {0}",Object.getType(i.Condition.Item));u=!1}}else{_j.e.a(_bs.m.a,"Non-supported paging type. PagingType={0}",n.Paging);u=!1}else{_j.e.a(_bs.m.a,"Rejecting request to the server as message sync state context for the folder '{0}' is null.",this.d.Id);u=!1}return u},z:function(n,t,i,r){var u=_j.n.b(_a.a.cn,2,"FindItem:ProcessMessages");n.RootFolder.Items=t;n.RootFolder.TotalItemsInView=i;n.RootFolder.IndexedPagingOffset=r;_j.n.a(u)}};_bs.cc=function(n,t,i,r){_bs.cc.initializeBase(this,[n,t,i]);_a.b.b(r,"syncManager");this.i=r;this.d=new _gg.L;this.d.Header=_bs.B.a};_bs.cc.a=function(n){return _g.r.isInstanceOfType(n)&&n.Id==="directory"};_bs.cc.b=function(n){return _g.r.isInstanceOfType(n)&&n.Id==="relevancegroup"};_bs.cc.prototype={i:null,d:null,e:null,l:function(){return"FindPeople"},bK:function(n,t,i){var r=this.b.Body.ParentFolderId?this.b.Body.ParentFolderId.BaseFolderId:null;var f=_g.l.isInstanceOfType(r);if(!_j.h.a(this.b.Body.QueryString)||this.b.Body.Restriction||this.b.Body.AggregationRestriction||!f||_bs.cc.a(r)||_bs.cc.b(r))i(-1);else{var u=this;this.i.a(8,new _a.cp,function(f){if(f)if(_g.r.isInstanceOfType(r))_a.b.d(!1,"FindPeople is not supported with DistinguishedFolderId as ParentFolderId, offending Folder Id: "+r.Id);else{u.e=r;u.g(n,t,i)}else i(-1)})}},bL:function(n,t,i){_a.b.e(this.b.Body.SortOrder.length,1,2,"expecting 1 - 2 sort columns");_a.b.d(_g.J.isInstanceOfType(this.b.Body.IndexedPageItemView)||_dg.w.isInstanceOfType(this.b.Body.IndexedPageItemView),"Browse People only support IndexedPageView or SeekToConditionWithOffsetPageView.");var f=_bs.A.a(this.c);if(_g.J.isInstanceOfType(this.b.Body.IndexedPageItemView)){var o=this.b.Body.IndexedPageItemView;this.k(f,o,n,t);return}var s=_j.n.b(_a.a.o,517,"FindPeople.SeekToCondition");var r=this.b.Body.IndexedPageItemView;var e=this,u=this;f.s(r.Condition,this.e,this.b.Body.SortOrder,function(i){_j.n.a(s);e.d.Body.FirstMatchingRowIndex=i;var u=new _g.J("Beginning");u.Offset=Math.max(0,i+r.Offset);u.MaxEntriesReturned=r.MaxEntriesReturned;e.k(f,u,n,t)},function(n){u.d.Body.ResponseCode="ErrorDataSourceOperation";u.d.Body.ResponseClass="Error";u.d.Body.MessageText=n.a();t(n)})},k:function(n,t,i,r){var u=this,f=this;n.j(t.Offset,t.MaxEntriesReturned,this.e,this.b.Body.SortOrder,function(n,r){u.d.Body.ResponseCode="NoError";u.d.Body.ResponseClass="Success";u.d.Body.ResultSet=n;u.d.Body.TotalNumberOfPeopleInView=r;u.d.Body.FirstLoadedRowIndex=t.Offset;i()},function(n){f.d.Body.ResponseCode="ErrorDataSourceOperation";f.d.Body.ResponseClass="Error";f.d.Body.MessageText=n.a();r(n)})}};_bs.bx=function(n,t,i,r){_bs.bx.initializeBase(this,[n,t,i,i.Body.FolderIds.length]);this.n=r;this.m=new Array(this.o);this.e=new _g.fU;this.e.Header=_bs.B.a;this.e.Body.ResponseMessages=new _gg.k;this.e.Body.ResponseMessages.Items=this.m};_bs.bx.prototype={n:null,e:null,m:null,i:!1,k:-1,l:function(){return"GetFolder"},bK:function(n,t,i){if(!this.r()){i(303);return}var r=this;this.n.a(2,new _a.cp,function(u){u?r.g(function(){r.i?i(r.k):n()},t,i):i(301)})},bJ:function(n,t,i,r){var o=this.b.Body.FolderIds[n];var u=new _g.fK;u.ResponseCode="NoError";u.ResponseClass="Success";u.Folders=new Array(0);this.m[n]=u;var e=u.Folders;if(_g.r.isInstanceOfType(o)){var f=o;if(f.Id==="archivemsgfolderroot"){this.i=!0;this.k=100;t()}else if(f.Mailbox){_j.e.a(_bs.bx.a,"This is a mailbox-specific call for ('{0}'). Multiple mailboxes are not supported in offline.",f.Mailbox.EmailAddress);this.i=!0;this.k=100;t()}else{var l=this,a=this;_bs.I.a(this.c.c(),f.Id,function(n){if(n)e[e.length]=n.get_data();else{_j.e.b(_bs.bx.a,"Could not find folder with DistinguishedFolderId = {0} in the ClientStore",f.Id);var i=new _g.bD;i.DisplayName=""}t()},function(n){u.ResponseCode="ErrorDataSourceOperation";u.ResponseClass="Error";u.MessageText=n.a();i(n)})}}else{var s=this,c=this,h=this;this.h(function(n){s.c.c().bindIn(n,_bs.d.a(o.Id),function(n){if(n)e[e.length]=n.get_data();else{_j.e.a(_bs.bx.a,"Could not find folder with id = {0} in the ClientStore - rejecting command.",o.Id);s.i=!0;s.k=302}},null)},function(){t()},function(n){u.ResponseCode="ErrorDataSourceOperation";u.ResponseClass="Error";u.MessageText=n.a;_bs.b.a(n,i)})}},r:function(){if(this.b.Body.FolderShape&&this.b.Body.FolderShape.AdditionalProperties)for(var n=0;n<this.b.Body.FolderShape.AdditionalProperties.length;++n)if(this.b.Body.FolderShape.AdditionalProperties[n]===_g.c.bf())return!1;return!0}};_bs.bI=function(n,t,i){_bs.bI.initializeBase(this,[n,t]);_a.b.b(i,"syncManager");this.d=i;this.b=null};_bs.bI.prototype={d:null,b:null,l:function(){return"GetCalendarFolders"},bK:function(n,t,i){var r=this;this.d.a(9,new _a.cp,function(u){if(u){_j.e.a(_bs.bI.a,"Executing offline GetCalendarFolders command.");r.g(n,t,i)}else{_j.e.a(_bs.bI.a,"Offline GetCalendarFolders command rejected.");i(301)}})},bL:function(n,t,i){var r=this;this.u().i(function(t){r.b=t;n()},t)}};_bs.cL=function(n,t,i){_bs.cL.initializeBase(this,[n,t,i,i.Body.EventIds.length]);this.m=new Array(this.o);this.i=new _cz.dn;this.i.Header=_bs.B.a;this.i.Body.ResponseMessages=new _gg.k;this.i.Body.ResponseMessages.Items=this.m};_bs.cL.$$cctor=function(){_bs.cP.$$(_cz.eB).b("GetCalendarEvent")};_bs.cL.prototype={i:null,m:null,e:!1,k:-1,r:0,l:function(){return"GetCalendarEvent"},bK:function(n,t,i){var r=this;this.g(function(){r.e?i(r.k):n()},t,i)},bJ:function(n,t,i,r){if(this.e){t();return}var f=new _g.dA;this.m[n]=f;var u=this.b.Body.EventIds[n];if(u.__type===_g.bm._dataContractName){var a=u;this.s(a,f,t,i)}else if(u.__type===_cz.z._dataContractName){this.e=!0;this.k=100;t()}else{var e=null;var h=u;var o=_bs.d.a(h.Id);var s=this,l=this,c=this;this.h(function(n){s.c.b().bindIn(n,o,function(t){t&&t.get_data()?e=t:s.c.f().bindIn(n,o,function(n){e=n},null)},null)},function(){l.n(h.Id,e,f,t)},function(n){_bs.b.a(n,function(n){c.j(f,n,i)})})}},s:function(n,t,i,r){var u=null;var o=null;var e=this,f=this,s=this;this.h(function(t){e.c.b().bindIn(t,_bs.d.a(n.OccurrenceId),function(n){if(n&&n.get_data()){u=n.c();_bs.Q.a(t,e.c.f(),u,function(n){o=n})}},null)},function(){if(u)f.n(u,o,t,i);else{f.e=!0;f.k=302;i()}},function(n){_bs.b.a(n,function(n){s.j(t,n,r)})})},n:function(n,t,i,r){var f=_j.n.b(_a.a.dS,2,"CheckAndReturnItemFromClientStore");i.ResponseCode="NoError";i.ResponseClass="Success";i.Items=new Array(0);var u=i.Items;if(t&&t.d())u[0]=t.d();else{this.e=!0;this.k=302}r();_j.n.a(f)}};_bs.N=function(n,t,i){this.o={};_bs.N.initializeBase(this,[n,t,i]);_a.b.a(n.lastModifiedTimeDictionary,"lastModifiedTimeDictionary");this.e=new _g.ev;this.e.Header=_bs.B.a;this.e.Body.ResponseMessages=new _gg.k};_bs.N.$$cctor=function(){_bs.cP.$$(_g.fO).b("GetConversationItems")};_bs.N.prototype={e:null,k:!1,d:-1,m:0,n:0,i:null,l:function(){return"GetConversationItems"},bK:function(n,t,i){var r=this.a.currentUserOptionsSortOrder;if(_j.h.a(this.a.explicitLogonUser))if(_j.u.a(r)||r===this.b.Body.SortOrder)if(_j.z.a(this.a.currentUserOptionsIgnoringDeletedItems)||this.a.currentUserOptionsIgnoringDeletedItems===this.a.requestIgnoringDeleteditems)if(this.b.Body.MaxItemsToReturn<=20){var u=this;this.g(function(){if(u.k){_j.e.a(_bs.N.a,"Client store unable to fulfil request. Forwarding request to the server.");i(u.d)}else n()},t,i)}else{_j.e.a(_bs.N.a,"{0} requested item parts is greater than {1} itemparts supported by the clientstore. Hence, rejecting the request",this.b.Body.MaxItemsToReturn,20);i(100)}else{_j.e.a(_bs.N.a,"Request specified a Hide Deleted Items option of {0} while the current UserOptions has Hided Deleted Items set to {1}, rejecting the request",this.a.requestIgnoringDeleteditems,this.a.currentUserOptionsIgnoringDeletedItems);i(304)}else{_j.e.a(_bs.N.a,"Request specified SortOrder of {0} while the current UserOptions has set SortOrder to {1}, rejecting the request",this.b.Body.SortOrder,r);i(304)}else{_j.e.a(_bs.N.a,"Request specified the explicitLogonUser = {0}, rejecting the request",this.a.explicitLogonUser);i(307)}},bL:function(n,t,i){var e=this.b.Body.Conversations;_a.b.e(e.length,1,1,"Invalid number of conversations requested. Number = "+e.length);var o=new _bs.bE(_a.bm.a());if(o.f()){_j.e.a(_bs.N.a,"Offline email data is outdated, forwarding request to the server.");this.k=!0;this.d=301;n()}else{var f=_bs.d.a(e[0].ConversationId.Id);var u=this,r=this,s=this;this.h(function(n){u.c.k().bindIn(n,f,function(t){u.i=t;if(t&&!u.w([t]))u.s(n);else{u.k=!0;u.d=t?306:305;_j.e.a(_bs.N.a,"id '{0}' rejectCode: {1}, forwarding request to the server",f,u.d)}},null)},function(){if(!r.k&&r.m>0&&r.m===r.n){_j.e.a(_bs.N.a,"All items found for conversation with id '{0}'. Providing data to the caller",f);r.v();r.r([r.i]);n()}else{_j.e.a(_bs.N.a,"Couldn't find all items for conversation with id '{0}', forwarding request to the server. Total items requested = {1}, total items found = {2}",f,r.m,r.n);r.k=!0;r.d=302;n()}},function(n){t(new _bs.b(new _a.bO(0,n.a)))})}},s:function(n){for(var s=this.i.get_data().ConversationId.Id,u=this.i.get_data().ConversationNodes,e=u.length,t=0;t<e;++t)for(var f=u[t],i=0;i<f.Items.length;i++){var o=f.Items[i];this.m++;var r=this;this.c.a().bindIn(n,_bs.d.a(o.ItemId.Id),function(n){if(n&&_bs.U.c(n.get_data(),0)){_j.e.a(_bs.N.a,"Adding item with id '{0}' to the dictionary for conversation with id '{1}'",n.get_data().ItemId.Id,s);r.o[n.get_data().ItemId.Id]=n.get_data();r.n++}},null)}},v:function(){for(var r=this.i.get_data().ConversationNodes,f=r.length,i=0;i<f;++i)for(var t=r[i],n=0;n<t.Items.length;n++){var u=this.o[t.Items[n].ItemId.Id];t.Items[n]=u}},r:function(n){this.e.Body.ResponseMessages.Items=new Array(n.length);for(var i=0;i<n.length;i++){var t=new _g.fR;t.ResponseCode="NoError";t.ResponseClass="Success";t.Conversation=n[i].get_data();this.e.Body.ResponseMessages.Items[i]=t}},w:function(n){for(var f=n,e=f.length,i=0;i<e;++i){var t=f[i];var r=this.a.lastModifiedTimeDictionary[t.get_data().ConversationId.Id];var u=_a.d.b(t.get_data().LastModifiedTime).h();if(u<r){_j.e.a(_bs.N.a,"LastModifiedTime does not match for conversation with id {0}, client store item value = {1}:{2}, requested value = {3}",t.get_data().ConversationId.Id,t.get_data().LastModifiedTime,u,r);return!0}}return!1}};_bs.cM=function(n,t,i){_bs.cM.initializeBase(this,[n,t]);_a.b.b(i,"syncManager");this.d=i;this.b=null};_bs.cM.prototype={d:null,b:null,l:function(){return"GetFavoriteFolders"},bK:function(n,t,i){var r=this;this.d.a(6,new _a.cp,function(u){u?r.g(n,t,i):i(301)})},bL:function(n,t,i){var r=this;this.u().k(function(t){r.b=t;n()},t)}};_bs.G=function(n,t,i){_bs.G.initializeBase(this,[n,t,i,i.Body.ItemIds.length]);this.m=new Array(this.o);this.k=new _g.ex;this.k.Header=_bs.B.a;this.k.Body.ResponseMessages=new _gg.k;this.k.Body.ResponseMessages.Items=this.m};_bs.G.$$cctor=function(){_bs.cP.$$(_g.bz).b("GetItem")};_bs.G.prototype={k:null,m:null,e:!1,i:-1,r:0,l:function(){return"GetItem"},bK:function(n,t,i){if(this.a.clientStoreItem){var r=this;this.g(function(){r.e?i(r.i):n()},t,i)}else{_j.e.a(_bs.G.a,"ClientStoreItem.None was passed. Request will be sent to the server.");i(100)}},bJ:function(n,t,i,r){if(this.e){t();return}var f=new _g.dA;this.m[n]=f;var u=this.b.Body.ItemIds[n];if(this.a.clientStoreItem===2)this.v(_bc.A,u,f,this.c.a(),t,i);else if(this.a.clientStoreItem===3)this.v(_bc.bj,u,f,this.c.e(),t,i);else if(this.a.clientStoreItem===1)if(u.__type===_g.bm._dataContractName){var a=u;this.I(a,f,t,i)}else if(u.__type===_cz.z._dataContractName){_j.e.a(_bs.G.a,"GetCalendarItem: RecurringMasterItemIdRanges isn't supported on offline getitem service command. Rejecting call.");this.e=!0;this.i=100;t()}else{var o=null;var h=u;var e=_bs.d.a(h.Id);var s=this,l=this,c=this;this.h(function(n){_j.e.a(_bs.G.a,"GetCalendarItem: Trying to find item with Id {0} in CalendarItem table",e);s.c.b().bindIn(n,e,function(t){if(t&&t.get_data())o=t;else{_j.e.a(_bs.G.a,"GetCalendarItem: Trying to find item with Id {0} in CalendarRecurrenceMaster table",e);s.c.f().bindIn(n,e,function(n){o=n},null)}},null)},function(){l.n(h.Id,o,f,t)},function(n){_bs.b.a(n,function(n){c.j(f,n,i)})})}else{this.e=!0;this.i=100;t()}},v:function(n,t,i,r,u,f){var e=t;_j.e.a(_bs.G.a,"GetItem called for id {1}",e.Id);var o=n===Number||Type.isEnum(n)?0:n===Boolean?!1:null;var c=this,s=this,h=this;this.h(function(n){r.e(n,_bs.d.a(e.Id),function(n){o=n},null)},function(){s.n(e.Id,o,i,u)},function(n){_j.e.a(_bs.G.a,"GetItem. Reporting store error {0}. id {1}",n.a,e.Id);h.j(i,new _bs.b(n),f)})},A:function(n,t){return _bc.A.isInstanceOfType(n)?this.H(n,t):_bc.t.isInstanceOfType(n)?this.w(n,t):_bc.u.isInstanceOfType(n)?this.z(n,t):!0},I:function(n,t,i,r){var u=null;var o=null;var e=this,f=this,s=this;this.h(function(t){e.c.b().bindIn(t,_bs.d.a(n.OccurrenceId),function(i){if(i&&i.get_data()){u=i.c();_bs.Q.a(t,e.c.f(),u,function(n){o=n})}else _j.e.a(_bs.G.a,"GetCalendarItem: Occurrence with id {0} not found in local store",n.OccurrenceId)},null)},function(){if(u)f.n(u,o,t,i);else{f.e=!0;f.i=302;i()}},function(n){_bs.b.a(n,function(n){s.j(t,n,r)})})},n:function(n,t,i,r){var f=_j.n.b(_a.a.dT,2,"CheckAndReturnItemFromClientStore");i.ResponseCode="NoError";i.ResponseClass="Success";i.Items=new Array(0);var u=i.Items;if(t&&t.d())if(this.A(t,this.b.Body.ItemShape)){_j.e.a(_bs.G.a,"Item {0} retrieved for local store satisfies request.",t.a());u[0]=t.d()}else{_j.e.b(_bs.G.a,"Item {0} retrieved for local store does not satisfy request.",t.a());this.e=!0;this.i=303}else{_j.e.a(_bs.G.a,"Item with id {0} not found in local store",n);this.e=!0;this.i=302}r();_j.n.a(f)},H:function(n,t){var i=n.get_data();var r=!1;if(this.a.requireNormalizedBody&&!n.get_data().NormalizedBody){_j.e.a(_bs.G.a,"Item with id {0} does not contain the NormalizedBody shape. So rejecting to server.",n.a());this.e=!0;this.i=303}else if(t.BodyType){if(i.Body)if(i.Body.BodyType==="HTML"&&t.BodyType==="HTML"||i.Body.BodyType==="Text"&&t.BodyType==="Text"){_j.e.a(_bs.G.a,"Message body type matches response shape body type. ItemId: {0} body type: {1}",i.ItemId.Id,i.Body.BodyType);r=!0}else _j.e.a(_bs.G.a,"Message body type doesn't match response shape body type. ItemId: {0}  Message body type: {1}  Response shape body type: {2}",i.ItemId.Id,i.Body.BodyType,t.BodyType);else if(_bs.c.c(i.__type)){var u=n.get_data();if(u.NewBodyContent){_j.e.a(_bs.G.a,"Item is a SmartResponse. ItemId: {0}",i.ItemId.Id);r=!0}else throw Error.invalidOperation(String.format("SmartResponse.NewBodyContent is undefined. ItemId: {0}",i.ItemId.Id));}}else r=!0;return r},w:function(n,t){return this.s(n.get_data(),t)},z:function(n,t){return this.s(n.get_data(),t)},s:function(n,t){if(t.BodyType==="Text"){n.TextBody||(n.TextBody=new _g.s("Text",n.Preview));n.Body=n.TextBody}if(n.Body.IsTruncated){_j.e.b(_a.a.n,"Truncated body type {0} on item with id {1}. Rejecting call.",n.Body.BodyType,n.ItemId.Id);this.r=16;return!1}n.TextBody=undefined;return!0}};_bs.by=function(n,t){_bs.by.initializeBase(this,[n,t])};_bs.by.prototype={b:null,l:function(){return"GetOwaUserConfiguration"},bK:function(n,t,i){var r=this,u=this;this.u().d(function(u){r.b=u;if(r.b)r.g(n,t,i);else{_j.e.a(_bs.by.a,"GetOwaUserconfiguration: Invoking rejected callback.");i(301)}},function(n){_j.e.a(_bs.by.a,"GetOwaUserconfiguration: Failed to load : {0}",n.a());t(Error.create(n.a()))})},bL:function(n,t,i){if(this.b)n();else{_j.e.a(_bs.by.a,"GetOwaUserconfiguration: Invoking rejected callback.");i(301)}}};_bs.cN=function(n,t,i){_bs.cN.initializeBase(this,[n,t]);_a.b.b(i,"syncManager");this.d=i;this.b=null};_bs.cN.prototype={d:null,b:null,l:function(){return"GetOtherMailboxConfiguration"},bK:function(n,t,i){var r=this;this.d.a(13,new _a.cp,function(u){u?r.g(n,t,i):i(301)})},bL:function(n,t,i){var r=this;this.u().n(function(t){r.b=t;n()},t)}};_bs.dQ=function(n,t,i){_bs.dQ.initializeBase(this,[n,t]);_a.b.b(i,"syncManager");this.d=i};_bs.dQ.prototype={d:null,b:null,l:function(){return"GetPeopleFilters"},bK:function(n,t,i){var r=this;this.d.a(7,new _a.cp,function(u){u?r.g(n,t,i):i(301)})},bL:function(n,t,i){var r=this,u=this;_bs.bA.a(this.c.o(),function(t){r.b=new Array(t.length);for(var i=0;i<t.length;++i)r.b[i]=t[i].get_data();n()},function(n){t(n)})}};_bs.dR=function(n,t,i,r){_bs.dR.initializeBase(this,[n,t,i]);_a.b.b(r,"syncManager");this.i=r;this.d=new _gg.hD;this.d.Header=_bs.B.a};_bs.dR.prototype={i:null,d:null,e:!1,l:function(){return"GetPersona"},bK:function(n,t,i){if(this.b.Body.EmailAddress){i(100);return}if(this.a.hasGALComponent){this.e=!0;i(303);return}_a.b.b(this.b.Body.PersonaId,"PersonaId");_a.b.b(this.b.Body.PersonaId.Id,"PersonaId.Id");var r=this;this.i.a(8,new _a.cp,function(u){u?r.g(function(){if(r.d.Body.Persona)if(r.d.Body.Persona.ADObjectId){r.e=!0;i(303)}else n();else i(302)},t,i):i(301)})},bL:function(n,t,i){var r=this,f=this,u=this;this.h(function(n){var t=_bs.A.a(r.c);t.c(n,r.b.Body.PersonaId,function(n){if(n){r.d.Body.ResponseCode="NoError";r.d.Body.ResponseClass="Success";r.d.Body.Persona=n}else{r.d.Body.ResponseCode="ErrorItemNotFound";r.d.Body.ResponseClass="Error"}},null)},function(){n()},function(n){_bs.b.a(n,function(n){u.j(u.d.Body,n,t)})})}};_bs.bz=function(n,t,i){_bs.bz.initializeBase(this,[n,t,i,i.Body.ItemIds.length])};_bs.bz.prototype={e:!1,i:0,l:function(){return"MoveItem"},bK:function(n,t,i){if(this.a.clientStoreItem===2){var r=this;this.g(function(){r.e?i(-1):n()},t,i)}else{_j.e.a(_bs.bz.a,"ClientStoreItem.{0} was passed. Request will be sent to the server.",this.a.clientStoreItem);i(-1)}},bJ:function(n,t,i,r){if(this.e){t();return}var f=this.b.Body.ItemIds[n];if(!_g.e.isInstanceOfType(f)){this.e=!0;this.i=12;t();return}var u=f;_j.e.a(_bs.bz.a,"Step {0} called for id {1}",n.toString(),u.Id);var o=this,e=this;this.k(u,function(){_j.e.a(_bs.bz.a,"Successfully deleted message with id {0} from client store.",u.Id);t()},function(n){i(n)})},k:function(n,t,i){var r=this,u=this;this.h(function(t){r.t().d(t,r.q(),"HardDelete",n,null,_g.k.a)},function(){t()},_bs.b.b(i))}};_bs.cO=function(n,t,i,r){this.bj=Function.createDelegate(this,this.bk);this.B=-1;_bs.cO.$$(this.$$gta["_bs.cO"].TRequest,this.$$gta["_bs.cO"].TActionContext).initializeBase(this,[n,t,i]);this.o=r};_bs.cO.$$=function(n,t){var f=_bs.__tc=_bs.__tc||{};var i="cO"+"$"+n.getName().replace(/\./g,"_")+"$"+t.getName().replace(/\./g,"_");if(!f[i]){var u=f[i]=function(){for(var t=[],n=0;n<arguments.length;++n)t[n]=arguments[n];_bs.cO.apply(this,t)};var c=_bs.cI.$$(n,t);u.registerClass("_bs.__tc."+i,c);var s={"_bs.cO":{TRequest:n,TActionContext:t},ctor:_bs.cO};var l=c.prototype.$$gta;for(var a in l){var h={key:a,value:l[a]};s[h.key]=h.value}u.prototype.$$gta=s;var e=_bs.cO.prototype;for(var o in e){var r={key:o,value:e[o]};"constructor"!==r.key&&(u.prototype[r.key]=r.value)}}return f[i]};_bs.cO.prototype={o:0,L:null,J:null,K:null,d:"",bL:function(n,t,i){this.L=n;this.J=t;this.K=i;this.bk()},bl:function(n){_a.b.a(n,"itemId");this.d="ItemId ="+JsonParser.serialize(n)},bk:function(){this.B++;this.B===this.o?this.L():this.bJ(this.B,this.bj,this.J,this.K)}};_bs.S=function(n,t,i,r){_bs.S.initializeBase(this,[n,t,i]);_a.b.b(r,"syncManager");this.e=r;this.d=new _gg.iS;this.d.Header=_bs.B.a};_bs.S.prototype={e:null,d:null,l:function(){return"PerformReminderAction"},bK:function(n,t,i){var r=this;this.e.a(3,new _a.cp,function(u){if(u)r.g(n,t,i);else{_j.e.a(_bs.S.a,"PerformReminderAction: Rejecting the call as the reminder module is not synced");i(-1)}})},bL:function(n,t,i){var r=this,f=this,u=this;this.h(function(n){for(var f=r.b.Body.ReminderItemActions,o=f.length,i=0;i<o;++i){var t=f[i];var u=t.ItemId;if(t.ActionType)if(t.ActionType===1){var e=_a.d.b(t.NewReminderTime);r.k(n,u,e)}else throw Error.argument("ActionType",String.format("Reminder Action Type not supported {0}",t.ActionType));else r.i(n,u)}},function(){_j.e.a(_bs.S.a,"PerformReminderAction: Successfully performed reminder actions to local store.");f.d.Body.ResponseCode="NoError";f.d.Body.ResponseClass="Success";n()},function(n){_j.e.c(_bs.S.a,"PerformReminderAction: Failed to perform reminder actions to local store.");var i=new _bs.b(new _a.bO(0,n.a));u.j(u.d.Body,i,t)})},i:function(n,t){var i=this.c.g();var r=this;i.bindIn(n,_bs.d.a(t.Id),function(u){if(!u||!u.get_data()){_j.e.b(_bs.S.a,"PerformReminderAction-Dismiss: Reminder item with id {0} could no be found in client store.",t);return}_j.e.a(_bs.S.a,"PerformReminderAction-Dismiss: Reminder item with id {0} found in client store. Dismissing it.",u.a());i.b(n,u.a());_j.e.a(_bs.S.a,"PerformReminderAction-Dismiss: Successfully deleted (dismissed) reminder item with id {0} from client store.",u.a());r.m(n,t,u.get_data())},null)},m:function(n,t,i){var r=this;this.c.b().d(n,_bs.d.a(t.Id),function(n){if(_j.F.a(n)){var u=String.format("PerformReminderAction-Dismiss: Calendar item with id {0} not found in local store. Calendar item couldn't be updated for reminder with Subject:{1}, Reminder Time: {2}, Start date:{3}, End date {4}.",t.Id,i.Subject,i.ReminderTime,i.StartDate,i.EndDate);_j.e.b(_bs.S.a,u);return}var r=n;r.ReminderIsSet=!1;_j.e.a(_bs.S.a,"PerformReminderAction-Dismiss: Successfully updated calendar item with id {0} from client store.",r.ItemId.Id)})},k:function(n,t,i){var r=this;this.c.g().d(n,_bs.d.a(t.Id),function(n){if(_j.F.a(n)){_j.e.b(_bs.S.a,"PerformReminderAction-Snooze: Reminder item with id {0} not found in local store",t.Id);return}var r=n;r.ReminderTime=_a.d.o(i);_j.e.a(_bs.S.a,"PerformReminderAction-Snooze: Successfully updated (snooze) reminder item with id {0} from client store.",r.ItemId.Id)})}};_bs.B=function(){};_bs.B.$$cctor=function(){_bs.B.a=new _gg.is;_bs.B.a.ServerVersionInfo=new _gg.jE;_bs.B.a.ServerVersionInfo.Version="Exchange2013"};_bs.cP=function(n,t){_a.b.a(n,"actionContext");_a.b.a(t.d(),"serviceCommandContext.ItemStoreGetter");_a.b.c(t.g(),"serviceCommandContext.TimeZone");this.a=n;this.N=t;this.c=t.d()};_bs.cP.$$=function(n){var u=_bs.__tc=_bs.__tc||{};var i="cP"+"$"+n.getName().replace(/\./g,"_");if(!u[i]){var t=u[i]=function(){for(var t=[],n=0;n<arguments.length;++n)t[n]=arguments[n];_bs.cP.apply(this,t)};t.registerClass("_bs.__tc."+i);var o={"_bs.cP":{TActionContext:n},ctor:_bs.cP};t.prototype.$$gta=o;var e=_bs.cP.prototype;for(var f in e){var r={key:f,value:e[f]};"constructor"!==r.key&&(t.prototype[r.key]=r.value)}t.b=function(n){_a.b.d(!t.a[0][n],"PerfCounter for "+n+" already exists");var r=new _a.bM("Svc","b",32832,!1,n);t.a[0][n]=r;var i=new _a.bM("Svc","s",64,!1,n);i.g(r);t.a[1][n]=i;i=new _a.bM("Svc","f",64,!1,n);i.g(r);t.a[2][n]=i;i=new _a.bM("Svc","r",64,!1,n);i.g(r);t.a[3][n]=i};t.c=function(n,t){var i=t[n];i&&i.c()};t.a=new Array(4);t.$$cctor=function(){for(var n=0;n<4;n++)t.a[n]={}};t.$$cctor()}return u[i]};_bs.cP.prototype={a:null,N:null,F:null,D:null,C:null,G:null,c:null,x:null,E:null,t:function(){this.F||(this.F=new _bs.ce(this.c));return this.F},q:function(){this.D||(this.D=new _bs.cK(this.c));return this.D},p:function(){this.C||(this.C=new _bs.M(this.c));return this.C},bN:function(n){this.x&&(this.x.b=n);this.E=n;return n},u:function(){this.G||(this.G=new _bs.E(this.c));return this.G},f:function(n,t,i){var c=_g.N.e(this.a);this.x=_a.g.f().g(this.l(),!0,c);_bs.cP.$$(this.$$gta["_bs.cP"].TActionContext).c(this.l(),_bs.cP.$$(this.$$gta["_bs.cP"].TActionContext).a[0]);var e=_a.K.a();if(this.N.l()){var f=null;var h=_j.n.b(_a.a.bv,2,"OfflineInvoke_"+this.l());var u=this,r=this,o=this;this.bK(function(){_j.n.a(f);var t=_j.n.b(_a.a.bv,0,"OfflineResponse_"+u.l());try{u.M(200);u.y(e,1);n()}finally{_bs.cP.$$(u.$$gta["_bs.cP"].TActionContext).c(u.l(),_bs.cP.$$(u.$$gta["_bs.cP"].TActionContext).a[1]);_j.n.a(t)}},function(n){_j.n.a(f);var i=_j.n.b(_a.a.bv,0,"OfflineResponseFailed_"+r.l());try{r.bN(n.message);r.M(500);r.y(e,2);t(n)}finally{_bs.cP.$$(r.$$gta["_bs.cP"].TActionContext).c(r.l(),_bs.cP.$$(r.$$gta["_bs.cP"].TActionContext).a[2]);_j.n.a(i)}},function(n){_j.n.a(f);var t=_j.n.b(_a.a.bv,0,"OfflineResponseRejected_"+o.l()+"_"+n);try{o.y(e,3,n);o.bm(n,i)}finally{_j.n.a(t)}});_j.n.a(h);f=_j.n.b(_a.a.bv,513,"OfflineRequest_"+this.l())}else{var s=_j.n.b(_a.a.bv,2,"CommandRejected_"+this.l());_j.e.b(_a.a.bc,"The offline component is not ready to use yet. {0} is rejected.",this.l());this.y(e,3,1);this.bm(1,i);_j.n.a(s)}},g:function(n,t,i){var r=this;this.bL(n,function(n){t(n.b())},i)},j:function(n,t,i){n.ResponseCode="ErrorDataSourceOperation";n.ResponseClass="Error";n.MessageText=t.a();_j.e.c(_a.a.bc,"Processing clientstore error '{0}' in servicecommand {1}",t.a(),this.l());i(t)},h:function(n,t,i){this.c.l(new _e.a(this.l()),n,t,i)},O:function(n,t,i,r){this.c.l(n,t,i,r)},bM:function(n){return _g.r.isInstanceOfType(n)?_g.b.a.nameToId(n.Id):n},M:function(n){_j.e.a(_a.a.bc,"ServiceCommand {0} completed. Status {1}. Details {2}",this.l(),n,this.E);_a.g.f().f(this.x,n,this.E,null,null,null,null,!1)},bm:function(n,t){_bs.cP.$$(this.$$gta["_bs.cP"].TActionContext).c(this.l(),_bs.cP.$$(this.$$gta["_bs.cP"].TActionContext).a[3]);_j.e.a(_a.a.bc,"Rejecting the service command '{0}' from the offline component (Reason: {1})...",this.l(),n);this.M(302);this.a.offlineRejectCode=n;t()},y:function(n,t,i){var r=new _g.H(new _g.dh(this.l(),null,this.a));r.id=286331153;r.actionType=1;r.processingTime=_a.K.a()-n;if(t===1)r.successCount+=1;else if(t===2)r.failureCount+=1;else if(t===3){r.rejectedCount+=1;r.offlineRejectCode=i}_g.dS.a(r,!0,0)}};_bs.cf=function(n,t,i){_bs.cf.initializeBase(this,[n,t]);this.b=i};_bs.cf.prototype={b:null,l:function(){return"SetLayoutSettings"},bK:function(n,t,i){this.g(n,t,i)},bL:function(n,t,i){_j.e.a(_bs.cf.a,"SetLayoutSettings ExecuteInternal invoked.");this.u().u(this.b,n)}};_bs.dT=function(n,t,i){_bs.dT.initializeBase(this,[n,t]);this.b=i};_bs.dT.prototype={b:null,l:function(){return"SetTimeZone"},bK:function(n,t,i){this.g(n,t,i)},bL:function(n,t,i){this.u().y(this.b,n)}};_bs.H=function(n,t,i){_bs.H.initializeBase(this,[n,t,i,i.Body.ItemChanges.length]);this.m=new Array(this.o);this.i=new _g.eQ;this.i.Header=_bs.B.a;this.i.Body.ResponseMessages=new _gg.k;this.i.Body.ResponseMessages.Items=this.m};_bs.H.prototype={i:null,m:null,e:!1,k:0,l:function(){return"UpdateCalendarItem"},bK:function(n,t,i){if(this.a.clientStoreItem===1){var r=this;this.g(function(){if(r.e){_j.e.a(_bs.H.a,"UpdateCalendarItem: Call rejected by updated calendar item service command. The call should be forwarded to online proxy.");i(-1)}else n()},t,i)}else throw Error.argument("ClientStoreItem",String.format("ClientStoreItem {0} is not supported.",this.a.clientStoreItem));},bJ:function(n,t,i,r){if(this.e){t();return}var o=this.b.Body.ItemChanges[n];var u=o.ItemId;_j.e.a(_bs.H.a,"Step {0} called for id {1}",n.toString(),u.Id);var e=new _g.eR;e.ResponseCode="NoError";e.ResponseClass="Success";e.Items=[new _g.L];e.Items[0].ItemId=u;this.m[n]=e;var f=this,h=this,s=this;this.h(function(n){if(f.a.isReferencedItemRecurring)if(u.__type===_g.bm._dataContractName){_j.e.a(_bs.H.a,"UpdateCalendarItem: RecurringMasterItemId isn't supported on offline updateitem service command. Rejecting call.");f.e=!0}else f.r(_bc.u,n,u,o.Updates,f.c.f());else f.r(_bc.t,n,u,o.Updates,f.c.b())},function(){_j.e.a(_bs.H.a,"Successfully updated calendar item with server id {0} in local store.",u.Id);t()},function(n){_j.e.c(_bs.H.a,"Failed to updated calendar item with server id {0} in local store. Error: {1}.",u.Id,n.a);i(new _bs.b(new _a.bO(0,n.a)))})},r:function(n,t,i,r,u){var f=this;u.bindIn(t,_bs.d.a(i.Id),function(u){if(u){var o,e;var c,h,s;(s=f.w(r,u.get_data(),c={val:o},h={val:e}),o=c.val,e=h.val,s)?f.p().h(t,o,e,function(){f.n(t,u,r)},function(){f.e=!0;f.k=11}):f.n(t,u,r)}else{_j.e.b(_bs.H.a,"UpdateCalendarItem: Calendar item (type: '{0}') with id {1} was not found in local store",n.getName(),i.Id);f.e=!0}},null)},n:function(n,t,i){var u;var r=t.get_data();var e,f;if(f=this.s(r,i,e={val:u}),u=e.val,f){this.e=!0;this.k=u}else{this.H(r,i);this.I(n,r,i);t.b(n,null)}},s:function(n,t,i){i.val=0;if(n.IsMeeting){i.val=6;return!0}else if(n.CalendarItemType==="RecurringMaster"){i.val=7;return!0}for(var r=0;r<t.length;r++)if(t[r].Path.__type===_g.d._dataContractName){var u=t[r].Path;switch(u.FieldURI){case"RequiredAttendees":case"OptionalAttendees":case"Resources":i.val=9;return!0;case"Recurrence":i.val=n.CalendarItemType==="Single"?2:8;return!0}}return!1},w:function(n,t,i,r){var f=!1;i.val=t.StartWallClock;r.val=t.EndWallClock;for(var u=0;u<n.length;u++)if(n[u].__type===_g.u._dataContractName&&n[u].Item.__type===_g.z._dataContractName&&n[u].Path.__type===_g.d._dataContractName){var e=n[u].Item;var o=n[u].Path;switch(o.FieldURI){case"Start":i.val=e.Start;f=!0;break;case"End":r.val=e.End;f=!0;break}}return f},H:function(n,t){for(var i=0;i<t.length;i++)if(t[i].__type===_g.u._dataContractName)this.z(n,t[i]);else if(t[i].__type===_g.bi._dataContractName)this.v(n,t[i]);else break;n.CalendarItemType==="Occurrence"&&(n.CalendarItemType="Exception")},z:function(n,t){var r=null;if(t.Path.__type===_g.d._dataContractName)r=t.Path;else if(t.Path.__type===_g.P._dataContractName){var e=t.Item.ExtendedProperty;if(!e){_j.e.b(_bs.H.a,"UpdateCalendarItem-SetCalendarItemProperty: ignoring null extended properties.");return}for(var f=e,o=f.length,u=0;u<o;++u){var s=f[u];_bs.p.c(n,s)}return}else throw Error.argument(String.format("UpdateCalendarItem-SetCalendarItemProperty: Property path type {0} is not supported.",Object.getType(t.Path).getName()));var i=null;if(t.Item.__type===_g.z._dataContractName)i=t.Item;else throw Error.argument(String.format("UpdateCalendarItem-SetCalendarItemProperty: Property update item type {0} is not supported.",Object.getType(t.Item).getName()));switch(r.FieldURI){case"Subject":n.Subject=i.Subject;break;case"Body":n.Body=i.Body;_bs.M.b(n);break;case"IsAllDayEvent":n.IsAllDayEvent=i.IsAllDayEvent;break;case"StartTimeZone":n.StartTimeZoneId=i.StartTimeZone.Id;break;case"Start":n.Start=i.Start;n.StartWallClock=i.Start;break;case"EndTimeZone":n.EndTimeZoneId=i.EndTimeZone.Id;break;case"End":n.End=i.End;n.EndWallClock=i.End;break;case"LegacyFreeBusyStatus":n.FreeBusyType=i.FreeBusyType;break;case"ReminderIsSet":n.ReminderIsSet=i.ReminderIsSet;break;case"ReminderMinutesBeforeStart":n.ReminderMinutesBeforeStart=i.ReminderMinutesBeforeStart;break;case"Sensitivity":n.Sensitivity=i.Sensitivity;break;case"Location":case"EnhancedLocation":n.Location=i.Location;break;case"Categories":n.Categories=i.Categories;break;case"InboxReminders":n.InboxReminders=i.InboxReminders;break;case"Charm":n.Charm=i.Charm;break;case"MentionsEx":n.MentionsEx=i.MentionsEx;break;case"AtAllMention":n.AtAllMention=i.AtAllMention;break;default:throw Error.invalidOperation(String.format("UpdateCalendarItem-SetProperty: Field uri {0} is not supported.",r.FieldURI));}},v:function(n,t){var i=null;if(t.Path.__type===_g.d._dataContractName)i=t.Path;else throw Error.argument(String.format("UpdateCalendarItem-DeleteProperty: Property path type {0} is not supported.",Object.getType(t.Path).getName()));switch(i.FieldURI){case"Location":case"EnhancedLocation":n.Location=null;break;case"InboxReminders":n.InboxReminders=null;break;default:throw Error.invalidOperation(String.format("UpdateCalendarItem-DeleteProperty: Field uri {0} is not supported.",i.FieldURI));}},I:function(n,t,i){var r=_bs.d.a(t.ItemId.Id);var f=this.c.g();if(t.ReminderIsSet){var u=this;f.d(n,r,function(f){if(_j.F.a(f)){_j.e.a(_bs.H.a,"UpdateCalendarItem: Reminder is set but no reminder with id {0} was found in local store. Creating a reminder.",t.ItemId.Id);u.p().c(n,t,t.ItemId,function(n){_j.e.a(_bs.H.a,"UpdateCalendarItem: Reminder with id {0} created successfuly.",n)})}else{_j.e.a(_bs.H.a,"UpdateCalendarItem: Reminder with id {0} found. Updating properties.",r);var e=f;u.P(e,t,i)}})}else{_j.e.a(_bs.H.a,"UpdateCalendarItem: Reminder not set on calendar item with id {0}. Deleting reminder if one exist.",t.ItemId.Id);f.b(n,r)}},P:function(n,t,i){for(var r=0;r<i.length;r++)i[r].__type===_g.u._dataContractName?this.A(n,t,i[r]):_j.e.a(_bs.H.a,"UpdateCalendarItem: Property update type {0} is not handled for reminders.",Object.getType(i[r]).getName())},A:function(n,t,i){var u=null;if(i.Path.__type===_g.d._dataContractName)u=i.Path;else if(i.Path.__type===_g.P._dataContractName){_j.e.a(_bs.H.a,"UpdateCalendarItem-SetReminderItemProperty: ExtendedPropertyUri is not handled for reminders.");return}else throw Error.argument(String.format("UpdateCalendarItem-SetReminderItemProperty: Property path type {0} is not supported.",Object.getType(i.Path).getName()));var r=null;if(i.Item.__type===_g.z._dataContractName)r=i.Item;else throw Error.argument(String.format("UpdateCalendarItem-SetReminderItemProperty: Property update item type {0} is not supported.",Object.getType(i.Item).getName()));switch(u.FieldURI){case"Subject":n.Subject=r.Subject;break;case"Start":var e=_a.d.b(r.Start);n.StartDate=r.Start;n.ReminderTime=_a.d.o(e.p(-t.ReminderMinutesBeforeStart));break;case"ReminderMinutesBeforeStart":var f=_a.d.b(n.StartDate);n.ReminderTime=_a.d.o(f.p(-t.ReminderMinutesBeforeStart));break;case"End":n.EndDate=r.End;break;case"EnhancedLocation":n.Location=r.Location?r.Location.DisplayName:null;break;default:_j.e.a(_bs.H.a,"UpdateCalendarItem-SetReminderItemProperty: Field uri {0} is not handled for reminders.",u.FieldURI);break}}};_bs.p=function(n,t,i){_bs.p.initializeBase(this,[n,t,i,i.Body.ItemChanges.length,_bs.p.a]);this.k=new Array(this.o);this.i=new _g.eQ;this.i.Header=_bs.B.a;this.i.Body.ResponseMessages=new _gg.k;this.i.Body.ResponseMessages.Items=this.k;this.a.itemIds=new Array(i.Body.ItemChanges.length)};_bs.p.b=function(n,t,i){var r=new _g.W;r.ExtendedFieldURI=t;r.Value=i;_bs.p.c(n,r)};_bs.p.c=function(n,t){if(n.ExtendedProperty){for(var i=0;i<n.ExtendedProperty.length;i++)if(n.ExtendedProperty[i].ExtendedFieldURI.PropertySetId===t.ExtendedFieldURI.PropertySetId&&n.ExtendedProperty[i].ExtendedFieldURI.PropertyTag===t.ExtendedFieldURI.PropertyTag&&n.ExtendedProperty[i].ExtendedFieldURI.PropertyId===t.ExtendedFieldURI.PropertyId&&n.ExtendedProperty[i].ExtendedFieldURI.DistinguishedPropertySetId===t.ExtendedFieldURI.DistinguishedPropertySetId){n.ExtendedProperty[i]=t;return}var r=[];Array.addRange(r,n.ExtendedProperty);Array.add(r,t);n.ExtendedProperty=r}else{n.ExtendedProperty=new Array(1);n.ExtendedProperty[0]=t}};_bs.p.prototype={i:null,k:null,l:function(){return"UpdateItem"},I:function(n,t){_bs.R.c(this.c.e(),n,t,_bs.p.a)},br:function(){return _bs.bJ.b(this.a)},bp:function(){return this.b.Body.ComplianceId},bq:function(){return 1},bK:function(n,t,i){this.g(n,t,i)},bL:function(n,t,i){var r=this;_bs.cO.prototype.bL.call(this,function(){r.a.clientStoreBodyValue=null;n()},t,i)},bJ:function(n,t,i,r){var o=this.b.Body.ItemChanges[n];var f=o.ItemId;this.bl(f);_j.e.a(_bs.p.a,"ExecuteCurrentStep called for step={0}. {1}",n.toString(),this.d);var u=new _g.eR;u.ResponseCode="NoError";u.ResponseClass="Success";if(this.b.Body.MessageDisposition==="SaveOnly"){u.Items=[new _g.L];u.Items[0].ItemId=f}this.k[n]=u;if(!this.a.clientStoreItem){_j.e.a(_bs.p.a,"ClientStoreItem.None was passed. Request will be sent to the server. {0}",this.d);t();return}if(this.a.resendItemId){_j.e.a(_bs.p.a,"Action is a resend of outbox item. itemId: {0}",this.a.resendItemId.Id);this.a.itemIds[n]=this.a.resendItemId;t();return}if(this.a.clientStoreItem===2)if(this.b.Body.MessageDisposition==="SendAndSaveCopy"){_j.e.a(_bs.p.a,"Moving Draft item to Outbox. {0}",this.d);var s=this;this.R(f,function(t,i){return s.w(f,o,n,t,i)},u,t,i)}else if(this.a.outboxItemId){_j.e.a(_bs.p.a,"Moving Outbox item back to Drafts. {0}",this.d);var e=this;this.S(function(n){var i=new _g.K;e.r(i,f,e.a.parentFolderId,!0,!1);var t=e.c.a().fromData(i);e.s(n,t.get_data(),o.Updates);return t},!1,this.k[n],t,i)}else{_j.e.a(_bs.p.a,"Updating MessageItem. {0}",this.d);this.Y(o,f,n,t,i)}else{_j.e.b(_bs.p.a,"ClientStoreItem is not supported. ClientStoreItem={0}. {1}",this.a.clientStoreItem,this.d);t()}},Y:function(n,t,i,r,u){_j.e.a(_bs.p.a,"Opening a transaction to update a MessageItem. {0}",this.d);var f=this,o=this,e=this;this.O(new _e.a("UpdateItem.UpdateMessageItem",!1),function(i){_j.e.a(_bs.p.a,"Getting a MessageItem for update. {0}",f.d);f.c.a().d(i,_bs.d.a(t.Id),function(r){if(_j.F.a(r)){_j.e.b(_bs.p.a,"Message with id {0} was not found in client store. {1}",t.Id,f.d);return}_j.e.a(_bs.p.a,"MessageItem retrieved for update. {0}",f.d);f.s(i,r,n.Updates);var u=r;_j.h.d(f.a.bodySubstring)||_bs.c.d(u,null,f.a.bodySubstring);_j.e.a(_bs.p.a,"Message with updates going to client store via update ItemId={0}; Subject{1}. {2}",JsonParser.serialize(u.ItemId),u.Subject,f.d)})},function(){_j.e.a(_bs.p.a,"Successfully updated message in local store. {0}",o.d);r()},function(n){_j.e.a(_bs.p.a,"Reporting store error {0}. {1}",n.a,e.d);e.j(e.k[i],new _bs.b(n),u)})},s:function(n,t,i){this.m(n,t,i);var r=t;this.a.isUpdatingRightsManagementLicenseData&&(r.RightsManagementLicenseData=this.a.rightsManagementLicenseData);r.LastModifiedTime=_a.d.d(_a.d.a())},w:function(n,t,i,r,u){_a.b.a(this.a.outboxFolderId,"OutboxFolderId");var e=!!r;var f;if(e)f=_ff.i.b(r.get_data());else{_j.e.a(_bs.p.a,"Message with id {0} not found in local store",n.Id);f=new _g.K}this.r(f,n,this.a.outboxFolderId,!1,e);f.ItemId=_bc.OutboxItemContext.b(f.ItemId,_bs.p.a);this.a.itemIds[i]=f.ItemId;this.m(u,f,t.Updates);return this.c.e().fromData(f)},r:function(n,t,i,r,u){if(!u){n.DateTimeCreated=_a.d.d(_a.d.a());n.DateTimeReceived||(n.DateTimeReceived=n.DateTimeCreated);n.ItemId=new _g.e(t.Id);n.ItemId.ChangeKey=t.ChangeKey;n.InstanceKey="INSK:"+(new _bc.h).a}n.ParentFolderId=i;_bs.c.d(n,null,this.a.bodySubstring);n.IsDraft=r;this.a.isUpdatingRightsManagementLicenseData&&(n.RightsManagementLicenseData=this.a.rightsManagementLicenseData);this.a.conversationId&&(n.ConversationId=this.a.conversationId)},m:function(n,t,i){for(var r=t,e=0;e<i.length;e++){var o=i[e];if(o&&o.__type===_g.bi._dataContractName){var l=o.Path;if("From"===l.FieldURI){r.From=null;continue}else{var h=o.Path;if(h.DistinguishedPropertySetId==="Sharing"&&h.PropertyId===35356)continue}}var s=i[e];var c=s.Path;var u=s.Item;if(!c||!u)break;switch(c.FieldURI){case"BccRecipients":r.BccRecipients=u.BccRecipients;break;case"Body":r.Body=u.Body.BodyType==="HTML"?new _g.s(this.a.isTextBodyValue?"Text":u.Body.BodyType,this.a.clientStoreBodyValue):u.Body;(r.__type===_g.bs._dataContractName||r.__type===_g.bO._dataContractName||r.__type===_g.bJ._dataContractName)&&(r.__type=_g.K._dataContractName);break;case"CcRecipients":r.CcRecipients=u.CcRecipients;break;case"Importance":r.Importance=u.Importance;break;case"Subject":r.Subject=u.Subject;break;case"From":r.From=u.From;break;case"ToRecipients":r.ToRecipients=u.ToRecipients;r.DisplayTo=this.P(u.ToRecipients);break;case"IsRead":this.X(n,r,u.IsRead);break;case"Flag":this.W(n,r,u.Flag);break;case"ItemPolicyTag":r.PolicyTag=u.PolicyTag;break;case"ItemArchiveTag":r.ArchiveTag=u.ArchiveTag;break;case"Sensitivity":r.Sensitivity=u.Sensitivity;break;case"IsDeliveryReceiptRequested":r.IsDeliveryReceiptRequested=u.IsDeliveryReceiptRequested;break;case"IsReadReceiptRequested":r.IsReadReceiptRequested=u.IsReadReceiptRequested;break;case"ItemClass":r.ItemClass=u.ItemClass;break;case"ModernReminders":r.ModernReminders=u.ModernReminders;break;case"MimeContent":r.MimeContent=u.MimeContent;break;default:var f=s.Path;if(f.DistinguishedPropertySetId==="Sharing"&&f.PropertyId===35356)continue;if(f.DistinguishedPropertySetId==="Common")if(f.PropertyId===34229){_bs.p.b(r,f,u.ExtendedProperty[0].Value);break}else if(f.PropertyId===34232){_bs.p.b(r,f,u.ExtendedProperty[0].Value);break}else if(f.PropertyId===34230){_bs.p.b(r,f,u.ExtendedProperty[0].Value);break}else if(f.PropertyId===34231){_bs.p.b(r,f,u.ExtendedProperty[0].Value);break}if(f.DistinguishedPropertySetId==="InternetHeaders"&&(f.PropertyName==="X-Ms-Exchange-Organization-Dlp-SenderOverrideJustification"||f.PropertyName==="X-Ms-Exchange-Organization-Dlp-FalsePositive"))break;if(f.DistinguishedPropertySetId==="PublicStrings"&&f.PropertyName.startsWith("cecp-")){_bs.p.b(r,f,u.ExtendedProperty[0].Value);break}break}}},X:function(n,t,i){if(t.IsRead!==i){t.IsRead=i;var r=this;this.c.c().bindIn(n,_bs.d.a(t.ParentFolderId.Id),function(u){if(u){var f=u.get_data();i&&f.UnreadCount>0?f.UnreadCount--:i||f.UnreadCount++;u.b(n,null);if(t.ConversationId&&t.ConversationId.Id){var e=_bs.Y.a(t.ParentFolderId,t.ConversationId);r.c.d().bindIn(n,e,function(r){if(r){for(var u=r.get_data(),e=!1,f=0;f<u.ItemIds.length;f++)if(u.ItemIds[f].Id===t.ItemId.Id){e=!0;break}if(e){i&&u.UnreadCount>0?u.UnreadCount--:i||u.UnreadCount++;r.b(n,null)}}},null)}}},null)}},W:function(n,t,i){_a.b.g(this.a.flag,null,"UpdateItemContext.Flag can't be null when Flag is being updated.");_a.b.f(this.a.flag.FlagStatus,i.FlagStatus,"UpdateItemContext.Flag.FlagStatus should match the FlagStatus in SetItemPropertyUpdate.");t.Flag=this.a.flag;if(t.ConversationId){var u=_bs.Y.a(t.ParentFolderId,t.ConversationId);var r=this;this.c.d().bindIn(n,u,function(u){if(u)if(r.a.isFlagConversation){u.get_data().FlagStatus=r.a.flag.FlagStatus;u.b(n,null)}else r.v(n,t,i.FlagStatus,u)},null)}},v:function(n,t,i,r){for(var u=r.get_data(),e=[],o=!1,f=0;f<u.ItemIds.length;f++)u.ItemIds[f].Id===t.ItemId.Id?o=!0:Array.add(e,_bs.d.a(u.ItemIds[f].Id));if(o){var s=u.FlagStatus;if(i>=s||!e.length){u.FlagStatus=i;r.b(n,null);return}var c=this,h=this;this.c.a().bindMultipleIn(n,e,function(t){for(var f=0;f<t.length;f++){t[f].get_data().Flag.FlagStatus>i&&(i=t[f].get_data().Flag.FlagStatus);if(i==="Flagged"){u.FlagStatus=i;r.b(n,null);break}}u.FlagStatus=i;r.b(n,null)},function(n){_j.e.c(_bs.p.a,"Error binding to messages in conversation with id {0}, Error {1}",u.ConversationId.Id,n.a())})}}};_bs.dU=function(n,t,i,r,u){_bs.dU.initializeBase(this,[n,t,r,u]);_a.b.b(i,"personaId");_a.b.c(i.Id,"personaId.Id");this.d=i};_bs.dU.prototype={d:null,l:function(){return"UpdatePersona"},bK:function(n,t,i){if(this.e===_bs.a.z){i(-1);return}this.g(n,t,i)},bL:function(n,t,i){var r=this,f=this,u=this;this.h(function(n){var t=_bs.A.a(r.c);t.c(n,r.d,function(i){if(i){_bs.a.w(i,r.i);t.l(n,i,function(){t.b(n,i,0,null)})}r.b=i},null)},function(){n()},function(n){_bs.b.a(n,t)})}};_bs.cd=function(n,t,i,r){_bs.cd.initializeBase(this,[n,t,i]);_a.b.b(r,"syncManager");this.e=r;this.d=new _g.fX;this.d.Header=_bs.B.a};_bs.cd.prototype={d:null,e:null,l:function(){return"GetReminders"},bK:function(n,t,i){if(this.k()){var r=this;this.i(3,new _a.cp,function(u){if(u)r.g(n,t,i);else{_j.e.a(_bs.cd.a,"Rejecting the call as the reminderm module is not synced");i(301)}})}else i(100)},bL:function(n,t,i){var r=this,u=this;_bs.J.e(this.c.g(),this.b.Body.MaxItems,this.b.Body.BeginTime,this.b.Body.EndTime,function(t){r.d.Body.ResponseCode="NoError";r.d.Body.ResponseClass="Success";r.d.Body.Reminders=new Array(t.length);for(var i=0;i<t.length;++i){var u=t[i].get_data();r.d.Body.Reminders[i]=u}n()},function(n){u.d.Body.ResponseCode="ErrorDataSourceOperation";u.d.Body.ResponseClass="Error";u.d.Body.MessageText=n.a();t(n)})},i:function(n,t,i){this.e.a(n,t,i)},k:function(){return this.b.Body.ReminderType===1||this.b.Body.ReminderType===2||this.b.Body.ReminderType===3?!1:!0}};_bs.cR=function(n,t,i){this.d=Function.createDelegate(this,this.e);_bs.cR.initializeBase(this,[n,t,i])};_bs.cR.prototype={l:function(){return"UpdateViewStateConfiguration"},bK:function(n,t,i){this.g(n,t,i)},bL:function(n,t,i){this.u().w(this.d,n,t)},e:function(n){for(var r=this.b.Body.UserConfiguration.Dictionary,u=r.length,i=0;i<u;++i){var t=r[i];switch(t.DictionaryKey.Value[0]){case"CalendarViewTypeNarrow":n.CalendarViewTypeNarrow=Number.parseInvariant(t.DictionaryValue.Value[0]);break;case"CalendarViewTypeWide":n.CalendarViewTypeWide=Number.parseInvariant(t.DictionaryValue.Value[0]);break;case"CalendarViewTypeDesktop":n.CalendarViewTypeDesktop=Number.parseInvariant(t.DictionaryValue.Value[0]);break;case"CalendarSidePanelIsExpanded":n.CalendarSidePanelIsExpanded=Boolean.parse(t.DictionaryValue.Value[0]);break;case"FolderViewState":n.FolderViewState=t.DictionaryValue.Value;break;case"SchedulingViewType":n.SchedulingViewType=Number.parseInvariant(t.DictionaryValue.Value[0]);break;case"SchedulingLastUsedRoomListName":n.SchedulingLastUsedRoomListName=t.DictionaryValue.Value[0];break;case"SchedulingLastUsedRoomListEmailAddress":n.SchedulingLastUsedRoomListEmailAddress=t.DictionaryValue.Value[0];break;case"SearchHistory":n.SearchHistory=t.DictionaryValue.Value;break;case"CalendarSidePanelMonthPickerCount":n.CalendarSidePanelMonthPickerCount=Number.parseInvariant(t.DictionaryValue.Value[0]);break;case"SelectedCalendarsDesktop":n.SelectedCalendarsDesktop=t.DictionaryValue.Value;break;case"SelectedCalendarsTWide":n.SelectedCalendarsTWide=t.DictionaryValue.Value;break;case"SelectedCalendarsTNarrow":n.SelectedCalendarsTNarrow=t.DictionaryValue.Value;break;case"AttachmentsFilePickerViewTypeMouse":n.AttachmentsFilePickerViewTypeForMouse=Number.parseInvariant(t.DictionaryValue.Value[0]);break;case"AttachmentsFilePickerViewTypeTouch":n.AttachmentsFilePickerViewTypeForTouch=Number.parseInvariant(t.DictionaryValue.Value[0]);break;case"AttachmentsFilePickerHideBanner":n.AttachmentsFilePickerHideBanner=Boolean.parse(t.DictionaryValue.Value[0]);break;case"BookmarkedWeatherLocations":n.BookmarkedWeatherLocations=t.DictionaryValue.Value;break;case"CurrentWeatherLocationBookmarkIndex":n.CurrentWeatherLocationBookmarkIndex=Number.parseInvariant(t.DictionaryValue.Value[0]);break;case"CalendarAgendaViewIsExpandedMouse":n.CalendarAgendaViewIsExpandedMouse=Boolean.parse(t.DictionaryValue.Value[0]);break;case"CalendarAgendaViewIsExpandedTWide":n.CalendarAgendaViewIsExpandedTWide=Boolean.parse(t.DictionaryValue.Value[0]);break;case"SystemCategoriesToShowAsFilter":n.SystemCategoriesToShowAsFilter=t.DictionaryValue.Value;break;case"SystemCategoriesToShowInFolderPane":n.SystemCategoriesToShowInFolderPane=t.DictionaryValue.Value;break;case"UserCategoriesToShowAsFilter":n.UserCategoriesToShowAsFilter=t.DictionaryValue.Value;break;case"UserCategoriesToShowInFolderPane":n.UserCategoriesToShowInFolderPane=t.DictionaryValue.Value;break;case"ShowCategoryColumnOnMessageItems":n.ShowCategoryColumnOnMessageItems=Boolean.parse(t.DictionaryValue.Value[0]);break;case"FocusedViewWatermark":n.FocusedViewWatermark=t.DictionaryValue.Value[0];break;case"FocusedInboxBitFlags":n.FocusedInboxBitFlags=Number.parseInvariant(t.DictionaryValue.Value[0]);break;case"ClutterViewWatermark":n.ClutterViewWatermark=t.DictionaryValue.Value[0];break;case"SelectedBookingMailbox":n.SelectedBookingMailbox=t.DictionaryValue.Value[0];break;case"SelectedBookingSubModule":n.SelectedBookingSubModule=Number.parseInvariant(t.DictionaryValue.Value[0]);break;case"BookingCalendarViewType":n.BookingCalendarViewType=Number.parseInvariant(t.DictionaryValue.Value[0]);break;case"BookingSidePanelIsExpanded":n.BookingSidePanelIsExpanded=Boolean.parse(t.DictionaryValue.Value[0]);break;case"EdgePromotionRejectedLast":n.EdgePromotionRejectedLast=Boolean.parse(t.DictionaryValue.Value[0]);break}}}};_bs.M=function(n){_bs.M.initializeBase(this,[n])};_bs.M.b=function(n){if(n.Body&&n.Body.Value)if(n.Body.BodyType==="Text"){n.TextBody=n.Body;var f=_a.A.b(n.TextBody.Value);n.Body=new _g.s("HTML",f);_j.e.a(_a.a.n,"Created Body from TextBody for new created item with client id {0}",n.ItemId.Id)}else{var i=_a.A.H(n.Body.Value);i||(i=n.Body.Value);var t=null;var u,r;if(r=_a.A.E(i,u={val:t}),t=u.val,r)_j.e.a(_a.a.n,"Created TextBody from body for new created item with client id {0}",n.ItemId.Id);else{_j.e.b(_a.a.n,"HTML body couldn't be converted to TEXT for item with client id {0}. Setting Text body to empty.",n.ItemId.Id);t=""}n.TextBody=new _g.s("Text",t)}};_bs.M.prototype={c:function(n,t,i,r){var e=_a.d.b(t.Start);var o=_a.d.o(e.p(-t.ReminderMinutesBeforeStart));var u=new _g.dF(t.Subject,o,t.Start,t.End,i,t.UID);t.Location&&(u.Location=t.Location.DisplayName);var f=this.b.g().fromData(u);f.b(n,r)},a:function(n,t,i){var f=this.b.b();if(i.CalendarItemType==="RecurringMaster"){_j.e.a(_bs.M.a,"Item {0} is a recurring master. Deleteting occurrences/exceptions and master",t);var u=_bs.bL.a(this.b);var o=this;u.d(n,t,function(){});var r=new _e.b(_bs.J.c,i.UID);var e=this;this.b.g().f(n,r,function(){});this.b.f().b(n,t)}else{f.b(n,t);this.f(n,t)}},g:function(n,t,i,r){var f=new _bs.bC(this.b.i(),"CalendarSyncState");var u=this,e=this;f.c(function(f){u.e(f,n,t,i,r)},function(n){r()})},h:function(n,t,i,r,u){var e=new _bs.bC(this.b.i(),"CalendarSyncState");var f=this;e.k(n,function(n){f.e(n,t,i,r,u)})},d:function(n,t,i,r){var u=this;this.b.b().bindIn(n,_bs.d.a(t.OccurrenceId),function(n){if(!n||!n.get_data()){_j.e.b(_bs.M.a,"Occurrence item with id {0} could no be found in client store.",t.OccurrenceId);r();return}_j.e.a(_bs.M.a,"Occurrence item with id {0} found in client store. Master Uid is {1}.",n.a(),n.c());i(n.c())},null)},e:function(n,t,i,r,u){if(!n){_j.e.b(_bs.M.a,"No calendar sync state was found. Considering item outside sync range.");u();return}var f=n.get_data();if(!f.IsSynced){_j.e.a(_bs.M.a,"Calendar isn't synced. Considering item outside sync range.");u();return}var s=_a.d.b(t);var h=_a.d.b(i);var e=_a.d.b(f.WindowStart);var o=_a.d.b(f.WindowEnd);h.b(e)<0||s.b(o)>0?u():r()},f:function(n,t){var i=this.b.g();var r=this;i.bindIn(n,t,function(r){if(!r||!r.get_data()){_j.e.b(_bs.M.a,"Reminder item with id {0} could no be found in client store.",t);return}_j.e.a(_bs.M.a,"Reminder item with id {0} found in client store. Deleting it.",r.a());i.b(n,t);_j.e.a(_bs.M.a,"Successfully deleted reminder item with id {0} from client store.",r.a())},null)}};_bs.cK=function(n){_bs.cK.initializeBase(this,[n])};_bs.cK.prototype={e:function(n,t,i,r,u,f,e){_a.b.a(n,"tx");_a.b.a(t,"conversationId");_a.b.a(i,"itemPartToAdd");_a.b.c(r,"parentConversationNodeId");_a.b.a(f,"mailboxDataContext");_a.b.a(e,"successCallback");_j.e.a(_bs.f.a,"Adding itemPart with id {0} to conversation with id {1}",i.ItemId.Id,t.Id);var o=this;this.f(n,t,i,r,u,function(u){if(!u){_j.e.a(_bs.f.a,"ConversationNode not found in the clientstore. Hence, not updating conversation metadata properties also");e(!1);return}o.h(n,t,i,r,f);if(i.ConversationId&&i.ConversationId!==t)throw Error.invalidOperation(String.format("The itemPartToAdd already has a different conversationId. conversationId = {0}, itemPartToAdd.ConversationId = {1}",t.Id,i.ConversationId.Id));else i.ConversationId=t;_j.e.a(_bs.f.a,"Successfully added itempart to the conversation");e(!0)})},a:function(n,t,i,r,u,f){_a.b.a(t,"conversationId");_a.b.a(i,"itemOriginalParentFolderId");_a.b.a(r,"itemPartToRemove");_a.b.a(u,"mailboxDataContext");_a.b.a(f,"successCallback");_j.e.a(_bs.f.a,"Removing itemPart with id {0} from conversation with id {1}",r.ItemId.Id,t);var e=this;this.g(n,t,r,u,function(o){_j.e.a(_bs.f.a,"Successfully updated the conversationNodeItem. Retreived parentConversationIndex = ",o);e.i(n,t,i,r,u);f(o)})},f:function(n,t,i,r,u,f){var e=this;this.b.k().bindIn(n,_bs.d.a(t.Id),function(t){if(!t){_j.e.a(_bs.f.a,"ConversationNodeItem not found in the clientstore. Hence, not adding the itempart");f(!1);return}var s=t.get_data();var c=(new _bc.h).b.Id;var o=new _g.cg(c);o.ParentInternetMessageId=r;var h=_bs.bl.a(i);o.Items=[h];u?Array.insert(s.ConversationNodes,0,o):Array.add(s.ConversationNodes,o);s.LastModifiedTime=e.d(s.LastModifiedTime);t.b(n,null);_j.e.a(_bs.f.a,"Successfully updated and saved the conversationNodeItem");f(!0)},null)},g:function(n,t,i,r,u){var f=this;this.b.k().bindIn(n,_bs.d.a(t.Id),function(e){if(!e){_j.e.a(_bs.f.a,"ConversationNodeItem not found in the clientstore. Hence, not removing the itempart");u(null);return}for(var h=e.get_data(),a=null,l=!1,c=0;c<h.ConversationNodes.length;c++){var o=h.ConversationNodes[c];if(o.Items.length===1&&f.c(o.Items[0].ItemId,i.ItemId,r)){a=o.ParentInternetMessageId;_j.e.a(_bs.f.a,"Removing the whole ConversationNode at index {0}",c);Array.removeAt(h.ConversationNodes,c);l=!0;break}else for(var s=0,s=0;s<o.Items.length;s++){var v=o.Items[s];if(f.c(v.ItemId,i.ItemId,r)){_j.e.a(_bs.f.a,"Removing the item at index {0}",s);Array.removeAt(o.Items,s);l=!0;break}}if(l)break}if(l){h.LastModifiedTime=f.d(h.LastModifiedTime);if(h.ConversationNodes.length){e.b(n,null);_j.e.a(_bs.f.a,"Successfully removed item from the conversationNode")}u(a)}else{_j.e.a(_bs.f.a,"ItemId {0} not removed from conversationNode with id {0}",i.ItemId.Id,t.Id);u(null)}},null)},h:function(n,t,i,r,u){_j.e.a(_bs.f.a,"Update metadata properties for all conversations with id {0} for addition. The itempart added has id {1}",t,i.ItemId.Id);var f=this;_bs.C.c(n,this.b.d(),t,function(t){for(var c=t,y=c.length,s=0;s<y;++s){for(var v=c[s],r=v.get_data(),a=r.GlobalItemIds,p=a.length,h=0;h<p;++h){var w=a[h];if(f.c(w,i.ItemId,u))throw Error.invalidOperation(String.format("itempart is already a part of the conversation, id = {0}, GlobalItemIds = [{1}]",i.ItemId.Id,r.GlobalItemIds.join(",")));}var e=new _g.e(i.ItemId.Id);e.ChangeKey=i.ItemId.ChangeKey;Array.add(r.GlobalItemIds,e);if(i.IsDraft&&!i.IsSubmitted)if(r.DraftItemIds){for(var l=!1,o=0;o<r.DraftItemIds.length;o++)if(r.DraftItemIds[o].Id===e.Id){l=!0;r.DraftItemIds[o]=e;break}l||Array.add(r.DraftItemIds,e)}else r.DraftItemIds=[e];r.GlobalMessageCount++;r.LastModifiedTime=f.d(r.LastModifiedTime);v.b(n,null)}})},i:function(n,t,i,r,u){_j.e.a(_bs.f.a,"Update metadata properties for all conversations with id {0} for remove. The itempart removed has id {1}",t,r.ItemId.Id);var f=this;_bs.C.c(n,this.b.d(),t,function(t){for(var v=t,p=v.length,l=0;l<p;++l){for(var c=v[l],e=c.get_data(),y=!1,o=0;o<e.GlobalItemIds.length;o++){var a=e.GlobalItemIds[o];if(a.Id===r.ItemId.Id){Array.removeAt(e.GlobalItemIds,o);if(e.DraftItemIds)for(var s=0;s<e.DraftItemIds.length;s++)e.DraftItemIds[s].Id===a.Id&&Array.removeAt(e.DraftItemIds,s);y=!0}}if(y){if(e.GlobalMessageCount<=0)throw Error.invalidOperation("conversation.GlobalMessageCount "+e.GlobalMessageCount+" is less than or equal to 0");e.GlobalMessageCount--;if(!_j.z.a(r.IsRead)&&!r.IsRead){if(e.GlobalUnreadCount<=0)throw Error.invalidOperation("conversation.GlobalUnreadCount "+e.GlobalUnreadCount+" is less than or equal to 0");e.GlobalUnreadCount--}if(e.MessageCount<=0)throw Error.invalidOperation("conversation.MessageCount "+e.MessageCount+" is less than or equal to 0");if(e.FolderId.Id===i.Id){e.MessageCount--;if(!_j.z.a(r.IsRead)&&!r.IsRead){if(e.UnreadCount<=0)throw Error.invalidOperation("conversation.UnreadCount "+e.UnreadCount+" is less than or equal to 0");e.UnreadCount--}for(var h=0;h<e.ItemIds.length;h++)f.c(e.ItemIds[h],r.ItemId,u)&&Array.removeAt(e.ItemIds,h)}e.LastModifiedTime=f.d(e.LastModifiedTime);if(e.ItemIds.length){c.b(n,null);_j.e.a(_bs.f.a,"Saved the updated conversation object")}else{e.MessageCount&&_j.e.b(_bs.f.a,"ConversationHelper.UpdateConversationMetadataForRemove, Conversation.ItemIds.length == 0 but conversation MessageCount = {0}",e.MessageCount);c.e(n);_j.e.a(_bs.f.a,"Last itemPart for this folder in this conversation, hence deleted the listView entry for this conversation")}}else _j.e.a(_bs.f.a,"ItemPart not found in the GlobalItemIds list, conversation JSON = {0}",JsonParser.serialize(e))}})},c:function(n,t,i){return n.Id===t.Id||n.Id===i.q(t).Id||i.q(n).Id===t.Id},d:function(n){return _a.d.b(n).l(1).i()}};_bs.ce=function(n){_bs.ce.initializeBase(this,[n])};_bs.ce.a=function(n,t){return!n.IsRead&&!_g.b.a.doesIdEqualName(t,"outbox")&&!_g.b.a.doesIdEqualName(t,"drafts")?1:0};_bs.ce.prototype={d:function(n,t,i,r,u,f){_a.b.a(n,"tx");_a.b.a(t,"conversationHelper");_a.b.a(r,"messageItemId");_a.b.a(f,"mailboxDataContext");var e=this;this.b.a().bindIn(n,_bs.d.a(r.Id),function(o){if(!o){_j.e.b(_bs.f.a,"Message item with id {0} was not found in the client store.",r.Id);return}e.c(n,t,i,o,u,f)},null)},a:function(n,t,i){_a.b.a(n,"tx");_a.b.a(t,"outboxItemId");_a.b.a(i,"mailboxDataContext");var r=this;this.b.e().bindIn(n,_bs.d.a(t.Id),function(u){if(!u){_j.e.b(_bs.f.a,"Outbox item with id {0} was not found in the client store.",t.Id);return}r.c(n,null,"HardDelete",u,null,i,!0)},null)},c:function(n,t,i,r,u,f,e){_a.b.a(n,"tx");_a.b.a(f,"mailboxDataContext");e||_a.b.a(t,"conversationHelper");_a.b.a(r,"messageItem");i==="MoveToDeletedItems"&&_a.b.a(u,"deletedItemsFolderId");var o=r.get_data();var c=o.IsRead?0:1;var s=new _g.l(o.ParentFolderId.Id);var h=_bs.ce.a(o,s);if(i==="MoveToDeletedItems"&&o.ParentFolderId.Id!==u.Id){o.ParentFolderId=u;r.b(n,null);this.b.c().l(n,s,1,h);this.b.c().g(n,o.ParentFolderId,1,c)}else{_j.e.a(_a.a.bc,"Deleting the message with id {0}",o.ItemId.Id);r.e(n);this.b.c().l(n,s,1,h)}if(!e&&o.ConversationId){var l=this;t.a(n,o.ConversationId,s,o,f,function(n){})}}};_bs.bJ=function(){};_bs.bJ.a=function(n){var t=new _bs.bJ;t.d=n.inboxFolderId;t.f=n.outboxFolderId;t.c=n.outboxItemId;t.g=n.parentFolderId;t.b=n.conversationId;t.a=n.parentConversationNodeId;t.e=n.itemPartsOrderDescending;return t};_bs.bJ.b=function(n){var t=new _bs.bJ;t.d=n.inboxFolderId;t.f=n.outboxFolderId;t.c=n.outboxItemId;t.g=n.parentFolderId;t.b=n.conversationId;t.a=n.parentConversationNodeId;t.e=n.itemPartsOrderDescending;return t};_bs.bJ.prototype={d:null,f:null,c:null,g:null,b:null,a:null,e:!1,get_inboxFolderId:function(){return this.d},get_outboxFolderId:function(){return this.f},get_outboxItemId:function(){return this.c},get_parentFolderId:function(){return this.g},get_conversationId:function(){return this.b},get_parentConversationNodeId:function(){return this.a},get_itemPartsOrderDescending:function(){return this.e}};_bs.ek=function(n){_a.b.a(n,"itemStoreGetter");this.b=n};_bs.ek.prototype={b:null};_bs.dS=function(n){this.b=new _bs.ce(n);this.c=new _bs.cK(n)};_bs.dS.prototype={b:null,c:null,a:function(){return this.b}};CoreStorageComponent.registerClass("CoreStorageComponent",null,_a.jw,_j.ce);AddressbookPostalAddress.registerClass("AddressbookPostalAddress");AddressbookEmailAddressInfo.registerClass("AddressbookEmailAddressInfo");AddressbookItemMetaData.registerClass("AddressbookItemMetaData");AddressbookPhoneNumberInfo.registerClass("AddressbookPhoneNumberInfo");AddressbookPostalAddressInfo.registerClass("AddressbookPostalAddressInfo");_bs.cU.registerClass("_bs.cU");_bs.cV.registerClass("_bs.cV",_bs.cU);_bs.k.registerClass("_bs.k");_bs.bK.registerClass("_bs.bK",_bs.k);_bs.j.registerClass("_bs.j",null,_bc.bz);_bs.x.registerClass("_bs.x",_bs.cy.$$(AttachmentInfoRecord),_bc.Q,_bc.bz);ItemMetadata.registerClass("ItemMetadata");AttachmentInfoMetadata.registerClass("AttachmentInfoMetadata",ItemMetadata);_bs.cg.registerClass("_bs.cg",_bs.bO.$$(_bc.Q,_bs.x),_bc.R,_bc.bB);_bs.cW.registerClass("_bs.cW");CustomSyncData.registerClass("CustomSyncData");_bs.n.registerClass("_bs.n",_a.br);_bs.dc.registerClass("_bs.dc");_bs.T.registerClass("_bs.T",_bs.k);_bs.bm.registerClass("_bs.bm",_bs.bO.$$(_bc.bw,_bs.I),_bc.bx,_bc.bB);_bs.bP.registerClass("_bs.bP",null,_bc.G);_bs.U.registerClass("_bs.U",_bs.cy.$$(_g.L),_bc.A);_bs.R.registerClass("_bs.R",_bs.U,_bc.A);_bs.dl.registerClass("_bs.dl",_bs.cp.$$(_bc.bj,_bs.R),_bc.bF,_bc.bB);_bs.V.registerClass("_bs.V");_bs.bA.registerClass("_bs.bA",_bs.cy.$$(_g.hi),_bc.H,_bc.bz);PersistedDataRecord.registerClass("PersistedDataRecord");_bs.J.registerClass("_bs.J",_bs.cy.$$(_g.dF),_bc.Y,_bc.bz);_bs.d.registerClass("_bs.d",null,_a.iR);_bs.bi.registerClass("_bs.bi",_bs.cy.$$(_g.H),_bc.bg,_bc.bz);ActionItemMetadata.registerClass("ActionItemMetadata",ItemMetadata);_bs.cS.registerClass("_bs.cS",_bs.cy.$$(AddressbookOperation),_bc.bh,_bc.bz);_bs.cT.registerClass("_bs.cT",_bs.cy.$$(AddressbookPersona),_bc.bi,_bc.bz);_bs.dV.registerClass("_bs.dV",null,_a.ky);_bs.cY.registerClass("_bs.cY",_bs.dV);_bs.de.registerClass("_bs.de",_bs.dV);_bs.ct.registerClass("_bs.ct",_bs.dV);_bs.u.registerClass("_bs.u",_bs.cy.$$(_g.z),_bc.t,_bc.br,_bc.bz);CalendarItemMetadata.registerClass("CalendarItemMetadata",ItemMetadata);_bs.Q.registerClass("_bs.Q",_bs.cy.$$(_g.z),_bc.u,_bc.br,_bc.bz);_bs.P.b.registerClass("_bs.P.b");_bs.P.e.registerClass("_bs.P.e",_bs.P.b);_bs.P.d.registerClass("_bs.P.d",_bs.P.e);_bs.P.c.registerClass("_bs.P.c",_bs.P.e);_bs.cX.registerClass("_bs.cX",_bs.k);_bs.ch.registerClass("_bs.ch",_bs.k);_bs.cZ.registerClass("_bs.cZ",_j.bZ,_a.kx,Sys.IDisposable);_bs.b.registerClass("_bs.b",null,_bc.bs);_bs.bj.registerClass("_bs.bj",_bs.cy.$$(_g.bW),_bc.T,_bc.bz);_bs.db.registerClass("_bs.db",_bs.dV);_bs.bN.registerClass("_bs.bN",_bs.co.$$(_bc.bt,_bs.C,_g.ek),_bc.bu,_bc.bB);_bs.bQ.registerClass("_bs.bQ",null,_bs.ea);_bs.ci.registerClass("_bs.ci",_bs.bQ);_bs.e.registerClass("_bs.e",null,_bs.ck);_bs.dd.registerClass("_bs.dd",_bs.bO.$$(_bc.bw,_bs.I),_bc.bv,_bc.bB);_bs.I.registerClass("_bs.I",_bs.cy.$$(_g.gU));_bs.Y.registerClass("_bs.Y",_bs.d);_bs.Y.prototype.toString=_bs.d.prototype.toString;FolderItemMetadata.registerClass("FolderItemMetadata",ItemMetadata);_bs.cl.registerClass("_bs.cl",_bs.cy.$$(InlineImageRecord));_bs.cm.registerClass("_bs.cm",_bs.bO.$$(_bc.by,_bs.cl),_bc.F,_bc.bB);_bs.dh.registerClass("_bs.dh",_bs.dV);_bs.cq.registerClass("_bs.cq",_bs.bQ);_bs.di.registerClass("_bs.di",_bs.bn.$$(_bc.A,_g.L));_bs.bC.registerClass("_bs.bC",null,_bs.eb);_bs.dj.registerClass("_bs.dj",_bs.bC);_bs.cs.registerClass("_bs.cs",_bs.bQ);_bs.dk.registerClass("_bs.dk",_bs.dV);_bs.dm.registerClass("_bs.dm",_bs.dV);_bs.bp.registerClass("_bs.bp",_bs.cy.$$(SyncState),_bc.Z,_bc.bz);_bs.C.registerClass("_bs.C",_bs.cy.$$(_g.ek));ConversationItemMetadata.registerClass("ConversationItemMetadata",ItemMetadata);_bs.bl.registerClass("_bs.bl",_bs.cy.$$(_g.hb),_bc.E,_bc.bz);MessageItemMetadata.registerClass("MessageItemMetadata",ItemMetadata);_bs.bR.registerClass("_bs.bR",_bs.cp.$$(_bc.A,_bs.U),_bc.bE,_bc.bB);_bs.g.registerClass("_bs.g",_bs.cy.$$(PartialPersonaRecord),_bc.X,_bc.bz);_bs.dp.registerClass("_bs.dp",_bs.dV);_bs.dn.registerClass("_bs.dn",_bs.k);_bs.dq.registerClass("_bs.dq",_bs.k,_bs.cu);ConfigChangeCleanupModuleItem.registerClass("ConfigChangeCleanupModuleItem");MessageItemRecord.registerClass("MessageItemRecord",_g.L);_bs.v.registerClass("_bs.v",_bs.cy.$$(SettingRecord),_bc.bk,_bc.bz);_bs.bD.registerClass("_bs.bD",_bs.cy.$$(_g.hq),_bc.I,_bc.bz);_bs.cw.registerClass("_bs.cw",_bs.cy.$$(TombstonedItemRecord));_bs.cx.registerClass("_bs.cx",_bs.bO.$$(_bc.bN,_bs.cw),_bc.bO,_bc.bB);_bs.dr.registerClass("_bs.dr",_bs.bQ);_bs.bB.registerClass("_bs.bB",_bs.k,_bs.cu);_bs.bo.registerClass("_bs.bo",_a.cp);_bs.bS.registerClass("_bs.bS",_bs.k);EmailItemSyncState.registerClass("EmailItemSyncState",SyncState);ConversationItemSyncState.registerClass("ConversationItemSyncState",EmailItemSyncState);_bs.ds.registerClass("_bs.ds",_bs.k,_bs.cu);_bs.bT.registerClass("_bs.bT",_bs.bn.$$(_bc.bt,_g.ek));_bs.dt.registerClass("_bs.dt",_bs.bM.$$(_bc.bw,_g.gU));MessageItemSyncState.registerClass("MessageItemSyncState",EmailItemSyncState);_bs.bU.registerClass("_bs.bU",_bs.bn.$$(_bc.A,_g.L));_bs.q.registerClass("_bs.q",_j.R,_bc.bq,_j.bs,Sys.IDisposable);_bs.ec.registerClass("_bs.ec");_bs.bf.registerClass("_bs.bf",_gg.a,_g.kn);_bs.OfflineCreateItemResponseProcessor.registerClass("_bs.OfflineCreateItemResponseProcessor",_h.CreateItemResponseProcessor);_bs.dv.registerClass("_bs.dv",null,_h.dp,_h.eT);_bs.r.registerClass("_bs.r",_g.k,_bc.n,_g.kC,Sys.IDisposable,_bc.bI);_bs.dw.registerClass("_bs.dw",_g.kq,_g.kn);_bs.dx.registerClass("_bs.dx",_bs.ec);_bs.bd.registerClass("_bs.bd",_bs.q);_bs.bV.registerClass("_bs.bV");_bs.bW.registerClass("_bs.bW",null,_a.gc);_bs.dy.a.registerClass("_bs.dy.a",_e.J);_bs.s.registerClass("_bs.s",_a.bO);_bs.dz.registerClass("_bs.dz",_bs.bW);_bs.bq.registerClass("_bs.bq");_bs.dB.registerClass("_bs.dB",_bs.bq);_bs.dC.registerClass("_bs.dC");_bs.cA.registerClass("_bs.cA");_bs.cz.a.registerClass("_bs.cz.a",null,_bs.ee);_bs.i.registerClass("_bs.i");_bs.W.registerClass("_bs.W",_bs.i);_bs.bF.registerClass("_bs.bF",_bs.i);_bs.dD.registerClass("_bs.dD",_bs.i);_bs.Z.registerClass("_bs.Z",_bs.dD);_bs.Z.a.registerClass("_bs.Z.a");_bs.dG.registerClass("_bs.dG");_bs.dI.registerClass("_bs.dI",_bs.bq);_bs.cE.registerClass("_bs.cE");_bs.bg.f.registerClass("_bs.bg.f",_e.J);_bs.K.registerClass("_bs.K",_a.bO);_bs.cF.registerClass("_bs.cF",_bs.bW);_bs.o.registerClass("_bs.o",null,_a.kw);_bs.bH.registerClass("_bs.bH");_bs.dN.registerClass("_bs.dN",_bs.bH);_bs.dO.registerClass("_bs.dO",_bs.bH);_bs.dP.registerClass("_bs.dP",_bs.bH);_bs.cH.registerClass("_bs.cH",null,_bs.ei);_bs.bt.registerClass("_bs.bt",_j.bZ,_a.kD);_bs.dK.registerClass("_bs.dK",_e.ISqlResultSet);_bs.dL.registerClass("_bs.dL",_e.ISqlResultSetRowList);_bs.bG.registerClass("_bs.bG");_bs.X.registerClass("_bs.X",null,_e.L);_bs.bu.registerClass("_bs.bu",_bs.cO.$$(_g.ea,_g.gT));_bs.bv.registerClass("_bs.bv",_bs.cO.$$(_gg.dF,_gg.lA));_bs.c.registerClass("_bs.c",_bs.cJ.$$(_g.ds,_g.hc));_bs.bw.registerClass("_bs.bw",_bs.cQ.$$(_gg.oN));_bs.cb.registerClass("_bs.cb",_bs.cP.$$(_gg.pl));_bs.bk.registerClass("_bs.bk",_bs.cO.$$(_gg.gg,_gg.pe));_bs.F.registerClass("_bs.F",_bs.cO.$$(_g.em,_g.hd));_bs.bb.registerClass("_bs.bb",_bs.cO.$$(_g.fz,_g.ir));_bs.L.registerClass("_bs.L",_bs.cI.$$(_g.fB,_g.bU));_bs.be.registerClass("_bs.be",_bs.cO.$$(_g.fC,_g.ix));_bs.m.registerClass("_bs.m",_bs.cI.$$(_g.du,_g.br));_bs.cc.registerClass("_bs.cc",_bs.cI.$$(_gg.dR,_gg.lB));_bs.bx.registerClass("_bs.bx",_bs.cO.$$(_g.dw,_g.fT));_bs.bI.registerClass("_bs.bI",_bs.cP.$$(_cz.hn));_bs.cL.registerClass("_bs.cL",_bs.cO.$$(_cz.dm,_cz.eB));_bs.N.registerClass("_bs.N",_bs.cI.$$(_g.fP,_g.fO));_bs.cM.registerClass("_bs.cM",_bs.cP.$$(_g.he));_bs.G.registerClass("_bs.G",_bs.cO.$$(_g.bw,_g.bz));_bs.by.registerClass("_bs.by",_bs.cP.$$(_g.hf));_bs.cN.registerClass("_bs.cN",_bs.cP.$$(_g.iK));_bs.dQ.registerClass("_bs.dQ",_bs.cP.$$(_gg.lQ));_bs.dR.registerClass("_bs.dR",_bs.cI.$$(_gg.hC,_gg.tE));_bs.bz.registerClass("_bs.bz",_bs.cO.$$(_g.gi,_g.je));_bs.S.registerClass("_bs.S",_bs.cI.$$(_gg.iR,_gg.xA));_bs.cf.registerClass("_bs.cf",_bs.cP.$$(_gg.AI));_bs.dT.registerClass("_bs.dT",_bs.cP.$$(_gg.AX));_bs.H.registerClass("_bs.H",_bs.cO.$$(_g.dO,_g.gy));_bs.p.registerClass("_bs.p",_bs.cJ.$$(_g.dO,_g.gy));_bs.dU.registerClass("_bs.dU",_bs.cQ.$$(_gg.DN));_bs.cd.registerClass("_bs.cd",_bs.cI.$$(_g.ey,_g.hg));_bs.cR.registerClass("_bs.cR",_bs.cI.$$(_g.gB,_g.jN));_bs.ek.registerClass("_bs.ek");_bs.M.registerClass("_bs.M",_bs.ek);_bs.cK.registerClass("_bs.cK",_bs.ek,_bc.bJ);_bs.ce.registerClass("_bs.ce",_bs.ek);CoreStorageComponent.$$cctor();_bs.O.a=_a.a.em;_bs.O.b=null;_bs.x.c=new _a.R("Data.MessageID");_bs.x.d=new _a.R("Data.MessageReceivedDateTime");_bs.x.b=new _a.R("Data.AttachmentType");_bs.x.a=new _a.R("Metadata.AttachmentTypeAndSyncStatus");_bs.n.k="ct";_bs.n.j="tct";_bs.n.m="tctbtc";_bs.n.h="tcc";_bs.n.b="ncc";_bs.n.c="nccnc";_bs.n.g="tcnc";_bs.n.a="ncnc";_bs.n.i="tcm";_bs.n.e="nmc";_bs.n.l="tcia";_bs.n.d="noiac";_bs.n.f="notick";_bs.V.a=_a.a.Q;_bs.V.b="OutboxMonitorService";_bs.j.e=_a.a.fG;_bs.j.a=new _a.R("Data.SaveMode");_bs.j.l=new _a.R("Data.LastModifiedOnClient");_bs.j.m=new _a.R("Data.LastSynchronizedToServer");_bs.J.a=200;_bs.J.d=0;_bs.J.b=new _a.R("Data.ReminderTime");_bs.J.c=new _a.R("Data.UID");_bs.bi.b=new _a.R("Data.state");_bs.u.h=_a.a.fF;_bs.u.a=new _a.R("Data.Start");_bs.u.d=new _a.R("Data.End");_bs.u.c=new _a.R("Data.UID");_bs.u.b=new _a.R("Metadata.DurationInHours");_bs.Q.c=new _a.R("Data.UID");_bs.P.a=_a.a.b;_bs.f.a=_a.a.Q;_bs.f.b="UTC";_bs.b.e=new Sys.EventHandlerList;_bs.e.d="15.00.0342.00";_bs.e.c=null;_bs.e.b=[new _a.Q(_bs.j.a,1)];_bs.cl.a=new _a.R("Data.Blob");_bs.z.a=new Array(0);_bs.D.a=new Array(0);_bs.bQ.a=_a.a.cE;_bs.t.a=-1;_bs.bp.a=100;_bs.k.a=_a.a.fH;_bs.g.c=new _a.R("Data.FolderId.Id");_bs.g.g=new _a.R("Data.Persona.PersonaId.Id");_bs.g.i=new _a.R("Data.Persona.DisplayNameFirstLast");_bs.g.a=new _a.R("Data.Persona.DisplayNameFirstLastSortKey");_bs.g.j=new _a.R("Data.Persona.DisplayNameLastFirst");_bs.g.b=new _a.R("Data.Persona.DisplayNameLastFirstSortKey");_bs.g.o=new _a.R("Data.Persona.CompanyName");_bs.g.d=new _a.R("Data.Persona.CompanyNameSortKey");_bs.g.r=new _a.R("Data.Persona.HomeCity");_bs.g.f=new _a.R("Data.Persona.HomeCitySortKey");_bs.g.s=new _a.R("Data.Persona.WorkCity");_bs.g.h=new _a.R("Data.Persona.WorkCitySortKey");_bs.g.e=new _a.R("Data.Persona.CreationTimeString");_bs.g.k=new _a.R("Data.Persona.RelevanceScore");_bs.A.b=null;_bs.A.c=null;_bs.A.$$cctor();_bs.q.a=_a.a.dE;_bs.q.d=new _a.e("LastEnqueuedAction",_g.H,_bs.q);_bs.q.e=new _a.e("RequestAvailable",Boolean,_bs.q,!0);_bs.q.c=new _a.e("CanProcess",Boolean,_bs.q,!0);_bs.q.b=new _a.e("IsEmpty",Boolean,_bs.q,!1);_bs.bf.a="OfflineErrorInfo";_bs.r.a=_a.a.fh;_bs.bd.a=[new _a.ca(_a.R.a,0)];_bs.bd.c=new _a.bk(null,_bs.bd.a);_bs.bd.b=new _a.bk(null,_bs.bd.a);_bs.ba.a=_a.R.a.a;_bs.X.a=_a.a.dx;_bs.bu.a=_a.a.ek;_bs.bv.a=_a.a.c;_bs.c.a=_a.a.ex;_bs.a.u="#";_bs.a.z="DistributionList";_bs.bw.a=_a.a.fv;_bs.cb.a=_a.a.fw;_bs.bk.a=_a.a.c;_bs.F.a=_a.a.eC;_bs.bb.a=_a.a.bc;_bs.L.a=_a.a.eK;_bs.L.$$cctor();_bs.be.a=_a.a.eL;_bs.m.a=_a.a.cn;_bs.m.b=null;_bs.m.$$cctor();_bs.bx.a=_a.a.eP;_bs.bI.a=_a.a.eM;_bs.cL.a=_a.a.dS;_bs.cL.$$cctor();_bs.N.a=_a.a.eN;_bs.N.$$cctor();_bs.cM.a=_a.a.eO;_bs.G.a=_a.a.dT;_bs.G.$$cctor();_bs.by.a=_a.a.ea;_bs.cN.a=_a.a.eQ;_bs.bz.a=_a.a.fe;_bs.S.a=_a.a.fy;_bs.B.a=null;_bs.B.$$cctor();_bs.cf.a=_a.a.fA;_bs.H.a=_a.a.fO;_bs.p.a=_a.a.fQ;_bs.cd.a=_a.a.fx;_bs.cR.a=_a.a.fz;_bs.M.a=_a.a.et;
window.scriptsLoaded['microsoft.owa.core.storage.js'] = 1; window.scriptProcessEnd = window.scriptProcessEnd || {}; window.scriptProcessEnd['microsoft.owa.core.storage.js'] = (new Date()).getTime();
